(this["webpackJsonpvk-mini-apps-empty"]=this["webpackJsonpvk-mini-apps-empty"]||[]).push([[0],{235:function(e,t,a){e.exports=a(415)},326:function(e,t){},328:function(e,t){},361:function(e,t){},362:function(e,t){},415:function(e,t,a){"use strict";a.r(t);a(236),a(262),a(264),a(265),a(267),a(268),a(269),a(270),a(271),a(272),a(273),a(274),a(276),a(277),a(278),a(279),a(280),a(281),a(282),a(283),a(284),a(285),a(287),a(288),a(289),a(290),a(291),a(292),a(293),a(294),a(295),a(296),a(297),a(298),a(299),a(300),a(301),a(302),a(303),a(304);var n=a(0),c=a.n(n),r=a(45),l=a.n(r),o=a(34),i=a.n(o),u=a(10),s=(a(312),a(11)),m=a(176),b=a.n(m),f=a(185),d=a(181),j=a.n(d),O=a(105),g=a.n(O),p=a(177),E=a.n(p),h=a(178),v=a.n(h),S=a(186),k=a(104),y=a.n(k),w=a(179),C=a.n(w),I=Object(n.createContext)([{},function(){}]),P=Object(n.createContext)([{},function(e){}]),U=a(180),z=a.n(U),V=function(e){var t=e.go,a=e.goView,r=e.type,l=e.loadIndicator,o=Object(n.useState)(""),i=Object(u.a)(o,2),m=i[0],d=i[1],O=Object(n.useState)(""),p=Object(u.a)(O,2),h=p[0],k=p[1],y=Object(n.useState)(null),w=Object(u.a)(y,2),C=w[0],U=w[1],V=function(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),c=a[0],r=a[1],l=Object(n.useState)(null),o=Object(u.a)(l,2),i=o[0],s=o[1],m=Object(n.useState)(null),b=Object(u.a)(m,2),f=b[0],d=b[1],j=Object(n.useState)({}),O=Object(u.a)(j,2),g=O[0],p=O[1],E="http://localhost:3000/api",h=Object(n.useCallback)((function(e){p(e),r(!0)}),[]),v=g.method,k=g.token,y=Object(S.a)(g,["method","token"]);return Object(n.useEffect)((function(){if(c){var t={"Content-Type":"application/json",Authorization:k?"Token ".concat(k):""};fetch("".concat(E).concat(e),{method:v,mode:"cors",headers:t,body:"GET"!==v?JSON.stringify(y):null}).then((function(e){return e.json()})).then((function(e){r(!1),s(e)})).catch((function(e){r(!1),d(e)}))}}),[c,y,v,e,E,k]),[{isLoading:c,response:i,error:f},h]}("/users/".concat(r)),_=Object(u.a)(V,2),x=_[0],T=x.response,A=x.error,K=_[1],L=Object(n.useContext)(I),W=Object(u.a)(L,1)[0].vkUserId,G=Object(n.useState)(!1),J=Object(u.a)(G,2),Z=J[0],q=J[1],F=Object(n.useContext)(P),N=Object(u.a)(F,2)[1];Object(n.useEffect)((function(){"login"!==r&&(m.length===h.length?m!==h&&U({status:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438",message:"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0432\u0432\u043e\u0434 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443."}):U(null))}),[m,h,r]),Object(n.useEffect)((function(){Z&&(K({method:"POST",user:{id:+W,password:m}}),q(!1))}),[Z,K,m,W]),Object(n.useEffect)((function(){if(T&&(!T.user&&T.error&&U(T.error),N((function(e){return Object(f.a)({},e,{isLoading:!1,isLoggedIn:!!T.user,currentUser:T.user||null})})),l(null),T.user)){var e=T.user,n=e.name,c=e.phone,r=e.email,o=e.kktPassword,i=e.token;localStorage.setItem("token",i),n&&c&&r&&o||(a("profile"),t("profile.edit")),console.log(T.user)}}),[T,N,l,t,a]),Object(n.useEffect)((function(){A&&(U(A),l(null))}),[A,l]);var R=function(e){e.target.value=Math.max(0,parseInt(e.target.value)).toString().slice(0,4),"password"===e.target.name?d(e.target.value):k(e.target.value)};return c.a.createElement(n.Fragment,null,c.a.createElement(j.a,null,"login"===r?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),c.a.createElement(s.o,{icon:"login"===r?c.a.createElement(E.a,null):c.a.createElement(v.a,null),header:"login"===r?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c":"\u041f\u0440\u0438\u0434\u0443\u043c\u0430\u0439\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.d,null,C?c.a.createElement(s.f,{header:C.status,mode:"error"},C.message):null,c.a.createElement(s.e,{top:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.j,{name:"password",type:"number",onChange:R,align:"center",value:m})),"login"!==r?c.a.createElement(s.e,{top:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.j,{type:"number",name:"confirmPassword",onChange:R,align:"center",value:h})):null,c.a.createElement(g.a,{size:"l",onClick:function(){return b.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:q(!0),l(c.a.createElement(z.a,{size:"large"}));case 2:case"end":return e.stop()}}))}},"login"===r?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"))),c.a.createElement(s.c,null,c.a.createElement(g.a,{stretched:!0,mode:"tertiary",onClick:t,"data-to":"login"===r?"authorization.registration":"authorization.login"},"login"===r?"\u041d\u0435\u0442 \u043f\u0430\u0440\u043e\u043b\u044f?":"\u0415\u0441\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c?")))},_=a(182),x=a.n(_),T=a(183),A=a.n(T),K=a(184),L=a.n(K),W=function(e){e.id;var t=e.go,a=e.fetchedUser,r=Object(n.useState)(""),l=Object(u.a)(r,2),o=l[0],m=l[1],b=Object(n.useState)(""),f=Object(u.a)(b,2),d=f[0],j=f[1],O=Object(n.useState)(""),g=Object(u.a)(O,2),p=(g[0],g[1],Object(n.useState)("")),E=Object(u.a)(p,2),h=(E[0],E[1],Object(s.r)());return Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppGetPersonalCardResult":m(n.email),j(n.phone)}}))}),[]),c.a.createElement(n.Fragment,null,c.a.createElement(s.m,{left:c.a.createElement(s.n,{onClick:t,"data-to":"home"},h===s.h?c.a.createElement(x.a,null):c.a.createElement(A.a,null))},"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"),a&&c.a.createElement(s.g,{title:a.id},c.a.createElement(s.b,{before:a.photo_200?c.a.createElement(L.a,{src:a.photo_200}):null,description:a.city&&a.city.title?a.city.title:""},"".concat(a.first_name," ").concat(a.last_name))),c.a.createElement(s.d,null,c.a.createElement(s.g,null,c.a.createElement(s.k,null,c.a.createElement(s.b,null,c.a.createElement(s.i,{title:"E-mail"},o||"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c email")),c.a.createElement(s.b,null,c.a.createElement(s.i,{title:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"},d||"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0442\u0435\u043b\u0435\u0444\u043e\u043d")))),c.a.createElement(s.a,{size:"xl",level:"2",onClick:function(){i.a.send("VKWebAppGetPersonalCard",{type:["phone","email"]})}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 VK")))},G=function(){var e=Object(n.useState)("authorization.login"),t=Object(u.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)("authorization"),o=Object(u.a)(l,2),i=o[0],m=o[1],b=Object(n.useState)(null),f=Object(u.a)(b,2),d=f[0],j=f[1],O=function(e){e.currentTarget?r(e.currentTarget.dataset.to):r(e)},g=function(e){e.currentTarget?m(e.currentTarget.dataset.to):m(e)},p=function(e){j(e)};return c.a.createElement(s.p,{activeView:i},c.a.createElement(s.q,{id:"authorization",activePanel:a,popout:d},c.a.createElement(s.l,{id:"authorization.login"},c.a.createElement(V,{go:O,type:"login",goView:g,loadIndicator:p})),c.a.createElement(s.l,{id:"authorization.registration"},c.a.createElement(V,{go:O,type:"register",goView:g,loadIndicator:p}))),c.a.createElement(s.q,{id:"profile",activePanel:a,popout:d},c.a.createElement(s.l,{id:"profile.edit"},c.a.createElement(W,null))))},J=function(e){var t=e.children;return Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;if("VKWebAppUpdateConfig"===a){var c=document.createAttribute("scheme");c.value=n.scheme?n.scheme:"client_light",document.body.attributes.setNamedItem(c)}}))}),[]),t};i.a.send("VKWebAppInit"),l.a.render(c.a.createElement(J,null,c.a.createElement((function(e){var t=e.children,a=function(){var e=Object(n.useState)(""),t=Object(u.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)(!1),l=Object(u.a)(r,2),o=l[0],i=l[1],s=Object(n.useState)(null),m=Object(u.a)(s,2),b=m[0],f=m[1],d=Object(n.useState)(!1),j=Object(u.a)(d,2),O=j[0],g=j[1];return Object(n.useEffect)((function(){if(o){var e=y.a.parse(a);if(e){f(e.vk_user_id);var t={};Object.keys(e).sort().forEach((function(a){"vk_"===a.slice(0,3)&&(t[a]=e[a])}));var n=y.a.stringify(t),c=C.a.createHmac("sha256","Zs6DYRE8Z2mZ44LfciKW").update(n).digest().toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=$/,"");g(c===e.sign)}}}),[o,a]),[{vkUserId:b,matchUrlParams:O},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";c(e),i(!0)}]}(),r=Object(u.a)(a,2),l=r[0],o=l.vkUserId,i=l.matchUrlParams,s=r[1],m=Object(n.useState)({vkUserId:null,matchUrlParams:!1}),b=Object(u.a)(m,2),f=b[0],d=b[1];return Object(n.useEffect)((function(){s(window.location.search.slice(1))}),[s]),Object(n.useEffect)((function(){o&&d({vkUserId:o,matchUrlParams:i})}),[o,i]),c.a.createElement(I.Provider,{value:[f,d]},t)}),null,c.a.createElement((function(e){var t=e.children,a=Object(n.useState)({isLoading:!1,isLoggedIn:null,currentUser:null}),r=Object(u.a)(a,2),l=r[0],o=r[1];return c.a.createElement(P.Provider,{value:[l,o]},t)}),null,c.a.createElement(G,null)))),document.getElementById("root"))}},[[235,1,2]]]);
//# sourceMappingURL=main.3c665369.chunk.js.map