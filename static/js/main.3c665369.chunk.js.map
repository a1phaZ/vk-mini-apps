{"version":3,"sources":["contexts/appSign.js","contexts/currentUser.js","views/Authorization.js","hooks/useApi.js","panels/Profile.js","App.js","components/InstallingTheme.js","index.js","hooks/useCompareSign.js"],"names":["AppSignContext","createContext","CurrentUserContext","p","Authorization","go","goView","type","loadIndicator","useState","password","setPassword","confirmPassword","setConfirmPassword","formError","setFormError","url","isLoading","setIsLoading","response","setResponse","error","setError","options","setOptions","_apiBase","doApiFetch","useCallback","method","token","bodyFields","useEffect","headers","fetch","mode","body","JSON","stringify","then","res","json","r","catch","e","useApi","useContext","vkUserId","startFetchData","setStartFetchData","setCurrentUserState","length","status","message","user","id","state","isLoggedIn","currentUser","name","phone","email","kktPassword","localStorage","setItem","console","log","onInput","target","value","Math","max","parseInt","toString","slice","icon","header","top","onChange","align","size","onClick","a","async","stretched","data-to","Profile","fetchedUser","setEmail","setPhone","osName","platform","connect","subscribe","detail","data","left","IOS","title","before","photo_200","src","description","city","first_name","last_name","level","send","App","activePanel","setActivePanel","activeView","setActiveView","popout","setPopout","currentTarget","dataset","to","changeActiveView","indicator","InstallingTheme","children","schemeAttribute","document","createAttribute","scheme","attributes","setNamedItem","ReactDOM","render","urlParams","setUrlParams","setVkUserId","matchUrlParams","setMatch","params","qs","parse","vk_user_id","ordered","Object","keys","sort","forEach","key","stringParams","paramsHash","crypto","createHmac","update","digest","replace","sign","useCompareSign","setParams","setState","window","location","search","Provider","getElementById"],"mappings":"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","file":"static/js/main.3c665369.chunk.js","sourcesContent":["import React, { useState, createContext, useEffect } from 'react';\r\nimport useCompareSign from \"../hooks/useCompareSign\";\r\n\r\nexport const AppSignContext = createContext([{}, () => {}]);\r\n\r\nexport const AppSignProvider = ({ children }) => {\r\n  const [{vkUserId, matchUrlParams}, setParams] = useCompareSign();\r\n  const [state, setState] = useState({\r\n    vkUserId: null,\r\n    matchUrlParams: false\r\n  });\r\n\r\n  useEffect(()=>{\r\n    setParams(window.location.search.slice(1));\r\n  }, [setParams]);\r\n\r\n  useEffect(() => {\r\n    if (!vkUserId) return;\r\n    setState({vkUserId, matchUrlParams});\r\n  }, [vkUserId, matchUrlParams]);\r\n\r\n  return (\r\n    <AppSignContext.Provider value={[state, setState]}>\r\n      {children}\r\n    </AppSignContext.Provider>\r\n  )\r\n};","import React, { createContext, useState } from 'react';\r\n\r\nexport const CurrentUserContext = createContext([{}, p => {}]);\r\n\r\nexport const CurrentUserProvider = ({ children }) => {\r\n\tconst [state, setState] = useState({\r\n\t\tisLoading: false,\r\n\t\tisLoggedIn: null,\r\n\t\tcurrentUser: null\r\n\t});\r\n\treturn (\r\n\t\t<CurrentUserContext.Provider value={[state, setState]}>\r\n\t\t\t{children}\r\n\t\t</CurrentUserContext.Provider>\r\n\t)\r\n};\r\n","import React, {Fragment, useState, useEffect, useContext} from 'react';\r\nimport {Div, FormLayout, FormLayoutGroup, Input, Placeholder, FormStatus} from \"@vkontakte/vkui\";\r\nimport PanelHeader from \"@vkontakte/vkui/dist/components/PanelHeader/PanelHeader\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Icon56LockOutline from '@vkontakte/icons/dist/56/lock_outline';\r\nimport Icon56UserAddOutline from '@vkontakte/icons/dist/56/user_add_outline';\r\nimport useApi from \"../hooks/useApi\";\r\nimport {AppSignContext} from \"../contexts/appSign\";\r\nimport {CurrentUserContext} from \"../contexts/currentUser\";\r\nimport ScreenSpinner from '@vkontakte/vkui/dist/components/ScreenSpinner/ScreenSpinner';\r\n\r\nconst Authorization = ({go, goView, type, loadIndicator}) => {\r\n\tconst [password, setPassword] = useState('');\r\n\tconst [confirmPassword, setConfirmPassword] = useState('');\r\n\tconst [formError, setFormError] = useState(null);\r\n\tconst [{response, error}, doApiFetch] = useApi(`/users/${type}`);\r\n\tconst [{vkUserId}] = useContext(AppSignContext);\r\n\tconst [startFetchData, setStartFetchData] = useState(false);\r\n\tconst [, setCurrentUserState] = useContext(CurrentUserContext);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (type === 'login') return;\r\n\r\n\t\tif ((password.length !== confirmPassword.length)) {\r\n\t\t\tsetFormError(null);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (password !== confirmPassword) {\r\n\t\t\tsetFormError({status: 'Ошибка валидации', message: 'Пароли не совпадают. Проверьте ввод и повторите попытку.'});\r\n\t\t}\r\n\t}, [password, confirmPassword, type]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (!startFetchData) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'POST',\r\n\t\t\tuser: {\r\n\t\t\t\tid: +vkUserId,\r\n\t\t\t\tpassword: password\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdoApiFetch(body);\r\n\t\tsetStartFetchData(false);\r\n\t},[startFetchData, doApiFetch, password, vkUserId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\r\n\t\tif (!response.user && response.error) {\r\n\t\t\tsetFormError(response.error);\r\n\t\t}\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!response.user,\r\n\t\t\tcurrentUser: response.user || null\r\n\t\t}));\r\n\r\n\r\n\r\n\t\tloadIndicator(null);\r\n\t\tif (response.user) {\r\n\t\t\tconst {name, phone, email, kktPassword, token} = response.user;\r\n\t\t\tlocalStorage.setItem('token', token);\r\n\t\t\tif (!name || !phone || !email || !kktPassword) {\r\n\t\t\t\tgoView('profile');\r\n\t\t\t\tgo('profile.edit');\r\n\t\t\t}\r\n\t\t\tconsole.log(response.user);\r\n\t\t}\r\n\t}, [response, setCurrentUserState, loadIndicator, go, goView]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!error) return;\r\n\t\tsetFormError(error);\r\n\t\tloadIndicator(null);\r\n\t}, [error, loadIndicator]);\r\n\r\n\tconst onInput = (e) => {\r\n\t\te.target.value = Math.max(0, parseInt(e.target.value) ).toString().slice(0,4);\r\n\t\tif (e.target.name === 'password') {\r\n\t\t\tsetPassword(e.target.value);\r\n\t\t} else {\r\n\t\t\tsetConfirmPassword(e.target.value);\r\n\t\t}\r\n\t};\r\n\r\n\tconst formStatus = () => {\r\n\t\tif (!formError) return null;\r\n\t\treturn (\r\n\t\t\t<FormStatus header={formError.status} mode=\"error\">\r\n\t\t\t\t{formError.message}\r\n\t\t\t</FormStatus>\r\n\t\t)\r\n\t};\r\n\r\n\tconst formButtonClick = async () => {\r\n\t\tsetStartFetchData(true);\r\n\t\tloadIndicator(<ScreenSpinner size='large' />);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>{type === 'login' ? 'Авторизация' : 'Регистрация'}</PanelHeader>\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={type === 'login' ? <Icon56LockOutline /> : <Icon56UserAddOutline />}\r\n\t\t\t\theader={type === 'login' ? 'Введите пароль' : 'Придумайте пароль'}\r\n\t\t\t>\r\n\t\t\t\t<FormLayout>\r\n\t\t\t\t\t{formStatus()}\r\n\t\t\t\t\t<FormLayoutGroup top={'Введите пароль'}>\r\n\t\t\t\t\t\t<Input name={'password'} type={'number'} onChange = {onInput} align=\"center\" value={password}/>\r\n\t\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype !== 'login'\r\n\t\t\t\t\t\t\t?\r\n\t\t\t\t\t\t\t<FormLayoutGroup top={'Повторите пароль'}>\r\n\t\t\t\t\t\t\t\t<Input type={'number'} name={'confirmPassword'} onChange = {onInput} align=\"center\" value={confirmPassword}/>\r\n\t\t\t\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<Button size=\"l\" onClick={formButtonClick}>{type === 'login' ? 'Авторизация' : 'Регистрация'}</Button>\r\n\t\t\t\t</FormLayout>\r\n\t\t\t</Placeholder>\r\n\t\t\t<Div>\r\n\t\t\t\t<Button\r\n\t\t\t\t\tstretched\r\n\t\t\t\t\tmode=\"tertiary\"\r\n\t\t\t\t\tonClick={go}\r\n\t\t\t\t\tdata-to={type === 'login' ? 'authorization.registration' : 'authorization.login'}\r\n\t\t\t\t>{type === 'login' ? 'Нет пароля?' : 'Есть пароль?'}</Button>\r\n\t\t\t</Div>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Authorization;\r\n","import {useState, useEffect, useCallback} from 'react';\r\n\r\nexport default url => {\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [response, setResponse] = useState(null);\r\n\tconst [error, setError] = useState(null);\r\n\tconst [options, setOptions] = useState({});\r\n\tconst _apiBase = `http://localhost:3000/api`;\r\n\r\n\tconst doApiFetch = useCallback((options) => {\r\n\t\tsetOptions(options);\r\n\t\tsetIsLoading(true);\r\n\t}, []);\r\n\r\n\tconst { method, token, ...bodyFields} = options;\r\n\tuseEffect(() => {\r\n\t\tif (!isLoading) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst headers = {\r\n\t\t\t'Content-Type': 'application/json',\r\n\t\t\t'Authorization': token ? `Token ${token}` : '',\r\n\t\t};\r\n\r\n\t\tfetch(`${_apiBase}${url}`, {\r\n\t\t\tmethod,\r\n\t\t\tmode: 'cors',\r\n\t\t\theaders,\r\n\t\t\tbody: method !== 'GET' ? JSON.stringify(bodyFields) : null,\r\n\t\t})\r\n\t\t\t.then(res => res.json())\r\n\t\t\t.then(r => {\r\n\t\t\t\tsetIsLoading(false);\r\n\t\t\t\tsetResponse(r);\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tsetIsLoading(false);\r\n\t\t\t\tsetError(e);\r\n\t\t\t});\r\n\r\n\t}, [isLoading, bodyFields, method, url, _apiBase, token]);\r\n\treturn [{isLoading, response, error}, doApiFetch];\r\n}\r\n","import React, {useState, useEffect, Fragment} from 'react';\r\nimport {\r\n\tFormLayout,\r\n\tIOS,\r\n\tPanelHeader,\r\n\tplatform,\r\n\tPanelHeaderButton,\r\n\tGroup, List, InfoRow, Cell, Button\r\n} from '@vkontakte/vkui';\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport connect from \"@vkontakte/vk-connect\";\r\nimport Avatar from \"@vkontakte/vkui/dist/components/Avatar/Avatar\";\r\n\r\nconst Profile = ({id, go, fetchedUser}) =>{\r\n\tconst [email, setEmail] = useState('');\r\n\tconst [phone, setPhone] = useState('');\r\n\tconst [name, setName] = useState('');\r\n\tconst [kktPassword, setKktPassword] = useState('');\r\n\tconst osName = platform();\r\n\r\n\tuseEffect(()=>{\r\n\t\tconnect.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'VKWebAppGetPersonalCardResult':\r\n\t\t\t\t\tsetEmail(data.email);\r\n\t\t\t\t\tsetPhone(data.phone);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}, []);\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={<PanelHeaderButton onClick={go} data-to=\"home\">\r\n\t\t\t\t\t{osName === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}\r\n\t\t\t\t</PanelHeaderButton>}\r\n\t\t\t>\r\n\t\t\t\tПрофиль\r\n\t\t\t</PanelHeader>\r\n\t\t\t{fetchedUser &&\r\n\t\t\t<Group title={fetchedUser.id}>\r\n\t\t\t\t<Cell\r\n\t\t\t\t\tbefore={fetchedUser.photo_200 ? <Avatar src={fetchedUser.photo_200}/> : null}\r\n\t\t\t\t\tdescription={fetchedUser.city && fetchedUser.city.title ? fetchedUser.city.title : ''}\r\n\t\t\t\t>\r\n\t\t\t\t\t{`${fetchedUser.first_name} ${fetchedUser.last_name}`}\r\n\t\t\t\t</Cell>\r\n\t\t\t</Group>}\r\n\t\t\t<FormLayout>\r\n\t\t\t\t<Group>\r\n\t\t\t\t\t<List>\r\n\t\t\t\t\t\t<Cell>\r\n\t\t\t\t\t\t\t<InfoRow title='E-mail'>\r\n\t\t\t\t\t\t\t\t{email ? email : 'Необходимо получить email'}\r\n\t\t\t\t\t\t\t</InfoRow>\r\n\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t<Cell>\r\n\t\t\t\t\t\t\t<InfoRow title='Телефон'>\r\n\t\t\t\t\t\t\t\t{phone ? phone : 'Необходимо получить телефон'}\r\n\t\t\t\t\t\t\t</InfoRow>\r\n\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t</List>\r\n\t\t\t\t</Group>\r\n\t\t\t\t<Button size=\"xl\" level=\"2\" onClick={() => {\r\n\t\t\t\t\tconnect.send(\"VKWebAppGetPersonalCard\", {\"type\": [\"phone\", \"email\"]});\r\n\t\t\t\t}}>\r\n\t\t\t\t\tПолучить данные из VK\r\n\t\t\t\t</Button>\r\n\t\t\t</FormLayout>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Profile;\r\n","import React, { useState } from 'react';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport {Root, Panel, View} from \"@vkontakte/vkui\";\r\nimport Authorization from \"./views/Authorization\";\r\nimport Profile from \"./panels/Profile\";\r\n\r\n\r\nconst App = () => {\r\n\tconst [activePanel, setActivePanel] = useState('authorization.login');\r\n\tconst [activeView, setActiveView] = useState('authorization');\r\n\tconst [popout, setPopout] = useState(null);\r\n\t//const [popout, setPopout] = useState(null);\r\n\r\n\tconst go = e => {\r\n\t\tif (!e.currentTarget) {\r\n\t\t\tsetActivePanel(e);\r\n\t\t} else {\r\n\t\t\tsetActivePanel(e.currentTarget.dataset.to);\r\n\t\t}\r\n\t};\r\n\r\n\tconst changeActiveView = e => {\r\n\t\tif (!e.currentTarget) {\r\n\t\t\tsetActiveView(e);\r\n\t\t} else {\r\n\t\t\tsetActiveView(e.currentTarget.dataset.to);\r\n\t\t}\r\n\t};\r\n\r\n\tconst loadIndicator = (indicator) => {\r\n\t\tsetPopout(indicator);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Root activeView={activeView}>\r\n\t\t\t<View id={'authorization'} activePanel={activePanel} popout={popout}>\r\n\t\t\t\t<Panel id={'authorization.login'}>\r\n\t\t\t\t\t<Authorization go={go} type={'login'} goView={changeActiveView} loadIndicator={loadIndicator}/>\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'authorization.registration'}>\r\n\t\t\t\t\t<Authorization go={go} type={'register'} goView={changeActiveView} loadIndicator={loadIndicator}/>\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'profile'} activePanel={activePanel} popout={popout}>\r\n\t\t\t\t<Panel id={'profile.edit'}>\r\n\t\t\t\t\t<Profile />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t</Root>\r\n\t);\r\n};\r\n\r\nexport default App;\r\n","import { useEffect } from 'react';\r\nimport connect from \"@vkontakte/vk-connect\";\r\n\r\nconst InstallingTheme = ({ children }) => {\r\n\r\n\tuseEffect(() => {\r\n\t\tconnect.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\r\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\r\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\r\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\r\n\t\t\t}\r\n\t\t});\r\n\t}, []);\r\n\r\n\treturn (children)\r\n};\r\n\r\nexport default InstallingTheme;\r\n","import 'core-js/features/map';\r\nimport 'core-js/features/set';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport connect from '@vkontakte/vk-connect';\r\nimport App from './App';\r\nimport {CurrentUserProvider} from \"./contexts/currentUser\";\r\nimport {AppSignProvider} from \"./contexts/appSign\";\r\nimport InstallingTheme from \"./components/InstallingTheme\";\r\n// import registerServiceWorker from './sw';\r\n\r\n// Init VK  Mini App\r\nconnect.send('VKWebAppInit');\r\n\r\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\r\n// расскомментируйте строку с registerServiceWorker();\r\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\r\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\r\n// registerServiceWorker();\r\n\r\nReactDOM.render(\r\n\t<InstallingTheme>\r\n\t\t<AppSignProvider>\r\n\t\t\t<CurrentUserProvider>\r\n\t\t\t\t<App />\r\n\t\t\t</CurrentUserProvider>\r\n\t\t</AppSignProvider>\r\n\t</InstallingTheme>\r\n\t,\r\n\tdocument.getElementById('root')\r\n);\r\n","import { useState, useEffect } from 'react';\r\nimport qs from 'querystring';\r\nimport crypto from 'crypto';\r\n\r\nexport default () => {\r\n\tconst [urlParams, setUrlParams] = useState('');\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [vkUserId, setVkUserId] = useState(null);\r\n\tconst [matchUrlParams, setMatch] = useState(false);\r\n\r\n\tconst setParams = (urlParams = '') => {\r\n\t\tsetUrlParams(urlParams);\r\n\t\tsetIsLoading(true);\r\n\t};\r\n\r\n\tuseEffect(() =>{\r\n\t\tif( !isLoading ) return;\r\n\r\n\t\tconst params = qs.parse(urlParams);\r\n\r\n\t\tif (!params) return;\r\n\r\n\t\tsetVkUserId(params.vk_user_id);\r\n\r\n\t\tconst ordered = {};\r\n\t\tObject.keys(params).sort().forEach((key) => {\r\n\t\t\tif (key.slice(0, 3) === 'vk_') {\r\n\t\t\t\tordered[key] = params[key];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst stringParams = qs.stringify(ordered);\r\n\t\tconst paramsHash = crypto\r\n\t\t\t.createHmac('sha256', 'Zs6DYRE8Z2mZ44LfciKW')\r\n\t\t\t.update(stringParams)\r\n\t\t\t.digest()\r\n\t\t\t.toString('base64')\r\n\t\t\t.replace(/\\+/g, '-')\r\n\t\t\t.replace(/\\//g, '_')\r\n\t\t\t.replace(/=$/, '');\r\n\r\n\t\tsetMatch(paramsHash === params.sign);\r\n\t}, [isLoading, urlParams]);\r\n\r\n\treturn [{vkUserId, matchUrlParams}, setParams];\r\n}"],"sourceRoot":""}