{"version":3,"sources":["hooks/useLocalStorage.js","hooks/useApi.js","contexts/appSign.js","contexts/currentUser.js","contexts/routerContext.js","panels/Authorization.js","panels/Profile.js","handlers/prepare.js","panels/ColoredSum.js","contexts/loadingContext.js","components/Calendar.js","panels/Balance.js","panels/AddDay.js","App.js","components/InstallingTheme.js","components/CurrentUserChecker.js","index.js","hooks/useCompareSign.js"],"names":["key","initialValue","useState","localStorage","getItem","value","setValue","useEffect","setItem","url","isLoading","setIsLoading","response","setResponse","error","setError","options","setOptions","useLocalStorage","token","_apiBase","doApiFetch","useCallback","method","params","bodyFields","headers","Authorization","qString","queryString","stringify","uri","fetch","mode","body","JSON","then","res","json","r","catch","e","AppSignContext","createContext","CurrentUserContext","p","RouterContext","go","goView","type","password","setPassword","confirmPassword","setConfirmPassword","formError","setFormError","useApi","useContext","vkUserId","startFetchData","setStartFetchData","currentUserState","setCurrentUserState","setToken","setRouterContext","isLoggedIn","currentUser","name","phone","email","state","view","panel","length","status","message","user","id","onChange","target","Math","max","parseInt","toString","slice","icon","header","top","align","size","onClick","a","async","stretched","currentTarget","dataset","to","data-to","Profile","fetchedUser","setEmail","setPhone","setName","kktPassword","setKktPassword","fetchToFns","setFetchToFns","osName","platform","connect","subscribe","detail","data","update","left","IOS","title","before","photo_200","src","description","city","first_name","last_name","bottom","placeholder","send","Prepare","str","dt","sum","fn","i","fp","match","monthName","Date","getMonth","getDate","getFullYear","n","Intl","NumberFormat","style","currency","format","arr","map","item","totalSum","reduce","previousValue","currentValue","income","reducer","ts","items","ColoredSum","fs","stl","color","fontSize","prepare","LoadingContext","Calendar","setDateFromCalendar","currentDate","setCurrentDate","subMonths","asideContent","addMonths","textAlign","fontWeight","locale","ru","toLocaleUpperCase","Balance","initialFetch","setInitialFetch","receipts","setReceipts","setPopout","date","totalReceiptSum","action","display","flexDirection","justifyContent","paddingTop","flex","paddingRight","width","height","fill","paddingLeft","receipt","index","expandable","setActiveModal","_id","indicator","dateTime","AddDay","m","d","setDate","quantity","setQuantity","price","setPrice","setIncome","osname","modifiers","properties","console","log","checked","disabled","App","routerContext","activeView","activePanel","InstallingTheme","children","schemeAttribute","document","createAttribute","scheme","attributes","setNamedItem","CurrentUserChecker","doFetch","ReactDOM","render","urlParams","setUrlParams","setVkUserId","matchUrlParams","setMatch","qs","parse","vk_user_id","ordered","Object","keys","sort","forEach","stringParams","paramsHash","crypto","createHmac","digest","replace","sign","useCompareSign","setParams","setState","window","location","search","Provider","getElementById"],"mappings":"2sBAEe,WAACA,GAA4B,IAAvBC,EAAsB,uDAAP,GAAO,EACfC,oBAAS,WACjC,OAAOC,aAAaC,QAAQJ,IAAQC,KAFG,mBAClCI,EADkC,KAC3BC,EAD2B,KASzC,OAJAC,qBAAU,WACRJ,aAAaK,QAAQR,EAAKK,KACzB,CAACA,EAAOL,IAEJ,CAACK,EAAOC,I,kBCPF,WAAAG,GAAQ,IAAD,EACaP,oBAAS,GADtB,mBACdQ,EADc,KACHC,EADG,OAEWT,mBAAS,MAFpB,mBAEdU,EAFc,KAEJC,EAFI,OAGKX,mBAAS,MAHd,mBAGdY,EAHc,KAGPC,EAHO,OAISb,mBAAS,IAJlB,mBAIdc,EAJc,KAILC,EAJK,OAKLC,EAAgB,SAAzBC,EALc,oBAOfC,EAAQ,kCAERC,EAAaC,uBAAY,WAAmB,IAAlBN,EAAiB,uDAAP,GACzCC,EAAWD,GACXL,GAAa,KAEX,IAbkB,EAe4BK,EAAzCO,cAfa,MAeJ,MAfI,EAeGC,EAAyBR,EAAzBQ,OAAWC,EAfd,YAe4BT,EAf5B,qBA8CrB,OA9BAT,qBAAU,WACT,GAAKG,EAAL,CAIA,IAAMgB,EAAU,CACf,eAAgB,mBAChBC,cAAeR,EAAK,gBAAYA,GAAU,IAGrCS,EAAUJ,EAASK,IAAYC,UAAUN,GAAU,KAEnDO,EAAMH,EAAO,UAAMR,GAAN,OAAiBX,EAAjB,YAAwBmB,GAAxB,UAAuCR,GAAvC,OAAkDX,GAErEuB,MAAMD,EAAK,CACVR,SACAU,KAAM,OACNP,UACAQ,KAAiB,QAAXX,EAAmBY,KAAKL,UAAUL,GAAc,OAErDW,MAAK,SAAAC,GAAG,OAAIA,EAAIC,UAChBF,MAAK,SAAAG,GACL5B,GAAa,GACbE,EAAY0B,MAEZC,OAAM,SAAAC,GACN9B,GAAa,GACbI,EAAS0B,SAET,CAAC/B,EAAWe,EAAYF,EAAQd,EAAKW,EAAUD,EAAOK,IAClD,CAAC,CAACd,YAAWE,WAAUE,SAAQO,I,oCC/C1BqB,EAAiBC,wBAAc,CAAC,GAAI,eCDpCC,EAAqBD,wBAAc,CAAC,GAAI,SAAAE,OCAxCC,EAAgBH,wBAAc,CAAC,GAAI,SAAAE,OCuJjClB,EA7IO,SAAC,GAAwB,IAAvBoB,EAAsB,EAAtBA,GAAIC,EAAkB,EAAlBA,OAAQC,EAAU,EAAVA,KAAU,EACb/C,mBAAS,IADI,mBACtCgD,EADsC,KAC5BC,EAD4B,OAECjD,mBAAS,IAFV,mBAEtCkD,EAFsC,KAErBC,EAFqB,OAGXnD,mBAAS,MAHE,mBAGtCoD,EAHsC,KAG3BC,EAH2B,OAILC,EAAO,UAAD,OAAWP,IAJZ,0BAIrCrC,EAJqC,EAIrCA,SAAUE,EAJ2B,EAI3BA,MAAQO,EAJmB,OAKxBoC,qBAAWf,GAAxBgB,EALqC,oBAKrCA,SALqC,EAMDxD,oBAAS,GANR,mBAMtCyD,EANsC,KAMtBC,EANsB,OAOGH,qBAAWb,GAPd,mBAOtCiB,EAPsC,KAOpBC,EAPoB,OAQxB5C,EAAgB,SAA5B6C,EARoC,sBASjBN,qBAAWX,GAA/BkB,EATqC,oBAW7CzD,qBAAU,WACT,GAAKsD,EAAiBI,WAAtB,CADe,MAEwBJ,EAAiBK,YAAjDC,EAFQ,EAERA,KAAMC,EAFE,EAEFA,MAAOC,EAFL,EAEKA,MAAOnB,EAFZ,EAEYA,SAQ1Bc,EAPIG,GAASC,GAAUC,GAAUnB,EAOhB,SAAAoB,GAAK,sBAClBA,EADkB,CAErBC,KAAM,UACNC,MAAO,kBATS,SAAAF,GAAK,sBAClBA,EADkB,CAErBC,KAAM,UACNC,MAAO,sBASR,CAACX,EAAkBG,IAErBzD,qBAAU,WACI,UAAT0C,IAECC,EAASuB,SAAWrB,EAAgBqB,OAKrCvB,IAAaE,GAChBG,EAAa,CAACmB,OAAQ,8FAAoBC,QAAS,wSALnDpB,EAAa,SAOZ,CAACL,EAAUE,EAAiBH,IAE/B1C,qBAAU,WACJoD,IASLtC,EARa,CACZE,OAAQ,OACRqD,KAAM,CACLC,IAAKnB,EACLR,SAAUA,KAKZU,GAAkB,MACjB,CAACD,EAAgBtC,EAAY6B,EAAUQ,IAEzCnD,qBAAU,WACJK,KAEAA,EAASgE,MAAQhE,EAASE,MAC9ByC,EAAa3C,EAASE,OAEtBiD,EAASnD,EAASgE,KAAKzD,OAExB2C,GAAoB,SAAAQ,GAAK,sBACrBA,EADqB,CAExB5D,WAAW,EACXuD,aAAcrD,EAASgE,KACvBV,YAAatD,EAASgE,MAAQ,aAG7B,CAAChE,EAAUkD,EAAqBf,EAAIC,EAAQe,IAE/CxD,qBAAU,WACJO,GACLyC,EAAazC,KACX,CAACA,IAEJ,IAAMgE,EAAW,SAACrC,GACjBA,EAAEsC,OAAO1E,MAAQ2E,KAAKC,IAAI,EAAGC,SAASzC,EAAEsC,OAAO1E,QAAS8E,WAAWC,MAAM,EAAE,GACrD,aAAlB3C,EAAEsC,OAAOZ,KACZhB,EAAYV,EAAEsC,OAAO1E,OAErBgD,EAAmBZ,EAAEsC,OAAO1E,QAiB9B,OACC,kBAAC,WAAD,KACC,kBAAC,IAAD,KAAuB,UAAT4C,EAAmB,qEAAgB,sEACjD,kBAAC,IAAD,CACCoC,KAAe,UAATpC,EAAmB,kBAAC,IAAD,MAAwB,kBAAC,IAAD,MACjDqC,OAAiB,UAATrC,EAAmB,kFAAmB,qGAE9C,kBAAC,IAAD,KAnBGK,EAEJ,kBAAC,IAAD,CAAYgC,OAAQhC,EAAUoB,OAAQzC,KAAK,SACzCqB,EAAUqB,SAHU,KAqBpB,kBAAC,IAAD,CAAiBY,IAAK,mFACrB,kBAAC,IAAD,CAAOpB,KAAM,WAAYlB,KAAM,SAAU6B,SAAYA,EAAUU,MAAM,SAASnF,MAAO6C,KAG5E,UAATD,EAEC,kBAAC,IAAD,CAAiBsC,IAAK,+FACrB,kBAAC,IAAD,CAAOtC,KAAM,SAAUkB,KAAM,kBAAmBW,SAAYA,EAAUU,MAAM,SAASnF,MAAO+C,KAG9F,KAED,kBAAC,IAAD,CAAQqC,KAAK,IAAIC,QAzBG,oBAAAC,EAAAC,OAAA,gDACvBhC,GAAkB,GADK,uCAyBiC,UAATX,EAAmB,qEAAgB,wEAGjF,kBAAC,IAAD,KACC,kBAAC,IAAD,CACC4C,WAAS,EACT5D,KAAK,WACLyD,QAAS,SAACjD,GACTuB,GAAiB,SAAAM,GAAK,sBAClBA,EADkB,CAErBE,MAAO/B,EAAEqD,cAAcC,QAAQC,SAGjCC,UAAkB,UAAThD,EAAmB,yBAA2B,uBAC7C,UAATA,EAAmB,2DAAgB,qE,oDCY1BiD,EA9IC,SAAC,GAAsB,IAArBnD,EAAoB,EAApBA,GAAIoD,EAAgB,EAAhBA,YAAgB,EACXjG,mBAAS,IADE,mBAC9BmE,EAD8B,KACvB+B,EADuB,OAEXlG,mBAAS,IAFE,mBAE9BkE,EAF8B,KAEvBiC,EAFuB,OAGbnG,mBAAS,IAHI,mBAG9BiE,EAH8B,KAGxBmC,EAHwB,OAICpG,mBAAS,IAJV,mBAI9BqG,EAJ8B,KAIjBC,EAJiB,OAKDtG,oBAAS,GALR,mBAK9BuG,EAL8B,KAKlBC,EALkB,OAOJlD,EAAO,kBAPH,mBAO7B5C,EAP6B,KAO7BA,SAAWS,EAPkB,OAQOnB,oBAAS,GARhB,mBAQ9ByD,EAR8B,KAQdC,EARc,OASVH,qBAAWb,GAA/BiB,EAT8B,sBAUTJ,qBAAWX,GAA/BkB,EAV6B,oBAW/B2C,EAASC,cAoDf,OAlDArG,qBAAU,WAETsG,IAAQC,WAAU,YAAgC,IAAD,IAA5BC,OAAU9D,EAAkB,EAAlBA,KAAM+D,EAAY,EAAZA,KACpC,OAAQ/D,GACP,IAAK,gCACJmD,EAASY,EAAK3C,OACdgC,EAASW,EAAK5C,aAMf,IAEH7D,qBAAU,WACT6F,EAASvC,EAAiBK,YAAYG,OAAS,IAC/CiC,EAAQzC,EAAiBK,YAAYC,MAAQ,IAC7CkC,EAASxC,EAAiBK,YAAYE,OAAS,IAC/CoC,EAAe3C,EAAiBK,YAAYhB,UAAY,MACtD,CAACW,IAEJtD,qBAAU,WACJoD,IAWLtC,EAVa,CACZE,OAAQ,MACR0F,OAAQ,CACP5C,QACAD,QACAD,OACAoC,iBAKF3C,GAAkB,MACjB,CAACD,EAAgBtC,EAAYgD,EAAOD,EAAOD,EAAMoC,IAEnDhG,qBAAU,WACT,GAAKK,EAAL,CADe,IAEPgE,EAAShE,EAATgE,KACHA,EAAKT,MAASS,EAAKR,OAAUQ,EAAKP,OAAUO,EAAK1B,UAGtDc,GAAiB,SAAAM,GAAK,sBAClBA,EADkB,CAErBC,KAAM,UACNC,MAAO,uBAEN,CAAC5D,EAAUoD,IAGb,kBAAC,WAAD,KACC,kBAAC,IAAD,CACCkD,KAAM,kBAAC,IAAD,CAAmBxB,QAAS3C,EAAIkD,UAAQ,QAC5CU,IAAWQ,IAAM,kBAAC,IAAD,MAAuB,kBAAC,IAAD,QAF3C,8CAOChB,GACD,kBAAC,IAAD,CAAOiB,MAAOjB,EAAYtB,IACzB,kBAAC,IAAD,CACCwC,OAAQlB,EAAYmB,UAAY,kBAAC,IAAD,CAAQC,IAAKpB,EAAYmB,YAAe,KACxEE,YAAarB,EAAYsB,MAAQtB,EAAYsB,KAAKL,MAAQjB,EAAYsB,KAAKL,MAAQ,IAFpF,UAIKjB,EAAYuB,WAJjB,YAI+BvB,EAAYwB,aAG5C,kBAAC,IAAD,KACElB,GAAc,kBAAC,IAAD,CAAYnB,OAAO,kPAA+CrD,KAAK,WAAvE,qmBAGf,kBAAC,IAAD,CACCgB,KAAM,OACNsC,IAAK,qBACLpB,KAAM,OACN9D,MAAO8D,EACPW,SAAU,SAACrC,GAAO6D,EAAQ7D,EAAEsC,OAAO1E,UAEpC,kBAAC,IAAD,CAAiBkF,IAAI,2DAAmBqC,OAAO,ssBAC9C,kBAAC,IAAD,CACC3E,KAAM,QACNsC,IAAK,SACLpB,KAAM,QACN0D,YAAa,oDACbxH,MAAOgE,EACPS,SAAU,SAACrC,GAAO2D,EAAS3D,EAAEsC,OAAO1E,UAErC,kBAAC,IAAD,CACC4C,KAAM,QACNsC,IAAK,6CACLpB,KAAM,QACN9D,MAAO+D,EACPyD,YAAa,wFACb/C,SAAU,SAACrC,GAAO4D,EAAS5D,EAAEsC,OAAO1E,UAErC,kBAAC,IAAD,CAAQoF,KAAK,KAAKC,QAAS,WAE1BmB,IAAQiB,KAAK,0BAA2B,CAAC,KAAQ,CAAC,QAAS,aAF5D,0GAOD,kBAAC,IAAD,CAAiBvC,IAAK,wEACrB,kBAAC,IAAD,CACCtC,KAAM,SACNsC,IAAK,uEACLsC,YAAa,qGACb1D,KAAM,cACN9D,MAAOkG,EACPzB,SAAU,SAACrC,GAAO+D,EAAe/D,EAAEsC,OAAO1E,UAE3C,kBAAC,IAAD,CAAQoF,KAAK,KAAKC,QAAS,WAC1BgB,GAAc,KADf,0HAOD,kBAAC,IAAD,CAAQjB,KAAK,KAAKxD,KAAK,WAAWyD,QAAS,WAC1C9B,GAAkB,KADnB,2K,kBCrJiBmE,E,gGAMTC,GACV,IAAIC,EAAIC,EAAKC,EAAIC,EAAGC,EAEpB,GAAIL,EAAK,CAAC,IAAD,EACiBA,EAAIM,MAAM,yDAD3B,mBACLL,EADK,KACDC,EADC,KACIC,EADJ,KACQC,EADR,KACWC,EADX,KAIT,MAAO,CACNJ,KACAC,MACAC,KACAC,IACAC,Q,2BASUL,GACX,IACIO,EADEN,EAAK,IAAIO,KAAKR,GAEpB,OAAQC,EAAGQ,WAAa,GACvB,KAAK,EACJF,EAAY,uCACZ,MACD,KAAK,EACJA,EAAY,6CACZ,MACD,KAAK,EACJA,EAAY,iCACZ,MACD,KAAK,EACJA,EAAY,uCACZ,MACD,KAAK,EACJA,EAAY,qBACZ,MACD,KAAK,EACJA,EAAY,2BACZ,MACD,KAAK,EACJA,EAAY,2BACZ,MACD,KAAK,EACJA,EAAY,6CACZ,MACD,KAAK,EACJA,EAAY,mDACZ,MACD,KAAK,GACJA,EAAY,6CACZ,MACD,KAAK,GACJA,EAAY,uCACZ,MACD,KAAK,GACJA,EAAY,6CAKd,MAAM,GAAN,OAAUN,EAAGS,UAAb,YAA0BH,EAA1B,YAAuCN,EAAGU,iB,0BAQhCC,GACV,OAAO,IAAIC,KAAKC,aAAa,QAAS,CAACC,MAAO,WAAYC,SAAU,QAAQC,OAAOL,EAAI,O,sCAQjEM,GACtB,GAAmB,IAAfA,EAAIzE,OAAc,OAAO,EAE7B,OAAOyE,EAAIC,KAAI,SAACC,GACf,OAAOA,EAAKC,YACVC,QAHa,SAACC,EAAeC,GAAhB,OAAiCD,EAAgBC,O,+BAYlDN,EAAKO,GACpB,GAAmB,IAAfP,EAAIzE,OAAc,OAAO,EAC7B,IAAMiF,EAAU,SAACH,EAAeC,GAAhB,OAAiCD,EAAgBC,GAC3DG,EAAKT,EAAIC,KAAI,SAAAS,GAClB,OAAOA,EAAMA,MAAMT,KAAI,SAAAC,GACtB,OAAIK,EACIL,EAAKK,OAASL,EAAKlB,IAAM,EAEzBkB,EAAKK,OAAoB,EAAXL,EAAKlB,OACzBoB,OAAOI,MACRJ,OAAOI,GACV,OAAOD,EAASE,GAAM,EAAIA,M,KCtGbE,EAPI,SAAC,GAAe,IAAd3B,EAAa,EAAbA,IAAK4B,EAAQ,EAARA,GACnBC,EAAM7B,GAAO,EAAI,CAAC8B,MAAO,UAAWC,SAAUH,GAAM,CAACE,MAAO,UAAWC,SAAUH,GACvF,OACC,0BAAMf,MAAOgB,GAAMG,EAAQhC,IAAIA,K,6FCJpBiC,GAAiBxH,wBAAc,CAAC,GAAI,SAAAE,O,kFCoClCuH,GA/BE,SAAC,GAA2B,IAA1BC,EAAyB,EAAzBA,oBAAyB,EACJnK,mBAAS,IAAIsI,MADT,mBACnC8B,EADmC,KACtBC,EADsB,KAI1ChK,qBAAU,WACR8J,EAAoBC,KACnB,CAACA,EAAaD,IAUjB,OACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CACEhD,OAAQ,kBAAC,IAAD,CAAQ3B,QARN,WAChB6E,EAAeC,aAAUF,EAAa,KAOIrI,KAAM,aAAa,kBAAC,KAAD,OACvDwI,aAAc,kBAAC,IAAD,CAAQ/E,QAbZ,WAChB6E,EAAeG,aAAUJ,EAAa,KAYUrI,KAAM,aAAa,kBAAC,KAAD,OAC7D8G,MAAO,CAAC4B,UAAW,SAAUC,WAAY,SAExC3B,aAAOqB,EAtBG,YAsBsB,CAACO,OAAQC,OAAKC,wB,UC+E1CC,GA7FC,WAAO,IAAD,EACmB9K,oBAAS,GAD5B,mBACd+K,EADc,KACAC,EADA,OAEiBhL,mBAAS,IAAIsI,MAF9B,mBAEd8B,EAFc,KAEDC,EAFC,OAOWrK,mBAAS,IAPpB,mBAOdiL,EAPc,KAOJC,EAPI,OAQY5H,EAAO,QARnB,mBAQb5C,EARa,KAQbA,SAAWS,EARE,OASQoC,qBAAWX,GAA/BkB,EATY,sBAUCP,qBAAW0G,IAAxBkB,EAVY,oBAafhB,EAAsB/I,uBAAY,SAACgK,GACxCf,EAAee,GACfJ,GAAgB,KACd,IAiBH,OAfA3K,qBAAU,WACJ0K,IACL5J,EAAW,CACVG,OAAQ,CACP8J,KAAMrC,aAAOqB,EAXG,iBAclBY,GAAgB,MACd,CAACD,EAAcC,EAAiB7J,EAAYgK,EAAWf,IAE1D/J,qBAAU,WACJK,GACLwK,EAAYxK,KACV,CAACA,EAAUyK,IAGb,kBAAC,WAAD,KACC,kBAAC,IAAD,gBACA,kBAAC,IAAD,CACChG,KAAM,kBAAC,IAAD,MACNC,OAAQ,kBAAC,EAAD,CAAY4C,IAAKgC,EAAQqB,gBAAgBJ,GAAWrB,GAAI,QAChE0B,OAAQ,kBAAC,IAAD,CAAQ/F,KAAK,IAAIC,QAAS,WACjC1B,GAAiB,SAAAM,GAAK,sBAClBA,EADkB,CAErBE,MAAO,oBAENyB,UAAS,WALJ,2HAHT,gJAYA,kBAAC,IAAD,MACA,yBAAK8C,MAAO,CACX0C,QAAS,OACTC,cAAe,MACfC,eAAgB,gBAChBC,WAAY,QAEZ,yBAAK7C,MAAO,CAAC8C,KAAM,UAAWJ,QAAS,OAAOE,eAAgB,aAC7D,yBAAK5C,MAAO,CAAC0C,QAAS,OAAQC,cAAe,SAAUI,aAAc,SACpE,0BAAM/C,MAAO,CAACiB,MAAO,UAAWC,SAAU,QAASU,UAAW,QAA9D,wCACA,kBAAC,EAAD,CAAYzC,IAAKgC,EAAQb,SAAS8B,GAAU,GAAOrB,GAAI,WAExD,kBAAC,IAAD,CAAUiC,MAAO,GAAIC,OAAQ,GAAIC,KAAM,aAExC,yBAAKlD,MAAO,CAAC8C,KAAM,UAAWJ,QAAS,OAAOE,eAAgB,eAC7D,kBAAC,KAAD,CAAYI,MAAO,GAAIC,OAAQ,GAAIC,KAAM,YACzC,yBAAKlD,MAAO,CAAC0C,QAAS,OAAQC,cAAe,SAAUQ,YAAa,SACnE,0BAAMnD,MAAO,CAACiB,MAAO,UAAWC,SAAU,UAA1C,8CACA,kBAAC,EAAD,CAAY/B,IAAKgC,EAAQb,SAAS8B,GAAU,GAAQrB,GAAI,aAK3D,kBAAC,IAAD,CAAO1C,MAAM,4BACZ,kBAAC,IAAD,KACC,kBAAC,GAAD,CAAUiD,oBAAqBA,IAC9Bc,EAAShC,KAAI,SAACgD,EAASC,GACvB,OACC,kBAAC,IAAD,CACCpM,IAAKoM,EACLC,YAAU,EACV3G,QAAS,SAACjD,GAAD,OAAO,GAAK6J,eAAe7J,EAAEqD,cAAcC,QAAQC,KAC5DC,UAASkG,EAAQI,IACjBC,UAAW,kBAAC,EAAD,CAAYtE,IAAKiE,EAAQ9C,YAEnCa,EAAQoB,KAAKa,EAAQM,kB,6HC4BfC,GAjHA,WAAO,IAAD,EACKxM,mBAAS,IADd,mBACZiE,EADY,KACNmC,EADM,OAEKpG,oBAAS,WAC/B,IAAMoL,EAAO,IAAI9C,KACXmE,EAAIrB,EAAK7C,WAAW,EAAI,EAAI6C,EAAK7C,WAAW,EAAxC,WAAgD6C,EAAK7C,WAAW,GACpEmE,EAAItB,EAAK5C,UAAY,EAAI4C,EAAK5C,UAA1B,WAA0C4C,EAAK5C,WACzD,MAAM,GAAN,OAAU4C,EAAK3C,cAAf,YAAgCgE,EAAhC,YAAqCC,MANpB,mBAEZtB,EAFY,KAENuB,EAFM,OAQa3M,mBAAS,GARtB,mBAQZ4M,EARY,KAQFC,EARE,OASO7M,mBAAS,IAThB,mBASZ8M,EATY,KASLC,EATK,OAUS/M,oBAAS,GAVlB,mBAUZuJ,EAVY,KAUJyD,EAVI,OAWUzJ,qBAAWX,GAA/BkB,EAXU,sBAYcR,EAAO,QAZrB,mBAYX5C,EAZW,KAYXA,SAAWS,EAZA,OAayBnB,oBAAS,GAblC,mBAaZyD,EAbY,KAaIC,EAbJ,KAcbuJ,EAASvG,cAiCf,OA/BArG,qBAAU,WACHoD,IAgBLtC,EAfa,CACXE,OAAQ,OACR+J,KAAMA,EACN1B,MAAO,CACL,CACEzF,OACA2I,WACAE,MAAe,IAARA,EACP9E,IAAa,IAAR8E,EAAcF,EACnBrD,SACA2D,UAAW,GACXC,WAAY,OAMlB/G,EAAQ,IACRyG,EAAY,GACZG,GAAU,GACVD,EAAS,IACTrJ,GAAkB,MACjB,CAACD,EAAgBC,EAAmB0H,EAAMjK,EAAYoI,EAAQtF,EAAM6I,EAAOF,IAE9EvM,qBAAU,WACHK,GACL0M,QAAQC,IAAI3M,KACX,CAACA,IAGF,kBAAC,WAAD,KACE,kBAAC,IAAD,CACEsG,KACE,kBAAC,KAAD,CAAmBlH,IAAK,OAAQ0F,QAAS,WACvC1B,GAAiB,SAAAM,GAAK,sBACjBA,EADiB,CAEpBE,MAAO,qBAERyB,UAAS,WAAYkH,IAAWhG,IAAM,kBAAC,IAAD,MAAuB,kBAAC,IAAD,QAGlE,kBAAC,KAAD,CACEE,OAAQ,kBAAC,KAAD,CAAmBrH,IAAK,MAAM,kBAAC,KAAD,QADxC,sGAMF,kBAAC,KAAD,KACE,kBAAC,KAAD,CACEiD,KAAM,OACNsC,IAAK,2BACLpB,KAAM,OACN9D,MAAOiL,EACPxG,SAAU,SAACrC,GAAKoK,EAAQpK,EAAEqD,cAAczF,UAE1C,kBAAC,KAAD,CACE4C,KAAM,OACNsC,IAAK,mDACLpB,KAAM,OACN9D,MAAO8D,EACPW,SAAU,SAACrC,GAAK6D,EAAQ7D,EAAEqD,cAAczF,UAE1C,kBAAC,KAAD,CACE4C,KAAM,SACNsC,IAAK,+DACLpB,KAAM,WACN9D,MAAOyM,EACPhI,SAAU,SAACrC,GAAKsK,EAAYtK,EAAEqD,cAAczF,UAE9C,kBAAC,KAAD,CACE4C,KAAM,SACNsC,IAAK,2BACLpB,KAAM,QACN9D,MAAO2M,EACPlI,SAAU,SAACrC,GAAKwK,EAASxK,EAAEqD,cAAczF,UAE3C,kBAAC,KAAD,CACE8D,KAAM,SACNqJ,QAAS/D,EACT3E,SAAU,SAACrC,GAAKyK,EAAUzK,EAAEqD,cAAc0H,WAH5C,kCAMA,kBAAC,IAAD,CACE/H,KAAK,KACLgI,UAAWnC,IAASnH,IAAS2I,IAAaE,EAC1C/K,KAAMwH,EAAS,WAAa,cAC5B/D,QAAS,WAAO9B,GAAkB,KAJpC,oDAMY6F,EAAS,iCAAU,2CClFxBiE,GA9BH,WAAO,IAAD,EACOjK,qBAAWX,GAA5B6K,EADU,oBAGjB,OACC,kBAAC,IAAD,CAAMC,WAAYD,EAAcpJ,MAC/B,kBAAC,IAAD,CAAMM,GAAI,gBAAiBgJ,YAAaF,EAAcnJ,OACrD,kBAAC,IAAD,CAAOK,GAAI,uBACV,kBAAC,EAAD,CAAe5B,KAAM,WAEtB,kBAAC,IAAD,CAAO4B,GAAI,0BACV,kBAAC,EAAD,CAAe5B,KAAM,eAGvB,kBAAC,IAAD,CAAM4B,GAAI,UAAWgJ,YAAaF,EAAcnJ,OAC/C,kBAAC,IAAD,CAAOK,GAAI,gBACV,kBAAC,EAAD,QAGF,kBAAC,IAAD,CAAMA,GAAI,UAAWgJ,YAAaF,EAAcnJ,OAC/C,kBAAC,IAAD,CAAOK,GAAI,gBACV,kBAAC,GAAD,OAED,kBAAC,IAAD,CAAOA,GAAI,eACV,kBAAC,GAAD,UCdUiJ,GAfS,SAAC,GAAkB,IAAhBC,EAAe,EAAfA,SAY1B,OAVAxN,qBAAU,WACTsG,IAAQC,WAAU,YAAgC,IAAD,IAA5BC,OAAU9D,EAAkB,EAAlBA,KAAM+D,EAAY,EAAZA,KACpC,GAAa,yBAAT/D,EAAiC,CACpC,IAAM+K,EAAkBC,SAASC,gBAAgB,UACjDF,EAAgB3N,MAAQ2G,EAAKmH,OAASnH,EAAKmH,OAAS,eACpDF,SAAS/L,KAAKkM,WAAWC,aAAaL,SAGtC,IAEKD,GCwBMO,GAlCY,SAAC,GAAkB,IAAhBP,EAAe,EAAfA,SAAe,EACdvK,EAAO,kBADO,mBACpC5C,EADoC,KACpCA,SAAW2N,EADyB,OAEZ9K,qBAAWb,GAAlCkB,EAFmC,sBAG5B5C,EAAgB,SAAzBC,EAHqC,oBA+B5C,OA1BAZ,qBAAU,WACJY,GAOLoN,IACAzK,GAAoB,SAAAQ,GAAK,sBACrBA,EADqB,CAExB5D,WAAW,QATXoD,GAAoB,SAAAQ,GAAK,sBACrBA,EADqB,CAExBL,YAAY,SASZ,CAACsK,EAASzK,EAAqB3C,IAElCZ,qBAAU,WACJK,GAELkD,GAAoB,SAAAQ,GAAK,sBACrBA,EADqB,CAExB5D,WAAW,EACXuD,aAAcrD,EAASgE,KACvBV,YAAatD,EAASgE,MAAQ,YAG7B,CAAChE,EAAUkD,IACPiK,GCrBRlH,IAAQiB,KAAK,gBAQb0G,IAASC,OACR,kBAAC,GAAD,KACC,mBdpB6B,SAAC,GAAkB,IAAhBV,EAAe,EAAfA,SAAe,EeDlC,WAAO,IAAD,EACc7N,mBAAS,IADvB,mBACbwO,EADa,KACFC,EADE,OAEczO,oBAAS,GAFvB,mBAEbQ,EAFa,KAEFC,EAFE,OAGYT,mBAAS,MAHrB,mBAGbwD,EAHa,KAGHkL,EAHG,OAIe1O,oBAAS,GAJxB,mBAIb2O,EAJa,KAIGC,EAJH,KAwCpB,OA7BAvO,qBAAU,WACT,GAAKG,EAAL,CAEA,IAAMc,EAASuN,IAAGC,MAAMN,GAExB,GAAKlN,EAAL,CAEAoN,EAAYpN,EAAOyN,YAEnB,IAAMC,EAAU,GAChBC,OAAOC,KAAK5N,GAAQ6N,OAAOC,SAAQ,SAACtP,GACX,QAApBA,EAAIoF,MAAM,EAAG,KAChB8J,EAAQlP,GAAOwB,EAAOxB,OAIxB,IAAMuP,EAAeR,IAAGjN,UAAUoN,GAC5BM,EAAaC,IACjBC,WAAW,SAAU,wBACrBzI,OAAOsI,GACPI,SACAxK,SAAS,UACTyK,QAAQ,MAAO,KACfA,QAAQ,MAAO,KACfA,QAAQ,KAAM,IAEhBd,EAASU,IAAehO,EAAOqO,UAC7B,CAACnP,EAAWgO,IAER,CAAC,CAAChL,WAAUmL,kBAlCD,WAAqB,IAApBH,EAAmB,uDAAP,GAC9BC,EAAaD,GACb/N,GAAa,KfNmCmP,GADD,0BACvCpM,EADuC,EACvCA,SAAUmL,EAD6B,EAC7BA,eAAiBkB,EADY,OAErB7P,mBAAS,CACjCwD,SAAU,KACVmL,gBAAgB,IAJ6B,mBAExCvK,EAFwC,KAEjC0L,EAFiC,KAgB/C,OATAzP,qBAAU,WACRwP,EAAUE,OAAOC,SAASC,OAAO/K,MAAM,MACtC,CAAC2K,IAEJxP,qBAAU,WACHmD,GACLsM,EAAS,CAACtM,WAAUmL,qBACnB,CAACnL,EAAUmL,IAGZ,kBAACnM,EAAe0N,SAAhB,CAAyB/P,MAAO,CAACiE,EAAO0L,IACrCjC,KcEL,KAEE,mBbvB+B,SAAC,GAAkB,IAAhBA,EAAe,EAAfA,SAAe,EAC1B7N,mBAAS,CAClCQ,WAAW,EACXuD,WAAY,KACZC,YAAa,OAJsC,mBAC7CI,EAD6C,KACtC0L,EADsC,KAMpD,OACC,kBAACpN,EAAmBwN,SAApB,CAA6B/P,MAAO,CAACiE,EAAO0L,IAC1CjC,KaeA,KACC,mBZxBgC,SAAC,GAAkB,IAAhBA,EAAe,EAAfA,SAAe,EAC5B7N,mBAAS,CAClCqE,KAAM,gBACNC,MAAO,2BAH8C,mBAC/CF,EAD+C,KACxC0L,EADwC,KAMtD,OACC,kBAAClN,EAAcsN,SAAf,CAAwB/P,MAAO,CAACiE,EAAO0L,IACrCjC,KYgBC,KACC,kBAAC,GAAD,KACC,kBAAC,GAAD,WAQNE,SAASoC,eAAe,W","file":"static/js/main.aea7dc4e.chunk.js","sourcesContent":["import { useState, useEffect } from 'react';\r\n\r\nexport default (key, initialValue = '') => {\r\n  const [value, setValue] = useState(() => {\r\n    return localStorage.getItem(key) || initialValue;\r\n  });\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem(key, value)\r\n  }, [value, key]);\r\n\r\n  return [value, setValue];\r\n}\r\n","import { useState, useEffect, useCallback } from 'react';\r\nimport useLocalStorage from \"./useLocalStorage\";\r\nimport queryString from 'query-string';\r\n\r\nexport default url => {\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [response, setResponse] = useState(null);\r\n\tconst [error, setError] = useState(null);\r\n\tconst [options, setOptions] = useState({});\r\n\tconst [token] = useLocalStorage('token');\r\n\t// const _apiBase = `http://localhost:3000/api`;\r\n\tconst _apiBase = `https://35.238.182.107:8080/api`;\r\n\r\n\tconst doApiFetch = useCallback((options = {}) => {\r\n\t\tsetOptions(options);\r\n\t\tsetIsLoading(true);\r\n\r\n\t}, []);\r\n\r\n\tconst { method = 'GET', params, ...bodyFields} = options;\r\n\tuseEffect(() => {\r\n\t\tif (!isLoading) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst headers = {\r\n\t\t\t'Content-Type': 'application/json',\r\n\t\t\tAuthorization: token ? `Token ${token}` : '',\r\n\t\t};\r\n\r\n\t\tconst qString = params ? queryString.stringify(params) : null;\r\n\r\n\t\tconst uri = qString ? `${_apiBase}${url}?${qString}` : `${_apiBase}${url}`;\r\n\r\n\t\tfetch(uri, {\r\n\t\t\tmethod,\r\n\t\t\tmode: 'cors',\r\n\t\t\theaders,\r\n\t\t\tbody: method !== 'GET' ? JSON.stringify(bodyFields) : null,\r\n\t\t})\r\n\t\t\t.then(res => res.json())\r\n\t\t\t.then(r => {\r\n\t\t\t\tsetIsLoading(false);\r\n\t\t\t\tsetResponse(r);\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tsetIsLoading(false);\r\n\t\t\t\tsetError(e);\r\n\t\t\t});\r\n\t}, [isLoading, bodyFields, method, url, _apiBase, token, params]);\r\n\treturn [{isLoading, response, error}, doApiFetch];\r\n}\r\n","import React, { useState, createContext, useEffect } from 'react';\r\nimport useCompareSign from \"../hooks/useCompareSign\";\r\n\r\nexport const AppSignContext = createContext([{}, () => {}]);\r\n\r\nexport const AppSignProvider = ({ children }) => {\r\n  const [{vkUserId, matchUrlParams}, setParams] = useCompareSign();\r\n  const [state, setState] = useState({\r\n    vkUserId: null,\r\n    matchUrlParams: false\r\n  });\r\n\r\n  useEffect(()=>{\r\n    setParams(window.location.search.slice(1));\r\n  }, [setParams]);\r\n\r\n  useEffect(() => {\r\n    if (!vkUserId) return;\r\n    setState({vkUserId, matchUrlParams});\r\n  }, [vkUserId, matchUrlParams]);\r\n\r\n  return (\r\n    <AppSignContext.Provider value={[state, setState]}>\r\n      {children}\r\n    </AppSignContext.Provider>\r\n  )\r\n};","import React, { createContext, useState } from 'react';\r\n\r\nexport const CurrentUserContext = createContext([{}, p => {}]);\r\n\r\nexport const CurrentUserProvider = ({ children }) => {\r\n\tconst [state, setState] = useState({\r\n\t\tisLoading: false,\r\n\t\tisLoggedIn: null,\r\n\t\tcurrentUser: null\r\n\t});\r\n\treturn (\r\n\t\t<CurrentUserContext.Provider value={[state, setState]}>\r\n\t\t\t{children}\r\n\t\t</CurrentUserContext.Provider>\r\n\t)\r\n};\r\n","import React, { createContext, useState } from 'react';\r\n\r\nexport const RouterContext = createContext([{}, p => {}]);\r\n\r\nexport const RouterContextProvider = ({ children }) => {\r\n\tconst [state, setState] = useState({\r\n\t\tview: 'authorization',\r\n\t\tpanel: 'authorization.register'\r\n\t});\r\n\r\n\treturn (\r\n\t\t<RouterContext.Provider value={[state, setState]}>\r\n\t\t\t{children}\r\n\t\t</RouterContext.Provider>\r\n\t)\r\n};","import React, {Fragment, useState, useEffect, useContext} from 'react';\r\nimport {Div, FormLayout, FormLayoutGroup, Input, Placeholder, FormStatus} from \"@vkontakte/vkui\";\r\nimport PanelHeader from \"@vkontakte/vkui/dist/components/PanelHeader/PanelHeader\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Icon56LockOutline from '@vkontakte/icons/dist/56/lock_outline';\r\nimport Icon56UserAddOutline from '@vkontakte/icons/dist/56/user_add_outline';\r\nimport useApi from \"../hooks/useApi\";\r\nimport {AppSignContext} from \"../contexts/appSign\";\r\nimport {CurrentUserContext} from \"../contexts/currentUser\";\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nconst Authorization = ({go, goView, type}) => {\r\n\tconst [password, setPassword] = useState('');\r\n\tconst [confirmPassword, setConfirmPassword] = useState('');\r\n\tconst [formError, setFormError] = useState(null);\r\n\tconst [{response, error}, doApiFetch] = useApi(`/users/${type}`);\r\n\tconst [{vkUserId}] = useContext(AppSignContext);\r\n\tconst [startFetchData, setStartFetchData] = useState(false);\r\n\tconst [currentUserState, setCurrentUserState] = useContext(CurrentUserContext);\r\n\tconst [, setToken] = useLocalStorage('token');\r\n\tconst [,setRouterContext] = useContext(RouterContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!currentUserState.isLoggedIn) return;\r\n\t\tconst {name, phone, email, password} = currentUserState.currentUser;\r\n\t\tif (!name || !phone || !email || !password) {\r\n\t\t\tsetRouterContext(state =>({\r\n\t\t\t\t...state,\r\n\t\t\t\tview: 'profile',\r\n\t\t\t\tpanel: 'profile.edit'\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tsetRouterContext(state => ({\r\n\t\t\t\t...state,\r\n\t\t\t\tview: 'balance',\r\n\t\t\t\tpanel: 'balance.home'\r\n\t\t\t}));\r\n\t\t}\r\n\t},[currentUserState, setRouterContext]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (type === 'login') return;\r\n\r\n\t\tif ((password.length !== confirmPassword.length)) {\r\n\t\t\tsetFormError(null);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (password !== confirmPassword) {\r\n\t\t\tsetFormError({status: 'Ошибка валидации', message: 'Пароли не совпадают. Проверьте ввод и повторите попытку.'});\r\n\t\t}\r\n\t}, [password, confirmPassword, type]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (!startFetchData) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'POST',\r\n\t\t\tuser: {\r\n\t\t\t\tid: +vkUserId,\r\n\t\t\t\tpassword: password\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdoApiFetch(body);\r\n\t\tsetStartFetchData(false);\r\n\t},[startFetchData, doApiFetch, password, vkUserId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\r\n\t\tif (!response.user && response.error) {\r\n\t\t\tsetFormError(response.error);\r\n\t\t} else {\r\n\t\t\tsetToken(response.user.token);\r\n\t\t}\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!response.user,\r\n\t\t\tcurrentUser: response.user || null\r\n\t\t}));\r\n\r\n\t}, [response, setCurrentUserState, go, goView, setToken]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!error) return;\r\n\t\tsetFormError(error);\r\n\t}, [error]);\r\n\r\n\tconst onChange = (e) => {\r\n\t\te.target.value = Math.max(0, parseInt(e.target.value) ).toString().slice(0,4);\r\n\t\tif (e.target.name === 'password') {\r\n\t\t\tsetPassword(e.target.value);\r\n\t\t} else {\r\n\t\t\tsetConfirmPassword(e.target.value);\r\n\t\t}\r\n\t};\r\n\r\n\tconst formStatus = () => {\r\n\t\tif (!formError) return null;\r\n\t\treturn (\r\n\t\t\t<FormStatus header={formError.status} mode=\"error\">\r\n\t\t\t\t{formError.message}\r\n\t\t\t</FormStatus>\r\n\t\t)\r\n\t};\r\n\r\n\tconst formButtonClick = async () => {\r\n\t\tsetStartFetchData(true);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>{type === 'login' ? 'Авторизация' : 'Регистрация'}</PanelHeader>\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={type === 'login' ? <Icon56LockOutline /> : <Icon56UserAddOutline />}\r\n\t\t\t\theader={type === 'login' ? 'Введите пароль' : 'Придумайте пароль'}\r\n\t\t\t>\r\n\t\t\t\t<FormLayout>\r\n\t\t\t\t\t{formStatus()}\r\n\t\t\t\t\t<FormLayoutGroup top={'Введите пароль'}>\r\n\t\t\t\t\t\t<Input name={'password'} type={'number'} onChange = {onChange} align=\"center\" value={password}/>\r\n\t\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype !== 'login'\r\n\t\t\t\t\t\t\t?\r\n\t\t\t\t\t\t\t<FormLayoutGroup top={'Повторите пароль'}>\r\n\t\t\t\t\t\t\t\t<Input type={'number'} name={'confirmPassword'} onChange = {onChange} align=\"center\" value={confirmPassword}/>\r\n\t\t\t\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<Button size=\"l\" onClick={formButtonClick}>{type === 'login' ? 'Авторизация' : 'Регистрация'}</Button>\r\n\t\t\t\t</FormLayout>\r\n\t\t\t</Placeholder>\r\n\t\t\t<Div>\r\n\t\t\t\t<Button\r\n\t\t\t\t\tstretched\r\n\t\t\t\t\tmode=\"tertiary\"\r\n\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\tsetRouterContext(state => ({\r\n\t\t\t\t\t\t\t...state,\r\n\t\t\t\t\t\t\tpanel: e.currentTarget.dataset.to\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tdata-to={type === 'login' ? 'authorization.register' : 'authorization.login'}\r\n\t\t\t\t>{type === 'login' ? 'Нет пароля?' : 'Есть пароль?'}</Button>\r\n\t\t\t</Div>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Authorization;\r\n","import React, {useState, useEffect, Fragment, useContext} from 'react';\r\nimport {\r\n\tFormLayout,\r\n\tIOS,\r\n\tPanelHeader,\r\n\tplatform,\r\n\tPanelHeaderButton,\r\n\tGroup, Cell, Button, Input, FormLayoutGroup, FormStatus\r\n} from '@vkontakte/vkui';\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport connect from \"@vkontakte/vk-connect\";\r\nimport Avatar from \"@vkontakte/vkui/dist/components/Avatar/Avatar\";\r\nimport useApi from \"../hooks/useApi\";\r\nimport {CurrentUserContext} from \"../contexts/currentUser\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nconst Profile = ({go, fetchedUser}) =>{\r\n\tconst [email, setEmail] = useState('');\r\n\tconst [phone, setPhone] = useState('');\r\n\tconst [name, setName] = useState('');\r\n\tconst [kktPassword, setKktPassword] = useState('');\r\n\tconst [fetchToFns, setFetchToFns] = useState(false);\r\n\t//TODO Использовать {response, error} чтобы делать переход или показывать ошибки\r\n\tconst [{response}, doApiFetch] = useApi(`/users/profile`);\r\n\tconst [startFetchData, setStartFetchData] = useState(false);\r\n\tconst [currentUserState] = useContext(CurrentUserContext);\r\n\tconst [,setRouterContext] = useContext(RouterContext);\r\n\tconst osName = platform();\r\n\r\n\tuseEffect(()=>{\r\n\t\t//TODO Перейти с connect на bridge!!!!\r\n\t\tconnect.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'VKWebAppGetPersonalCardResult':\r\n\t\t\t\t\tsetEmail(data.email);\r\n\t\t\t\t\tsetPhone(data.phone);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetEmail(currentUserState.currentUser.email || '');\r\n\t\tsetName(currentUserState.currentUser.name || '');\r\n\t\tsetPhone(currentUserState.currentUser.phone || '');\r\n\t\tsetKktPassword(currentUserState.currentUser.password || '');\r\n\t}, [currentUserState]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (!startFetchData) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'PUT',\r\n\t\t\tupdate: {\r\n\t\t\t\temail,\r\n\t\t\t\tphone,\r\n\t\t\t\tname,\r\n\t\t\t\tkktPassword\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdoApiFetch(body);\r\n\t\tsetStartFetchData(false);\r\n\t},[startFetchData, doApiFetch, email, phone, name, kktPassword]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tconst { user } = response;\r\n\t\tif (!user.name || !user.phone || !user.email || !user.password) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsetRouterContext(state => ({\r\n\t\t\t...state,\r\n\t\t\tview: 'balance',\r\n\t\t\tpanel: 'balance.home'\r\n\t\t}));\r\n\t}, [response, setRouterContext]);\r\n\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={<PanelHeaderButton onClick={go} data-to=\"home\">\r\n\t\t\t\t\t{osName === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}\r\n\t\t\t\t</PanelHeaderButton>}\r\n\t\t\t>\r\n\t\t\t\tПрофиль\r\n\t\t\t</PanelHeader>\r\n\t\t\t{fetchedUser &&\r\n\t\t\t<Group title={fetchedUser.id}>\r\n\t\t\t\t<Cell\r\n\t\t\t\t\tbefore={fetchedUser.photo_200 ? <Avatar src={fetchedUser.photo_200}/> : null}\r\n\t\t\t\t\tdescription={fetchedUser.city && fetchedUser.city.title ? fetchedUser.city.title : ''}\r\n\t\t\t\t>\r\n\t\t\t\t\t{`${fetchedUser.first_name} ${fetchedUser.last_name}`}\r\n\t\t\t\t</Cell>\r\n\t\t\t</Group>}\r\n\t\t\t<FormLayout>\r\n\t\t\t\t{fetchToFns && <FormStatus header=\"Запрос на получение пароля успешно отправлен\" mode=\"default\">\r\n\t\t\t\t\tПароль должен придти к вам в смс. Введите пароль в соответствующее поле. Если пароль не пришел повторите попытку позже.\r\n\t\t\t\t</FormStatus>}\r\n\t\t\t\t<Input\r\n\t\t\t\t\ttype={'text'}\r\n\t\t\t\t\ttop={'Имя'}\r\n\t\t\t\t\tname={'name'}\r\n\t\t\t\t\tvalue={name}\r\n\t\t\t\t\tonChange={(e) => {setName(e.target.value)}}\r\n\t\t\t\t/>\r\n\t\t\t\t<FormLayoutGroup top=\"E-mail и Телефон\" bottom=\"Эти данные можно получить через персональные карточки Вконтакте. Они нужны для того, чтобы получить пароль от ФНС для расшифровки чеков.\">\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'email'}\r\n\t\t\t\t\t\ttop={'e-mail'}\r\n\t\t\t\t\t\tname={'email'}\r\n\t\t\t\t\t\tplaceholder={'Введите e-mail'}\r\n\t\t\t\t\t\tvalue={email}\r\n\t\t\t\t\t\tonChange={(e) => {setEmail(e.target.value)}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'phone'}\r\n\t\t\t\t\t\ttop={'Телефон'}\r\n\t\t\t\t\t\tname={'phone'}\r\n\t\t\t\t\t\tvalue={phone}\r\n\t\t\t\t\t\tplaceholder={'Введите телефон'}\r\n\t\t\t\t\t\tonChange={(e) => {setPhone(e.target.value)}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Button size=\"xl\" onClick={() => {\r\n\t\t\t\t\t\t//TODO Перейти с connect на bridge!!!!\r\n\t\t\t\t\t\tconnect.send(\"VKWebAppGetPersonalCard\", {\"type\": [\"phone\", \"email\"]});\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t\tПолучить данные из VK\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t<FormLayoutGroup top={'Пароль от ФНС'}>\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'number'}\r\n\t\t\t\t\t\ttop={'Пароль от ФНС'}\r\n\t\t\t\t\t\tplaceholder={'Введите пароль ФНС'}\r\n\t\t\t\t\t\tname={'kktPassword'}\r\n\t\t\t\t\t\tvalue={kktPassword}\r\n\t\t\t\t\t\tonChange={(e) => {setKktPassword(e.target.value)}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Button size=\"xl\" onClick={() => {\r\n\t\t\t\t\t\tsetFetchToFns(true);\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t\tПолучить пароль от ФНС\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</FormLayoutGroup>\r\n\r\n\t\t\t\t<Button size=\"xl\" mode=\"commerce\" onClick={() => {\r\n\t\t\t\t\tsetStartFetchData(true);\r\n\t\t\t\t}}>\r\n\t\t\t\t\tОбновить профиль пользователя\r\n\t\t\t\t</Button>\r\n\t\t\t</FormLayout>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Profile;\r\n","export default class Prepare {\r\n\t/**\r\n\t * Преобразование qr кода\r\n\t * @param str\r\n\t * @returns {{dt: *, fn: *, i: *, sum: *, fp: *}}\r\n\t */\r\n\tstatic qr (str){\r\n\t\tlet dt, sum, fn, i, fp;\r\n\r\n\t\tif (str) {\r\n\t\t\t[, dt, sum, fn, i, fp] = str.match(/t=(\\w{8}T\\w+)&s=(\\w+\\.*\\w+)&fn=(\\w+)&i=(\\w+)&fp=(\\w+)/);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tdt,\r\n\t\t\tsum,\r\n\t\t\tfn,\r\n\t\t\ti,\r\n\t\t\tfp\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Преобразование даты\r\n\t * @param str\r\n\t * @returns {string}\r\n\t */\r\n\tstatic date(str) {\r\n\t\tconst dt = new Date(str);\r\n\t\tlet monthName;\r\n\t\tswitch (dt.getMonth() + 1) {\r\n\t\t\tcase 1:\r\n\t\t\t\tmonthName = 'января';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tmonthName = 'февраля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tmonthName = 'марта';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tmonthName = 'апреля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tmonthName = 'мая';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tmonthName = 'июня';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7:\r\n\t\t\t\tmonthName = 'июля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8:\r\n\t\t\t\tmonthName = 'августа';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 9:\r\n\t\t\t\tmonthName = 'сентября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 10:\r\n\t\t\t\tmonthName = 'октября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 11:\r\n\t\t\t\tmonthName = 'ноября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 12:\r\n\t\t\t\tmonthName = 'декабря';\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn `${dt.getDate()} ${monthName} ${dt.getFullYear()}`;\r\n\t}\r\n\r\n\t/**\r\n\t * Преобразование суммы\r\n\t * @param n\r\n\t * @returns {string}\r\n\t */\r\n\tstatic sum(n) {\r\n\t\treturn new Intl.NumberFormat('ru-RU', {style: 'currency', currency: 'RUB'}).format(n / 100);\r\n\t}\r\n\r\n\t/**\r\n\t * Расчет общей суммы\r\n\t * @param arr\r\n\t * @returns {number}\r\n\t */\r\n\tstatic totalReceiptSum(arr) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\treturn arr.map((item) => {\r\n\t\t\treturn item.totalSum;\r\n\t\t}).reduce(reducer);\r\n\t}\r\n\r\n\t/**\r\n\t * Подсчет суммарных доходов / расходов\r\n\t * @param arr\r\n\t * @param income\r\n\t * @returns {number}\r\n\t */\r\n\tstatic totalSum(arr, income) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\tconst ts = arr.map(items => {\r\n\t\t\treturn items.items.map(item => {\r\n\t\t\t\tif (income) {\r\n\t\t\t\t\treturn item.income ? item.sum : 0\r\n\t\t\t\t}\r\n\t\t\t\treturn !item.income ? item.sum : 0\r\n\t\t\t}).reduce(reducer)\r\n\t\t}).reduce(reducer);\r\n\t\treturn income ? ts : -1 * ts;\r\n\t}\r\n}","import React from 'react';\r\nimport prepare from \"../handlers/prepare\";\r\n\r\nconst ColoredSum = ({sum, fs}) => {\r\n\tconst stl = sum >= 0 ? {color: '#28a745', fontSize: fs} : {color: '#dc3545', fontSize: fs};\r\n\treturn(\r\n\t\t<span style={stl}>{prepare.sum(sum)}</span>\r\n\t)\r\n};\r\n\r\nexport default ColoredSum;\r\n","import React, { createContext, useState } from 'react';\r\n\r\nexport const LoadingContext = createContext([{}, p => {}]);\r\n\r\nexport const LoadingProvider = ({ children }) => {\r\n\tconst [state, setState] = useState({\r\n\t\tpopout: null\r\n\t});\r\n\r\n\treturn (\r\n\t\t<LoadingContext.Provider value={[state, setState]}>\r\n\t\t\t{ children }\r\n\t\t</LoadingContext.Provider>\r\n\t)\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport {format, addMonths, subMonths} from 'date-fns';\r\nimport { ru } from 'date-fns/locale'\r\nimport {Group, List, Cell, Button} from \"@vkontakte/vkui\";\r\nimport Icon24BrowserBack from '@vkontakte/icons/dist/24/browser_back';\r\nimport Icon24BrowserForward from '@vkontakte/icons/dist/24/browser_forward';\r\n\r\nconst Calendar = ({setDateFromCalendar}) => {\r\n  const [currentDate, setCurrentDate] = useState(new Date());\r\n  const dateFormat = 'LLLL yyyy';\r\n\r\n  useEffect(() => {\r\n    setDateFromCalendar(currentDate);\r\n  }, [currentDate, setDateFromCalendar]);\r\n\r\n  const nextMonth = () => {\r\n    setCurrentDate(addMonths(currentDate, 1));\r\n  };\r\n\r\n  const prevMonth = () => {\r\n    setCurrentDate(subMonths(currentDate, 1));\r\n  };\r\n\r\n  return(\r\n    <Group>\r\n      <List>\r\n        <Cell\r\n          before={<Button onClick={prevMonth} mode={'secondary'}><Icon24BrowserBack /></Button>}\r\n          asideContent={<Button onClick={nextMonth} mode={'secondary'}><Icon24BrowserForward /></Button>}\r\n          style={{textAlign: 'center', fontWeight: 'bold'}}\r\n        >\r\n          {format(currentDate, dateFormat, {locale: ru}).toLocaleUpperCase()}\r\n        </Cell>\r\n      </List>\r\n    </Group>\r\n  )\r\n};\r\n\r\nexport default Calendar;","import React, {useState, useEffect, Fragment, useContext, useCallback} from 'react';\r\nimport useApi from \"../hooks/useApi\";\r\nimport PanelHeader from \"@vkontakte/vkui/dist/components/PanelHeader/PanelHeader\";\r\nimport {List, Placeholder, Separator} from \"@vkontakte/vkui\";\r\nimport ColoredSum from \"./ColoredSum\";\r\nimport prepare from \"../handlers/prepare\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Group from \"@vkontakte/vkui/dist/components/Group/Group\";\r\nimport Cell from \"@vkontakte/vkui/dist/components/Cell/Cell\";\r\nimport Icon56GoodsCollection from '@vkontakte/icons/dist/56/goods_collection';\r\nimport Icon16Up from '@vkontakte/icons/dist/16/up';\r\nimport Icon16Down from '@vkontakte/icons/dist/16/down';\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport {LoadingContext} from \"../contexts/loadingContext\";\r\nimport Calendar from \"../components/Calendar\";\r\nimport {format} from 'date-fns';\r\n\r\nconst Balance = () => {\r\n\tconst [initialFetch, setInitialFetch] = useState(true);\r\n\tconst [currentDate, setCurrentDate] = useState(new Date());\r\n\t// const [dateRange, setDateRange] = useState([\r\n\t// \tnew Date(currentDate.getFullYear(), currentDate.getMonth(), 1),\r\n\t// \tnew Date(currentDate.getFullYear(), currentDate.getMonth()+1, 0),\r\n\t// ]);\r\n\tconst [receipts, setReceipts] = useState([]);\r\n\tconst [{response}, doApiFetch] = useApi('/day');\r\n\tconst [, setRouterContext] = useContext(RouterContext);\r\n\tconst [, setPopout] = useContext(LoadingContext);\r\n\tconst dateFormat = 'yyyy-MM-dd';\r\n\r\n\tconst setDateFromCalendar = useCallback((date) => {\r\n\t\tsetCurrentDate(date);\r\n\t\tsetInitialFetch(true);\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!initialFetch) return;\r\n\t\tdoApiFetch({\r\n\t\t\tparams: {\r\n\t\t\t\tdate: format(currentDate, dateFormat)\r\n\t\t\t}\r\n\t\t});\r\n\t\tsetInitialFetch(false);\r\n\t}, [initialFetch, setInitialFetch, doApiFetch, setPopout, currentDate]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tsetReceipts(response);\r\n\t}, [response, setPopout]);\r\n\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>Balance</PanelHeader>\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={<Icon56GoodsCollection />}\r\n\t\t\t\theader={<ColoredSum sum={prepare.totalReceiptSum(receipts)} fs={'2em'}/>}\r\n\t\t\t\taction={<Button size=\"l\" onClick={()=>{\r\n\t\t\t\t\tsetRouterContext(state => ({\r\n\t\t\t\t\t\t...state,\r\n\t\t\t\t\t\tpanel: 'balance.add'\r\n\t\t\t\t\t}));\r\n\t\t\t\t}} data-to={'addnote'}>Добавить доход / расход</Button>}\r\n\t\t\t>\r\n\t\t\t\tДобавляйте доходы/расходы\r\n\t\t\t</Placeholder>\r\n\t\t\t<Separator/>\r\n\t\t\t<div style={{\r\n\t\t\t\tdisplay: 'flex',\r\n\t\t\t\tflexDirection: 'row',\r\n\t\t\t\tjustifyContent: 'space-between',\r\n\t\t\t\tpaddingTop: '1em',\r\n\t\t\t}}>\r\n\t\t\t\t<div style={{flex: '0 1 50%', display: 'flex',justifyContent: 'flex-end',}}>\r\n\t\t\t\t\t<div style={{display: 'flex', flexDirection: 'column', paddingRight: '10px'}}>\r\n\t\t\t\t\t\t<span style={{color: '#6F6F6F', fontSize: '0.7em', textAlign: 'end'}}>Доходы</span>\r\n\t\t\t\t\t\t<ColoredSum sum={prepare.totalSum(receipts, true)} fs={'1.4em'}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<Icon16Up width={16} height={40} fill={'#28a745'}/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style={{flex: '0 1 50%', display: 'flex',justifyContent: 'flex-start',}}>\r\n\t\t\t\t\t<Icon16Down width={16} height={40} fill={'#dc3545'}/>\r\n\t\t\t\t\t<div style={{display: 'flex', flexDirection: 'column', paddingLeft: '10px'}}>\r\n\t\t\t\t\t\t<span style={{color: '#6F6F6F', fontSize: '0.7em'}}>Расходы</span>\r\n\t\t\t\t\t\t<ColoredSum sum={prepare.totalSum(receipts, false)} fs={'1.4em'}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<Group title='Чеки'>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t<Calendar setDateFromCalendar={setDateFromCalendar}/>\r\n\t\t\t\t\t{receipts.map((receipt, index) => {\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\texpandable\r\n\t\t\t\t\t\t\t\tonClick={(e) => this.setActiveModal(e.currentTarget.dataset.to)}\r\n\t\t\t\t\t\t\t\tdata-to={receipt._id}\r\n\t\t\t\t\t\t\t\tindicator={<ColoredSum sum={receipt.totalSum}/>}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{prepare.date(receipt.dateTime)}\r\n\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t})}\r\n\t\t\t\t</List>\r\n\t\t\t</Group>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Balance;\r\n","import React, {useState, useEffect, useContext, Fragment} from 'react';\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\r\nimport FormLayout from \"@vkontakte/vkui/dist/components/FormLayout/FormLayout\";\r\nimport Input from \"@vkontakte/vkui/dist/components/Input/Input\";\r\nimport PanelHeaderButton from \"@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton\";\r\nimport {IOS, platform} from \"@vkontakte/vkui\";\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Checkbox from \"@vkontakte/vkui/dist/components/Checkbox/Checkbox\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Icon24Qr from '@vkontakte/icons/dist/24/qr';\r\nimport PanelHeaderContent from \"@vkontakte/vkui/dist/components/PanelHeaderContent/PanelHeaderContent\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport useApi from \"../hooks/useApi\";\r\n\r\nconst AddDay = () => {\r\n  const [name, setName] = useState('');\r\n  const [date, setDate] = useState(() => {\r\n    const date = new Date();\r\n    const m = date.getMonth()+1 > 9 ? date.getMonth()+1 : `0${date.getMonth()+1}`;\r\n    const d = date.getDate() > 9 ? date.getDate() : `0${date.getDate()}`;\r\n    return `${date.getFullYear()}-${m}-${d}`;\r\n  });\r\n  const [quantity, setQuantity] = useState(1);\r\n  const [price, setPrice] = useState('');\r\n  const [income, setIncome] = useState(false);\r\n  const [, setRouterContext] = useContext(RouterContext);\r\n  const [{response}, doApiFetch] = useApi('/day');\r\n  const [startFetchData, setStartFetchData] = useState(false);\r\n  const osname = platform();\r\n\r\n  useEffect(() => {\r\n    if (!startFetchData) return;\r\n    const body = {\r\n      method: 'POST',\r\n      date: date,\r\n      items: [\r\n        {\r\n          name,\r\n          quantity,\r\n          price: price * 100,\r\n          sum: price * 100 * quantity,\r\n          income,\r\n          modifiers: [],\r\n          properties: [],\r\n        }\r\n      ]\r\n    };\r\n    doApiFetch(body);\r\n\r\n    setName('');\r\n    setQuantity(1);\r\n    setIncome(false);\r\n    setPrice('');\r\n    setStartFetchData(false);\r\n  }, [startFetchData, setStartFetchData, date, doApiFetch, income, name, price, quantity]);\r\n\r\n  useEffect(() => {\r\n    if (!response) return;\r\n    console.log(response);\r\n  }, [response]);\r\n\r\n  return(\r\n    <Fragment>\r\n      <PanelHeader\r\n        left={\r\n          <PanelHeaderButton key={'back'} onClick={() => {\r\n            setRouterContext(state => ({\r\n              ...state,\r\n              panel: 'balance.home'\r\n            }));\r\n          }} data-to={'balance'}>{osname === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}</PanelHeaderButton>\r\n        }\r\n      >\r\n        <PanelHeaderContent\r\n          before={<PanelHeaderButton key={'qr'}><Icon24Qr /></PanelHeaderButton>}\r\n        >\r\n          Добавление записи\r\n        </PanelHeaderContent>\r\n      </PanelHeader>\r\n      <FormLayout>\r\n        <Input\r\n          type={'date'}\r\n          top={'Дата'}\r\n          name={'date'}\r\n          value={date}\r\n          onChange={(e)=>{setDate(e.currentTarget.value)}}\r\n        />\r\n        <Input\r\n          type={'text'}\r\n          top={'Название'}\r\n          name={'name'}\r\n          value={name}\r\n          onChange={(e)=>{setName(e.currentTarget.value)}}\r\n        />\r\n        <Input\r\n          type={'number'}\r\n          top={'Количество'}\r\n          name={'quantity'}\r\n          value={quantity}\r\n          onChange={(e)=>{setQuantity(e.currentTarget.value)}}\r\n        />\r\n        <Input\r\n          type={'number'}\r\n          top={'Цена'}\r\n          name={'price'}\r\n          value={price}\r\n          onChange={(e)=>{setPrice(e.currentTarget.value)}}\r\n        />\r\n        <Checkbox\r\n          name={'income'}\r\n          checked={income}\r\n          onChange={(e)=>{setIncome(e.currentTarget.checked)}}\r\n        >Доход</Checkbox>\r\n\r\n        <Button\r\n          size=\"xl\"\r\n          disabled={!date || !name || !quantity || !price}\r\n          mode={income ? \"commerce\" : \"destructive\"}\r\n          onClick={() => {setStartFetchData(true)}}\r\n        >\r\n          Добавить {income ? \"доход\" : \"расход\"}\r\n        </Button>\r\n      </FormLayout>\r\n    </Fragment>\r\n  )\r\n};\r\n\r\nexport default AddDay;","import React, {useContext} from 'react';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport {Root, Panel, View} from \"@vkontakte/vkui\";\r\nimport Authorization from \"./panels/Authorization\";\r\nimport Profile from \"./panels/Profile\";\r\nimport {RouterContext} from \"./contexts/routerContext\";\r\nimport Balance from \"./panels/Balance\";\r\nimport AddDay from \"./panels/AddDay\";\r\n\r\nconst App = () => {\r\n\tconst [routerContext] = useContext(RouterContext);\r\n\r\n\treturn (\r\n\t\t<Root activeView={routerContext.view}>\r\n\t\t\t<View id={'authorization'} activePanel={routerContext.panel}>\r\n\t\t\t\t<Panel id={'authorization.login'}>\r\n\t\t\t\t\t<Authorization type={'login'} />\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'authorization.register'}>\r\n\t\t\t\t\t<Authorization type={'register'} />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'profile'} activePanel={routerContext.panel}>\r\n\t\t\t\t<Panel id={'profile.edit'}>\r\n\t\t\t\t\t<Profile />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'balance'} activePanel={routerContext.panel}>\r\n\t\t\t\t<Panel id={'balance.home'}>\r\n\t\t\t\t\t<Balance />\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'balance.add'}>\r\n\t\t\t\t\t<AddDay />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t</Root>\r\n\t);\r\n};\r\n\r\nexport default App;\r\n","import { useEffect } from 'react';\r\nimport connect from \"@vkontakte/vk-connect\";\r\n\r\nconst InstallingTheme = ({ children }) => {\r\n\r\n\tuseEffect(() => {\r\n\t\tconnect.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\r\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\r\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\r\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\r\n\t\t\t}\r\n\t\t});\r\n\t}, []);\r\n\r\n\treturn (children)\r\n};\r\n\r\nexport default InstallingTheme;\r\n","import { useEffect, useContext } from 'react';\r\nimport useApi from \"../hooks/useApi\";\r\nimport { CurrentUserContext } from '../contexts/currentUser';\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\n\r\nconst CurrentUserChecker = ({ children }) => {\r\n\tconst [{response}, doFetch] = useApi('/users/profile');\r\n\tconst [, setCurrentUserState] = useContext(CurrentUserContext);\r\n\tconst [token] = useLocalStorage('token');\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!token) {\r\n\t\t\tsetCurrentUserState(state => ({\r\n\t\t\t\t...state,\r\n\t\t\t\tisLoggedIn: false\r\n\t\t\t}));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdoFetch();\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: true\r\n\t\t}))\r\n\t}, [doFetch, setCurrentUserState, token]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!response.user,\r\n\t\t\tcurrentUser: response.user || null\r\n\t\t}));\r\n\r\n\t}, [response, setCurrentUserState]);\r\n\treturn children;\r\n};\r\n\r\nexport default CurrentUserChecker;\r\n","import 'core-js/features/map';\r\nimport 'core-js/features/set';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport connect from '@vkontakte/vk-connect';\r\nimport App from './App';\r\nimport {CurrentUserProvider} from \"./contexts/currentUser\";\r\nimport {AppSignProvider} from \"./contexts/appSign\";\r\nimport InstallingTheme from \"./components/InstallingTheme\";\r\nimport CurrentUserChecker from \"./components/CurrentUserChecker\";\r\nimport {RouterContextProvider} from \"./contexts/routerContext\";\r\n//import {LoadingProvider} from \"./contexts/loadingContext\";\r\n// import registerServiceWorker from './sw';\r\n\r\n// Init VK  Mini App\r\nconnect.send('VKWebAppInit');\r\n\r\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\r\n// расскомментируйте строку с registerServiceWorker();\r\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\r\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\r\n// registerServiceWorker();\r\n\r\nReactDOM.render(\r\n\t<InstallingTheme>\r\n\t\t<AppSignProvider>\r\n\t\t\t{/*<LoadingProvider>*/}\r\n\t\t\t\t<CurrentUserProvider>\r\n\t\t\t\t\t<RouterContextProvider>\r\n\t\t\t\t\t\t<CurrentUserChecker>\r\n\t\t\t\t\t\t\t<App />\r\n\t\t\t\t\t\t</CurrentUserChecker>\r\n\t\t\t\t\t</RouterContextProvider>\r\n\t\t\t\t</CurrentUserProvider>\r\n\t\t\t{/*</LoadingProvider>*/}\r\n\t\t</AppSignProvider>\r\n\t</InstallingTheme>\r\n\t,\r\n\tdocument.getElementById('root')\r\n);\r\n","import { useState, useEffect } from 'react';\r\nimport qs from 'querystring';\r\nimport crypto from 'crypto';\r\n\r\nexport default () => {\r\n\tconst [urlParams, setUrlParams] = useState('');\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [vkUserId, setVkUserId] = useState(null);\r\n\tconst [matchUrlParams, setMatch] = useState(false);\r\n\r\n\tconst setParams = (urlParams = '') => {\r\n\t\tsetUrlParams(urlParams);\r\n\t\tsetIsLoading(true);\r\n\t};\r\n\r\n\tuseEffect(() =>{\r\n\t\tif( !isLoading ) return;\r\n\r\n\t\tconst params = qs.parse(urlParams);\r\n\r\n\t\tif (!params) return;\r\n\r\n\t\tsetVkUserId(params.vk_user_id);\r\n\r\n\t\tconst ordered = {};\r\n\t\tObject.keys(params).sort().forEach((key) => {\r\n\t\t\tif (key.slice(0, 3) === 'vk_') {\r\n\t\t\t\tordered[key] = params[key];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst stringParams = qs.stringify(ordered);\r\n\t\tconst paramsHash = crypto\r\n\t\t\t.createHmac('sha256', 'Zs6DYRE8Z2mZ44LfciKW')\r\n\t\t\t.update(stringParams)\r\n\t\t\t.digest()\r\n\t\t\t.toString('base64')\r\n\t\t\t.replace(/\\+/g, '-')\r\n\t\t\t.replace(/\\//g, '_')\r\n\t\t\t.replace(/=$/, '');\r\n\r\n\t\tsetMatch(paramsHash === params.sign);\r\n\t}, [isLoading, urlParams]);\r\n\r\n\treturn [{vkUserId, matchUrlParams}, setParams];\r\n}"],"sourceRoot":""}