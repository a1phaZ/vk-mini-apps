(this["webpackJsonpvk-mini-apps-empty"]=this["webpackJsonpvk-mini-apps-empty"]||[]).push([[0],{236:function(e,t,a){e.exports=a(416)},327:function(e,t){},329:function(e,t){},362:function(e,t){},363:function(e,t){},416:function(e,t,a){"use strict";a.r(t);a(237),a(263),a(265),a(266),a(268),a(269),a(270),a(271),a(272),a(273),a(274),a(275),a(277),a(278),a(279),a(280),a(281),a(282),a(283),a(284),a(285),a(286),a(288),a(289),a(290),a(291),a(292),a(293),a(294),a(295),a(296),a(297),a(298),a(299),a(300),a(301),a(302),a(303),a(304),a(305);var n=a(0),c=a.n(n),r=a(102),o=a.n(r),i=a(39),u=a.n(i),l=a(9),s=(a(313),a(17)),b=a(103),f=a.n(b),m=a(172),d=a(178),g=a(177),j=a.n(g),O=a(105),h=a.n(O),p=a(173),v=a.n(p),E=a(174),S=a.n(E),k=a(179),y=a(104),I=a.n(y),w=a(175),U=a.n(w),C=Object(n.createContext)([{},function(){}]),z=Object(n.createContext)([{},function(e){}]),P=a(176),x=a.n(P),L=function(e){var t=e.go,a=e.type,r=e.loadIndicator,o=Object(n.useState)(""),i=Object(l.a)(o,2),u=i[0],b=i[1],g=Object(n.useState)(""),O=Object(l.a)(g,2),p=O[0],E=O[1],y=Object(n.useState)(null),I=Object(l.a)(y,2),w=I[0],U=I[1],P=function(e){var t=Object(n.useState)(!1),a=Object(l.a)(t,2),c=a[0],r=a[1],o=Object(n.useState)(null),i=Object(l.a)(o,2),u=i[0],s=i[1],b=Object(n.useState)(null),f=Object(l.a)(b,2),m=f[0],d=f[1],g=Object(n.useState)({}),j=Object(l.a)(g,2),O=j[0],h=j[1],p="http://localhost:3000/api",v=Object(n.useCallback)((function(e){h(e),r(!0)}),[]),E=O.method,S=O.token,y=Object(k.a)(O,["method","token"]);return Object(n.useEffect)((function(){if(c){var t={"Content-Type":"application/json",Authorization:S?"Token ".concat(S):""};fetch("".concat(p).concat(e),{method:E,mode:"cors",headers:t,body:"GET"!==E?JSON.stringify(y):null}).then((function(e){return e.json()})).then((function(e){r(!1),s(e)})).catch((function(e){r(!1),d(e)}))}}),[c,y,E,e,p,S]),[{isLoading:c,response:u,error:m},v]}("/users/".concat(a)),L=Object(l.a)(P,2),T=L[0].response,V=L[1],_=Object(n.useContext)(C),A=Object(l.a)(_,1)[0].vkUserId,J=Object(n.useState)(!1),K=Object(l.a)(J,2),W=K[0],Z=K[1],N=Object(n.useContext)(z),B=Object(l.a)(N,2)[1];Object(n.useEffect)((function(){"login"!==a&&(u.length===p.length?u!==p&&U({status:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438",message:"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0432\u0432\u043e\u0434 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443."}):U(null))}),[u,p,a]),Object(n.useEffect)((function(){W&&(V({method:"POST",user:{id:+A,password:u}}),Z(!1))}),[W,V,u,A]),Object(n.useEffect)((function(){T&&(!T.user&&T.error&&U(T.error),B((function(e){return Object(d.a)({},e,{isLoading:!1,isLoggedIn:!!T.user,currentUser:T.user||null})})),r(null))}),[T,B,r]);var D=function(e){e.target.value=Math.max(0,parseInt(e.target.value)).toString().slice(0,4),"password"===e.target.name?b(e.target.value):E(e.target.value)},F=function(){var e=Object(m.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Z(!0),r(c.a.createElement(x.a,{size:"large"}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return c.a.createElement(n.Fragment,null,c.a.createElement(j.a,null,"login"===a?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),c.a.createElement(s.g,{icon:"login"===a?c.a.createElement(v.a,null):c.a.createElement(S.a,null),header:"login"===a?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c":"\u041f\u0440\u0438\u0434\u0443\u043c\u0430\u0439\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.b,null,w?c.a.createElement(s.d,{header:w.status,mode:"error"},w.message):null,c.a.createElement(s.c,{top:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.e,{name:"password",type:"number",onChange:D,align:"center",value:u})),"login"!==a?c.a.createElement(s.c,{top:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.e,{type:"number",name:"confirmPassword",onChange:D,align:"center",value:p})):null,c.a.createElement(h.a,{size:"l",onClick:F},"login"===a?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"))),c.a.createElement(s.a,null,c.a.createElement(h.a,{stretched:!0,mode:"tertiary",onClick:t,"data-to":"login"===a?"authorization.registration":"authorization.login"},"login"===a?"\u041d\u0435\u0442 \u043f\u0430\u0440\u043e\u043b\u044f?":"\u0415\u0441\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c?")))},T=function(){var e=Object(n.useState)("authorization.login"),t=Object(l.a)(e,2),a=t[0],r=t[1],o=Object(n.useState)("authorization"),i=Object(l.a)(o,2),u=i[0],b=i[1],f=Object(n.useState)(null),m=Object(l.a)(f,2),d=m[0],g=m[1],j=function(e){r(e.currentTarget.dataset.to)},O=function(e){b(e.currentTarget.dataset.to)},h=function(e){g(e)};return c.a.createElement(s.h,{activeView:u},c.a.createElement(s.i,{id:"authorization",activePanel:a,popout:d},c.a.createElement(s.f,{id:"authorization.login"},c.a.createElement(L,{go:j,type:"login",goView:O,loadIndicator:h})),c.a.createElement(s.f,{id:"authorization.registration"},c.a.createElement(L,{go:j,type:"register",goView:O,loadIndicator:h}))))},V=function(e){var t=e.children;return Object(n.useEffect)((function(){u.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;if("VKWebAppUpdateConfig"===a){var c=document.createAttribute("scheme");c.value=n.scheme?n.scheme:"client_light",document.body.attributes.setNamedItem(c)}}))}),[]),t};u.a.send("VKWebAppInit"),o.a.render(c.a.createElement(V,null,c.a.createElement((function(e){var t=e.children,a=function(){var e=Object(n.useState)(""),t=Object(l.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)(!1),o=Object(l.a)(r,2),i=o[0],u=o[1],s=Object(n.useState)(null),b=Object(l.a)(s,2),f=b[0],m=b[1],d=Object(n.useState)(!1),g=Object(l.a)(d,2),j=g[0],O=g[1];return Object(n.useEffect)((function(){if(i){var e=I.a.parse(a);if(console.log(e),e){m(e.vk_user_id);var t={};Object.keys(e).sort().forEach((function(a){"vk_"===a.slice(0,3)&&(t[a]=e[a])}));var n=I.a.stringify(t),c=U.a.createHmac("sha256","Zs6DYRE8Z2mZ44LfciKW").update(n).digest().toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=$/,"");O(c===e.sign)}}}),[i,a]),[{vkUserId:f,matchUrlParams:j},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";c(e),u(!0)}]}(),r=Object(l.a)(a,2),o=r[0],i=o.vkUserId,u=o.matchUrlParams,s=r[1],b=Object(n.useState)({vkUserId:null,matchUrlParams:!1}),f=Object(l.a)(b,2),m=f[0],d=f[1];return Object(n.useEffect)((function(){s(window.location.search.slice(1))}),[s]),Object(n.useEffect)((function(){i&&d({vkUserId:i,matchUrlParams:u})}),[i,u]),c.a.createElement(C.Provider,{value:[m,d]},t)}),null,c.a.createElement((function(e){var t=e.children,a=Object(n.useState)({isLoading:!1,isLoggedIn:null,currentUser:null}),r=Object(l.a)(a,2),o=r[0],i=r[1];return c.a.createElement(z.Provider,{value:[o,i]},t)}),null,c.a.createElement(T,null)))),document.getElementById("root"))}},[[236,1,2]]]);
//# sourceMappingURL=main.6f904082.chunk.js.map