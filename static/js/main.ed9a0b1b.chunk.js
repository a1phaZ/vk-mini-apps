(this["webpackJsonpvk-mini-apps-empty"]=this["webpackJsonpvk-mini-apps-empty"]||[]).push([[0],{284:function(e,t,a){e.exports=a(483)},390:function(e,t){},392:function(e,t){},425:function(e,t){},426:function(e,t){},481:function(e,t,a){},483:function(e,t,a){"use strict";a.r(t);a(285),a(311),a(313),a(314),a(316),a(317),a(318),a(319),a(320),a(321),a(322),a(323),a(325),a(326),a(327),a(328),a(329),a(330),a(331),a(332),a(333),a(334),a(336),a(337),a(338),a(339),a(340),a(341),a(342),a(343),a(344),a(345),a(346),a(347),a(348),a(349),a(350),a(351),a(352),a(353);var n=a(0),c=a.n(n),r=a(205),l=a.n(r),o=a(30),u=a.n(o),i=a(4),s=(a(361),a(2)),m=a(51),p=a.n(m),f=a(67),d=a(29),b=a(68),E=a.n(b),O=a(63),j=a.n(O),g=a(213),v=a.n(g),h=a(214),y=a.n(h),S=a(237),C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=Object(n.useState)((function(){return localStorage.getItem(e)||t})),c=Object(i.a)(a,2),r=c[0],l=c[1];return Object(n.useEffect)((function(){localStorage.setItem(e,r)}),[r,e]),[r,l]},k=a(215),w=a.n(k),x={view:"authorization",panel:"authorization.login",popout:null,error:null},T=function(e,t){switch(t.type){case"SET_VIEW":return Object(d.a)({},e,{view:t.payload.view,panel:"".concat(t.payload.view,".").concat(t.payload.panel)});case"SET_PANEL":return Object(d.a)({},e,{panel:"".concat(e.view,".").concat(t.payload.panel)});case"SHOW_LOADING":return Object(d.a)({},e,{popout:c.a.createElement(s.w,null,c.a.createElement(s.z,null))});case"HIDE_LOADING":return Object(d.a)({},e,{popout:null});case"SET_ERROR":return Object(d.a)({},e,{error:t.payload.error});case"UNSET_ERROR":return Object(d.a)({},e,{error:null});default:return e}},P=Object(n.createContext)(),R=function(e){var t=e.children,a=Object(n.useReducer)(T,x);return c.a.createElement(P.Provider,{value:a},t)},_=function(e){var t=Object(n.useState)(!1),a=Object(i.a)(t,2),c=a[0],r=a[1],l=Object(n.useState)(null),o=Object(i.a)(l,2),u=o[0],s=o[1],m=Object(n.useState)(null),d=Object(i.a)(m,2),b=d[0],E=d[1],O=Object(n.useState)({}),j=Object(i.a)(O,2),g=j[0],v=j[1],h=C("token"),y=Object(i.a)(h,1)[0],k=Object(n.useContext)(P),x=Object(i.a)(k,2)[1],T="https://balance.z-labz.ru:8080/api",R=Object(n.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v(e),r(!0),x({type:"SHOW_LOADING"})}),[x]),_=g.method,I=void 0===_?"GET":_,F=g.params,L=Object(S.a)(g,["method","params"]);return Object(n.useEffect)((function(){if(c){var t={"Content-Type":"application/json",Authorization:y?"Token ".concat(y):""},a=F?w.a.stringify(F):null,n=a?"".concat(T).concat(e,"?").concat(a):"".concat(T).concat(e);(function(){var e=Object(f.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,{method:I,mode:"cors",headers:t,body:"GET"!==I?JSON.stringify(L):null}).then((function(e){return e.json()})).then((function(e){if(e.error)throw Error(e.error.message);r(!1),x({type:"HIDE_LOADING"}),s(e)})).catch((function(e){r(!1),x({type:"HIDE_LOADING"}),x({type:"SET_ERROR",payload:{error:e}}),E(e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}}),[c,L,I,e,T,y,F,x]),[{isLoading:c,response:u,error:b},R]},I=a(133),F=a.n(I),L=a(216),z=a.n(L),N=Object(n.createContext)([{},function(){}]),A=function(e){var t=e.children,a=function(){var e=Object(n.useState)(""),t=Object(i.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)(!1),l=Object(i.a)(r,2),o=l[0],u=l[1],s=Object(n.useState)(null),m=Object(i.a)(s,2),p=m[0],f=m[1],d=Object(n.useState)(!1),b=Object(i.a)(d,2),E=b[0],O=b[1];return Object(n.useEffect)((function(){if(o){var e=F.a.parse(a);if(e){f(e.vk_user_id);var t={};Object.keys(e).sort().forEach((function(a){"vk_"===a.slice(0,3)&&(t[a]=e[a])}));var n=F.a.stringify(t),c=z.a.createHmac("sha256","Zs6DYRE8Z2mZ44LfciKW").update(n).digest().toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=$/,"");O(c===e.sign)}}}),[o,a]),[{vkUserId:p,matchUrlParams:E},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";c(e),u(!0)}]}(),r=Object(i.a)(a,2),l=r[0],o=l.vkUserId,u=l.matchUrlParams,s=r[1],m=Object(n.useState)({vkUserId:null,matchUrlParams:!1}),p=Object(i.a)(m,2),f=p[0],d=p[1];return Object(n.useEffect)((function(){s(window.location.search.slice(1))}),[s]),Object(n.useEffect)((function(){o&&d({vkUserId:o,matchUrlParams:u})}),[o,u]),c.a.createElement(N.Provider,{value:[f,d]},t)},U=Object(n.createContext)([{},function(e){}]),W=function(e){var t=e.children,a=Object(n.useState)({isLoading:!1,isLoggedIn:null,currentUser:null}),r=Object(i.a)(a,2),l=r[0],o=r[1];return c.a.createElement(U.Provider,{value:[l,o]},t)},D=function(e){var t=e.go,a=e.goView,r=e.type,l=Object(n.useState)(""),o=Object(i.a)(l,2),u=o[0],m=o[1],b=Object(n.useState)(""),O=Object(i.a)(b,2),g=O[0],h=O[1],S=Object(n.useState)(null),k=Object(i.a)(S,2),w=k[0],x=k[1],T=_("/users/".concat(r)),R=Object(i.a)(T,2),I=R[0],F=I.response,L=I.error,z=R[1],A=Object(n.useContext)(N),W=Object(i.a)(A,1)[0].vkUserId,D=Object(n.useState)(!1),V=Object(i.a)(D,2),G=V[0],K=V[1],q=Object(n.useContext)(U),B=Object(i.a)(q,2),H=B[0],M=B[1],J=C("token"),Y=Object(i.a)(J,2)[1],Z=Object(n.useContext)(P),Q=Object(i.a)(Z,2)[1];Object(n.useEffect)((function(){if(H.isLoggedIn){var e=H.currentUser,t=e.name,a=e.phone,n=e.email,c=e.password;Q(t&&a&&n&&c?{type:"SET_VIEW",payload:{view:"balance",panel:"home"}}:{type:"SET_VIEW",payload:{view:"registration",panel:"finish"}})}}),[H,Q]),Object(n.useEffect)((function(){"login"!==r&&(u.length===g.length?u!==g&&x({status:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438",message:"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0432\u0432\u043e\u0434 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443."}):x(null))}),[u,g,r]),Object(n.useEffect)((function(){G&&(z({method:"POST",user:{id:+W,password:u}}),K(!1))}),[G,z,u,W]),Object(n.useEffect)((function(){F&&(!F.user&&F.error?x(F.error):Y(F.user.token),M((function(e){return Object(d.a)({},e,{isLoading:!1,isLoggedIn:!!F.user,currentUser:F.user||null})})))}),[F,M,t,a,Y]),Object(n.useEffect)((function(){L&&x(L)}),[L]);var $=function(e){e.target.value=Math.max(0,parseInt(e.target.value)).toString().slice(0,4),"password"===e.target.name?m(e.target.value):h(e.target.value)},X=function(){var e=Object(f.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:K(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return c.a.createElement(n.Fragment,null,c.a.createElement(E.a,null,"login"===r?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),c.a.createElement(s.v,{icon:"login"===r?c.a.createElement(v.a,null):c.a.createElement(y.a,null),header:"login"===r?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c":"\u041f\u0440\u0438\u0434\u0443\u043c\u0430\u0439\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.g,null,w?c.a.createElement(s.i,{header:w.status,mode:"error"},w.message):null,c.a.createElement(s.h,{top:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.m,{name:"password",type:"number",onChange:$,align:"center",value:u})),"login"!==r?c.a.createElement(s.h,{top:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.m,{type:"number",name:"confirmPassword",onChange:$,align:"center",value:g})):null,c.a.createElement(j.a,{size:"l",onClick:X},"login"===r?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"))),c.a.createElement(s.d,null,c.a.createElement(j.a,{stretched:!0,mode:"tertiary",onClick:function(e){Q({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"login"===r?"register":"login"},"login"===r?"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f":"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f")))},V=a(69),G=a.n(V),K=a(70),q=a.n(K),B=a(64),H=a.n(B),M=a(43),J=a.n(M),Y=function(){var e=Object(n.useState)(""),t=Object(i.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)(""),o=Object(i.a)(l,2),m=o[0],p=o[1],f=Object(n.useState)(""),b=Object(i.a)(f,2),E=b[0],O=b[1],j=Object(n.useState)(""),g=Object(i.a)(j,2),v=g[0],h=g[1],y=Object(n.useState)(!1),S=Object(i.a)(y,2),C=S[0],k=S[1],w=Object(n.useState)(!0),x=Object(i.a)(w,2),T=x[0],R=x[1],I=Object(n.useState)(null),F=Object(i.a)(I,2),L=F[0],z=F[1],N=Object(n.useState)(""),A=Object(i.a)(N,2),W=A[0],D=A[1],V=_("/users/profile"),K=Object(i.a)(V,2),B=K[0].response,M=K[1],Y=_("/fns/password"),Z=Object(i.a)(Y,2),Q=Z[0],$=Z[1],X=Object(n.useState)(!1),ee=Object(i.a)(X,2),te=ee[0],ae=ee[1],ne=Object(n.useContext)(U),ce=Object(i.a)(ne,2),re=ce[0],le=ce[1],oe=Object(n.useContext)(P),ue=Object(i.a)(oe,2)[1],ie=Object(s.H)();return Object(n.useEffect)((function(){u.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppGetPersonalCardResult":r(n.email),p(n.phone),console.log("profile",n);break;case"VKWebAppGetPersonalCardFailed":console.log("profile error",n)}}))}),[]),Object(n.useEffect)((function(){var e=re.currentUser,t=e.email,a=e.name,n=e.phone,c=e.password;r(t||""),O(a||""),p(n||""),h(c||""),R(!!t&&!!a&&!!n&&!!c)}),[re]),Object(n.useEffect)((function(){te&&(M({method:"PUT",update:{email:a,phone:m,name:E,kktPassword:v}}),ae(!1))}),[te,M,a,m,E,v]),Object(n.useEffect)((function(){if(C){var e={};"restore"!==W&&(e.name=E,e.email=a),e.params={type:W},e.phone=m.replace(/[ ()-]/g,""),e.phone=e.phone.replace(/^[8]/g,"+7"),e.method="POST",$(e),k(!1)}}),[C,W,$,E,a,m]),Object(n.useEffect)((function(){if(B){var e=B.user;e.name&&e.phone&&e.email&&e.password&&(le((function(e){return Object(d.a)({},e,{isLoading:!1,isLoggedIn:!!B.user,currentUser:B.user||null})})),ue({type:"SET_VIEW",payload:{view:"balance",panel:"home"}}))}}),[B,ue,le]),Object(n.useEffect)((function(){Q.response&&z(c.a.createElement(s.D,{layout:"vertical",onClose:function(){return z(null)},before:c.a.createElement(H.a,{size:24,style:{backgroundColor:"var(--accent)"}},c.a.createElement(J.a,{fill:"#fff",width:14,height:14}))},Q.response.message))}),[Q.response]),c.a.createElement(n.Fragment,null,c.a.createElement(s.s,{left:T&&c.a.createElement(s.t,{onClick:function(){ue({type:"SET_VIEW",payload:{view:"balance",panel:"home"}})}},ie===s.l?c.a.createElement(G.a,null):c.a.createElement(q.a,null))},T?"\u041f\u0440\u043e\u0444\u0438\u043b\u044c":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),c.a.createElement(s.g,null,!T&&c.a.createElement(s.i,{header:"\u0420\u0430\u0437\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435",mode:"default"},"\u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e \u0447\u0435\u043a\u0430\u043c. \u041d\u0438 \u043a\u0430\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043e \u0432\u0430\u0448\u0438\u0445 \u043f\u043e\u043a\u0443\u043f\u043a\u0430\u0445 \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u044e\u0442\u0441\u044f \u0432 \u043d\u0430\u043b\u043e\u0433\u043e\u0432\u0443\u044e."),c.a.createElement(s.m,{type:"text",top:"\u0418\u043c\u044f",name:"name",value:E,onChange:function(e){O(e.target.value)}}),c.a.createElement(s.h,{top:"E-mail \u0438 \u0422\u0435\u043b\u0435\u0444\u043e\u043d",bottom:"\u042d\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0447\u0435\u0440\u0435\u0437 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0412\u043a\u043e\u043d\u0442\u0430\u043a\u0442\u0435. \u041e\u043d\u0438 \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421 \u0434\u043b\u044f \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438 \u0447\u0435\u043a\u043e\u0432."},c.a.createElement(s.m,{type:"email",top:"e-mail",name:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 e-mail",value:a,onChange:function(e){r(e.target.value)}}),c.a.createElement(s.m,{type:"phone",top:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",name:"phone",value:m,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043b\u0435\u0444\u043e\u043d",onChange:function(e){e.target.value.replace(/^[8]/,"+7"),p(e.target.value)}}),c.a.createElement(s.a,{size:"xl",onClick:function(){u.a.send("VKWebAppGetPersonalCard",{type:["phone","email"]})}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 VK")),c.a.createElement(s.h,{top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",bottom:"\u0415\u0441\u043b\u0438 \u043d\u0435 \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043f\u043e \u043a\u0430\u043a\u0438\u043c \u0442\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0430\u043c, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 0 \u0432 \u043f\u043e\u043b\u0435 \u0432\u0432\u043e\u0434\u0430 \u043f\u0430\u0440\u043e\u043b\u044f"},c.a.createElement(s.m,{type:"number",top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c \u0424\u041d\u0421",name:"kktPassword",value:v,onChange:function(e){h(e.target.value)}}),c.a.createElement(s.d,{style:{display:"flex",justifyContent:"space-between"}},c.a.createElement(s.a,{size:"l","data-type":"signup",onClick:function(e){D(e.currentTarget.dataset.type),k(!0)},style:{margin:"0px",width:"49%"}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"),c.a.createElement(s.a,{size:"l","data-type":"restore",onClick:function(e){D(e.currentTarget.dataset.type),k(!0)},style:{margin:"0px",width:"49%"}},"\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"))),c.a.createElement(s.a,{size:"xl",mode:"commerce",onClick:function(){ae(!0)}},T?"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c":"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044e")),L)},Z=a(217),Q=a(218),$=function(){function e(){Object(Z.a)(this,e)}return Object(Q.a)(e,null,[{key:"qr",value:function(e){try{var t,a,n,c,r;if(e){var l=e.match(/t=(\w{8}T\w+)&s=(\w+\.*\w+)&fn=(\w+)&i=(\w+)&fp=(\w+)/),o=Object(i.a)(l,6);t=o[1],a=o[2],n=o[3],c=o[4],r=o[5]}return{dt:t,sum:a.replace(/[.]/g,""),fn:n,i:c,fp:r}}catch(u){return console.log(u),{error:{message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0447\u0442\u0435\u043d\u0438\u044f QR \u043a\u043e\u0434\u0430"}}}}},{key:"date",value:function(e){var t,a=new Date(e);switch(a.getMonth()+1){case 1:t="\u044f\u043d\u0432\u0430\u0440\u044f";break;case 2:t="\u0444\u0435\u0432\u0440\u0430\u043b\u044f";break;case 3:t="\u043c\u0430\u0440\u0442\u0430";break;case 4:t="\u0430\u043f\u0440\u0435\u043b\u044f";break;case 5:t="\u043c\u0430\u044f";break;case 6:t="\u0438\u044e\u043d\u044f";break;case 7:t="\u0438\u044e\u043b\u044f";break;case 8:t="\u0430\u0432\u0433\u0443\u0441\u0442\u0430";break;case 9:t="\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f";break;case 10:t="\u043e\u043a\u0442\u044f\u0431\u0440\u044f";break;case 11:t="\u043d\u043e\u044f\u0431\u0440\u044f";break;case 12:t="\u0434\u0435\u043a\u0430\u0431\u0440\u044f"}return"".concat(a.getDate()," ").concat(t," ").concat(a.getFullYear())}},{key:"sum",value:function(e){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e/100)}},{key:"totalReceiptSum",value:function(e){if(0===e.length)return 0;return e.map((function(e){return e.sum||e.totalSum})).reduce((function(e,t){return e+t}))}},{key:"totalSumWithParams",value:function(e){if(0===e.length)return 0;return e.map((function(e){var t=e.income,a=e.sum;return t?a:-1*a})).reduce((function(e,t){return e+t}))}},{key:"totalSum",value:function(e,t){if(0===e.length)return 0;var a=function(e,t){return e+t},n=e.map((function(e){return e.items.map((function(e){return t?e.income?e.sum:0:e.income?0:e.sum})).reduce(a)})).reduce(a);return t?n:-1*n}}]),e}(),X=function(e){var t=e.sum,a=e.fs,n=t>=0?{color:"#28a745",fontSize:a}:{color:"#dc3545",fontSize:a};return c.a.createElement("span",{style:n},$.sum(t))},ee=a(99),te=a.n(ee),ae=a(224),ne=a.n(ae),ce=a(219),re=a.n(ce),le=a(220),oe=a.n(le),ue=a(221),ie=a.n(ue),se=a(238),me=a(485),pe=a(486),fe=a(487),de=a(222),be=a.n(de),Ee=a(223),Oe=a.n(Ee),je=function(e){var t=e.setDateFromCalendar,a=Object(n.useState)(new Date),r=Object(i.a)(a,2),l=r[0],o=r[1];Object(n.useEffect)((function(){t(l)}),[l,t]);return c.a.createElement(s.j,null,c.a.createElement(s.n,null,c.a.createElement(s.b,{before:c.a.createElement(s.a,{onClick:function(){o(Object(me.a)(l,1))},mode:"secondary"},c.a.createElement(be.a,null)),asideContent:c.a.createElement(s.a,{onClick:function(){o(Object(se.a)(l,1))},mode:"secondary"},c.a.createElement(Oe.a,null)),style:{textAlign:"center",fontWeight:"bold"}},Object(pe.a)(l,"LLLL yyyy",{locale:fe.a}).toLocaleUpperCase())))},ge=a(85),ve=(a(481),a(98)),he=a.n(ve),ye=function(e){var t=e.items,a=e.id,r=e.isSearch,l=void 0!==r&&r,o=t.map((function(e,t){var a=e.income?e.sum:-1*e.sum,r=function(e){return e&&e.definition?e.definition.definition:null}(e);return c.a.createElement(n.Fragment,{key:t},c.a.createElement("div",{className:"receipt-item"},c.a.createElement("span",{className:"receipt-item-name"},r||e.name),e.price&&!l?c.a.createElement("span",{className:"receipt-item-price"},$.sum(e.price)):null,e.quantity&&!l?c.a.createElement("span",{className:"receipt-item-quantity"},e.quantity):null,e.dateTime&&l?c.a.createElement("span",{className:"receipt-item-dateTime"},$.date(e.dateTime)):null,a?c.a.createElement("span",{className:"receipt-item-sum"},c.a.createElement(X,{sum:a})):null))}));return c.a.createElement(he.a,{id:a,className:"receipt-item-wrapper"},c.a.createElement("div",{className:"receipt-item"},c.a.createElement("span",{className:"receipt-item-name"},"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),l?c.a.createElement("span",{className:"receipt-item-dateTime"},"\u0414\u0430\u0442\u0430"):c.a.createElement(n.Fragment,null,c.a.createElement("span",{className:"receipt-item-price"},"\u0426\u0435\u043d\u0430"),c.a.createElement("span",{className:"receipt-item-quantity"},"\u041a\u043e\u043b-\u0432\u043e")),c.a.createElement("span",{className:"receipt-item-sum"},"\u0421\u0443\u043c\u043c\u0430")),c.a.createElement(s.B,null),o,c.a.createElement(s.B,null),c.a.createElement("div",{className:"receipt-total"},c.a.createElement("span",{className:""},"\u0418\u0442\u043e\u0433\u043e:"),c.a.createElement("span",null,c.a.createElement(X,{sum:$.totalSumWithParams(t)}))))},Se=function(e){var t=e.receipts,a=Object(n.useState)(""),r=Object(i.a)(a,2),l=r[0],o=r[1],u=Object(n.useState)([]),m=Object(i.a)(u,2),p=m[0],f=m[1],d=Object(n.useState)([]),b=Object(i.a)(d,2),E=b[0],O=b[1];return Object(n.useEffect)((function(){if(t){var e=[];t.map((function(e){var t=e.dateTime;return e.items.map((function(e){return e.dateTime=t,e}))})).forEach((function(t){e.push.apply(e,Object(ge.a)(t))})),f(e)}}),[t]),Object(n.useEffect)((function(){O(l?p.filter((function(e){return e.name.toLowerCase().indexOf(l)>-1})):[])}),[l,p]),c.a.createElement(n.Fragment,null,c.a.createElement(s.A,{value:l,onChange:function(e){o(e.target.value.toLowerCase())}}),c.a.createElement(te.a,{title:"\u041f\u043e\u0438\u0441\u043a"},E.length>0&&c.a.createElement(ye,{id:E._id,isSearch:!0,items:E})))},Ce=function(e){var t=e.setReceiptFromBalance,a=e.onClickActiveModal,r=Object(n.useState)(!0),l=Object(i.a)(r,2),o=l[0],u=l[1],m=Object(n.useState)(new Date),p=Object(i.a)(m,2),f=p[0],d=p[1],b=Object(n.useState)([]),O=Object(i.a)(b,2),g=O[0],v=O[1],h=Object(n.useState)(!1),y=Object(i.a)(h,2),S=y[0],C=y[1],k=_("/day"),w=Object(i.a)(k,2),x=w[0].response,T=w[1],R=Object(n.useContext)(P),I=Object(i.a)(R,2)[1],F=Object(n.useCallback)((function(e){d(e),u(!0)}),[]);return Object(n.useEffect)((function(){o&&(T({params:{date:Object(pe.a)(f,"yyyy-MM-dd")}}),u(!1),C(!1))}),[o,u,T,f]),Object(n.useEffect)((function(){x&&v(x)}),[x,t]),c.a.createElement(n.Fragment,null,c.a.createElement(E.a,null,c.a.createElement(s.u,{aside:c.a.createElement(s.c,{size:"s",mode:"primary"},"0.5.3")},"\u0411\u0430\u043b\u0430\u043d\u0441")),c.a.createElement(Se,{receipts:g}),c.a.createElement(s.v,{icon:c.a.createElement(re.a,null),header:c.a.createElement(X,{sum:$.totalReceiptSum(g),fs:"2em"}),action:c.a.createElement(j.a,{size:"l",onClick:function(e){I({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"add"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0445\u043e\u0434 / \u0440\u0430\u0441\u0445\u043e\u0434")},"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439\u0442\u0435 \u0434\u043e\u0445\u043e\u0434\u044b/\u0440\u0430\u0441\u0445\u043e\u0434\u044b"),c.a.createElement(s.B,null),c.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",paddingTop:"1em"}},c.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-end"}},c.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingRight:"10px"}},c.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em",textAlign:"end"}},"\u0414\u043e\u0445\u043e\u0434\u044b"),c.a.createElement(X,{sum:$.totalSum(g,!0),fs:"1.4em"})),c.a.createElement(oe.a,{width:16,height:40,fill:"#28a745"})),c.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-start"}},c.a.createElement(ie.a,{width:16,height:40,fill:"#dc3545"}),c.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingLeft:"10px"}},c.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em"}},"\u0420\u0430\u0441\u0445\u043e\u0434\u044b"),c.a.createElement(X,{sum:$.totalSum(g,!1),fs:"1.4em"})))),c.a.createElement(s.x,{onRefresh:function(){C(!0),u(!0)},isFetching:S},c.a.createElement(te.a,{title:"\u0427\u0435\u043a\u0438"},c.a.createElement(s.n,null,c.a.createElement(je,{setDateFromCalendar:F}),g.map((function(e,n){return c.a.createElement(ne.a,{key:n,expandable:!0,onClick:function(){a("modal-page"),t(e)},"data-to":e._id,indicator:c.a.createElement(X,{sum:e.totalSum})},$.date(e.dateTime))}))))))},ke=a(86),we=a.n(ke),xe=a(71),Te=a.n(xe),Pe=a(228),Re=a.n(Pe),_e=a(225),Ie=a.n(_e),Fe=a(227),Le=a.n(Fe),ze=a(226),Ne=a.n(ze),Ae=function(e){var t=e.message,a=e.isError,r=e.onClose,l=Object(n.useState)(null),o=Object(i.a)(l,2),u=o[0],m=o[1],p=Object(n.useContext)(P),f=Object(i.a)(p,2)[1];return Object(n.useEffect)((function(){m(c.a.createElement(s.D,{layout:"vertical",onClose:r,before:a?c.a.createElement(H.a,{size:24,style:{backgroundColor:"var(--destructive)"}},c.a.createElement(Ne.a,{fill:"#fff",width:18,height:18})):c.a.createElement(H.a,{size:24,style:{backgroundColor:"var(--accent)"}},c.a.createElement(J.a,{fill:"#fff",width:18,height:18}))},t))}),[m,f,a,t,r]),u},Ue=function(){var e=Object(n.useState)(""),t=Object(i.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)((function(){var e=new Date,t=e.getMonth()+1>9?e.getMonth()+1:"0".concat(e.getMonth()+1),a=e.getDate()>9?e.getDate():"0".concat(e.getDate());return"".concat(e.getFullYear(),"-").concat(t,"-").concat(a)})),o=Object(i.a)(l,2),m=o[0],p=o[1],f=Object(n.useState)(1),b=Object(i.a)(f,2),O=b[0],g=b[1],v=Object(n.useState)(""),h=Object(i.a)(v,2),y=h[0],S=h[1],C=Object(n.useState)(!1),k=Object(i.a)(C,2),w=k[0],x=k[1],T=Object(n.useState)(null),R=Object(i.a)(T,2),I=R[0],F=R[1],L=Object(n.useState)(null),z=Object(i.a)(L,2),N=z[0],A=z[1],U=Object(n.useContext)(P),W=Object(i.a)(U,2),D=W[0],V=W[1],K=_("/day"),B=Object(i.a)(K,2),H=B[0],M=H.response,J=H.error,Y=B[1],Z=_("/day/receipt"),Q=Object(i.a)(Z,2),X=Q[0],ee=Q[1],te=Object(n.useState)(!1),ae=Object(i.a)(te,2),ne=ae[0],ce=ae[1],re=Object(n.useState)(!1),le=Object(i.a)(re,2),oe=le[0],ue=le[1],ie=Object(s.H)(),se=Object(n.useCallback)((function(){V({type:"UNSET_ERROR"}),F(null)}),[V]);return Object(n.useEffect)((function(){u.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppOpenCodeReaderResult":A(n.code_data);break;case"VKWebAppOpenCodeReaderFailed":console.log("add day error",n)}}))}),[]),Object(n.useEffect)((function(){ne&&(Y({method:"POST",date:m,items:[{name:a,quantity:O,price:100*y,sum:100*y*O,income:w,modifiers:[],properties:[]}]}),r(""),g(1),x(!1),S(""),ce(!1))}),[ne,ce,m,Y,w,a,y,O]),Object(n.useEffect)((function(){M&&F(c.a.createElement(Ae,{message:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0448\u043b\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e",isError:!1,onClose:se}))}),[M,se]),Object(n.useEffect)((function(){if(N){var e=$.qr(N);if(e.error){var t=e.error;return V({type:"SET_ERROR",payload:{error:t}}),A(null),void ue(!1)}var a=Object(d.a)({method:"POST"},e);ee(a)}}),[N,ee,oe,V]),Object(n.useEffect)((function(){X.response&&X.response._id&&(F(c.a.createElement(Ae,{message:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0448\u043b\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e",isError:!1,onClose:se})),ue(!1),A(null))}),[X.response,ee,N,se]),Object(n.useEffect)((function(){D.error&&(V({type:"SET_ERROR",payload:{error:X.error||J}}),F(c.a.createElement(Ae,{message:D.error.message,isError:!0,onClose:se})),ue(!1),A(null))}),[X.error,J,V,D.error,se]),c.a.createElement(n.Fragment,null,c.a.createElement(E.a,{left:c.a.createElement(Te.a,{key:"back",onClick:function(e){V({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"home"},ie===s.l?c.a.createElement(G.a,null):c.a.createElement(q.a,null))},c.a.createElement(Le.a,{before:u.a.supports("VKWebAppOpenCodeReader")&&c.a.createElement(Te.a,{key:"qr","data-to":"qr",onClick:function(){V({type:"UNSET_ERROR"}),u.a.send("VKWebAppOpenCodeReader",{})}},c.a.createElement(Ie.a,null))},"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438")),c.a.createElement(he.a,null,c.a.createElement(we.a,{type:"date",top:"\u0414\u0430\u0442\u0430",name:"date",value:m,onChange:function(e){p(e.currentTarget.value)}}),c.a.createElement(we.a,{type:"text",top:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"name",value:a,onChange:function(e){r(e.currentTarget.value)}}),c.a.createElement(we.a,{type:"number",top:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",name:"quantity",value:O,onChange:function(e){g(e.currentTarget.value)}}),c.a.createElement(we.a,{type:"number",top:"\u0426\u0435\u043d\u0430",name:"price",value:y,onChange:function(e){S(e.currentTarget.value)}}),c.a.createElement(Re.a,{name:"income",checked:w,onChange:function(e){x(e.currentTarget.checked)}},"\u0414\u043e\u0445\u043e\u0434"),c.a.createElement(j.a,{size:"xl",disabled:!m||!a||!O||!y,mode:w?"commerce":"destructive",onClick:function(){ce(!0)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c ",w?"\u0434\u043e\u0445\u043e\u0434":"\u0440\u0430\u0441\u0445\u043e\u0434")),I)},We=function(e){var t=e.receipt;return c.a.createElement(s.n,null,c.a.createElement(ye,{id:t._id,dateTime:t.dateTime,items:t.items}))},De=a(83),Ve=a.n(De),Ge=a(229),Ke=a.n(Ge),qe=function(){var e=Object(n.useState)(""),t=Object(i.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)(""),o=Object(i.a)(l,2),m=o[0],p=o[1],f=Object(n.useState)(""),b=Object(i.a)(f,2),E=b[0],O=b[1],j=Object(n.useState)(""),g=Object(i.a)(j,2),v=g[0],h=g[1],y=Object(n.useState)(0),S=Object(i.a)(y,2),C=S[0],k=S[1],w=Object(n.useState)(""),x=Object(i.a)(w,2),T=x[0],R=x[1],I=Object(n.useState)(!1),F=Object(i.a)(I,2),L=F[0],z=F[1],N=Object(n.useContext)(P),A=Object(i.a)(N,2)[1],W=_("/users/profile"),D=Object(i.a)(W,2),V=D[0].response,K=D[1],B=_("/fns/password"),M=Object(i.a)(B,2),Y=M[0],Z=M[1],Q=Object(n.useState)(!1),$=Object(i.a)(Q,2),X=$[0],ee=$[1],te=Object(n.useContext)(U),ae=Object(i.a)(te,2)[1],ne=Object(n.useState)(null),ce=Object(i.a)(ne,2),re=ce[0],le=ce[1],oe=Object(s.H)();Object(n.useEffect)((function(){u.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppGetPersonalCardResult":r(n.email),p(n.phone);break;case"VKWebAppGetPersonalCardFailed":console.log("profile error",n)}}))}),[]),Object(n.useEffect)((function(){X&&(K({method:"PUT",update:{email:a,phone:m,name:E,kktPassword:v}}),ee(!1))}),[X,K,a,m,E,v]),Object(n.useEffect)((function(){if(L){var e={};"restore"!==T&&(e.name=E,e.email=a),e.params={type:T},e.phone=m.replace(/[ ()-]/g,""),e.phone=e.phone.replace(/^[8]/g,"+7"),e.method="POST",Z(e),z(!1)}}),[L,T,Z,E,a,m]),Object(n.useEffect)((function(){if(V){var e=V.user;e.name&&e.phone&&e.email&&e.password&&(ae((function(e){return Object(d.a)({},e,{isLoading:!1,isLoggedIn:!!V.user,currentUser:V.user||null})})),A({type:"SET_VIEW",payload:{view:"balance",panel:"home"}}))}}),[V,A,ae]),Object(n.useEffect)((function(){Y.response&&le(c.a.createElement(s.D,{layout:"vertical",onClose:function(){return le(null)},before:c.a.createElement(H.a,{size:24,style:{backgroundColor:"var(--accent)"}},c.a.createElement(J.a,{fill:"#fff",width:14,height:14}))},Y.response.message))}),[Y.response]);return c.a.createElement(n.Fragment,null,c.a.createElement(s.s,{left:c.a.createElement(s.t,{onClick:function(){A({type:"SET_VIEW",payload:{view:"balance",panel:"home"}})}},oe===s.l?c.a.createElement(G.a,null):c.a.createElement(q.a,null))},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f(",C+1,"/3)"),c.a.createElement(s.g,null,function(e){switch(e){case 0:return c.a.createElement(s.h,{top:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u0432\u043e\u0451 \u0438\u043c\u044f"},c.a.createElement(s.m,{type:"text",top:"\u0418\u043c\u044f",name:"name",value:E,onChange:function(e){O(e.target.value)}}),c.a.createElement(s.a,{size:"xl",mode:"commerce",disabled:!E,onClick:function(){k(1)}},"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c"));case 1:return c.a.createElement(s.h,{top:"E-mail \u0438 \u0422\u0435\u043b\u0435\u0444\u043e\u043d",bottom:"\u042d\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0447\u0435\u0440\u0435\u0437 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0412\u043a\u043e\u043d\u0442\u0430\u043a\u0442\u0435. \u041e\u043d\u0438 \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421 \u0434\u043b\u044f \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438 \u0447\u0435\u043a\u043e\u0432."},c.a.createElement(s.m,{type:"email",top:"e-mail",name:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 e-mail",value:a,onChange:function(e){r(e.target.value)}}),c.a.createElement(s.m,{type:"phone",top:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",name:"phone",value:m,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043b\u0435\u0444\u043e\u043d",onChange:function(e){e.target.value.replace(/^[8]/,"+7"),p(e.target.value)}}),c.a.createElement(s.a,{size:"xl",onClick:function(){u.a.send("VKWebAppGetPersonalCard",{type:["phone","email"]})}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 VK"),c.a.createElement(s.a,{size:"xl",mode:"commerce",disabled:!a||!m,onClick:function(){k(2)}},"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c"));case 2:return c.a.createElement(s.h,{top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",bottom:"\u0415\u0441\u043b\u0438 \u0412\u044b, \u043f\u043e \u043a\u0430\u043a\u0438\u043c \u0442\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0430\u043c, \u043d\u0435 \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c - \u0432\u0432\u0435\u0434\u0438\u0442\u0435 0 \u0432 \u043f\u043e\u043b\u0435 \u0432\u0432\u043e\u0434\u0430 \u043f\u0430\u0440\u043e\u043b\u044f"},c.a.createElement(s.m,{type:"number",top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c \u0424\u041d\u0421",name:"kktPassword",value:v,onChange:function(e){h(e.target.value)}}),c.a.createElement(s.d,{style:{display:"flex",justifyContent:"space-between"}},c.a.createElement(s.a,{size:"l","data-type":"signup",onClick:function(e){R(e.currentTarget.dataset.type),z(!0)},style:{margin:"0px",width:"49%"}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"),c.a.createElement(s.a,{size:"l","data-type":"restore",onClick:function(e){R(e.currentTarget.dataset.type),z(!0)},style:{margin:"0px",width:"49%"}},"\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c")),c.a.createElement(s.a,{size:"xl",mode:"commerce",disabled:!a&&!m,onClick:function(){ee(!0)}},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c"));default:return}}(C)),re)},Be=a(230),He=a.n(Be),Me=a(231),Je=a.n(Me),Ye=a(232),Ze=a.n(Ye),Qe=a(233),$e=a.n(Qe),Xe=a(234),et=a.n(Xe),tt=function(){return c.a.createElement(n.Fragment,null,c.a.createElement(s.s,null,"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0430"),c.a.createElement(s.v,null,"\u0420\u0430\u0437\u0434\u0435\u043b \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435"))},at=a(235),nt=a.n(at),ct=function(){var e=Object(n.useContext)(P),t=Object(i.a)(e,2)[1];return c.a.createElement(n.Fragment,null,c.a.createElement(s.s,null,"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e"),c.a.createElement(s.j,null,c.a.createElement(s.k,{mode:"secondary"},"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e"),c.a.createElement(s.C,{"data-panel":"catalog",expandable:!0,before:c.a.createElement(nt.a,null),onClick:function(e){t({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.panel}})}},"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a")))},rt=a(236),lt=a.n(rt),ot=a(134),ut=a.n(ot),it=function(){var e=Object(n.useState)(""),t=Object(i.a)(e,2),a=t[0],r=t[1],l=_("/catalog".concat(a)),o=Object(i.a)(l,2),u=o[0].response,m=o[1],d=Object(n.useState)([]),b=Object(i.a)(d,2),E=b[0],O=b[1],j=Object(n.useState)(!0),g=Object(i.a)(j,2),v=g[0],h=g[1],y=Object(n.useState)("get"),S=Object(i.a)(y,1)[0],C=Object(n.useState)(""),k=Object(i.a)(C,2),w=k[0],x=k[1],T=Object(n.useState)(new Set),P=Object(i.a)(T,2),R=P[0],I=P[1],F=function(e,t){var a=E.findIndex((function(t){return t._id===e}));if(t){var n=E;n[a].definition=t,O(n),function(e){var t=new Set(R);t.add(e),I(t)}(n[a])}},L=E.map((function(e,t){return c.a.createElement(n.Fragment,{key:t},c.a.createElement(s.y,{"data-id":e._id,multiline:!0,caption:e.name,after:c.a.createElement(lt.a,null),bottom:w===e._id&&c.a.createElement(s.m,{id:w,type:"text",defaultValue:e.definition,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0443",onChange:function(){var e=Object(f.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(w,t.target.value);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),onClick:function(e){!function(e){var t=e.currentTarget.dataset.id;(""===w||w!==t)&&x(t)}(e)},actions:c.a.createElement(n.Fragment,null,c.a.createElement(s.a,{disabled:!0,style:{display:"none"}},c.a.createElement(ut.a,null)),c.a.createElement(s.a,{disabled:!0,style:{display:"none"},mode:"secondary"},c.a.createElement(ut.a,null)))},c.a.createElement("b",null,e.definition?e.definition:"\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438")))}));return Object(n.useEffect)((function(){w&&document.getElementById(w).focus()}),[w]),Object(n.useEffect)((function(){v&&(m({params:{a:S}}),h(!1))}),[v,h,m,S]),Object(n.useEffect)((function(){if(a){var e={method:"PUT",update:Object(ge.a)(R)};m(e)}}),[a,R,m]),Object(n.useEffect)((function(){u&&(O(u),I(new Set),r(""),x(""))}),[u]),c.a.createElement(n.Fragment,null,c.a.createElement(s.s,null,"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a"),c.a.createElement(s.j,{style:{paddingBottom:60}},L),0!==Object(ge.a)(R).length&&c.a.createElement(s.f,{vertical:"bottom"},c.a.createElement(s.B,{wide:!0}),c.a.createElement(s.a,{size:"xl",onClick:function(){r("/update")}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f")))},st=function(){var e=Object(n.useContext)(P),t=Object(i.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)(null),o=Object(i.a)(l,2),u=o[0],m=o[1],p=Object(n.useState)(null),f=Object(i.a)(p,2),d=f[0],b=f[1],E=Object(n.useState)(null),O=Object(i.a)(E,2),j=O[0],g=O[1],v=Object(n.useContext)(U),h=Object(i.a)(v,1)[0],y=Object(n.useCallback)((function(){m(null)}),[]);Object(n.useEffect)((function(){if(j){var e=Object(s.H)();b(c.a.createElement(s.q,{activeModal:u,onClose:y},c.a.createElement(s.o,{id:"modal-page",onClose:y,header:c.a.createElement(s.p,{left:e!==s.l&&c.a.createElement(Te.a,{onClick:y},c.a.createElement(Ve.a,null)),right:e===s.l&&c.a.createElement(Te.a,{onClick:y},e===s.l?"\u0413\u043e\u0442\u043e\u0432\u043e":c.a.createElement(Ke.a,null))},$.date(j.dateTime))},c.a.createElement(We,{onClose:y,receipt:j}))))}}),[j,u,y]);var S=function(e){r({type:"SET_VIEW",payload:{view:e.currentTarget.dataset.story,panel:e.currentTarget.dataset.panel}})},C=h.currentUser&&c.a.createElement(s.E,null,c.a.createElement(s.F,{onClick:S,selected:"balance"===a.view&&"balance.home"===a.panel,"data-story":"balance","data-panel":"home",text:"\u0411\u0430\u043b\u0430\u043d\u0441"},c.a.createElement(He.a,null)),c.a.createElement(s.F,{onClick:S,selected:"analytics"===a.view,"data-story":"analytics","data-panel":"home",text:"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0430"},c.a.createElement(Je.a,null)),c.a.createElement(s.F,{onClick:S,selected:"balance"===a.view&&"balance.add"===a.panel,"data-story":"balance","data-panel":"add",text:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"},c.a.createElement(et.a,null)),c.a.createElement(s.F,{onClick:S,selected:"profile"===a.view,"data-story":"profile","data-panel":"edit",text:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"},c.a.createElement($e.a,null)),c.a.createElement(s.F,{onClick:S,selected:"more"===a.view,"data-story":"more","data-panel":"more",text:"\u0415\u0449\u0451"},c.a.createElement(Ze.a,null)));return c.a.createElement(s.e,{activeStory:a.view,tabbar:C},c.a.createElement(s.G,{id:"authorization",activePanel:a.panel,popout:a.popout},c.a.createElement(s.r,{id:"authorization.login"},c.a.createElement(D,{type:"login"})),c.a.createElement(s.r,{id:"authorization.register"},c.a.createElement(D,{type:"register"}))),c.a.createElement(s.G,{id:"profile",activePanel:a.panel,popout:a.popout},c.a.createElement(s.r,{id:"profile.edit"},c.a.createElement(Y,null))),c.a.createElement(s.G,{id:"registration",activePanel:a.panel,popout:a.popout},c.a.createElement(s.r,{id:"registration.finish"},c.a.createElement(qe,null))),c.a.createElement(s.G,{id:"balance",activePanel:a.panel,popout:a.popout,modal:d},c.a.createElement(s.r,{id:"balance.home"},c.a.createElement(Ce,{setReceiptFromBalance:g,onClickActiveModal:m})),c.a.createElement(s.r,{id:"balance.add"},c.a.createElement(Ue,null))),c.a.createElement(s.G,{id:"analytics",activePanel:a.panel,popout:a.popout},c.a.createElement(s.r,{id:"analytics.home"},c.a.createElement(tt,null))),c.a.createElement(s.G,{id:"more",activePanel:a.panel,popout:a.popout},c.a.createElement(s.r,{id:"more.more"},c.a.createElement(ct,null)),c.a.createElement(s.r,{id:"more.catalog"},c.a.createElement(it,null))))},mt=function(e){var t=e.children,a=_("/users/profile"),c=Object(i.a)(a,2),r=c[0].response,l=c[1],o=Object(n.useContext)(U),u=Object(i.a)(o,2)[1],s=Object(n.useContext)(N),m=Object(i.a)(s,1)[0],p=m.vkUserId,f=m.matchUrlParams,b=C("token"),E=Object(i.a)(b,1)[0];return Object(n.useEffect)((function(){E&&f?(l(),u((function(e){return Object(d.a)({},e,{isLoading:!0})}))):u((function(e){return Object(d.a)({},e,{isLoggedIn:!1})}))}),[l,u,E,f]),Object(n.useEffect)((function(){if(r){var e=r.user.vk_id.toString()===p?r.user:null;u((function(t){return Object(d.a)({},t,{isLoading:!1,isLoggedIn:!!e,currentUser:e})}))}}),[r,u,p]),t};u.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;if("VKWebAppUpdateConfig"===a){var c=document.createAttribute("scheme");c.value=n.scheme?n.scheme:"client_light",document.body.attributes.setNamedItem(c)}})),u.a.send("VKWebAppInit"),window.onload=function(){l.a.render(c.a.createElement(A,null,c.a.createElement(R,null,c.a.createElement(W,null,c.a.createElement(mt,null,c.a.createElement(st,null))))),document.getElementById("root"))}}},[[284,1,2]]]);
//# sourceMappingURL=main.ed9a0b1b.chunk.js.map