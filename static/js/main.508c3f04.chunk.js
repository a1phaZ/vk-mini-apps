(this["webpackJsonpvk-mini-apps-empty"]=this["webpackJsonpvk-mini-apps-empty"]||[]).push([[0],{180:function(e,t,a){e.exports=a(288)},288:function(e,t,a){"use strict";a.r(t);a(181),a(207),a(209),a(210),a(212),a(213),a(214),a(215),a(216),a(217),a(218),a(219),a(221),a(222),a(223),a(224),a(225),a(226),a(227),a(228),a(229),a(230),a(232),a(233),a(234),a(235),a(236),a(237),a(238),a(239),a(240),a(241),a(242),a(243),a(244),a(245),a(246),a(247),a(248),a(249);var n=a(0),r=a.n(n),c=a(70),i=a.n(c),s=a(31),u=a.n(s),o=a(11),l=a.n(o),d=a(35),m=a(32),f=a(114),p=a.n(f),b=(a(258),a(44)),h=a(45),y=function(){function e(){Object(b.a)(this,e)}return Object(h.a)(e,null,[{key:"qr",value:function(e){var t,a,n,r,c;if(e){var i=e.match(/t=(\w{8}T\w+)&s=(\w+\.*\w+)&fn=(\w+)&i=(\w+)&fp=(\w+)/),s=Object(m.a)(i,6);t=s[1],a=s[2],n=s[3],r=s[4],c=s[5]}return{dt:t,sum:a,fn:n,i:r,fp:c}}},{key:"date",value:function(e){var t,a=new Date(e);switch(a.getMonth()+1){case 1:t="\u044f\u043d\u0432\u0430\u0440\u044f";break;case 2:t="\u0444\u0435\u0432\u0440\u0430\u043b\u044f";break;case 3:t="\u043c\u0430\u0440\u0442\u0430";break;case 4:t="\u0430\u043f\u0440\u0435\u043b\u044f";break;case 5:t="\u043c\u0430\u044f";break;case 6:t="\u0438\u044e\u043d\u044f";break;case 7:t="\u0438\u044e\u043b\u044f";break;case 8:t="\u0430\u0432\u0433\u0443\u0441\u0442\u0430";break;case 9:t="\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f";break;case 10:t="\u043e\u043a\u0442\u044f\u0431\u0440\u044f";break;case 11:t="\u043d\u043e\u044f\u0431\u0440\u044f";break;case 12:t="\u0434\u0435\u043a\u0430\u0431\u0440\u044f"}return"".concat(a.getDate()," ").concat(t," ").concat(a.getFullYear())}},{key:"sum",value:function(e){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e/100)}},{key:"totalReceiptSum",value:function(e){return e.map((function(e){return e.totalSum})).reduce((function(e,t){return e+t}))}},{key:"totalSum",value:function(e,t){var a=function(e,t){return e+t},n=e.map((function(e){return e.items.map((function(e){return t?e.income?e.sum:0:e.income?0:e.sum})).reduce(a)})).reduce(a);return t?n:-1*n}}]),e}(),v=a(117),k=function(){function e(){Object(b.a)(this,e),this._apiBase="http://localhost:3000/api"}return Object(h.a)(e,[{key:"callApi",value:function(){var e=Object(d.a)(l.a.mark((function e(t,a,n){var r,c,i,s,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.token,c=Object(v.a)(n,["token"]),i={"Content-Type":"application/json",Authorization:r?"Token ".concat(r):""},e.next=4,fetch("".concat(this._apiBase).concat(a),{method:t,mode:"cors",headers:i,body:"GET"!==t?JSON.stringify(c):null});case 4:if((s=e.sent).ok){e.next=9;break}throw(u=new Error("\u041e\u0448\u0438\u0431\u043a\u0430 \u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438")).subMessage="\u041d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c",u;case 9:return e.next=11,s.json();case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"userLogin",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callApi("POST","/users/login",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"userRegister",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callApi("POST","/users",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"userCurrent",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callApi("GET","/users/current",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"userUpdate",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callApi("PUT","/users/current",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),E=a(115),x=a(116),O=a(103),j=a(118),w=a(12),g=a(110),_=a.n(g),S=a(111),T=a.n(S),q=a(112),A=a.n(q),C=a(113),M=a.n(C),R=a(46),B=a.n(R),I=function(e){var t=e.sum,a=e.fs,n=t>0?{color:"#28a745",fontSize:a}:{color:"#dc3545",fontSize:a};return r.a.createElement("span",{style:n},y.sum(t))},F=a(109),U=a.n(F),z=function(e){var t=e.items,a=e.id,n=(e.dateTime,e.setActiveModal,t.map((function(e,t){var a=e.income?e.sum:-1*e.sum;return r.a.createElement(w.a,{title:e.name,key:t},r.a.createElement(w.c,null,e.price?r.a.createElement(B.a,{indicator:y.sum(e.price)},"\u0426\u0435\u043d\u0430"):null,e.quantity?r.a.createElement(B.a,{indicator:e.quantity},"\u041a\u043e\u043b-\u0432\u043e"):null,r.a.createElement(B.a,{indicator:r.a.createElement(I,{sum:a})},"\u0421\u0443\u043c\u043c\u0430")))})));return r.a.createElement(w.a,{id:a},n)},H=a(72),D=a.n(H),K=a(105),P=a.n(K),V=a(73),W=a.n(V),G=a(106),J=a.n(G),L=a(107),N=a.n(L),Y=a(108),Q=a.n(Y),X=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(x.a)(this,(e=Object(O.a)(t)).call.apply(e,[this].concat(r)))).state={activeModal:null,modalHistory:[]},a.modalBack=function(){a.setActiveModal(a.state.modalHistory[a.state.modalHistory.length-2])},a.setActiveModal=function(e){e=e||null;var t=a.state.modalHistory?Object(E.a)(a.state.modalHistory):[];null===e?t=[]:-1!==t.indexOf(e)?t=t.splice(0,t.indexOf(e)+1):t.push(e),a.setState({activeModal:e,modalHistory:t})},a}return Object(j.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.receipts,n=(t.fetchedUser,t.qr,t.go,t.popout),c=t.id,i=Object(w.i)(),s=r.a.createElement(w.f,{activeModal:this.state.activeModal},a.map((function(t,a){return r.a.createElement(w.d,{key:a,id:t._id,onClose:e.modalBack,header:r.a.createElement(w.e,{left:i!==w.b&&r.a.createElement(W.a,{onClick:e.modalBack},r.a.createElement(D.a,null)),right:i===w.b&&r.a.createElement(W.a,{onClick:e.modalBack},i===w.b?"\u0413\u043e\u0442\u043e\u0432\u043e":r.a.createElement(P.a,null))},y.date(t.dateTime))},r.a.createElement(w.c,null,r.a.createElement(z,{id:t._id,dateTime:t.dateTime,items:t.items})))})));return r.a.createElement(U.a,{id:c,activePanel:c,popout:n,modal:s},r.a.createElement(_.a,{id:c},r.a.createElement(T.a,null,"Balance"),r.a.createElement(w.g,{icon:r.a.createElement(J.a,null),header:r.a.createElement(I,{sum:y.totalReceiptSum(a),fs:"2em"}),action:r.a.createElement(A.a,{size:"l"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0445\u043e\u0434 / \u0440\u0430\u0441\u0445\u043e\u0434")},"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439\u0442\u0435 \u0434\u043e\u0445\u043e\u0434\u044b/\u0440\u0430\u0441\u0445\u043e\u0434\u044b"),r.a.createElement(w.h,null),r.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",paddingTop:"1em"}},r.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-end"}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingRight:"10px"}},r.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em",textAlign:"end"}},"\u0414\u043e\u0445\u043e\u0434\u044b"),r.a.createElement(I,{sum:y.totalSum(a,!0),fs:"1.4em"})),r.a.createElement(N.a,{width:16,height:40,fill:"#28a745"})),r.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-start"}},r.a.createElement(Q.a,{width:16,height:40,fill:"#dc3545"}),r.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingLeft:"10px"}},r.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em"}},"\u0420\u0430\u0441\u0445\u043e\u0434\u044b"),r.a.createElement(I,{sum:y.totalSum(a,!1),fs:"1.4em"})))),r.a.createElement(M.a,{title:"\u0427\u0435\u043a\u0438"},r.a.createElement(w.c,null,a.map((function(t,a){return r.a.createElement(B.a,{key:a,expandable:!0,onClick:function(t){return e.setActiveModal(t.currentTarget.dataset.to)},"data-to":t._id,indicator:r.a.createElement(I,{sum:t.totalSum})},y.date(t.dateTime))}))))))}}]),t}(n.Component),Z=function(){var e=new k,t=Object(n.useState)("home"),a=Object(m.a)(t,2),c=(a[0],a[1]),i=Object(n.useState)(null),s=Object(m.a)(i,2),o=s[0],f=s[1],b=Object(n.useState)(null),h=Object(m.a)(b,2),v=h[0],E=h[1],x=Object(n.useState)(null),O=Object(m.a)(x,2),j=(O[0],O[1]),w=Object(n.useState)(r.a.createElement(p.a,{size:"large"})),g=Object(m.a)(w,2),_=g[0],S=g[1],T=Object(n.useState)(""),q=Object(m.a)(T,2),A=q[0],C=q[1],M=Object(n.useState)([{_id:"5ddf911573e0c321bc89f1ef",receipts:[{fn:"9289000100521868",fd:"12691",fp:"339287482"}],userId:"5dce89f495636e23345b7d34",dateTime:"2019-11-12T00:00:00.000",items:[{modifiers:[],properties:[],_id:"5ddf911573e0c321bc89f1f0",name:"test",sum:1e3,income:!0},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa20",sum:490,quantity:1,name:"\u041f\u0430\u043a\u0435\u0442-\u043c\u0430\u0439\u043a\u0430 \u041c\u0430\u0433\u043d\u0438\u0442",price:490},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa1f",sum:5490,quantity:1,name:"4 \u0421\u0415\u0417\u041e\u041d\u0410 \u0420\u0430\u0433\u0443 \u043e\u0432\u043e\u0449\u043d\u043e\u0435 0,4\u043a\u0433(\u0417\u0430\u043f\u0430\u0434\u043d\u044b\u0439 \u0425\u041a \u041e\u041e\u041e):20",price:5490},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa1e",sum:22038,quantity:1.225,name:"\u0421\u043a\u0443\u043c\u0431\u0440\u0438\u044f \u0441/\u043c \u0443\u043f (\u0432\u0435\u0441):6",price:17990},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa1d",sum:4490,quantity:1,name:"\u041a\u0420\u0410\u0421\u041a\u0418 \u041b\u0415\u0422\u0410 \u0421\u043e\u0442\u0435 400 \u0433 \u043f/\u0443\u043f(\u0420\u0443\u0441\u0441\u043a\u0430\u044f \u043e\u0432\u043e\u0449\u043d\u0430\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044f):8",price:4490},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa1c",sum:3490,quantity:1,name:"MR RICCO Organic \u041c\u0430\u0439\u043e\u043d\u0435\u0437 \u043f\u0435\u0440\u0435\u043f \u044f\u0439\u0446\u0430 67% 375\u0433 \u0434/\u043f(\u041d\u044d\u0444\u0438\u0441):12",price:3490},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa1b",sum:6490,quantity:1,name:'\u0422\u0432\u043e\u0440\u043e\u0433 \u043e\u0431\u0435\u0437\u0436\u0438\u0440\u0435\u043d\u043d\u044b\u0439 \u0412\u0435\u043c\u043e\u043b 0,5% 0,25\u043a\u0433 \u043a\u043e\u043d\u0442 (\u0417\u0410\u041e "\u0412\u0435\u043c\u043e\u043b") :18',price:6490},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa1a",sum:6490,quantity:1,name:"\u0421\u043c\u0435\u0442\u0430\u043d\u0430 15% 0,45\u043a\u0433 \u0444/\u043f (\u041c\u043e\u043b\u043a\u043e\u043c\u0431\u0438\u043d\u0430\u0442 \u041a\u0443\u043d\u0433\u0443\u0440\u0441\u043a\u0438\u0439)",price:6490},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa19",sum:7780,quantity:2,name:"\u041c\u043e\u043b\u043e\u043a\u043e \u043f\u0430\u0441\u0442 2,5% 1\u043b \u0444/\u043f (\u041c\u0430\u0421\u041a\u043e):15",price:3890},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa18",sum:4790,quantity:1,name:"\u042f\u0439\u0446\u043e \u0441\u0442\u043e\u043b\u043e\u0432\u043e\u0435 \u04211 10\u0448\u0442 \u0431\u043e\u043a\u0441 :20",price:4790}],totalSum:-60548,__v:0},{_id:"5de8d0037a0bbc1cd8169744",receipts:[{fn:"9280440300403604",fd:"8950",fp:"0648032311"}],userId:"5dce89f495636e23345b7d34",dateTime:"2019-11-29T00:00:00.000",totalSum:-3663,items:[{modifiers:[],properties:[],_id:"5de8d0037a0bbc1cd8169746",sum:1063,price:1063,quantity:1,name:"\u0423\u0441\u043b\u0443\u0433\u0430 \u043f\u0438\u0442\u0430\u043d\u0438\u044f"},{modifiers:[],properties:[],_id:"5de8d0037a0bbc1cd8169745",sum:2600,price:2600,quantity:1,name:"\u0423\u0441\u043b\u0443\u0433\u0430 \u043f\u0438\u0442\u0430\u043d\u0438\u044f"}],__v:0},{_id:"5ddf912273e0c321bc89f1f5",receipts:[],userId:"5dce89f495636e23345b7d34",dateTime:"2019-11-15T00:00:00.000",items:[{modifiers:[],properties:[],_id:"5ddf912273e0c321bc89f1f6",name:"test",sum:1e6,income:!0},{modifiers:[],properties:[],_id:"5ddf99d96db8bf32044d2009",name:"test",sum:15e5,income:!0}],totalSum:25e5,__v:0}]),R=Object(m.a)(M,2),B=R[0],I=(R[1],function(e){console.log(e),f(e),E(e.token),j(null),S(null)}),F=function(e){console.log(e),f(null),E(null),j(e),S(null)};Object(n.useEffect)((function(){function t(){return(t=Object(d.a)(l.a.mark((function t(){var a,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.send("VKWebAppGetUserInfo");case 2:if(!(a=t.sent).id){t.next=14;break}if(!v){t.next=9;break}return t.next=7,e.userCurrent({token:v}).then((function(e){return I(e)})).catch((function(e){return F(e)}));case 7:t.next=12;break;case 9:return n={user:{id:a.id}},t.next=12,e.userLogin(n).then(function(){var t=Object(d.a)(l.a.mark((function t(a){var r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=4;break}I(a),t.next=8;break;case 4:return t.next=6,e.userRegister(n);case 6:r=t.sent,I(r);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(e){return F(e)}));case 12:t.next=16;break;case 14:r=new Error("\u041d\u0435\u043f\u043e\u043b\u0443\u0447\u0435\u043d \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c vkontakte"),F(r);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}u.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppUpdateConfig":var r=document.createAttribute("scheme");r.value=n.scheme?n.scheme:"client_light",document.body.attributes.setNamedItem(r);break;case"VKWebAppOpenCodeReaderResult":C(n.code_data)}})),function(){t.apply(this,arguments)}()}),[]);var U=y.qr(A);return r.a.createElement(X,{id:"receipts-list",fetchedUser:o,go:function(e){c(e.currentTarget.dataset.to)},qr:U,receipts:B,popout:_})};u.a.send("VKWebAppInit"),i.a.render(r.a.createElement(Z,null),document.getElementById("root"))}},[[180,1,2]]]);
//# sourceMappingURL=main.508c3f04.chunk.js.map