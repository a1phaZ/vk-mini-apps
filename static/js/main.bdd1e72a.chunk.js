(this["webpackJsonpvk-mini-apps-empty"]=this["webpackJsonpvk-mini-apps-empty"]||[]).push([[0],{286:function(e,t,a){e.exports=a(486)},392:function(e,t){},394:function(e,t){},427:function(e,t){},428:function(e,t){},470:function(e,t,a){},484:function(e,t,a){},486:function(e,t,a){"use strict";a.r(t);a(287),a(313),a(315),a(316),a(318),a(319),a(320),a(321),a(322),a(323),a(324),a(325),a(327),a(328),a(329),a(330),a(331),a(332),a(333),a(334),a(335),a(336),a(338),a(339),a(340),a(341),a(342),a(343),a(344),a(345),a(346),a(347),a(348),a(349),a(350),a(351),a(352),a(353),a(354),a(355);var n=a(0),c=a.n(n),r=a(207),l=a.n(r),o=a(29),i=a.n(o),s=a(4),u=(a(363),a(2)),m=a(70),d=a.n(m),p=a(96),f=a(11),E=a(67),b=a.n(E),O=a(58),g=a.n(O),j=a(215),y=a.n(j),h=a(216),v=a.n(h),S=a(241),C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=Object(n.useState)((function(){return localStorage.getItem(e)||t})),c=Object(s.a)(a,2),r=c[0],l=c[1];return Object(n.useEffect)((function(){localStorage.setItem(e,r)}),[r,e]),[r,l]},T=a(217),w=a.n(T),k={view:"authorization",panel:"authorization.login",popout:null,error:null,password:"",confirmPassword:""},I=function(e,t){switch(t.type){case"SET_VIEW":return Object(f.a)({},e,{view:t.payload.view,panel:"".concat(t.payload.view,".").concat(t.payload.panel)});case"SET_PANEL":return Object(f.a)({},e,{password:"",confirmPassword:"",panel:"".concat(e.view,".").concat(t.payload.panel)});case"SHOW_LOADING":return Object(f.a)({},e,{popout:c.a.createElement(u.x,null,c.a.createElement(u.A,null))});case"HIDE_LOADING":return Object(f.a)({},e,{popout:null});case"SET_ERROR":return Object(f.a)({},e,{error:t.payload.error});case"UNSET_ERROR":return Object(f.a)({},e,{error:null});case"SET_PASSWORD":return Object(f.a)({},e,{password:e.password.length<4?e.password+t.payload.digit:e.password});case"SET_CONFIRM_PASSWORD":return Object(f.a)({},e,{confirmPassword:e.confirmPassword.length<4?e.confirmPassword+t.payload.digit:e.confirmPassword});case"UNSET_PASSWORD":return Object(f.a)({},e,{password:"",confirmPassword:""});default:return e}},x=Object(n.createContext)(),_=function(e){var t=e.children,a=Object(n.useReducer)(I,k);return c.a.createElement(x.Provider,{value:a},t)},R=function(e){var t=Object(n.useState)(!1),a=Object(s.a)(t,2),c=a[0],r=a[1],l=Object(n.useState)(null),o=Object(s.a)(l,2),i=o[0],u=o[1],m=Object(n.useState)(null),f=Object(s.a)(m,2),E=f[0],b=f[1],O=Object(n.useState)({}),g=Object(s.a)(O,2),j=g[0],y=g[1],h=C("token"),v=Object(s.a)(h,1)[0],T=Object(n.useContext)(x),k=Object(s.a)(T,2)[1],I="https://balance.z-labz.ru:8080/api",_=Object(n.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(e),r(!0),k({type:"SHOW_LOADING"})}),[k]),R=j.method,L=void 0===R?"GET":R,P=j.params,F=Object(S.a)(j,["method","params"]);return Object(n.useEffect)((function(){if(c){var t={"Content-Type":"application/json",Authorization:v?"Token ".concat(v):""},a=P?w.a.stringify(P):null,n=a?"".concat(I).concat(e,"?").concat(a):"".concat(I).concat(e);(function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,{method:L,mode:"cors",headers:t,body:"GET"!==L?JSON.stringify(F):null}).then((function(e){return e.json()})).then((function(e){if(e.error)throw Error(e.error.message);r(!1),k({type:"HIDE_LOADING"}),u(e)})).catch((function(e){r(!1),k({type:"HIDE_LOADING"}),k({type:"SET_ERROR",payload:{error:e}}),b(e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}}),[c,F,L,e,I,v,P,k]),[{isLoading:c,response:i,error:E},_]},L=a(135),P=a.n(L),F=a(218),A=a.n(F),N=Object(n.createContext)([{},function(){}]),D=function(e){var t=e.children,a=function(){var e=Object(n.useState)(""),t=Object(s.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)(!1),l=Object(s.a)(r,2),o=l[0],i=l[1],u=Object(n.useState)(null),m=Object(s.a)(u,2),d=m[0],p=m[1],f=Object(n.useState)(!1),E=Object(s.a)(f,2),b=E[0],O=E[1];return Object(n.useEffect)((function(){if(o){var e=P.a.parse(a);if(e){p(e.vk_user_id);var t={};Object.keys(e).sort().forEach((function(a){"vk_"===a.slice(0,3)&&(t[a]=e[a])}));var n=P.a.stringify(t),c=A.a.createHmac("sha256","Zs6DYRE8Z2mZ44LfciKW").update(n).digest().toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=$/,"");O(c===e.sign)}}}),[o,a]),[{vkUserId:d,matchUrlParams:b},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";c(e),i(!0)}]}(),r=Object(s.a)(a,2),l=r[0],o=l.vkUserId,i=l.matchUrlParams,u=r[1],m=Object(n.useState)({vkUserId:null,matchUrlParams:!1}),d=Object(s.a)(m,2),p=d[0],f=d[1];return Object(n.useEffect)((function(){u(window.location.search.slice(1))}),[u]),Object(n.useEffect)((function(){o&&f({vkUserId:o,matchUrlParams:i})}),[o,i]),c.a.createElement(N.Provider,{value:[p,f]},t)},U=Object(n.createContext)([{},function(e){}]),z=function(e){var t=e.children,a=Object(n.useState)({isLoading:!1,isLoggedIn:null,currentUser:null}),r=Object(s.a)(a,2),l=r[0],o=r[1];return c.a.createElement(U.Provider,{value:[l,o]},t)},W=a(219),V=a.n(W),M=(a(470),function(e){var t=e.confirm,a=void 0!==t&&t,r=Object(n.useContext)(x),l=Object(s.a)(r,2)[1],o=[{item:"1"},{item:"2"},{item:"3"},{item:"4"},{item:"5"},{item:"6"},{item:"7"},{item:"8"},{item:"9"},{item:null},{item:"0"},{item:c.a.createElement(V.a,null),onClick:function(){l({type:"UNSET_PASSWORD"})},mode:"destructive"}],i=function(e){l(a?{type:"SET_CONFIRM_PASSWORD",payload:{digit:e.currentTarget.dataset.digit}}:{type:"SET_PASSWORD",payload:{digit:e.currentTarget.dataset.digit}})},m=o.map((function(e,t){return c.a.createElement("div",{className:"digit",key:t},e.item&&c.a.createElement(u.a,{size:"xl",mode:e.mode||"secondary","data-digit":e.item,onClick:e.onClick||i},c.a.createElement("b",null,e.item)))}));return c.a.createElement("div",{className:"dialer"},m)}),G=function(e){var t=e.go,a=e.goView,r=e.type,l=Object(n.useState)(null),o=Object(s.a)(l,2),i=o[0],m=o[1],E=R("/users/".concat(r)),O=Object(s.a)(E,2),j=O[0],h=j.response,S=j.error,T=O[1],w=Object(n.useContext)(N),k=Object(s.a)(w,1)[0].vkUserId,I=Object(n.useState)(!1),_=Object(s.a)(I,2),L=_[0],P=_[1],F=Object(n.useContext)(U),A=Object(s.a)(F,2),D=A[0],z=A[1],W=C("token"),V=Object(s.a)(W,2)[1],G=Object(n.useContext)(x),K=Object(s.a)(G,2),H=K[0],q=K[1];Object(n.useEffect)((function(){if(D.isLoggedIn){var e=D.currentUser,t=e.name,a=e.phone,n=e.email,c=e.password;q(t&&a&&n&&c?{type:"SET_VIEW",payload:{view:"balance",panel:"home"}}:{type:"SET_VIEW",payload:{view:"registration",panel:"finish"}})}}),[D,q]),Object(n.useEffect)((function(){H.password.length===H.confirmPassword.length&&(H.password.length||H.confirmPassword.length)?H.password!==H.confirmPassword&&m({status:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438",message:"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0432\u0432\u043e\u0434 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443."}):m(null)}),[H.password,H.confirmPassword,r]),Object(n.useEffect)((function(){if(L){var e={method:"POST",user:{id:+k,password:H.password}};T(e),P(!1),q({type:"UNSET_PASSWORD"})}}),[L,T,H.password,k,q]),Object(n.useEffect)((function(){h&&(!h.user&&h.error?m(h.error):V(h.user.token),z((function(e){return Object(f.a)({},e,{isLoading:!1,isLoggedIn:!!h.user,currentUser:h.user||null})})))}),[h,z,t,a,V]),Object(n.useEffect)((function(){S&&m({message:S.message})}),[S]);var J=function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:P(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=H.password.replace(/[0-9]/g,"*")||"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",Y=H.confirmPassword.replace(/[0-9]/g,"*")||"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c";return c.a.createElement(n.Fragment,null,c.a.createElement(b.a,null,"login"===r?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),c.a.createElement(u.w,{icon:"login"===r?c.a.createElement(y.a,null):c.a.createElement(v.a,null),header:function(){var e;return e=4!==H.password.length||"login"===r?B:Y,c.a.createElement("b",null,e)}()},c.a.createElement(u.h,null,i?c.a.createElement(u.j,{header:i.status,mode:"error"},i.message):null),4!==H.password.length||"login"===r?H.password.length+" \u0438\u0437 4":H.confirmPassword.length+" \u0438\u0437 4"),c.a.createElement(M,{confirm:4===H.password.length}),c.a.createElement(u.h,{style:{textAlign:"center"}},"login"===r&&4===H.password.length&&c.a.createElement(g.a,{size:"xl",mode:"commerce",onClick:J},"login"===r?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),"login"!==r&&H.password&&H.confirmPassword&&H.password===H.confirmPassword&&c.a.createElement(g.a,{mode:"commerce",size:"xl",onClick:J},"login"===r?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f")),c.a.createElement(u.e,null,c.a.createElement(g.a,{stretched:!0,mode:"tertiary",onClick:function(e){q({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"login"===r?"register":"login"},"login"===r?"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f":"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f")))},K=a(68),H=a.n(K),q=a(69),J=a.n(q),B=a(64),Y=a.n(B),Z=a(36),Q=a.n(Z),$=function(){var e=Object(n.useState)(""),t=Object(s.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)(""),o=Object(s.a)(l,2),m=o[0],d=o[1],p=Object(n.useState)(""),E=Object(s.a)(p,2),b=E[0],O=E[1],g=Object(n.useState)(""),j=Object(s.a)(g,2),y=j[0],h=j[1],v=Object(n.useState)(!1),S=Object(s.a)(v,2),C=S[0],T=S[1],w=Object(n.useState)(!0),k=Object(s.a)(w,2),I=k[0],_=k[1],L=Object(n.useState)(null),P=Object(s.a)(L,2),F=P[0],A=P[1],N=Object(n.useState)(""),D=Object(s.a)(N,2),z=D[0],W=D[1],V=R("/users/profile"),M=Object(s.a)(V,2),G=M[0].response,K=M[1],q=R("/fns/password"),B=Object(s.a)(q,2),Z=B[0],$=B[1],X=Object(n.useState)(!1),ee=Object(s.a)(X,2),te=ee[0],ae=ee[1],ne=Object(n.useContext)(U),ce=Object(s.a)(ne,2),re=ce[0],le=ce[1],oe=Object(n.useContext)(x),ie=Object(s.a)(oe,2)[1],se=Object(u.J)();return Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppGetPersonalCardResult":r(n.email),d(n.phone),console.log("profile",n);break;case"VKWebAppGetPersonalCardFailed":console.log("profile error",n)}}))}),[]),Object(n.useEffect)((function(){var e=re.currentUser,t=e.email,a=e.name,n=e.phone,c=e.password;r(t||""),O(a||""),d(n||""),h(c||""),_(!!t&&!!a&&!!n&&!!c)}),[re]),Object(n.useEffect)((function(){te&&(K({method:"PUT",update:{email:a,phone:m,name:b,kktPassword:y}}),ae(!1))}),[te,K,a,m,b,y]),Object(n.useEffect)((function(){if(C){var e={};"restore"!==z&&(e.name=b,e.email=a),e.params={type:z},e.phone=m.replace(/[ ()-]/g,""),e.phone=e.phone.replace(/^[8]/g,"+7"),e.method="POST",$(e),T(!1)}}),[C,z,$,b,a,m]),Object(n.useEffect)((function(){if(G){var e=G.user;e.name&&e.phone&&e.email&&e.password&&(le((function(e){return Object(f.a)({},e,{isLoading:!1,isLoggedIn:!!G.user,currentUser:G.user||null})})),ie({type:"SET_VIEW",payload:{view:"balance",panel:"home"}}))}}),[G,ie,le]),Object(n.useEffect)((function(){Z.response&&A(c.a.createElement(u.E,{layout:"vertical",onClose:function(){return A(null)},before:c.a.createElement(Y.a,{size:24,style:{backgroundColor:"var(--accent)"}},c.a.createElement(Q.a,{fill:"#fff",width:14,height:14}))},Z.response.message))}),[Z.response]),c.a.createElement(n.Fragment,null,c.a.createElement(u.t,{left:I&&c.a.createElement(u.u,{onClick:function(){ie({type:"SET_VIEW",payload:{view:"balance",panel:"home"}})}},se===u.m?c.a.createElement(H.a,null):c.a.createElement(J.a,null))},I?"\u041f\u0440\u043e\u0444\u0438\u043b\u044c":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),c.a.createElement(u.h,null,!I&&c.a.createElement(u.j,{header:"\u0420\u0430\u0437\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435",mode:"default"},"\u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e \u0447\u0435\u043a\u0430\u043c. \u041d\u0438 \u043a\u0430\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043e \u0432\u0430\u0448\u0438\u0445 \u043f\u043e\u043a\u0443\u043f\u043a\u0430\u0445 \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u044e\u0442\u0441\u044f \u0432 \u043d\u0430\u043b\u043e\u0433\u043e\u0432\u0443\u044e."),c.a.createElement(u.n,{type:"text",top:"\u0418\u043c\u044f",name:"name",value:b,onChange:function(e){O(e.target.value)}}),c.a.createElement(u.i,{top:"E-mail \u0438 \u0422\u0435\u043b\u0435\u0444\u043e\u043d",bottom:"\u042d\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0447\u0435\u0440\u0435\u0437 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0412\u043a\u043e\u043d\u0442\u0430\u043a\u0442\u0435. \u041e\u043d\u0438 \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421 \u0434\u043b\u044f \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438 \u0447\u0435\u043a\u043e\u0432."},c.a.createElement(u.n,{type:"email",top:"e-mail",name:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 e-mail",value:a,onChange:function(e){r(e.target.value)}}),c.a.createElement(u.n,{type:"phone",top:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",name:"phone",value:m,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043b\u0435\u0444\u043e\u043d",onChange:function(e){e.target.value.replace(/^[8]/,"+7"),d(e.target.value)}}),c.a.createElement(u.a,{size:"xl",onClick:function(){i.a.send("VKWebAppGetPersonalCard",{type:["phone","email"]})}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 VK")),c.a.createElement(u.i,{top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",bottom:"\u0415\u0441\u043b\u0438 \u043d\u0435 \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043f\u043e \u043a\u0430\u043a\u0438\u043c \u0442\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0430\u043c, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 0 \u0432 \u043f\u043e\u043b\u0435 \u0432\u0432\u043e\u0434\u0430 \u043f\u0430\u0440\u043e\u043b\u044f"},c.a.createElement(u.n,{type:"number",top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c \u0424\u041d\u0421",name:"kktPassword",value:y,onChange:function(e){h(e.target.value)}}),c.a.createElement(u.e,{style:{display:"flex",justifyContent:"space-between"}},c.a.createElement(u.a,{size:"l","data-type":"signup",onClick:function(e){W(e.currentTarget.dataset.type),T(!0)},style:{margin:"0px",width:"49%"}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"),c.a.createElement(u.a,{size:"l","data-type":"restore",onClick:function(e){W(e.currentTarget.dataset.type),T(!0)},style:{margin:"0px",width:"49%"}},"\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"))),c.a.createElement(u.a,{size:"xl",mode:"commerce",onClick:function(){ae(!0)}},I?"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c":"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044e")),F)},X=a(220),ee=a(221),te=function(){function e(){Object(X.a)(this,e)}return Object(ee.a)(e,null,[{key:"qr",value:function(e){try{var t,a,n,c,r;if(e){var l=e.match(/t=(\w{8}T\w+)&s=(\w+\.*\w+)&fn=(\w+)&i=(\w+)&fp=(\w+)/),o=Object(s.a)(l,6);t=o[1],a=o[2],n=o[3],c=o[4],r=o[5]}return{dt:t,sum:a.replace(/[.]/g,""),fn:n,i:c,fp:r}}catch(i){return console.log(i),{error:{message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0447\u0442\u0435\u043d\u0438\u044f QR \u043a\u043e\u0434\u0430"}}}}},{key:"date",value:function(e){var t,a=new Date(e);switch(a.getMonth()+1){case 1:t="\u044f\u043d\u0432\u0430\u0440\u044f";break;case 2:t="\u0444\u0435\u0432\u0440\u0430\u043b\u044f";break;case 3:t="\u043c\u0430\u0440\u0442\u0430";break;case 4:t="\u0430\u043f\u0440\u0435\u043b\u044f";break;case 5:t="\u043c\u0430\u044f";break;case 6:t="\u0438\u044e\u043d\u044f";break;case 7:t="\u0438\u044e\u043b\u044f";break;case 8:t="\u0430\u0432\u0433\u0443\u0441\u0442\u0430";break;case 9:t="\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f";break;case 10:t="\u043e\u043a\u0442\u044f\u0431\u0440\u044f";break;case 11:t="\u043d\u043e\u044f\u0431\u0440\u044f";break;case 12:t="\u0434\u0435\u043a\u0430\u0431\u0440\u044f"}return"".concat(a.getDate()," ").concat(t," ").concat(a.getFullYear())}},{key:"sum",value:function(e){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e/100)}},{key:"totalReceiptSum",value:function(e){if(0===e.length)return 0;return e.map((function(e){return e.sum||e.totalSum})).reduce((function(e,t){return e+t}))}},{key:"totalSumWithParams",value:function(e){if(0===e.length)return 0;return e.map((function(e){var t=e.income,a=e.sum;return t?a:-1*a})).reduce((function(e,t){return e+t}))}},{key:"totalSum",value:function(e,t){if(0===e.length)return 0;var a=function(e,t){return e+t},n=e.map((function(e){return e.items.map((function(e){return t?e.income?e.sum:0:e.income?0:e.sum})).reduce(a)})).reduce(a);return t?n:-1*n}}]),e}(),ae=function(e){var t=e.sum,a=e.fs,n=t>=0?{color:"#28a745",fontSize:a}:{color:"#dc3545",fontSize:a};return c.a.createElement("span",{style:n},te.sum(t))},ne=a(99),ce=a.n(ne),re=a(227),le=a.n(re),oe=a(222),ie=a.n(oe),se=a(223),ue=a.n(se),me=a(224),de=a.n(me),pe=a(242),fe=a(488),Ee=a(489),be=a(490),Oe=a(225),ge=a.n(Oe),je=a(226),ye=a.n(je),he=function(e){var t=e.setDateFromCalendar,a=Object(n.useState)(new Date),r=Object(s.a)(a,2),l=r[0],o=r[1];Object(n.useEffect)((function(){t(l)}),[l,t]);return c.a.createElement(u.k,null,c.a.createElement(u.o,null,c.a.createElement(u.b,{before:c.a.createElement(u.a,{onClick:function(){o(Object(fe.a)(l,1))},mode:"secondary"},c.a.createElement(ge.a,null)),asideContent:c.a.createElement(u.a,{onClick:function(){o(Object(pe.a)(l,1))},mode:"secondary"},c.a.createElement(ye.a,null)),style:{textAlign:"center",fontWeight:"bold"}},Object(Ee.a)(l,"LLLL yyyy",{locale:be.a}).toLocaleUpperCase())))},ve=a(42),Se=(a(484),a(98)),Ce=a.n(Se),Te=function(e){var t=e.items,a=e.id,r=e.isSearch,l=void 0!==r&&r,o=t.map((function(e,t){var a=e.income?e.sum:-1*e.sum,r=function(e){return e&&e.definition?e.definition.definition:null}(e);return c.a.createElement(n.Fragment,{key:t},c.a.createElement("div",{className:"receipt-item"},c.a.createElement("span",{className:"receipt-item-name"},r||e.name),e.price&&!l?c.a.createElement("span",{className:"receipt-item-price"},te.sum(e.price)):null,e.quantity&&!l?c.a.createElement("span",{className:"receipt-item-quantity"},e.quantity):null,e.dateTime&&l?c.a.createElement("span",{className:"receipt-item-dateTime"},te.date(e.dateTime)):null,a?c.a.createElement("span",{className:"receipt-item-sum"},c.a.createElement(ae,{sum:a})):null))}));return c.a.createElement(Ce.a,{id:a,className:"receipt-item-wrapper"},c.a.createElement("div",{className:"receipt-item"},c.a.createElement("span",{className:"receipt-item-name"},"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),l?c.a.createElement("span",{className:"receipt-item-dateTime"},"\u0414\u0430\u0442\u0430"):c.a.createElement(n.Fragment,null,c.a.createElement("span",{className:"receipt-item-price"},"\u0426\u0435\u043d\u0430"),c.a.createElement("span",{className:"receipt-item-quantity"},"\u041a\u043e\u043b-\u0432\u043e")),c.a.createElement("span",{className:"receipt-item-sum"},"\u0421\u0443\u043c\u043c\u0430")),c.a.createElement(u.C,null),o,c.a.createElement(u.C,null),c.a.createElement("div",{className:"receipt-total"},c.a.createElement("span",{className:""},"\u0418\u0442\u043e\u0433\u043e:"),c.a.createElement("span",null,c.a.createElement(ae,{sum:te.totalSumWithParams(t)}))))},we=function(e){var t=e.receipts,a=Object(n.useState)(""),r=Object(s.a)(a,2),l=r[0],o=r[1],i=Object(n.useState)([]),m=Object(s.a)(i,2),d=m[0],p=m[1],f=Object(n.useState)([]),E=Object(s.a)(f,2),b=E[0],O=E[1];return Object(n.useEffect)((function(){if(t){var e=[];t.map((function(e){var t=e.dateTime;return e.items.map((function(e){return e.dateTime=t,e}))})).forEach((function(t){e.push.apply(e,Object(ve.a)(t))})),p(e)}}),[t]),Object(n.useEffect)((function(){O(l?d.filter((function(e){return e.name.toLowerCase().indexOf(l)>-1})):[])}),[l,d]),c.a.createElement(n.Fragment,null,c.a.createElement(u.B,{value:l,onChange:function(e){o(e.target.value.toLowerCase())}}),c.a.createElement(ce.a,{title:"\u041f\u043e\u0438\u0441\u043a"},b.length>0&&c.a.createElement(Te,{id:b._id,isSearch:!0,items:b})))},ke=function(e){var t=e.setReceiptFromBalance,a=e.onClickActiveModal,r=Object(n.useState)(!0),l=Object(s.a)(r,2),o=l[0],i=l[1],m=Object(n.useState)(new Date),d=Object(s.a)(m,2),p=d[0],f=d[1],E=Object(n.useState)([]),O=Object(s.a)(E,2),j=O[0],y=O[1],h=Object(n.useState)(!1),v=Object(s.a)(h,2),S=v[0],C=v[1],T=R("/day"),w=Object(s.a)(T,2),k=w[0].response,I=w[1],_=Object(n.useContext)(x),L=Object(s.a)(_,2)[1],P=Object(n.useCallback)((function(e){f(e),i(!0)}),[]);return Object(n.useEffect)((function(){o&&(I({params:{date:Object(Ee.a)(p,"yyyy-MM-dd")}}),i(!1),C(!1))}),[o,i,I,p]),Object(n.useEffect)((function(){k&&y(k)}),[k,t]),c.a.createElement(n.Fragment,null,c.a.createElement(b.a,null,c.a.createElement(u.v,{aside:c.a.createElement(u.d,{size:"s",mode:"primary"},"0.8.4")},"\u0411\u0430\u043b\u0430\u043d\u0441")),c.a.createElement(we,{receipts:j}),c.a.createElement(u.w,{icon:c.a.createElement(ie.a,null),header:c.a.createElement(ae,{sum:te.totalReceiptSum(j),fs:"2em"}),action:c.a.createElement(g.a,{size:"l",onClick:function(e){L({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"add"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0445\u043e\u0434 / \u0440\u0430\u0441\u0445\u043e\u0434")},"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439\u0442\u0435 \u0434\u043e\u0445\u043e\u0434\u044b/\u0440\u0430\u0441\u0445\u043e\u0434\u044b"),c.a.createElement(u.C,null),c.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",paddingTop:"1em"}},c.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-end"}},c.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingRight:"10px"}},c.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em",textAlign:"end"}},"\u0414\u043e\u0445\u043e\u0434\u044b"),c.a.createElement(ae,{sum:te.totalSum(j,!0),fs:"1.4em"})),c.a.createElement(ue.a,{width:16,height:40,fill:"#28a745"})),c.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-start"}},c.a.createElement(de.a,{width:16,height:40,fill:"#dc3545"}),c.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingLeft:"10px"}},c.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em"}},"\u0420\u0430\u0441\u0445\u043e\u0434\u044b"),c.a.createElement(ae,{sum:te.totalSum(j,!1),fs:"1.4em"})))),c.a.createElement(u.y,{onRefresh:function(){C(!0),i(!0)},isFetching:S},c.a.createElement(ce.a,{title:"\u0427\u0435\u043a\u0438"},c.a.createElement(u.o,null,c.a.createElement(he,{setDateFromCalendar:P}),j.map((function(e,n){return c.a.createElement(le.a,{key:n,expandable:!0,onClick:function(){a("modal-page"),t(e)},"data-to":e._id,indicator:c.a.createElement(ae,{sum:e.totalSum})},te.date(e.dateTime))}))))))},Ie=a(85),xe=a.n(Ie),_e=a(71),Re=a.n(_e),Le=a(231),Pe=a.n(Le),Fe=a(228),Ae=a.n(Fe),Ne=a(230),De=a.n(Ne),Ue=a(229),ze=a.n(Ue),We=function(e){var t=e.message,a=e.isError,r=e.onClose,l=Object(n.useState)(null),o=Object(s.a)(l,2),i=o[0],m=o[1],d=Object(n.useContext)(x),p=Object(s.a)(d,2)[1];return Object(n.useEffect)((function(){m(c.a.createElement(u.E,{layout:"vertical",onClose:r,before:a?c.a.createElement(Y.a,{size:24,style:{backgroundColor:"var(--destructive)"}},c.a.createElement(ze.a,{fill:"#fff",width:18,height:18})):c.a.createElement(Y.a,{size:24,style:{backgroundColor:"var(--accent)"}},c.a.createElement(Q.a,{fill:"#fff",width:18,height:18}))},t))}),[m,p,a,t,r]),i},Ve=function(){var e=Object(n.useState)(""),t=Object(s.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)((function(){var e=new Date,t=e.getMonth()+1>9?e.getMonth()+1:"0".concat(e.getMonth()+1),a=e.getDate()>9?e.getDate():"0".concat(e.getDate());return"".concat(e.getFullYear(),"-").concat(t,"-").concat(a)})),o=Object(s.a)(l,2),m=o[0],d=o[1],p=Object(n.useState)(1),E=Object(s.a)(p,2),O=E[0],j=E[1],y=Object(n.useState)(""),h=Object(s.a)(y,2),v=h[0],S=h[1],C=Object(n.useState)(!1),T=Object(s.a)(C,2),w=T[0],k=T[1],I=Object(n.useState)(null),_=Object(s.a)(I,2),L=_[0],P=_[1],F=Object(n.useState)(null),A=Object(s.a)(F,2),N=A[0],D=A[1],U=Object(n.useContext)(x),z=Object(s.a)(U,2),W=z[0],V=z[1],M=R("/day"),G=Object(s.a)(M,2),K=G[0],q=K.response,B=K.error,Y=G[1],Z=R("/day/receipt"),Q=Object(s.a)(Z,2),$=Q[0],X=Q[1],ee=Object(n.useState)(!1),ae=Object(s.a)(ee,2),ne=ae[0],ce=ae[1],re=Object(n.useState)(!1),le=Object(s.a)(re,2),oe=le[0],ie=le[1],se=Object(u.J)(),ue=Object(n.useCallback)((function(){V({type:"UNSET_ERROR"}),P(null)}),[V]);return Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppOpenCodeReaderResult":D(n.code_data);break;case"VKWebAppOpenCodeReaderFailed":console.log("add day error",n)}}))}),[]),Object(n.useEffect)((function(){ne&&(Y({method:"POST",date:m,items:[{name:a,quantity:O,price:100*v,sum:100*v*O,income:w,modifiers:[],properties:[]}]}),r(""),j(1),k(!1),S(""),ce(!1))}),[ne,ce,m,Y,w,a,v,O]),Object(n.useEffect)((function(){q&&P(c.a.createElement(We,{message:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0448\u043b\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e",isError:!1,onClose:ue}))}),[q,ue]),Object(n.useEffect)((function(){if(N){var e=te.qr(N);if(e.error){var t=e.error;return V({type:"SET_ERROR",payload:{error:t}}),D(null),void ie(!1)}var a=Object(f.a)({method:"POST"},e);X(a)}}),[N,X,oe,V]),Object(n.useEffect)((function(){$.response&&$.response._id&&(P(c.a.createElement(We,{message:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0448\u043b\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e",isError:!1,onClose:ue})),ie(!1),D(null))}),[$.response,X,N,ue]),Object(n.useEffect)((function(){W.error&&(V({type:"SET_ERROR",payload:{error:$.error||B}}),P(c.a.createElement(We,{message:W.error.message,isError:!0,onClose:ue})),ie(!1),D(null))}),[$.error,B,V,W.error,ue]),c.a.createElement(n.Fragment,null,c.a.createElement(b.a,{left:c.a.createElement(Re.a,{key:"back",onClick:function(e){V({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"home"},se===u.m?c.a.createElement(H.a,null):c.a.createElement(J.a,null))},c.a.createElement(De.a,{before:i.a.supports("VKWebAppOpenCodeReader")&&c.a.createElement(Re.a,{key:"qr","data-to":"qr",onClick:function(){V({type:"UNSET_ERROR"}),i.a.send("VKWebAppOpenCodeReader",{})}},c.a.createElement(Ae.a,null))},"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438")),c.a.createElement(Ce.a,null,c.a.createElement(xe.a,{type:"date",top:"\u0414\u0430\u0442\u0430",name:"date",value:m,onChange:function(e){d(e.currentTarget.value)}}),c.a.createElement(xe.a,{type:"text",top:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"name",value:a,onChange:function(e){r(e.currentTarget.value)}}),c.a.createElement(xe.a,{type:"number",top:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",name:"quantity",value:O,onChange:function(e){j(e.currentTarget.value)}}),c.a.createElement(xe.a,{type:"number",top:"\u0426\u0435\u043d\u0430",name:"price",value:v,onChange:function(e){S(e.currentTarget.value)}}),c.a.createElement(Pe.a,{name:"income",checked:w,onChange:function(e){k(e.currentTarget.checked)}},"\u0414\u043e\u0445\u043e\u0434"),c.a.createElement(g.a,{size:"xl",disabled:!m||!a||!O||!v,mode:w?"commerce":"destructive",onClick:function(){ce(!0)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c ",w?"\u0434\u043e\u0445\u043e\u0434":"\u0440\u0430\u0441\u0445\u043e\u0434")),L)},Me=function(e){var t=e.receipt;return c.a.createElement(u.o,null,c.a.createElement(Te,{id:t._id,dateTime:t.dateTime,items:t.items}))},Ge=a(83),Ke=a.n(Ge),He=a(232),qe=a.n(He),Je=function(){var e=Object(n.useState)(""),t=Object(s.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)(""),o=Object(s.a)(l,2),m=o[0],d=o[1],p=Object(n.useState)(""),E=Object(s.a)(p,2),b=E[0],O=E[1],g=Object(n.useState)(""),j=Object(s.a)(g,2),y=j[0],h=j[1],v=Object(n.useState)(0),S=Object(s.a)(v,2),C=S[0],T=S[1],w=Object(n.useState)(""),k=Object(s.a)(w,2),I=k[0],_=k[1],L=Object(n.useState)(!1),P=Object(s.a)(L,2),F=P[0],A=P[1],N=Object(n.useContext)(x),D=Object(s.a)(N,2)[1],z=R("/users/profile"),W=Object(s.a)(z,2),V=W[0].response,M=W[1],G=R("/fns/password"),K=Object(s.a)(G,2),q=K[0],B=K[1],Z=Object(n.useState)(!1),$=Object(s.a)(Z,2),X=$[0],ee=$[1],te=Object(n.useContext)(U),ae=Object(s.a)(te,2)[1],ne=Object(n.useState)(null),ce=Object(s.a)(ne,2),re=ce[0],le=ce[1],oe=Object(u.J)();Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppGetPersonalCardResult":r(n.email),d(n.phone);break;case"VKWebAppGetPersonalCardFailed":console.log("profile error",n)}}))}),[]),Object(n.useEffect)((function(){X&&(M({method:"PUT",update:{email:a,phone:m,name:b,kktPassword:y}}),ee(!1))}),[X,M,a,m,b,y]),Object(n.useEffect)((function(){if(F){var e={};"restore"!==I&&(e.name=b,e.email=a),e.params={type:I},e.phone=m.replace(/[ ()-]/g,""),e.phone=e.phone.replace(/^[8]/g,"+7"),e.method="POST",B(e),A(!1)}}),[F,I,B,b,a,m]),Object(n.useEffect)((function(){if(V){var e=V.user;e.name&&e.phone&&e.email&&e.password&&(ae((function(e){return Object(f.a)({},e,{isLoading:!1,isLoggedIn:!!V.user,currentUser:V.user||null})})),D({type:"SET_VIEW",payload:{view:"balance",panel:"home"}}))}}),[V,D,ae]),Object(n.useEffect)((function(){q.response&&le(c.a.createElement(u.E,{layout:"vertical",onClose:function(){return le(null)},before:c.a.createElement(Y.a,{size:24,style:{backgroundColor:"var(--accent)"}},c.a.createElement(Q.a,{fill:"#fff",width:14,height:14}))},q.response.message))}),[q.response]);return c.a.createElement(n.Fragment,null,c.a.createElement(u.t,{left:c.a.createElement(u.u,{onClick:function(){D({type:"SET_VIEW",payload:{view:"balance",panel:"home"}})}},oe===u.m?c.a.createElement(H.a,null):c.a.createElement(J.a,null))},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f(",C+1,"/3)"),c.a.createElement(u.h,null,function(e){switch(e){case 0:return c.a.createElement(u.i,{top:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u0432\u043e\u0451 \u0438\u043c\u044f"},c.a.createElement(u.n,{type:"text",top:"\u0418\u043c\u044f",name:"name",value:b,onChange:function(e){O(e.target.value)}}),c.a.createElement(u.a,{size:"xl",mode:"commerce",disabled:!b,onClick:function(){T(1)}},"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c"));case 1:return c.a.createElement(u.i,{top:"E-mail \u0438 \u0422\u0435\u043b\u0435\u0444\u043e\u043d",bottom:"\u042d\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0447\u0435\u0440\u0435\u0437 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0412\u043a\u043e\u043d\u0442\u0430\u043a\u0442\u0435. \u041e\u043d\u0438 \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421 \u0434\u043b\u044f \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438 \u0447\u0435\u043a\u043e\u0432."},c.a.createElement(u.n,{type:"email",top:"e-mail",name:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 e-mail",value:a,onChange:function(e){r(e.target.value)}}),c.a.createElement(u.n,{type:"phone",top:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",name:"phone",value:m,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043b\u0435\u0444\u043e\u043d",onChange:function(e){e.target.value.replace(/^[8]/,"+7"),d(e.target.value)}}),c.a.createElement(u.a,{size:"xl",onClick:function(){i.a.send("VKWebAppGetPersonalCard",{type:["phone","email"]})}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 VK"),c.a.createElement(u.a,{size:"xl",mode:"commerce",disabled:!a||!m,onClick:function(){T(2)}},"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c"));case 2:return c.a.createElement(u.i,{top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",bottom:"\u0415\u0441\u043b\u0438 \u0412\u044b, \u043f\u043e \u043a\u0430\u043a\u0438\u043c \u0442\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0430\u043c, \u043d\u0435 \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c - \u0432\u0432\u0435\u0434\u0438\u0442\u0435 0 \u0432 \u043f\u043e\u043b\u0435 \u0432\u0432\u043e\u0434\u0430 \u043f\u0430\u0440\u043e\u043b\u044f"},c.a.createElement(u.n,{type:"number",top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c \u0424\u041d\u0421",name:"kktPassword",value:y,onChange:function(e){h(e.target.value)}}),c.a.createElement(u.e,{style:{display:"flex",justifyContent:"space-between"}},c.a.createElement(u.a,{size:"l","data-type":"signup",onClick:function(e){_(e.currentTarget.dataset.type),A(!0)},style:{margin:"0px",width:"49%"}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"),c.a.createElement(u.a,{size:"l","data-type":"restore",onClick:function(e){_(e.currentTarget.dataset.type),A(!0)},style:{margin:"0px",width:"49%"}},"\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c")),c.a.createElement(u.a,{size:"xl",mode:"commerce",disabled:!a&&!m,onClick:function(){ee(!0)}},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c"));default:return}}(C)),re)},Be=a(233),Ye=a.n(Be),Ze=a(234),Qe=a.n(Ze),$e=a(235),Xe=a.n($e),et=a(236),tt=a.n(et),at=a(100),nt=a.n(at),ct=function(){return c.a.createElement(n.Fragment,null,c.a.createElement(u.t,null,"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0430"),c.a.createElement(u.w,null,"\u0420\u0430\u0437\u0434\u0435\u043b \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435"))},rt=a(237),lt=a.n(rt),ot=function(){var e=Object(n.useContext)(x),t=Object(s.a)(e,2),a=t[0],r=t[1],l=R("/day"),o=Object(s.a)(l,2),m=o[0],d=m.response,p=m.error,f=o[1],E=Object(n.useState)((function(){var e=new Date,t=e.getMonth()+1>9?e.getMonth()+1:"0".concat(e.getMonth()+1),a=e.getDate()>9?e.getDate():"0".concat(e.getDate());return"".concat(e.getFullYear(),"-").concat(t,"-").concat(a)})),b=Object(s.a)(E,1)[0],O=Object(n.useState)(null),g=Object(s.a)(O,2),j=g[0],y=g[1];Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppOpenPayFormResult":if(n.status){console.log("\u041f\u043b\u0430\u0442\u0435\u0436 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d");var c={method:"POST",date:b,items:[{name:"\u041f\u043e\u043c\u043e\u0449\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0443 Balance",quantity:1,price:100*n.amount,sum:100*n.amount*1,income:!1,modifiers:[],properties:[{transactionId:n.transaction_id}]}]};f(c)}break;case"VKWebAppOpenPayFormFailed":console.log("profile error",n)}}))}));var h=Object(n.useCallback)((function(){r({type:"UNSET_ERROR"}),y(null)}),[r]);return Object(n.useEffect)((function(){d&&y(c.a.createElement(We,{message:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u043f\u043e\u043c\u043e\u0449\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0443!",isError:!1,onClose:h}))}),[d,h]),Object(n.useEffect)((function(){a.error&&(r({type:"SET_ERROR",payload:{error:p}}),y(c.a.createElement(We,{message:a.error.message,isError:!0,onClose:h})))}),[p,r,a.error,h]),c.a.createElement(n.Fragment,null,c.a.createElement(u.t,null,"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e"),c.a.createElement(u.k,null,c.a.createElement(u.l,{mode:"secondary"},"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e"),c.a.createElement(u.D,{"data-panel":"catalog",expandable:!0,before:c.a.createElement(nt.a,null),onClick:function(e){r({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.panel}})}},"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a")),c.a.createElement(u.k,null,c.a.createElement(u.l,{mode:"secondary"},"\u041f\u043e\u043c\u043e\u0449\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0443"),c.a.createElement(u.D,{"data-panel":"catalog",expandable:!0,before:c.a.createElement(lt.a,null),onClick:function(){i.a.send("VKWebAppOpenPayForm",{app_id:7252987,action:"pay-to-user",params:{amount:100,description:"\u041d\u0430 \u043a\u043e\u0444\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443",user_id:3479465}})}},"\u041d\u0430 \u043a\u043e\u0444\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443")),j)},it=a(238),st=a.n(it),ut=a(136),mt=a.n(ut),dt=a(239),pt=a.n(dt),ft={catalog:[],filteredCatalog:[],catalogToSave:new Set,filterItems:[],editedElementId:"",openFilter:!1,filterRules:[]},Et=function(e,t){switch(t.type){case"SET_CATALOG":var a=e.filterRules.map((function(t){return e.catalog.filter((function(e){return e.definition===t&&e}))})).flat();return Object(f.a)({},e,{catalog:t.payload.catalog,filteredCatalog:a&&a.length>0?a:t.payload.catalog,filterRules:a&&a.length>0?e.filterRules:[],catalogToSave:new Set,editedElementId:""});case"SET_EDITED_ELEMENT":return Object(f.a)({},e,{editedElementId:t.payload.id});case"FILL_SAVE_CATALOG":var n,c=e.catalog.findIndex((function(e){return e._id===t.payload.id}));t.payload.definition&&((n=e.catalog[c]).definition=t.payload.definition);var r=new Set(e.catalogToSave);return r.add(n),Object(f.a)({},e,{catalogToSave:r});case"ERASE_FILTER_RULES":return Object(f.a)({},e,{filterRules:[],openFilter:!1,filteredCatalog:e.catalog});case"SET_FILTER_ITEMS":var l=e.catalog.map((function(e){return e.definition?e.definition:"*\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438"})).reduce((function(e,t){return e.includes(t)?e:[].concat(Object(ve.a)(e),[t])}),[]);return Object(f.a)({},e,{filterItems:l});case"SET_FILTER_RULES":var o=e.filterRules,i=e.filterRules.length>0?e.filteredCatalog:[];if(t.payload.checked){o=[].concat(Object(ve.a)(o),[t.payload.definition]);var s=e.catalog.filter((function(e){return e.definition===t.payload.definition}));i=[].concat(Object(ve.a)(i),Object(ve.a)(s))}else o.splice(o.findIndex((function(e){return e===t.payload.definition})),1),i=o.map((function(t){return e.catalog.filter((function(e){return e.definition===t&&e}))})).flat();return Object(f.a)({},e,{filteredCatalog:i,filterRules:o});case"OPEN_FILTER":return Object(f.a)({},e,{openFilter:!0});case"CLOSE_FILTER":return Object(f.a)({},e,{openFilter:!1});default:return e}},bt=function(){var e=Object(n.useReducer)(Et,ft),t=Object(s.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)(""),o=Object(s.a)(l,2),i=o[0],m=o[1],d=R("/catalog".concat(i)),p=Object(s.a)(d,2),f=p[0].response,E=p[1],b=Object(n.useState)(!0),O=Object(s.a)(b,2),g=O[0],j=O[1],y=Object(n.useState)("get"),h=Object(s.a)(y,1)[0],v=a.filteredCatalog.map((function(e,t){return c.a.createElement(n.Fragment,{key:t},c.a.createElement(u.z,{"data-id":e._id,multiline:!0,caption:e.name,after:c.a.createElement(st.a,null),bottom:a.editedElementId===e._id&&c.a.createElement(u.n,{id:a.editedElementId,type:"text",defaultValue:e.definition,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0443",onChange:function(e){r({type:"FILL_SAVE_CATALOG",payload:{id:a.editedElementId,definition:e.target.value}})}}),onClick:function(e){r({type:"SET_EDITED_ELEMENT",payload:{id:e.currentTarget.dataset.id}})},actions:c.a.createElement(n.Fragment,null,c.a.createElement(u.a,{disabled:!0,style:{display:"none"}},c.a.createElement(mt.a,null)),c.a.createElement(u.a,{disabled:!0,style:{display:"none"},mode:"secondary"},c.a.createElement(mt.a,null)))},c.a.createElement("b",null,e.definition?e.definition:"\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438")))})),S=a.filterItems.map((function(e,t){var n="*\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438"!==e?a.filterRules.includes(e):a.filterRules.includes(void 0);return c.a.createElement(u.D,{key:t,after:c.a.createElement(u.F,{"data-definition":e,onChange:function(e){var t=e.currentTarget.dataset.definition,a=e.currentTarget.checked;r({type:"SET_FILTER_RULES",payload:{checked:a,definition:"*\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438"!==t?t:void 0}})},defaultChecked:n})},e)}));Object(n.useEffect)((function(){a.editedElementId&&document.getElementById(a.editedElementId).focus()}),[a.editedElementId]),Object(n.useEffect)((function(){if(i||g){var e={};g&&(e.params={a:h}),i&&(e.method="PUT",e.update=Object(ve.a)(a.catalogToSave)),E(e)}}),[i,a.catalogToSave,E,g,h]),Object(n.useEffect)((function(){f&&(r({type:"SET_CATALOG",payload:{catalog:f}}),r({type:"SET_FILTER_ITEMS"}),m(""),j(!1))}),[f]);var C={paddingTop:0!==a.filterRules.length&&60,paddingBottom:(0!==Object(ve.a)(a.catalogToSave).length||0!==a.filterRules.length&&a.openFilter)&&60},T={paddingRight:10,paddingLeft:10};return c.a.createElement(n.Fragment,null,c.a.createElement(u.t,{left:c.a.createElement(u.u,{onClick:function(){a.openFilter?r({type:"CLOSE_FILTER"}):r({type:"OPEN_FILTER"})}},c.a.createElement(pt.a,null))},"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a"),c.a.createElement(u.k,{style:C},a.openFilter?S:v),0!==a.filterRules.length&&c.a.createElement(u.g,{style:T,vertical:"top"},c.a.createElement(u.C,{wide:!0}),c.a.createElement(u.a,{mode:"destructive",size:"xl",onClick:function(){r({type:"ERASE_FILTER_RULES"})}},"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440")),0!==Object(ve.a)(a.catalogToSave).length&&c.a.createElement(u.g,{style:T,vertical:"bottom"},c.a.createElement(u.C,{wide:!0}),c.a.createElement(u.a,{mode:"commerce",size:"xl",onClick:function(){m("/update")}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f")),0!==a.filterRules.length&&a.openFilter&&c.a.createElement(u.g,{style:T,vertical:"bottom"},c.a.createElement(u.C,{wide:!0}),c.a.createElement(u.a,{mode:"commerce",size:"xl",onClick:function(){r({type:"CLOSE_FILTER"})}},"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440")))},Ot=a(240),gt=a.n(Ot),jt={shoppingList:[],shoppingItem:{text:"",done:!1},date:new Date},yt=function(e,t){switch(t.type){case"INITIAL_SHOPPING_LIST":return Object(f.a)({},e,{shoppingList:t.payload.list});case"SET_SHOPPING_ITEM":return Object(f.a)({},e,{shoppingItem:{text:t.payload.text,done:!1}});case"ADD_ITEM":var a=e.shoppingList;return e.shoppingItem.text?Object(f.a)({},e,{shoppingList:[].concat(Object(ve.a)(a),[e.shoppingItem]),shoppingItem:{text:"",done:!1}}):e;case"DELETE_ITEM":var n=e.shoppingList;return n.splice(t.payload.index,1),Object(f.a)({},e,{shoppingList:n});case"SET_DONE":var c=e.shoppingList;return c[t.payload.index].done=!c[t.payload.index].done,Object(f.a)({},e,{shoppingList:c});default:return e}},ht=function(){var e=C("shoppingList",JSON.stringify([])),t=Object(s.a)(e,2),a=t[0],r=t[1],l=Object(n.useReducer)(yt,jt),o=Object(s.a)(l,2),i=o[0],m=o[1],d=i.shoppingList.map((function(e,t){return c.a.createElement(u.D,{key:t,after:c.a.createElement(gt.a,{"data-index":t,onClick:function(e){m({type:"DELETE_ITEM",payload:{index:e.currentTarget.dataset.index}})}})},c.a.createElement(u.c,{defaultChecked:e.done,"data-index":t,style:{textDecoration:e.done&&"line-through"},onChange:function(e){m({type:"SET_DONE",payload:{index:e.currentTarget.dataset.index}})}},e.text))}));return Object(n.useEffect)((function(){m({type:"INITIAL_SHOPPING_LIST",payload:{list:JSON.parse(a)}})}),[a]),Object(n.useEffect)((function(){0!==i.shoppingList.length&&r(JSON.stringify(i.shoppingList))}),[r,i]),c.a.createElement(n.Fragment,null,c.a.createElement(u.t,null,"\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043a\u0443\u043f\u043e\u043a"),c.a.createElement(u.h,{onSubmit:function(e){e.preventDefault(),m({type:"ADD_ITEM"})}},c.a.createElement(u.n,{type:"text",top:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",name:"shopping-item",value:i.shoppingItem.text,onChange:function(e){m({type:"SET_SHOPPING_ITEM",payload:{text:e.currentTarget.value}})},placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"})),c.a.createElement(u.k,null,i.shoppingList.length>0?d:c.a.createElement(u.w,null,"\u0412\u0430\u0448 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043a\u0443\u043f\u043e\u043a \u043f\u0443\u0441\u0442.")))},vt=function(){var e=Object(n.useContext)(x),t=Object(s.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)(null),o=Object(s.a)(l,2),i=o[0],m=o[1],d=Object(n.useState)(null),p=Object(s.a)(d,2),f=p[0],E=p[1],b=Object(n.useState)(null),O=Object(s.a)(b,2),g=O[0],j=O[1],y=Object(n.useContext)(U),h=Object(s.a)(y,1)[0],v=Object(n.useCallback)((function(){m(null)}),[]);Object(n.useEffect)((function(){if(g){var e=Object(u.J)();E(c.a.createElement(u.r,{activeModal:i,onClose:v},c.a.createElement(u.p,{id:"modal-page",onClose:v,header:c.a.createElement(u.q,{left:e!==u.m&&c.a.createElement(Re.a,{onClick:v},c.a.createElement(Ke.a,null)),right:e===u.m&&c.a.createElement(Re.a,{onClick:v},e===u.m?"\u0413\u043e\u0442\u043e\u0432\u043e":c.a.createElement(qe.a,null))},te.date(g.dateTime))},c.a.createElement(Me,{onClose:v,receipt:g}))))}}),[g,i,v]);var S=function(e){r({type:"SET_VIEW",payload:{view:e.currentTarget.dataset.story,panel:e.currentTarget.dataset.panel}})},C=h.currentUser&&c.a.createElement(u.G,null,c.a.createElement(u.H,{onClick:S,selected:"balance"===a.view&&"balance.home"===a.panel,"data-story":"balance","data-panel":"home",text:"\u0411\u0430\u043b\u0430\u043d\u0441"},c.a.createElement(Ye.a,null)),c.a.createElement(u.H,{onClick:S,selected:"list"===a.view,"data-story":"list","data-panel":"list",text:"\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043a\u0443\u043f\u043e\u043a"},c.a.createElement(nt.a,null)),c.a.createElement(u.H,{onClick:S,selected:"balance"===a.view&&"balance.add"===a.panel,"data-story":"balance","data-panel":"add",text:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"},c.a.createElement(tt.a,null)),c.a.createElement(u.H,{onClick:S,selected:"profile"===a.view,"data-story":"profile","data-panel":"edit",text:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"},c.a.createElement(Xe.a,null)),c.a.createElement(u.H,{onClick:S,selected:"more"===a.view,"data-story":"more","data-panel":"more",text:"\u0415\u0449\u0451"},c.a.createElement(Qe.a,null)));return c.a.createElement(u.f,{activeStory:a.view,tabbar:C},c.a.createElement(u.I,{id:"authorization",activePanel:a.panel,popout:a.popout},c.a.createElement(u.s,{id:"authorization.login"},c.a.createElement(G,{type:"login"})),c.a.createElement(u.s,{id:"authorization.register"},c.a.createElement(G,{type:"register"}))),c.a.createElement(u.I,{id:"profile",activePanel:a.panel,popout:a.popout},c.a.createElement(u.s,{id:"profile.edit"},c.a.createElement($,null))),c.a.createElement(u.I,{id:"registration",activePanel:a.panel,popout:a.popout},c.a.createElement(u.s,{id:"registration.finish"},c.a.createElement(Je,null))),c.a.createElement(u.I,{id:"balance",activePanel:a.panel,popout:a.popout,modal:f},c.a.createElement(u.s,{id:"balance.home"},c.a.createElement(ke,{setReceiptFromBalance:j,onClickActiveModal:m})),c.a.createElement(u.s,{id:"balance.add"},c.a.createElement(Ve,null))),c.a.createElement(u.I,{id:"analytics",activePanel:a.panel,popout:a.popout},c.a.createElement(u.s,{id:"analytics.home"},c.a.createElement(ct,null))),c.a.createElement(u.I,{id:"more",activePanel:a.panel,popout:a.popout},c.a.createElement(u.s,{id:"more.more"},c.a.createElement(ot,null)),c.a.createElement(u.s,{id:"more.catalog"},c.a.createElement(bt,null))),c.a.createElement(u.I,{id:"list",activePanel:a.panel,popout:a.popout},c.a.createElement(u.s,{id:"list.list"},c.a.createElement(ht,null))))},St=function(e){var t=e.children,a=R("/users/profile"),c=Object(s.a)(a,2),r=c[0].response,l=c[1],o=Object(n.useContext)(U),i=Object(s.a)(o,2)[1],u=Object(n.useContext)(N),m=Object(s.a)(u,1)[0],d=m.vkUserId,p=m.matchUrlParams,E=C("token"),b=Object(s.a)(E,1)[0];return Object(n.useEffect)((function(){b&&p?(l(),i((function(e){return Object(f.a)({},e,{isLoading:!0})}))):i((function(e){return Object(f.a)({},e,{isLoggedIn:!1})}))}),[l,i,b,p]),Object(n.useEffect)((function(){if(r){var e=r.user.vk_id.toString()===d?r.user:null;i((function(t){return Object(f.a)({},t,{isLoading:!1,isLoggedIn:!!e,currentUser:e})}))}}),[r,i,d]),t};i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;if("VKWebAppUpdateConfig"===a){var c=document.createAttribute("scheme");c.value=n.scheme?n.scheme:"client_light",document.body.attributes.setNamedItem(c)}})),i.a.send("VKWebAppInit"),window.onload=function(){l.a.render(c.a.createElement(D,null,c.a.createElement(_,null,c.a.createElement(z,null,c.a.createElement(St,null,c.a.createElement(vt,null))))),document.getElementById("root"))}}},[[286,1,2]]]);
//# sourceMappingURL=main.bdd1e72a.chunk.js.map