{"version":3,"sources":["hooks/useLocalStorage.js","contexts/routerContext.js","hooks/useApi.js","contexts/appSign.js","hooks/useCompareSign.js","contexts/currentUser.js","panels/Authorization.js","panels/Profile.js","handlers/prepare.js","components/ColoredSum.js","components/Calendar.js","components/Receipt/index.js","components/Receipt/receipt.js","components/search/index.js","components/search/SearchComponent.js","panels/Balance.js","components/CustomSnackbar.js","panels/AddDay.js","components/Modal.js","panels/Registration.js","panels/Analytics.js","panels/More.js","panels/Catalog.js","App.js","components/CurrentUserChecker.js","index.js"],"names":["key","initialValue","useState","localStorage","getItem","value","setValue","useEffect","setItem","initialState","view","panel","popout","error","reducer","state","action","type","payload","RouterContext","createContext","RouterContextProvider","children","useReducer","Provider","url","isLoading","setIsLoading","response","setResponse","setError","options","setOptions","useLocalStorage","token","useContext","dispatch","_apiBase","process","doApiFetch","useCallback","method","params","bodyFields","headers","Authorization","qString","queryString","stringify","uri","a","fetch","mode","body","JSON","then","res","json","r","Error","message","catch","e","fetchData","AppSignContext","AppSignProvider","urlParams","setUrlParams","vkUserId","setVkUserId","matchUrlParams","setMatch","qs","parse","vk_user_id","ordered","Object","keys","sort","forEach","slice","stringParams","paramsHash","crypto","createHmac","update","digest","toString","replace","sign","useCompareSign","setParams","setState","window","location","search","CurrentUserContext","p","CurrentUserProvider","isLoggedIn","currentUser","go","goView","password","setPassword","confirmPassword","setConfirmPassword","formError","setFormError","useApi","startFetchData","setStartFetchData","currentUserState","setCurrentUserState","setToken","name","phone","email","length","status","user","id","onChange","target","Math","max","parseInt","formButtonClick","icon","header","top","align","size","onClick","stretched","currentTarget","dataset","to","data-to","Profile","setEmail","setPhone","setName","kktPassword","setKktPassword","fetchToFns","setFetchToFns","canBack","setCanBack","snackbar","setSnackbar","fnsPasswordType","setFnsPasswordType","fnsResponse","doFnsFetch","osName","platform","bridge","subscribe","detail","data","console","log","layout","onClose","before","style","backgroundColor","fill","width","height","left","IOS","bottom","placeholder","send","display","justifyContent","data-type","margin","Prepare","str","dt","sum","fn","i","fp","match","monthName","Date","getMonth","getDate","getFullYear","n","Intl","NumberFormat","currency","format","arr","map","item","totalSum","reduce","previousValue","currentValue","income","ts","items","ColoredSum","fs","stl","color","fontSize","prepare","Calendar","setDateFromCalendar","currentDate","setCurrentDate","subMonths","asideContent","addMonths","textAlign","fontWeight","locale","ru","toLocaleUpperCase","Receipt","isSearch","receiptItem","index","definition","setDefinition","className","price","quantity","dateTime","date","totalSumWithParams","SearchComponent","receipts","setSearch","searchTarget","setSearchTarget","searchResult","setSearchResult","receipt","push","filter","toLowerCase","indexOf","title","_id","Balance","setReceiptFromBalance","onClickActiveModal","initialFetch","setInitialFetch","setReceipts","fetching","setFetching","aside","totalReceiptSum","flexDirection","paddingTop","flex","paddingRight","paddingLeft","onRefresh","isFetching","expandable","indicator","CustomSnackBar","isError","AddDay","m","d","setDate","setQuantity","setPrice","setIncome","qr","setQR","routerContext","checkReceipt","setCheckReceipt","osname","code_data","modifiers","properties","preparedQR","supports","checked","disabled","Modal","Registration","step","setStep","registerMarkup","Analytics","More","data-panel","Catalog","updateStr","setUpdateStr","catalog","setCatalog","editedElementId","setEditedElementId","Set","catalogToSave","setCatalogToSave","editCatalogElement","findIndex","cat","obj","set","add","fillSaveCatalog","catalogList","b","defA","defB","data-id","multiline","caption","after","defaultValue","onClickToEditElement","actions","document","getElementById","focus","paddingBottom","vertical","wide","App","activeModal","setActiveModal","modal","setModal","setReceipt","currentUserContext","modalBack","right","onStoryChange","story","tb","selected","data-story","text","activeStory","tabbar","activePanel","CurrentUserChecker","doFetch","vk_id","schemeAttribute","createAttribute","scheme","attributes","setNamedItem","onload","ReactDOM","render"],"mappings":"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","file":"static/js/main.bf7a6d91.chunk.js","sourcesContent":["import { useState, useEffect } from 'react';\r\n\r\nexport default (key, initialValue = '') => {\r\n  const [value, setValue] = useState(() => {\r\n    return localStorage.getItem(key) || initialValue;\r\n  });\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem(key, value)\r\n  }, [value, key]);\r\n\r\n  return [value, setValue];\r\n}\r\n","import React, { createContext, useReducer } from 'react';\r\nimport {PopoutWrapper, ScreenSpinner} from \"@vkontakte/vkui\";\r\n\r\nconst initialState = {\r\n\tview: 'authorization',\r\n\tpanel: 'authorization.login',\r\n\tpopout: null,\r\n  error: null\r\n};\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'SET_VIEW':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tview: action.payload.view,\r\n\t\t\t\tpanel: `${action.payload.view}.${action.payload.panel}`\r\n\t\t\t};\r\n\t\tcase 'SET_PANEL':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpanel: `${state.view}.${action.payload.panel}`\r\n\t\t\t};\r\n\t\tcase 'SHOW_LOADING':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpopout: (\r\n\t\t\t\t\t<PopoutWrapper>\r\n\t\t\t\t\t\t<ScreenSpinner />\r\n\t\t\t\t\t</PopoutWrapper>\r\n\t\t\t\t)\r\n\t\t\t};\r\n\t\tcase 'HIDE_LOADING':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpopout: null\r\n\t\t\t};\r\n    case 'SET_ERROR':\r\n      return {\r\n        ...state,\r\n        error: action.payload.error\r\n      }\r\n    case 'UNSET_ERROR' :\r\n      return {\r\n        ...state,\r\n        error: null\r\n      }\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n};\r\n\r\nexport const RouterContext = createContext();\r\n\r\nexport const RouterContextProvider = ({ children }) => {\r\n\tconst value = useReducer(reducer, initialState);\r\n\treturn (\r\n\t\t<RouterContext.Provider value={value}>\r\n\t\t\t{children}\r\n\t\t</RouterContext.Provider>\r\n\t)\r\n};","import { useState, useEffect, useCallback, useContext } from 'react';\r\nimport useLocalStorage from \"./useLocalStorage\";\r\nimport queryString from 'query-string';\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nexport default url => {\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [response, setResponse] = useState(null);\r\n\tconst [error, setError] = useState(null);\r\n\tconst [options, setOptions] = useState({});\r\n\tconst [token] = useLocalStorage('token');\r\n\tconst [,dispatch] = useContext(RouterContext);\r\n\tconst _apiBase = process.env.NODE_ENV !== 'development' ? process.env.REACT_APP_BASEURL : process.env.REACT_APP_BASEURL_DEV;\r\n\t// const _apiBase = `https://35.238.182.107:8080/api`; `http://localhost:3000/api`\r\n\r\n\tconst doApiFetch = useCallback((options = {}) => {\r\n\t\tsetOptions(options);\r\n\t\tsetIsLoading(true);\r\n\t\tdispatch({ type: 'SHOW_LOADING' });\r\n\t}, [dispatch]);\r\n\r\n\tconst { method = 'GET', params, ...bodyFields} = options;\r\n\tuseEffect(() => {\r\n\t\tif (!isLoading) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst headers = {\r\n\t\t\t'Content-Type': 'application/json',\r\n\t\t\tAuthorization: token ? `Token ${token}` : '',\r\n\t\t};\r\n\r\n\t\tconst qString = params ? queryString.stringify(params) : null;\r\n\r\n\t\tconst uri = qString ? `${_apiBase}${url}?${qString}` : `${_apiBase}${url}`;\r\n\r\n\t\tconst fetchData = async () => {\r\n\t\t\tawait fetch(uri, {\r\n\t\t\t\tmethod,\r\n\t\t\t\tmode: 'cors',\r\n\t\t\t\theaders,\r\n\t\t\t\tbody: method !== 'GET' ? JSON.stringify(bodyFields) : null,\r\n\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\t// console.log(res.json());\r\n\t\t\t\t\t// if (!res.ok) throw Error(res.statusText);\r\n\t\t\t\t\treturn res.json();\r\n\t\t\t\t})\r\n\t\t\t\t.then(r => {\r\n\t\t\t\t\tif (r.error) {throw Error(r.error.message);}\r\n\t\t\t\t\tsetIsLoading(false);\r\n\t\t\t\t\tdispatch({ type: 'HIDE_LOADING' });\r\n\t\t\t\t\tsetResponse(r);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\tsetIsLoading(false);\r\n\t\t\t\t\tdispatch({ type: 'HIDE_LOADING' });\r\n\t\t\t\t\tdispatch({type: 'SET_ERROR', payload: {error: e}});\r\n\t\t\t\t\tsetError(e);\r\n\t\t\t\t});\r\n\t\t};\r\n\r\n\t\tfetchData();\r\n\t}, [isLoading, bodyFields, method, url, _apiBase, token, params, dispatch]);\r\n\treturn [{isLoading, response, error}, doApiFetch];\r\n}\r\n","import React, { useState, createContext, useEffect } from 'react';\r\nimport useCompareSign from \"../hooks/useCompareSign\";\r\n\r\nexport const AppSignContext = createContext([{}, () => {}]);\r\n\r\nexport const AppSignProvider = ({ children }) => {\r\n  const [{vkUserId, matchUrlParams}, setParams] = useCompareSign();\r\n  const [state, setState] = useState({\r\n    vkUserId: null,\r\n    matchUrlParams: false\r\n  });\r\n\r\n  useEffect(()=>{\r\n    setParams(window.location.search.slice(1));\r\n  }, [setParams]);\r\n\r\n  useEffect(() => {\r\n    if (!vkUserId) return;\r\n    setState({vkUserId, matchUrlParams});\r\n  }, [vkUserId, matchUrlParams]);\r\n\r\n  return (\r\n    <AppSignContext.Provider value={[state, setState]}>\r\n      {children}\r\n    </AppSignContext.Provider>\r\n  )\r\n};","import { useState, useEffect } from 'react';\r\nimport qs from 'querystring';\r\nimport crypto from 'crypto';\r\n\r\nexport default () => {\r\n\tconst [urlParams, setUrlParams] = useState('');\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [vkUserId, setVkUserId] = useState(null);\r\n\tconst [matchUrlParams, setMatch] = useState(false);\r\n\r\n\tconst setParams = (urlParams = '') => {\r\n\t\tsetUrlParams(urlParams);\r\n\t\tsetIsLoading(true);\r\n\t};\r\n\r\n\tuseEffect(() =>{\r\n\t\tif( !isLoading ) return;\r\n\r\n\t\tconst params = qs.parse(urlParams);\r\n\r\n\t\tif (!params) return;\r\n\r\n\t\tsetVkUserId(params.vk_user_id);\r\n\r\n\t\tconst ordered = {};\r\n\t\tObject.keys(params).sort().forEach((key) => {\r\n\t\t\tif (key.slice(0, 3) === 'vk_') {\r\n\t\t\t\tordered[key] = params[key];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst stringParams = qs.stringify(ordered);\r\n\t\tconst paramsHash = crypto\r\n\t\t\t.createHmac('sha256', process.env.REACT_APP_VK)\r\n\t\t\t.update(stringParams)\r\n\t\t\t.digest()\r\n\t\t\t.toString('base64')\r\n\t\t\t.replace(/\\+/g, '-')\r\n\t\t\t.replace(/\\//g, '_')\r\n\t\t\t.replace(/=$/, '');\r\n\r\n\t\tsetMatch(paramsHash === params.sign);\r\n\t}, [isLoading, urlParams]);\r\n\r\n\treturn [{vkUserId, matchUrlParams}, setParams];\r\n}","import React, { createContext, useState } from 'react';\r\n\r\nexport const CurrentUserContext = createContext([{}, p => {}]);\r\n\r\nexport const CurrentUserProvider = ({ children }) => {\r\n\tconst [state, setState] = useState({\r\n\t\tisLoading: false,\r\n\t\tisLoggedIn: null,\r\n\t\tcurrentUser: null\r\n\t});\r\n\treturn (\r\n\t\t<CurrentUserContext.Provider value={[state, setState]}>\r\n\t\t\t{children}\r\n\t\t</CurrentUserContext.Provider>\r\n\t)\r\n};\r\n","import React, {Fragment, useState, useEffect, useContext} from 'react';\r\nimport {Div, FormLayout, FormLayoutGroup, Input, Placeholder, FormStatus} from \"@vkontakte/vkui\";\r\nimport PanelHeader from \"@vkontakte/vkui/dist/components/PanelHeader/PanelHeader\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Icon56LockOutline from '@vkontakte/icons/dist/56/lock_outline';\r\nimport Icon56UserAddOutline from '@vkontakte/icons/dist/56/user_add_outline';\r\nimport useApi from \"../hooks/useApi\";\r\nimport {AppSignContext} from \"../contexts/appSign\";\r\nimport {CurrentUserContext} from \"../contexts/currentUser\";\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nconst Authorization = ({go, goView, type}) => {\r\n\tconst [password, setPassword] = useState('');\r\n\tconst [confirmPassword, setConfirmPassword] = useState('');\r\n\tconst [formError, setFormError] = useState(null);\r\n\tconst [{response, error}, doApiFetch] = useApi(`/users/${type}`);\r\n\tconst [{vkUserId}] = useContext(AppSignContext);\r\n\tconst [startFetchData, setStartFetchData] = useState(false);\r\n\tconst [currentUserState, setCurrentUserState] = useContext(CurrentUserContext);\r\n\tconst [, setToken] = useLocalStorage('token');\r\n\tconst [,dispatch] = useContext(RouterContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!currentUserState.isLoggedIn) return;\r\n\t\tconst {name, phone, email, password} = currentUserState.currentUser;\r\n\t\tif (!name || !phone || !email || !password) {\r\n\t\t\tdispatch({type: 'SET_VIEW', payload: { view: 'registration', panel: 'finish'}});\r\n\t\t} else {\r\n\t\t\tdispatch({type: 'SET_VIEW', payload: { view: 'balance', panel: 'home'}})\r\n\t\t}\r\n\t},[currentUserState, dispatch]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (type === 'login') return;\r\n\r\n\t\tif ((password.length !== confirmPassword.length)) {\r\n\t\t\tsetFormError(null);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (password !== confirmPassword) {\r\n\t\t\tsetFormError({status: 'Ошибка валидации', message: 'Пароли не совпадают. Проверьте ввод и повторите попытку.'});\r\n\t\t}\r\n\t}, [password, confirmPassword, type]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (!startFetchData) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'POST',\r\n\t\t\tuser: {\r\n\t\t\t\tid: +vkUserId,\r\n\t\t\t\tpassword: password\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdoApiFetch(body);\r\n\t\tsetStartFetchData(false);\r\n\t},[startFetchData, doApiFetch, password, vkUserId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\r\n\t\tif (!response.user && response.error) {\r\n\t\t\tsetFormError(response.error);\r\n\t\t} else {\r\n\t\t\tsetToken(response.user.token);\r\n\t\t}\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!response.user,\r\n\t\t\tcurrentUser: response.user || null\r\n\t\t}));\r\n\r\n\t}, [response, setCurrentUserState, go, goView, setToken]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!error) return;\r\n\t\tsetFormError(error);\r\n\t}, [error]);\r\n\r\n\tconst onChange = (e) => {\r\n\t\te.target.value = Math.max(0, parseInt(e.target.value) ).toString().slice(0,4);\r\n\t\tif (e.target.name === 'password') {\r\n\t\t\tsetPassword(e.target.value);\r\n\t\t} else {\r\n\t\t\tsetConfirmPassword(e.target.value);\r\n\t\t}\r\n\t};\r\n\r\n\tconst formStatus = () => {\r\n\t\tif (!formError) return null;\r\n\t\treturn (\r\n\t\t\t<FormStatus header={formError.status} mode=\"error\">\r\n\t\t\t\t{formError.message}\r\n\t\t\t</FormStatus>\r\n\t\t)\r\n\t};\r\n\r\n\tconst formButtonClick = async () => {\r\n\t\tsetStartFetchData(true);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>{type === 'login' ? 'Авторизация' : 'Регистрация'}</PanelHeader>\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={type === 'login' ? <Icon56LockOutline /> : <Icon56UserAddOutline />}\r\n\t\t\t\theader={type === 'login' ? 'Введите пароль' : 'Придумайте пароль'}\r\n\t\t\t>\r\n\t\t\t\t<FormLayout>\r\n\t\t\t\t\t{formStatus()}\r\n\t\t\t\t\t<FormLayoutGroup top={'Введите пароль'}>\r\n\t\t\t\t\t\t<Input name={'password'} type={'number'} onChange = {onChange} align=\"center\" value={password}/>\r\n\t\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype !== 'login'\r\n\t\t\t\t\t\t\t?\r\n\t\t\t\t\t\t\t<FormLayoutGroup top={'Повторите пароль'}>\r\n\t\t\t\t\t\t\t\t<Input type={'number'} name={'confirmPassword'} onChange = {onChange} align=\"center\" value={confirmPassword}/>\r\n\t\t\t\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<Button size=\"l\" onClick={formButtonClick}>{type === 'login' ? 'Авторизация' : 'Регистрация'}</Button>\r\n\t\t\t\t</FormLayout>\r\n\t\t\t</Placeholder>\r\n\t\t\t<Div>\r\n\t\t\t\t<Button\r\n\t\t\t\t\tstretched\r\n\t\t\t\t\tmode=\"tertiary\"\r\n\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\tdispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.to}});\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tdata-to={type === 'login' ? 'register' : 'login'}\r\n\t\t\t\t>{type === 'login' ? 'Регистрация' : 'Авторизация'}</Button>\r\n\t\t\t</Div>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Authorization;\r\n","import React, {useState, useEffect, Fragment, useContext} from 'react';\r\nimport {\r\n\tFormLayout,\r\n\tIOS,\r\n\tPanelHeader,\r\n\tplatform,\r\n\tPanelHeaderButton, Button, Input, FormLayoutGroup, FormStatus, Snackbar,\r\n\tDiv\r\n} from '@vkontakte/vkui';\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\nimport useApi from \"../hooks/useApi\";\r\nimport {CurrentUserContext} from \"../contexts/currentUser\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport Avatar from \"@vkontakte/vkui/dist/components/Avatar/Avatar\";\r\nimport Icon16Done from '@vkontakte/icons/dist/16/done';\r\n\r\nconst Profile = () =>{\r\n\tconst [email, setEmail] = useState('');\r\n\tconst [phone, setPhone] = useState('');\r\n\tconst [name, setName] = useState('');\r\n\tconst [kktPassword, setKktPassword] = useState('');\r\n\tconst [fetchToFns, setFetchToFns] = useState(false);\r\n\tconst [canBack, setCanBack] = useState(true);\r\n\tconst [snackbar, setSnackbar] = useState(null);\r\n\tconst [fnsPasswordType, setFnsPasswordType] = useState('');\r\n\tconst [{response}, doApiFetch] = useApi(`/users/profile`);\r\n\tconst [fnsResponse, doFnsFetch] = useApi(`/fns/password`);\r\n\tconst [startFetchData, setStartFetchData] = useState(false);\r\n\tconst [currentUserState, setCurrentUserState] = useContext(CurrentUserContext);\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tconst osName = platform();\r\n\r\n\tuseEffect(()=>{\r\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'VKWebAppGetPersonalCardResult':\r\n\t\t\t\t\tsetEmail(data.email);\r\n\t\t\t\t\tsetPhone(data.phone);\r\n\t\t\t\t\tconsole.log('profile', data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'VKWebAppGetPersonalCardFailed':\r\n\t\t\t\t\tconsole.log('profile error', data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst { email, name, phone, password } = currentUserState.currentUser;\r\n\t\tsetEmail(email || '');\r\n\t\tsetName(name || '');\r\n\t\tsetPhone(phone || '');\r\n\t\tsetKktPassword(password || '');\r\n\t\tsetCanBack(!!email && !!name && !!phone && !!password);\r\n\t}, [currentUserState]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (!startFetchData) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'PUT',\r\n\t\t\tupdate: {\r\n\t\t\t\temail,\r\n\t\t\t\tphone,\r\n\t\t\t\tname,\r\n\t\t\t\tkktPassword\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdoApiFetch(body);\r\n\t\tsetStartFetchData(false);\r\n\t},[startFetchData, doApiFetch, email, phone, name, kktPassword]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!fetchToFns) return;\r\n\t\tlet body = {};\r\n\r\n\t\tif (fnsPasswordType !== 'restore') {\r\n\t\t\tbody.name = name;\r\n\t\t\tbody.email = email;\r\n\t\t}\r\n\r\n\t\tbody.params = {\r\n\t\t\ttype: fnsPasswordType\r\n\t\t};\r\n\r\n\t\tbody.phone = phone.replace(/[ ()-]/g, '');\r\n\t\tbody.phone = body.phone.replace(/^[8]/g, '+7');\r\n\t\tbody.method = 'POST';\r\n\r\n\t\tdoFnsFetch(body);\r\n\t\tsetFetchToFns(false);\r\n\t}, [fetchToFns, fnsPasswordType, doFnsFetch, name, email, phone]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tconst { user } = response;\r\n\t\tif (!user.name || !user.phone || !user.email || !user.password) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!response.user,\r\n\t\t\tcurrentUser: response.user || null\r\n\t\t}));\r\n\t\tdispatch({type: 'SET_VIEW', payload: { view: 'balance', panel: 'home'}});\r\n\t}, [response, dispatch, setCurrentUserState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!fnsResponse.response) return;\r\n\t\tsetSnackbar(\r\n\t\t\t<Snackbar\r\n\t\t\t\tlayout=\"vertical\"\r\n\t\t\t\tonClose={() => setSnackbar(null)}\r\n\t\t\t\tbefore={<Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon16Done fill=\"#fff\" width={14} height={14} /></Avatar>}\r\n\t\t\t>\r\n\t\t\t\t{fnsResponse.response.message}\r\n\t\t\t</Snackbar>\r\n\t\t)\r\n\t}, [fnsResponse.response]);\r\n\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={canBack && <PanelHeaderButton onClick={() => {\r\n\t\t\t\t\tdispatch({type: 'SET_VIEW', payload: {view: 'balance', panel: 'home'}})\r\n\t\t\t\t}}>\r\n\t\t\t\t\t{osName === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}\r\n\t\t\t\t</PanelHeaderButton>}\r\n\t\t\t>\r\n\t\t\t\t{canBack ? 'Профиль' : 'Регистрация'}\r\n\t\t\t</PanelHeader>\r\n\t\t\t<FormLayout>\r\n\t\t\t\t{\r\n\t\t\t\t\t!canBack && <FormStatus header=\"Разъяснение\" mode=\"default\">\r\n\t\t\t\t\t\tПриложение позволяет считывать данные по чекам.\r\n\t\t\t\t\t\tНи какие данные о ваших покупках не передаются в налоговую.\r\n\t\t\t\t\t</FormStatus>\r\n\t\t\t\t}\r\n\t\t\t\t<Input\r\n\t\t\t\t\ttype={'text'}\r\n\t\t\t\t\ttop={'Имя'}\r\n\t\t\t\t\tname={'name'}\r\n\t\t\t\t\tvalue={name}\r\n\t\t\t\t\tonChange={(e) => {setName(e.target.value)}}\r\n\t\t\t\t/>\r\n\t\t\t\t<FormLayoutGroup top=\"E-mail и Телефон\" bottom=\"Эти данные можно получить через персональные карточки Вконтакте. Они нужны для того, чтобы получить пароль от ФНС для расшифровки чеков.\">\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'email'}\r\n\t\t\t\t\t\ttop={'e-mail'}\r\n\t\t\t\t\t\tname={'email'}\r\n\t\t\t\t\t\tplaceholder={'Введите e-mail'}\r\n\t\t\t\t\t\tvalue={email}\r\n\t\t\t\t\t\tonChange={(e) => {setEmail(e.target.value)}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'phone'}\r\n\t\t\t\t\t\ttop={'Телефон'}\r\n\t\t\t\t\t\tname={'phone'}\r\n\t\t\t\t\t\tvalue={phone}\r\n\t\t\t\t\t\tplaceholder={'Введите телефон'}\r\n\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\te.target.value.replace(/^[8]/, '+7');\r\n\t\t\t\t\t\t\tsetPhone(e.target.value);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Button size=\"xl\" onClick={() => {\r\n\t\t\t\t\t\tbridge.send(\"VKWebAppGetPersonalCard\", {\"type\": [\"phone\", \"email\"]});\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t\tПолучить данные из VK\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t<FormLayoutGroup top={'Пароль от ФНС'} bottom={'Если не хотите получать пароль по каким то причинам, введите 0 в поле ввода пароля'}>\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'number'}\r\n\t\t\t\t\t\ttop={'Пароль от ФНС'}\r\n\t\t\t\t\t\tplaceholder={'Введите пароль ФНС'}\r\n\t\t\t\t\t\tname={'kktPassword'}\r\n\t\t\t\t\t\tvalue={kktPassword}\r\n\t\t\t\t\t\tonChange={(e) => {setKktPassword(e.target.value)}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Div  style={{display: 'flex', justifyContent:'space-between'}}>\r\n\t\t\t\t\t\t<Button size='l' data-type={'signup'} onClick={(e) => {\r\n\t\t\t\t\t\t\tsetFnsPasswordType(e.currentTarget.dataset.type);\r\n\t\t\t\t\t\t\tsetFetchToFns(true);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tstyle={{margin: '0px', width: '49%'}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tПолучить пароль\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t<Button size='l' data-type={'restore'} onClick={(e) => {\r\n\t\t\t\t\t\t\tsetFnsPasswordType(e.currentTarget.dataset.type);\r\n\t\t\t\t\t\t\tsetFetchToFns(true);\r\n\t\t\t\t\t\t}} style={{margin: '0px', width: '49%'}}\t>\r\n\t\t\t\t\t\t\tВосстановить пароль\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</Div>\r\n\t\t\t\t</FormLayoutGroup>\r\n\r\n\t\t\t\t<Button size=\"xl\" mode=\"commerce\" onClick={() => {\r\n\t\t\t\t\tsetStartFetchData(true);\r\n\t\t\t\t}}>\r\n\t\t\t\t\t{canBack ? 'Обновить профиль' : 'Завершить регистрацию'}\r\n\t\t\t\t</Button>\r\n\t\t\t</FormLayout>\r\n\t\t\t{snackbar}\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Profile;\r\n","export default class Prepare {\r\n\t/**\r\n\t * Преобразование qr кода\r\n\t * @param str\r\n\t * @returns {{dt: *, fn: *, i: *, sum: *, fp: *}}\r\n\t */\r\n\tstatic qr (str){\r\n\t\ttry {\r\n\t\t\tlet dt, sum, fn, i, fp;\r\n\r\n\t\t\tif (str) {\r\n\t\t\t\t[, dt, sum, fn, i, fp] = str.match(/t=(\\w{8}T\\w+)&s=(\\w+\\.*\\w+)&fn=(\\w+)&i=(\\w+)&fp=(\\w+)/);\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdt,\r\n\t\t\t\tsum: sum.replace(/[.]/g, ''),\r\n\t\t\t\tfn,\r\n\t\t\t\ti,\r\n\t\t\t\tfp\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log(e);\r\n\t\t\treturn {\r\n\t\t\t\terror: {\r\n\t\t\t\t\tmessage: 'Ошибка чтения QR кода'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Преобразование даты\r\n\t * @param str\r\n\t * @returns {string}\r\n\t */\r\n\tstatic date(str) {\r\n\t\tconst dt = new Date(str);\r\n\t\tlet monthName;\r\n\t\tswitch (dt.getMonth() + 1) {\r\n\t\t\tcase 1:\r\n\t\t\t\tmonthName = 'января';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tmonthName = 'февраля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tmonthName = 'марта';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tmonthName = 'апреля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tmonthName = 'мая';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tmonthName = 'июня';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7:\r\n\t\t\t\tmonthName = 'июля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8:\r\n\t\t\t\tmonthName = 'августа';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 9:\r\n\t\t\t\tmonthName = 'сентября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 10:\r\n\t\t\t\tmonthName = 'октября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 11:\r\n\t\t\t\tmonthName = 'ноября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 12:\r\n\t\t\t\tmonthName = 'декабря';\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn `${dt.getDate()} ${monthName} ${dt.getFullYear()}`;\r\n\t}\r\n\r\n\t/**\r\n\t * Преобразование суммы\r\n\t * @param n\r\n\t * @returns {string}\r\n\t */\r\n\tstatic sum(n) {\r\n\t\treturn new Intl.NumberFormat('ru-RU', {style: 'currency', currency: 'RUB'}).format(n / 100);\r\n\t}\r\n\r\n\t/**\r\n\t * Расчет общей суммы\r\n\t * @param arr\r\n\t * @returns {number}\r\n\t */\r\n\tstatic totalReceiptSum(arr) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\treturn arr.map((item) => {\r\n\t\t\treturn item.sum || item.totalSum;\r\n\t\t}).reduce(reducer);\r\n\t}\r\n\r\n\tstatic totalSumWithParams(arr) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\treturn arr.map((item) => {\r\n\t\t\tconst {income, sum} = item;\r\n\t\t\tif (income) return sum;\r\n\t\t\treturn -1*sum;\r\n\t\t}).reduce(reducer);\r\n\t}\r\n\r\n\t/**\r\n\t * Подсчет суммарных доходов / расходов\r\n\t * @param arr\r\n\t * @param income\r\n\t * @returns {number}\r\n\t */\r\n\tstatic totalSum(arr, income) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\tconst ts = arr.map(items => {\r\n\t\t\treturn items.items.map(item => {\r\n\t\t\t\tif (income) {\r\n\t\t\t\t\treturn item.income ? item.sum : 0\r\n\t\t\t\t}\r\n\t\t\t\treturn !item.income ? item.sum : 0\r\n\t\t\t}).reduce(reducer)\r\n\t\t}).reduce(reducer);\r\n\t\treturn income ? ts : -1 * ts;\r\n\t}\r\n}","import React from 'react';\r\nimport prepare from \"../handlers/prepare\";\r\n\r\nconst ColoredSum = ({sum, fs}) => {\r\n\tconst stl = sum >= 0 ? {color: '#28a745', fontSize: fs} : {color: '#dc3545', fontSize: fs};\r\n\treturn(\r\n\t\t<span style={stl}>{prepare.sum(sum)}</span>\r\n\t)\r\n};\r\n\r\nexport default ColoredSum;\r\n","import React, { useState, useEffect } from 'react';\r\nimport {format, addMonths, subMonths} from 'date-fns';\r\nimport { ru } from 'date-fns/locale'\r\nimport {Group, List, Cell, Button} from \"@vkontakte/vkui\";\r\nimport Icon24BrowserBack from '@vkontakte/icons/dist/24/browser_back';\r\nimport Icon24BrowserForward from '@vkontakte/icons/dist/24/browser_forward';\r\n\r\nconst Calendar = ({setDateFromCalendar}) => {\r\n  const [currentDate, setCurrentDate] = useState(new Date());\r\n  const dateFormat = 'LLLL yyyy';\r\n\r\n  useEffect(() => {\r\n    setDateFromCalendar(currentDate);\r\n  }, [currentDate, setDateFromCalendar]);\r\n\r\n  const nextMonth = () => {\r\n    setCurrentDate(addMonths(currentDate, 1));\r\n  };\r\n\r\n  const prevMonth = () => {\r\n    setCurrentDate(subMonths(currentDate, 1));\r\n  };\r\n\r\n  return(\r\n    <Group>\r\n      <List>\r\n        <Cell\r\n          before={<Button onClick={prevMonth} mode={'secondary'}><Icon24BrowserBack /></Button>}\r\n          asideContent={<Button onClick={nextMonth} mode={'secondary'}><Icon24BrowserForward /></Button>}\r\n          style={{textAlign: 'center', fontWeight: 'bold'}}\r\n        >\r\n          {format(currentDate, dateFormat, {locale: ru}).toLocaleUpperCase()}\r\n        </Cell>\r\n      </List>\r\n    </Group>\r\n  )\r\n};\r\n\r\nexport default Calendar;","import Receipt from \"./receipt\";\r\n\r\nexport default Receipt;\r\n","import React, {Fragment} from 'react';\r\nimport {Separator} from \"@vkontakte/vkui\";\r\nimport prepare from \"../../handlers/prepare\";\r\nimport ColoredSum from \"../ColoredSum\";\r\n\r\nimport './receipt.css';\r\nimport FormLayout from \"@vkontakte/vkui/dist/components/FormLayout/FormLayout\";\r\n\r\nconst Receipt = ({items, id, isSearch=false}) => {\r\n\tconst setDefinition = (item) => {\r\n\t\tif (!item || !item.definition) return null;\r\n\t\tconst {definition} = item.definition;\r\n\t\treturn definition;\r\n\t}\r\n\tconst receiptItem = (items.map((item, index) => {\r\n\t\tconst sum = item.income ? item.sum : (-1) * item.sum ;\r\n\r\n\t\tconst definition = setDefinition(item);// = item && item.definition.definition ? item.definition.definition : null;\r\n\r\n\r\n\t\treturn(\r\n\t\t\t<Fragment key={index}>\r\n\t\t\t\t<div className={'receipt-item'} >\r\n\t\t\t\t\t<span className={'receipt-item-name'}>{definition ? definition : item.name}</span>\r\n\t\t\t\t\t{item.price && !isSearch ? <span className={'receipt-item-price'}>{prepare.sum(item.price)}</span> : null}\r\n\t\t\t\t\t{item.quantity && !isSearch ? <span className={'receipt-item-quantity'}>{item.quantity}</span> : null}\r\n\t\t\t\t\t{item.dateTime && isSearch ? <span className={'receipt-item-dateTime'}>{prepare.date(item.dateTime)}</span> : null}\r\n\t\t\t\t\t{sum ? <span className={'receipt-item-sum'}>{<ColoredSum sum={sum}/>}</span> : null}\r\n\t\t\t\t</div>\r\n\t\t\t</Fragment>\r\n\t\t)\r\n\t}));\r\n\r\n\treturn(\r\n\t\t<FormLayout id={id} className={'receipt-item-wrapper'}>\r\n\t\t\t<div className={'receipt-item'}>\r\n\t\t\t\t<span className={'receipt-item-name'}>Наименование</span>\r\n\t\t\t\t{!isSearch ?\r\n\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t<span  className={'receipt-item-price'}>Цена</span>\r\n\t\t\t\t\t\t<span  className={'receipt-item-quantity'}>Кол-во</span>\r\n\t\t\t\t\t</Fragment> :\r\n\t\t\t\t\t<span className={'receipt-item-dateTime'}>Дата</span>\r\n\t\t\t\t}\r\n\t\t\t\t<span className={'receipt-item-sum'}>Сумма</span>\r\n\t\t\t</div>\r\n\t\t\t<Separator />\r\n\t\t\t{receiptItem}\r\n\t\t\t<Separator />\r\n\t\t\t<div className={'receipt-total'}>\r\n\t\t\t\t<span className={''}>Итого:</span>\r\n\t\t\t\t<span><ColoredSum sum={prepare.totalSumWithParams(items)}/></span>\r\n\t\t\t</div>\r\n\t\t</FormLayout>\r\n\t)\r\n};\r\n\r\nexport default Receipt;","import SearchComponent from \"./SearchComponent\";\r\n\r\nexport default SearchComponent;\r\n","import React, {Fragment, useState, useEffect} from 'react';\r\nimport {Search} from \"@vkontakte/vkui\";\r\nimport Receipt from \"../Receipt\";\r\nimport Group from \"@vkontakte/vkui/dist/components/Group/Group\";\r\n\r\nconst SearchComponent = ({ receipts }) => {\r\n  const [search, setSearch] = useState('');\r\n  const [searchTarget, setSearchTarget] = useState([]);\r\n  const [searchResult, setSearchResult] = useState([]);\r\n\r\n  const onSearchChange = (e) => {\r\n    setSearch(e.target.value.toLowerCase());\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!receipts) return;\r\n    let arr = [];\r\n    const tmp = receipts.map((receipt) => {\r\n      let dateTime = receipt.dateTime;\r\n      return receipt.items.map((item) => {\r\n        item.dateTime = dateTime;\r\n        return item;\r\n      });\r\n    });\r\n    tmp.forEach((item) => {\r\n      arr.push(...item);\r\n    });\r\n    setSearchTarget(arr);\r\n  }, [receipts]);\r\n\r\n  useEffect(() => {\r\n    if (!search) {\r\n      setSearchResult([]);\r\n      return;\r\n    }\r\n    setSearchResult(searchTarget.filter(({name}) => name.toLowerCase().indexOf(search) > -1));\r\n  }, [search, searchTarget]);\r\n\r\n  return (\r\n    <Fragment>\r\n      <Search value={search} onChange={onSearchChange}/>\r\n      <Group title='Поиск'>\r\n        {\r\n          searchResult.length > 0 && <Receipt id={searchResult._id} isSearch={true} items={searchResult}/>\r\n        }\r\n      </Group>\r\n    </Fragment>\r\n  )\r\n};\r\n\r\nexport default SearchComponent;\r\n","import React, {useState, useEffect, Fragment, useContext, useCallback} from 'react';\r\nimport useApi from \"../hooks/useApi\";\r\nimport {List, PanelHeaderContent, Placeholder, PullToRefresh, Separator, Counter} from \"@vkontakte/vkui\";\r\nimport ColoredSum from \"../components/ColoredSum\";\r\nimport prepare from \"../handlers/prepare\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Group from \"@vkontakte/vkui/dist/components/Group/Group\";\r\nimport Cell from \"@vkontakte/vkui/dist/components/Cell/Cell\";\r\nimport Icon56GoodsCollection from '@vkontakte/icons/dist/56/goods_collection';\r\nimport Icon16Up from '@vkontakte/icons/dist/16/up';\r\nimport Icon16Down from '@vkontakte/icons/dist/16/down';\r\n\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport Calendar from \"../components/Calendar\";\r\nimport {format} from 'date-fns';\r\nimport SearchComponent from \"../components/search\";\r\nimport PanelHeader from \"@vkontakte/vkui/dist/components/PanelHeader/PanelHeader\";\r\n\r\nconst Balance = ({setReceiptFromBalance, onClickActiveModal}) => {\r\n\tconst viewTitle = 'Баланс';\r\n\tconst [initialFetch, setInitialFetch] = useState(true);\r\n\tconst [currentDate, setCurrentDate] = useState(new Date());\r\n\tconst [receipts, setReceipts] = useState([]);\r\n\tconst [fetching, setFetching] = useState(false);\r\n\tconst [{response}, doApiFetch] = useApi('/day');\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tconst dateFormat = 'yyyy-MM-dd';\r\n\r\n\tconst setDateFromCalendar = useCallback((date) => {\r\n\t\tsetCurrentDate(date);\r\n\t\tsetInitialFetch(true);\r\n\t}, []);\r\n\r\n\tconst onRefresh = () => {\r\n\t\tsetFetching(true);\r\n\t\tsetInitialFetch(true);\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!initialFetch) return;\r\n\t\tdoApiFetch({\r\n\t\t\tparams: {\r\n\t\t\t\tdate: format(currentDate, dateFormat)\r\n\t\t\t}\r\n\t\t});\r\n\t\tsetInitialFetch(false);\r\n\t\tsetFetching(false);\r\n\t}, [initialFetch, setInitialFetch, doApiFetch, currentDate]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tsetReceipts(response);\r\n\t}, [response, setReceiptFromBalance]);\r\n\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\t<PanelHeaderContent\r\n\t\t\t\t\taside={<Counter size={'s'} mode={'primary'}>{process.env.REACT_APP_VERSION}</Counter>}\r\n\t\t\t\t\t//aside={<Icon16Dropdown style={{ transform: `rotate(${contextOpened ? '180deg' : '0'})` }} />}\r\n\t\t\t\t\t// onClick={toggleContext}\r\n\t\t\t\t>\r\n\t\t\t\t\t{viewTitle}\r\n\t\t\t\t</PanelHeaderContent>\r\n\t\t\t</PanelHeader>\r\n\t\t\t{/*<MainMenu title={viewTitle} />*/}\r\n\t\t\t<SearchComponent receipts={receipts} />\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={<Icon56GoodsCollection />}\r\n\t\t\t\theader={<ColoredSum sum={prepare.totalReceiptSum(receipts)} fs={'2em'}/>}\r\n\t\t\t\taction={<Button size=\"l\" onClick={(e)=>{\r\n\t\t\t\t\tdispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.to}});\r\n\t\t\t\t}} data-to={'add'}>Добавить доход / расход</Button>}\r\n\t\t\t>\r\n\t\t\t\tДобавляйте доходы/расходы\r\n\t\t\t</Placeholder>\r\n\t\t\t<Separator/>\r\n\t\t\t<div style={{\r\n\t\t\t\tdisplay: 'flex',\r\n\t\t\t\tflexDirection: 'row',\r\n\t\t\t\tjustifyContent: 'space-between',\r\n\t\t\t\tpaddingTop: '1em',\r\n\t\t\t}}>\r\n\t\t\t\t<div style={{flex: '0 1 50%', display: 'flex',justifyContent: 'flex-end',}}>\r\n\t\t\t\t\t<div style={{display: 'flex', flexDirection: 'column', paddingRight: '10px'}}>\r\n\t\t\t\t\t\t<span style={{color: '#6F6F6F', fontSize: '0.7em', textAlign: 'end'}}>Доходы</span>\r\n\t\t\t\t\t\t<ColoredSum sum={prepare.totalSum(receipts, true)} fs={'1.4em'}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<Icon16Up width={16} height={40} fill={'#28a745'}/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style={{flex: '0 1 50%', display: 'flex',justifyContent: 'flex-start',}}>\r\n\t\t\t\t\t<Icon16Down width={16} height={40} fill={'#dc3545'}/>\r\n\t\t\t\t\t<div style={{display: 'flex', flexDirection: 'column', paddingLeft: '10px'}}>\r\n\t\t\t\t\t\t<span style={{color: '#6F6F6F', fontSize: '0.7em'}}>Расходы</span>\r\n\t\t\t\t\t\t<ColoredSum sum={prepare.totalSum(receipts, false)} fs={'1.4em'}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<PullToRefresh onRefresh={onRefresh} isFetching={fetching} >\r\n\t\t\t\t<Group title='Чеки'>\r\n\t\t\t\t\t<List>\r\n\t\t\t\t\t\t<Calendar setDateFromCalendar={setDateFromCalendar}/>\r\n\t\t\t\t\t\t{receipts.map((receipt, index) => {\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\texpandable\r\n\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\tonClickActiveModal('modal-page');\r\n\t\t\t\t\t\t\t\t\t\tsetReceiptFromBalance(receipt);\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\tdata-to={receipt._id}\r\n\t\t\t\t\t\t\t\t\tindicator={<ColoredSum sum={receipt.totalSum}/>}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{prepare.date(receipt.dateTime)}\r\n\t\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</List>\r\n\t\t\t\t</Group>\r\n\t\t\t</PullToRefresh>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Balance;\r\n","import React, {useState, useEffect, useContext} from 'react';\r\nimport Avatar from \"@vkontakte/vkui/dist/components/Avatar/Avatar\";\r\nimport {Snackbar} from \"@vkontakte/vkui\";\r\nimport Icon16Done from '@vkontakte/icons/dist/16/done';\r\nimport Icon28ErrorOutline from '@vkontakte/icons/dist/28/error_outline';\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nconst CustomSnackBar = ({message, isError, onClose}) => {\r\n\tconst [snackbar, setSnackbar] = useState(null);\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tuseEffect(() => {\r\n\t\tsetSnackbar(<Snackbar\r\n\t\t\tlayout=\"vertical\"\r\n\t\t\tonClose={onClose}\r\n\t\t\tbefore={\r\n\t\t\t\tisError\r\n\t\t\t\t\t? <Avatar size={24} style={{backgroundColor: 'var(--destructive)'}}><Icon28ErrorOutline fill=\"#fff\" width={18} height={18} /></Avatar>\r\n\t\t\t\t\t: <Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon16Done fill=\"#fff\" width={18} height={18} /></Avatar>\r\n\t\t\t}\r\n\t\t>\r\n\t\t\t{message}\r\n\t\t</Snackbar>)\r\n\t}, [setSnackbar, dispatch, isError, message, onClose]);\r\n\treturn(\r\n\t\tsnackbar\r\n\t)\r\n};\r\n\r\nexport default CustomSnackBar;\r\n","import React, {useState, useEffect, useContext, Fragment, useCallback} from 'react';\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\r\nimport FormLayout from \"@vkontakte/vkui/dist/components/FormLayout/FormLayout\";\r\nimport Input from \"@vkontakte/vkui/dist/components/Input/Input\";\r\nimport PanelHeaderButton from \"@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton\";\r\nimport {IOS, platform} from \"@vkontakte/vkui\";\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Checkbox from \"@vkontakte/vkui/dist/components/Checkbox/Checkbox\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Icon24Qr from '@vkontakte/icons/dist/24/qr';\r\nimport PanelHeaderContent from \"@vkontakte/vkui/dist/components/PanelHeaderContent/PanelHeaderContent\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport useApi from \"../hooks/useApi\";\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport prepare from \"../handlers/prepare\";\r\nimport CustomSnackBar from \"../components/CustomSnackbar\";\r\n\r\nconst AddDay = () => {\r\n  const SUCCESS_MESSAGE = 'Добавление прошло успешно';\r\n  const [name, setName] = useState('');\r\n  const [date, setDate] = useState(() => {\r\n    const date = new Date();\r\n    const m = date.getMonth()+1 > 9 ? date.getMonth()+1 : `0${date.getMonth()+1}`;\r\n    const d = date.getDate() > 9 ? date.getDate() : `0${date.getDate()}`;\r\n    return `${date.getFullYear()}-${m}-${d}`;\r\n  });\r\n  const [quantity, setQuantity] = useState(1);\r\n  const [price, setPrice] = useState('');\r\n  const [income, setIncome] = useState(false);\r\n  const [snackbar, setSnackbar] = useState(null);\r\n  const [qr, setQR] = useState(null);\r\n  const [routerContext, dispatch] = useContext(RouterContext);\r\n  const [{response, error}, doApiFetch] = useApi('/day');\r\n  const [receipts, doFnsFetch] = useApi('/day/receipt');\r\n  const [startFetchData, setStartFetchData] = useState(false);\r\n  const [checkReceipt, setCheckReceipt] = useState(false);\r\n  const osname = platform();\r\n\r\n  const onClose = useCallback(() => {\r\n    dispatch({ type: 'UNSET_ERROR'});\r\n    setSnackbar(null);\r\n  }, [dispatch]);\r\n\r\n  /***\r\n   * Подписываемся на события\r\n   */\r\n  useEffect(()=>{\r\n    bridge.subscribe(({ detail: { type, data }}) => {\r\n      switch (type) {\r\n        case 'VKWebAppOpenCodeReaderResult':\r\n          setQR(data.code_data);\r\n          break;\r\n        case 'VKWebAppOpenCodeReaderFailed':\r\n          console.log('add day error', data);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  /***\r\n   * Добавляем данные на сервер\r\n   */\r\n  useEffect(() => {\r\n    if (!startFetchData) return;\r\n    const body = {\r\n      method: 'POST',\r\n      date: date,\r\n      items: [\r\n        {\r\n          name,\r\n          quantity,\r\n          price: price * 100,\r\n          sum: price * 100 * quantity,\r\n          income,\r\n          modifiers: [],\r\n          properties: [],\r\n        }\r\n      ]\r\n    };\r\n    doApiFetch(body);\r\n\r\n    setName('');\r\n    setQuantity(1);\r\n    setIncome(false);\r\n    setPrice('');\r\n    setStartFetchData(false);\r\n  }, [startFetchData, setStartFetchData, date, doApiFetch, income, name, price, quantity]);\r\n\r\n  /**\r\n   * Выводим сообщение об успехе\r\n   */\r\n  useEffect(() => {\r\n    if (!response) return;\r\n    setSnackbar(<CustomSnackBar message={SUCCESS_MESSAGE} isError={false} onClose={onClose}/>)\r\n  }, [response, onClose]);\r\n\r\n  /**\r\n   * Добавление QR кода\r\n   */\r\n  useEffect(() => {\r\n    if (!qr) return;\r\n\r\n    const preparedQR = prepare.qr(qr);\r\n\r\n    if (preparedQR.error) {\r\n      const e = preparedQR.error;\r\n      dispatch({ type: 'SET_ERROR', payload: { error: e }});\r\n      setQR(null);\r\n      setCheckReceipt(false);\r\n      return;\r\n    }\r\n\r\n    // const action = checkReceipt ? 'receive' : 'check';\r\n\r\n    const body = {\r\n      method: 'POST',\r\n      ...preparedQR\r\n    }\r\n    doFnsFetch(body);\r\n  }, [qr, doFnsFetch, checkReceipt, dispatch]);\r\n\r\n  /**\r\n   * Костыль. Проверка есть ли тело в ответе от ФНС. Сохраняем чек на сервере\r\n   */\r\n  useEffect(() => {\r\n    if (!receipts.response) return;\r\n    // setCheckReceipt(receipts.response.check);\r\n    // if (receipts.response.statusCode === 202) {\r\n    //   const body = {\r\n    //     method: 'POST',\r\n    //     ...prepare.qr(qr),\r\n    //     params: {\r\n    //       action: 'receive'\r\n    //     }\r\n    //   }\r\n    //   doFnsFetch(body);\r\n    // }\r\n    if (receipts.response._id) {\r\n      setSnackbar(<CustomSnackBar message={SUCCESS_MESSAGE} isError={false} onClose={onClose}/>)\r\n      setCheckReceipt(false);\r\n      setQR(null);\r\n    }\r\n  }, [receipts.response, doFnsFetch, qr, onClose]);\r\n\r\n  /**\r\n   * Вывод сообщения об ощибке\r\n   */\r\n  useEffect(() => {\r\n    if (!routerContext.error) return;\r\n    dispatch({\r\n      type: 'SET_ERROR',\r\n      payload: {\r\n        error: receipts.error || error\r\n      }\r\n    })\r\n    setSnackbar(<CustomSnackBar message={routerContext.error.message} isError={true} onClose={onClose}/>);\r\n    setCheckReceipt(false);\r\n    setQR(null);\r\n\r\n  }, [receipts.error, error, dispatch, routerContext.error, onClose]);\r\n\r\n  return(\r\n    <Fragment>\r\n      <PanelHeader\r\n        left={\r\n          <PanelHeaderButton key={'back'} onClick={(e) => {\r\n            dispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.to}});\r\n          }} data-to={'home'}>{osname === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}</PanelHeaderButton>\r\n        }\r\n      >\r\n        <PanelHeaderContent\r\n          before={\r\n            bridge.supports('VKWebAppOpenCodeReader') &&\r\n            <PanelHeaderButton\r\n              key={'qr'}\r\n              data-to={'qr'}\r\n              onClick={() => {\r\n                dispatch({ type: 'UNSET_ERROR'});\r\n                bridge.send('VKWebAppOpenCodeReader', {});\r\n              }}\r\n            ><Icon24Qr /></PanelHeaderButton>\r\n          }\r\n        >\r\n          Добавление записи\r\n        </PanelHeaderContent>\r\n      </PanelHeader>\r\n      <FormLayout>\r\n        <Input\r\n          type={'date'}\r\n          top={'Дата'}\r\n          name={'date'}\r\n          value={date}\r\n          onChange={(e)=>{setDate(e.currentTarget.value)}}\r\n        />\r\n        <Input\r\n          type={'text'}\r\n          top={'Название'}\r\n          name={'name'}\r\n          value={name}\r\n          onChange={(e)=>{setName(e.currentTarget.value)}}\r\n        />\r\n        <Input\r\n          type={'number'}\r\n          top={'Количество'}\r\n          name={'quantity'}\r\n          value={quantity}\r\n          onChange={(e)=>{setQuantity(e.currentTarget.value)}}\r\n        />\r\n        <Input\r\n          type={'number'}\r\n          top={'Цена'}\r\n          name={'price'}\r\n          value={price}\r\n          onChange={(e)=>{setPrice(e.currentTarget.value)}}\r\n        />\r\n        <Checkbox\r\n          name={'income'}\r\n          checked={income}\r\n          onChange={(e)=>{setIncome(e.currentTarget.checked)}}\r\n        >Доход</Checkbox>\r\n\r\n        <Button\r\n          size=\"xl\"\r\n          disabled={!date || !name || !quantity || !price}\r\n          mode={income ? \"commerce\" : \"destructive\"}\r\n          onClick={() => {setStartFetchData(true)}}\r\n        >\r\n          Добавить {income ? \"доход\" : \"расход\"}\r\n        </Button>\r\n      </FormLayout>\r\n\r\n      {snackbar}\r\n    </Fragment>\r\n  )\r\n};\r\n\r\nexport default AddDay;","import React from 'react';\r\nimport {List} from \"@vkontakte/vkui\";\r\nimport Receipt from \"./Receipt\";\r\n\r\nconst Modal = ({receipt}) => {\r\n\treturn (\r\n\t\t<List>\r\n\t\t\t<Receipt id={receipt._id} dateTime={receipt.dateTime} items={receipt.items}/>\r\n\t\t</List>\r\n\t)\r\n};\r\n\r\nexport default Modal;","import React, {useState, useEffect, Fragment, useContext} from 'react';\r\nimport {\r\n  Button,\r\n  Div,\r\n  FormLayout,\r\n  FormLayoutGroup,\r\n  Input,\r\n  IOS,\r\n  PanelHeader,\r\n  PanelHeaderButton, platform,\r\n  Snackbar\r\n} from \"@vkontakte/vkui\";\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport useApi from \"../hooks/useApi\";\r\nimport Avatar from \"@vkontakte/vkui/dist/components/Avatar/Avatar\";\r\nimport {CurrentUserContext} from \"../contexts/currentUser\";\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport Icon16Done from '@vkontakte/icons/dist/16/done';\r\n\r\nconst Registration = () => {\r\n  const [email, setEmail] = useState('');\r\n  const [phone, setPhone] = useState('');\r\n  const [name, setName] = useState('');\r\n  const [kktPassword, setKktPassword] = useState('');\r\n  const [step, setStep] = useState(0);\r\n  const [fnsPasswordType, setFnsPasswordType] = useState('');\r\n  const [fetchToFns, setFetchToFns] = useState(false);\r\n  const [, dispatch] = useContext(RouterContext);\r\n  const [{response}, doApiFetch] = useApi(`/users/profile`);\r\n  const [fnsResponse, doFnsFetch] = useApi(`/fns/password`);\r\n  const [startFetchData, setStartFetchData] = useState(false);\r\n  const [, setCurrentUserState] = useContext(CurrentUserContext);\r\n  const [snackbar, setSnackbar] = useState(null);\r\n  const osName = platform();\r\n\r\n  useEffect(()=>{\r\n    bridge.subscribe(({ detail: { type, data }}) => {\r\n      switch (type) {\r\n        case 'VKWebAppGetPersonalCardResult':\r\n          setEmail(data.email);\r\n          setPhone(data.phone);\r\n          break;\r\n        case 'VKWebAppGetPersonalCardFailed':\r\n          console.log('profile error', data);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  useEffect(()=>{\r\n    if (!startFetchData) return;\r\n    const body = {\r\n      method: 'PUT',\r\n      update: {\r\n        email,\r\n        phone,\r\n        name,\r\n        kktPassword\r\n      }\r\n    };\r\n\r\n    doApiFetch(body);\r\n    setStartFetchData(false);\r\n  },[startFetchData, doApiFetch, email, phone, name, kktPassword]);\r\n\r\n  useEffect(() => {\r\n    if (!fetchToFns) return;\r\n    let body = {};\r\n\r\n    if (fnsPasswordType !== 'restore') {\r\n      body.name = name;\r\n      body.email = email;\r\n    }\r\n\r\n    body.params = {\r\n      type: fnsPasswordType\r\n    };\r\n\r\n    body.phone = phone.replace(/[ ()-]/g, '');\r\n    body.phone = body.phone.replace(/^[8]/g, '+7');\r\n    body.method = 'POST';\r\n\r\n    doFnsFetch(body);\r\n    setFetchToFns(false);\r\n  }, [fetchToFns, fnsPasswordType, doFnsFetch, name, email, phone]);\r\n\r\n  useEffect(() => {\r\n    if (!response) return;\r\n    const { user } = response;\r\n    if (!user.name || !user.phone || !user.email || !user.password) {\r\n      return;\r\n    }\r\n    setCurrentUserState(state => ({\r\n      ...state,\r\n      isLoading: false,\r\n      isLoggedIn: !!response.user,\r\n      currentUser: response.user || null\r\n    }));\r\n    dispatch({type: 'SET_VIEW', payload: { view: 'balance', panel: 'home'}});\r\n  }, [response, dispatch, setCurrentUserState]);\r\n\r\n  useEffect(() => {\r\n    if (!fnsResponse.response) return;\r\n    setSnackbar(\r\n      <Snackbar\r\n        layout=\"vertical\"\r\n        onClose={() => setSnackbar(null)}\r\n        before={<Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon16Done fill=\"#fff\" width={14} height={14} /></Avatar>}\r\n      >\r\n        {fnsResponse.response.message}\r\n      </Snackbar>\r\n    )\r\n  }, [fnsResponse.response]);\r\n\r\n  const registerMarkup = (step) => {\r\n    switch (step) {\r\n      case 0:\r\n        return (\r\n          <FormLayoutGroup top={'Введите своё имя'}>\r\n            <Input\r\n              type={'text'}\r\n              top={'Имя'}\r\n              name={'name'}\r\n              value={name}\r\n              onChange={(e) => {setName(e.target.value)}}\r\n            />\r\n            <Button\r\n              size=\"xl\"\r\n              mode=\"commerce\"\r\n              disabled={!name}\r\n              onClick={() => {\r\n                setStep(1);\r\n              }}\r\n            >\r\n              Продолжить\r\n            </Button>\r\n          </FormLayoutGroup>\r\n        );\r\n      case 1:\r\n        return (\r\n          <FormLayoutGroup top=\"E-mail и Телефон\" bottom=\"Эти данные можно получить через персональные карточки Вконтакте. Они нужны для того, чтобы получить пароль от ФНС для расшифровки чеков.\">\r\n            <Input\r\n              type={'email'}\r\n              top={'e-mail'}\r\n              name={'email'}\r\n              placeholder={'Введите e-mail'}\r\n              value={email}\r\n              onChange={(e) => {setEmail(e.target.value)}}\r\n            />\r\n            <Input\r\n              type={'phone'}\r\n              top={'Телефон'}\r\n              name={'phone'}\r\n              value={phone}\r\n              placeholder={'Введите телефон'}\r\n              onChange={(e) => {\r\n                e.target.value.replace(/^[8]/, '+7');\r\n                setPhone(e.target.value);\r\n              }}\r\n            />\r\n            <Button size=\"xl\" onClick={() => {\r\n              bridge.send(\"VKWebAppGetPersonalCard\", {\"type\": [\"phone\", \"email\"]});\r\n            }}>\r\n              Получить данные из VK\r\n            </Button>\r\n            <Button\r\n              size=\"xl\"\r\n              mode=\"commerce\"\r\n              disabled={!email || !phone}\r\n              onClick={() => {\r\n                setStep(2);\r\n              }}\r\n            >\r\n              Продолжить\r\n            </Button>\r\n          </FormLayoutGroup>\r\n        );\r\n      case 2:\r\n        return (\r\n          <FormLayoutGroup top={'Пароль от ФНС'} bottom={'Если Вы, по каким то причинам, не хотите получать пароль - введите 0 в поле ввода пароля'}>\r\n            <Input\r\n              type={'number'}\r\n              top={'Пароль от ФНС'}\r\n              placeholder={'Введите пароль ФНС'}\r\n              name={'kktPassword'}\r\n              value={kktPassword}\r\n              onChange={(e) => {setKktPassword(e.target.value)}}\r\n            />\r\n            <Div  style={{display: 'flex', justifyContent:'space-between'}}>\r\n              <Button size='l' data-type={'signup'} onClick={(e) => {\r\n                setFnsPasswordType(e.currentTarget.dataset.type);\r\n                setFetchToFns(true);\r\n              }}\r\n                      style={{margin: '0px', width: '49%'}}\r\n              >\r\n                Получить пароль\r\n              </Button>\r\n              <Button size='l' data-type={'restore'} onClick={(e) => {\r\n                setFnsPasswordType(e.currentTarget.dataset.type);\r\n                setFetchToFns(true);\r\n              }} style={{margin: '0px', width: '49%'}}\t>\r\n                Восстановить пароль\r\n              </Button>\r\n            </Div>\r\n            <Button\r\n              size=\"xl\"\r\n              mode=\"commerce\"\r\n              disabled={!email && !phone}\r\n              onClick={() => {\r\n                setStartFetchData(true);\r\n              }}\r\n            >\r\n              Завершить\r\n            </Button>\r\n          </FormLayoutGroup>\r\n        )\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Fragment>\r\n      <PanelHeader\r\n        left={<PanelHeaderButton onClick={() => {\r\n          dispatch({type: 'SET_VIEW', payload: {view: 'balance', panel: 'home'}})\r\n        }}>\r\n          {osName === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}\r\n        </PanelHeaderButton>}\r\n      >\r\n        Регистрация({step + 1}/3)\r\n      </PanelHeader>\r\n      <FormLayout>\r\n        {registerMarkup(step)}\r\n      </FormLayout>\r\n      {snackbar}\r\n    </Fragment>\r\n  )\r\n}\r\n\r\nexport default Registration;\r\n","import React, {Fragment} from 'react';\r\nimport {PanelHeader, Placeholder} from '@vkontakte/vkui';\r\n\r\nconst Analytics = () => {\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\tАналитика\r\n\t\t\t</PanelHeader>\r\n\t\t\t<Placeholder>\r\n\t\t\t\tРаздел находится в разработке\r\n\t\t\t</Placeholder>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Analytics;","import React, {Fragment, useContext} from 'react';\r\nimport {Group, PanelHeader, Header, SimpleCell} from '@vkontakte/vkui';\r\nimport Icon28ListOutline from '@vkontakte/icons/dist/28/list_outline';\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nconst More = () => {\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tconst onCellClick = (e) => {\r\n\t\tdispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.panel }});\r\n\t}\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\tДополнительно\r\n\t\t\t</PanelHeader>\r\n\t\t\t<Group>\r\n\t\t\t\t<Header mode={'secondary'}>Дополнительно</Header>\r\n\t\t\t\t<SimpleCell\r\n\t\t\t\t\tdata-panel={'catalog'}\r\n\t\t\t\t\texpandable\r\n\t\t\t\t\tbefore={<Icon28ListOutline />}\r\n\t\t\t\t\tonClick = {onCellClick}\r\n\t\t\t\t>\r\n\t\t\t\t\tСправочник\r\n\t\t\t\t</SimpleCell>\r\n\t\t\t</Group>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default More;","import React, {Fragment, useEffect, useState} from 'react';\r\nimport {\r\n\tPanelHeader,\r\n\tFixedLayout,\r\n\tGroup,\r\n\tRichCell,\r\n\tButton, Input, Separator\r\n} from '@vkontakte/vkui';\r\nimport useApi from \"../hooks/useApi\";\r\nimport Icon28EditOutline from '@vkontakte/icons/dist/28/edit_outline';\r\nimport Icon16Cancel from '@vkontakte/icons/dist/16/cancel';\r\n\r\nconst Catalog = () => {\r\n\tconst [updateStr, setUpdateStr] = useState('');\r\n\tconst [{response}, doApiFetch] = useApi(`/catalog${updateStr}`);\r\n\tconst [catalog, setCatalog] = useState([]);\r\n\tconst [initialFetch, setInitialFetch] = useState(true);\r\n\tconst [action] = useState('get');\r\n\tconst [editedElementId, setEditedElementId] = useState('');\r\n\tconst [catalogToSave, setCatalogToSave] = useState(new Set());\r\n\r\n\tconst fillSaveCatalog = (obj) => {\r\n\t\tconst set = new Set(catalogToSave);\r\n\t\tset.add(obj);\r\n\t\tsetCatalogToSave(set);\r\n\t}\r\n\r\n\tconst onClickToEditElement = (e) => {\r\n\t\tconst { id } = e.currentTarget.dataset;\r\n\t\tif (editedElementId === '') {\r\n\t\t\tsetEditedElementId(id);\r\n\t\t} else if (editedElementId !== id) {\r\n\t\t\tsetEditedElementId(id);\r\n\t\t}\r\n\t}\r\n\r\n\tconst editCatalogElement = (id, definition) => {\r\n\t\tconst index = catalog.findIndex((item) => {\r\n\t\t\treturn item._id === id;\r\n\t\t});\r\n\t\tif (definition) {\r\n\t\t\tconst cat = catalog;\r\n\t\t\tcat[index].definition = definition;\r\n\t\t\tsetCatalog(cat);\r\n\t\t\tfillSaveCatalog(cat[index]);\r\n\t\t}\r\n\t}\r\n\r\n\tconst catalogList = catalog.sort((a, b) => {\r\n\t\tconst defA = a.definition ? a.definition.toLowerCase() : '!Нет расшифровки' ;\r\n\t\tconst defB = b.definition ? b.definition.toLowerCase() : '!Нет расшифровки';\r\n\t\tif (defA > defB) return 1;\r\n\t\tif (defA < defB) return -1;\r\n\t\treturn 0;\r\n\t}).map((item, i) => {\r\n\t\treturn (\r\n\t\t\t<Fragment key={i}>\r\n\t\t\t\t<RichCell\r\n\t\t\t\t\tdata-id={item._id}\r\n\t\t\t\t\tmultiline\r\n\t\t\t\t\tcaption={item.name}\r\n\t\t\t\t\tafter={<Icon28EditOutline />}\r\n\t\t\t\t\tbottom={\r\n\t\t\t\t\t\teditedElementId === item._id\r\n\t\t\t\t\t\t&&\r\n\t\t\t\t\t\t<Input\r\n\t\t\t\t\t\t\tid={editedElementId}\r\n\t\t\t\t\t\t\ttype={'text'}\r\n\t\t\t\t\t\t\tdefaultValue={item.definition}\r\n\t\t\t\t\t\t\tplaceholder={'Введите расшифровку'}\r\n\t\t\t\t\t\t\tonChange={async (e) => {\r\n\t\t\t\t\t\t\t\tawait editCatalogElement(editedElementId, e.target.value);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\tonClickToEditElement(e);\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tactions={\r\n\t\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t\t<Button disabled style={{display: 'none'}}><Icon16Cancel /></Button>\r\n\t\t\t\t\t\t\t<Button disabled style={{display: 'none'}} mode={'secondary'}><Icon16Cancel /></Button>\r\n\t\t\t\t\t\t</Fragment>\r\n\t\t\t\t\t}>\r\n\t\t\t\t\t<b>{item.definition ? item.definition : 'Нет расшифровки'}</b>\r\n\t\t\t\t</RichCell>\r\n\t\t\t</Fragment>\r\n\t\t)\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\tif(!editedElementId) return;\r\n\t\tdocument.getElementById(editedElementId).focus();\r\n\t},[editedElementId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!initialFetch) return;\r\n\t\tdoApiFetch({\r\n\t\t\tparams: {\r\n\t\t\t\ta: action\r\n\t\t\t}\r\n\t\t});\r\n\t\tsetInitialFetch(false);\r\n\t}, [initialFetch, setInitialFetch, doApiFetch, action]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!updateStr) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'PUT',\r\n\t\t\tupdate: [...catalogToSave]\r\n\t\t}\r\n\t\tdoApiFetch(body);\r\n\t}, [updateStr, catalogToSave, doApiFetch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tsetCatalog(response);\r\n\t\tsetCatalogToSave(new Set());\r\n\t\tsetUpdateStr('');\r\n\t\tsetEditedElementId('');\r\n\t}, [response]);\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\tСправочник\r\n\t\t\t</PanelHeader>\r\n\t\t\t<Group style={{paddingBottom: 60}}>\r\n\t\t\t\t{catalogList}\r\n\t\t\t</Group>\r\n\r\n\t\t\t{[...catalogToSave].length !== 0 && <FixedLayout vertical=\"bottom\">\r\n\t\t\t\t<Separator wide/>\r\n\t\t\t\t<Button size={'xl'} onClick={() => {setUpdateStr('/update')}}>Сохранить изменения</Button>\r\n\t\t\t</FixedLayout>}\r\n\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Catalog;\r\n","import React, {useContext, useState, useEffect, useCallback} from 'react';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport {Panel, View, platform, ModalRoot, ModalPage, ModalPageHeader, IOS, Epic, Tabbar, TabbarItem} from \"@vkontakte/vkui\";\r\nimport Authorization from \"./panels/Authorization\";\r\nimport Profile from \"./panels/Profile\";\r\nimport {RouterContext} from \"./contexts/routerContext\";\r\nimport Balance from \"./panels/Balance\";\r\nimport AddDay from \"./panels/AddDay\";\r\nimport Modal from \"./components/Modal\";\r\nimport PanelHeaderButton from \"@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton\";\r\nimport prepare from \"./handlers/prepare\";\r\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\r\nimport Icon24Dismiss from '@vkontakte/icons/dist/24/dismiss';\r\nimport Registration from \"./panels/Registration\";\r\nimport {CurrentUserContext} from \"./contexts/currentUser\";\r\nimport Icon28MarketOutline from '@vkontakte/icons/dist/28/market_outline';\r\nimport Icon28GraphOutline from '@vkontakte/icons/dist/28/graph_outline';\r\nimport Icon28More from '@vkontakte/icons/dist/28/more';\r\nimport Icon28UserOutline from '@vkontakte/icons/dist/28/user_outline';\r\nimport Icon28AddSquareOutline from '@vkontakte/icons/dist/28/add_square_outline';\r\nimport Analytics from \"./panels/Analytics\";\r\nimport More from \"./panels/More\";\r\nimport Catalog from \"./panels/Catalog\";\r\n\r\nconst App = () => {\r\n\tconst [routerContext, dispatch] = useContext(RouterContext);\r\n\tconst [activeModal, setActiveModal] = useState(null);\r\n\tconst [modal, setModal] = useState(null);\r\n\tconst [receipt, setReceipt] = useState(null);\r\n\tconst [currentUserContext] = useContext(CurrentUserContext);\r\n\r\n\tconst modalBack = useCallback(() => {\r\n\t\tsetActiveModal(null);\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!receipt) return;\r\n\t\tconst osName = platform();\r\n\t\tsetModal(\r\n\t\t\t<ModalRoot activeModal={activeModal} onClose={modalBack}>\r\n\t\t\t\t<ModalPage\r\n\t\t\t\t\tid={'modal-page'}\r\n\t\t\t\t\tonClose={modalBack}\r\n\t\t\t\t\theader={\r\n\t\t\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\t\t\tleft={osName !== IOS && <PanelHeaderButton onClick={modalBack}><Icon24Cancel /></PanelHeaderButton>}\r\n\t\t\t\t\t\t\tright={osName === IOS && <PanelHeaderButton onClick={modalBack}>{osName === IOS ? 'Готово' : <Icon24Dismiss />}</PanelHeaderButton>}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{prepare.date(receipt.dateTime)}\r\n\t\t\t\t\t\t</ModalPageHeader>\r\n\t\t\t\t\t}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Modal onClose={modalBack} receipt={receipt}/>\r\n\t\t\t\t</ModalPage>\r\n\t\t\t</ModalRoot>\r\n\t\t);\r\n\t}, [receipt, activeModal, modalBack]);\r\n\r\n\tconst onStoryChange = (e) => {\r\n\t\tdispatch({type: 'SET_VIEW', payload: { view: e.currentTarget.dataset.story, panel: e.currentTarget.dataset.panel}});\r\n\t}\r\n\r\n\tconst tb = currentUserContext.currentUser && (<Tabbar>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={routerContext.view === 'balance' && routerContext.panel === 'balance.home'}\r\n\t\t\tdata-story=\"balance\"\r\n\t\t\tdata-panel={'home'}\r\n\t\t\ttext=\"Баланс\"\r\n\t\t><Icon28MarketOutline /></TabbarItem>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={routerContext.view === 'analytics'}\r\n\t\t\tdata-story=\"analytics\"\r\n\t\t\tdata-panel={'home'}\r\n\t\t\ttext=\"Аналитика\"\r\n\t\t><Icon28GraphOutline /></TabbarItem>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={routerContext.view === 'balance' && routerContext.panel === 'balance.add'}\r\n\t\t\tdata-story=\"balance\"\r\n\t\t\tdata-panel=\"add\"\r\n\t\t\ttext=\"Добавить\"\r\n\t\t><Icon28AddSquareOutline /></TabbarItem>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={routerContext.view === 'profile'}\r\n\t\t\tdata-story=\"profile\"\r\n\t\t\tdata-panel={'edit'}\r\n\t\t\ttext=\"Профиль\"\r\n\t\t><Icon28UserOutline /></TabbarItem>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={routerContext.view === 'more'}\r\n\t\t\tdata-story=\"more\"\r\n\t\t\tdata-panel={'more'}\r\n\t\t\ttext=\"Ещё\"\r\n\t\t><Icon28More /></TabbarItem>\r\n\t</Tabbar>)\r\n\r\n\treturn (\r\n\t\t<Epic activeStory={routerContext.view}\r\n\t\t\t\t\ttabbar={tb}\r\n\t\t>\r\n\t\t\t<View id={'authorization'} activePanel={routerContext.panel} popout={routerContext.popout}>\r\n\t\t\t\t<Panel id={'authorization.login'}>\r\n\t\t\t\t\t<Authorization type={'login'} />\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'authorization.register'}>\r\n\t\t\t\t\t<Authorization type={'register'} />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'profile'} activePanel={routerContext.panel} popout={routerContext.popout}>\r\n\t\t\t\t<Panel id={'profile.edit'}>\r\n\t\t\t\t\t<Profile />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'registration'} activePanel={routerContext.panel} popout={routerContext.popout}>\r\n\t\t\t\t<Panel id={'registration.finish'}>\r\n\t\t\t\t\t<Registration />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'balance'} activePanel={routerContext.panel} popout={routerContext.popout} modal={modal}>\r\n\t\t\t\t<Panel id={'balance.home'}>\r\n\t\t\t\t\t<Balance\r\n\t\t\t\t\t\tsetReceiptFromBalance={setReceipt}\r\n\t\t\t\t\t\tonClickActiveModal={setActiveModal}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'balance.add'}>\r\n\t\t\t\t\t<AddDay />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'analytics'} activePanel={routerContext.panel} popout={routerContext.popout}>\r\n\t\t\t\t<Panel id={'analytics.home'}>\r\n\t\t\t\t\t<Analytics />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'more'} activePanel={routerContext.panel} popout={routerContext.popout}>\r\n\t\t\t\t<Panel id={'more.more'}>\r\n\t\t\t\t\t<More />\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'more.catalog'}>\r\n\t\t\t\t\t<Catalog />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t</Epic>\r\n\t);\r\n};\r\n\r\nexport default App;\r\n","import { useEffect, useContext } from 'react';\r\nimport useApi from \"../hooks/useApi\";\r\nimport { CurrentUserContext } from '../contexts/currentUser';\r\nimport { AppSignContext } from \"../contexts/appSign\";\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\n\r\nconst CurrentUserChecker = ({ children }) => {\r\n\tconst [{response}, doFetch] = useApi('/users/profile');\r\n\tconst [, setCurrentUserState] = useContext(CurrentUserContext);\r\n\tconst [{vkUserId, matchUrlParams}] = useContext(AppSignContext);\r\n\tconst [token] = useLocalStorage('token');\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!token || !matchUrlParams) {\r\n\t\t\tsetCurrentUserState(state => ({\r\n\t\t\t\t...state,\r\n\t\t\t\tisLoggedIn: false\r\n\t\t\t}));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdoFetch();\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: true\r\n\t\t}))\r\n\t}, [doFetch, setCurrentUserState, token, matchUrlParams]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\r\n\t\tconst user = response.user.vk_id.toString() === vkUserId ? response.user : null;\r\n\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!user,\r\n\t\t\tcurrentUser: user\r\n\t\t}));\r\n\r\n\t}, [response, setCurrentUserState, vkUserId]);\r\n\treturn children;\r\n};\r\n\r\nexport default CurrentUserChecker;\r\n","import 'core-js/features/map';\r\nimport 'core-js/features/set';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport App from './App';\r\nimport {CurrentUserProvider} from \"./contexts/currentUser\";\r\nimport {AppSignProvider} from \"./contexts/appSign\";\r\nimport CurrentUserChecker from \"./components/CurrentUserChecker\";\r\nimport {RouterContextProvider} from \"./contexts/routerContext\";\r\n// import InstallingTheme from \"./components/InstallingTheme\";\r\n// import * as eruda from 'eruda';\r\n// import registerServiceWorker from './sw';\r\n\r\n// const el = document.createElement('div');\r\n// document.body.appendChild(el);\r\n//\r\n// eruda.init({\r\n//   container: el,\r\n//   tool: ['console', 'elements']\r\n// });\r\n\r\nbridge.subscribe(({ detail: { type, data }}) => {\r\n\tif (type === 'VKWebAppUpdateConfig') {\r\n\t\tconst schemeAttribute = document.createAttribute('scheme');\r\n\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\r\n\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\r\n\t}\r\n});\r\n\r\n// Init VK  Mini App\r\nbridge.send('VKWebAppInit');\r\n\r\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\r\n// расскомментируйте строку с registerServiceWorker();\r\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\r\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\r\n// registerServiceWorker();\r\n\r\nwindow.onload = () => {\r\n\tReactDOM.render(\r\n\t\t// <InstallingTheme>\r\n\t\t\t<AppSignProvider>\r\n\t\t\t\t<RouterContextProvider>\r\n\t\t\t\t\t<CurrentUserProvider>\r\n\t\t\t\t\t\t<CurrentUserChecker>\r\n\t\t\t\t\t\t\t<App/>\r\n\r\n\t\t\t\t\t\t</CurrentUserChecker>\r\n\t\t\t\t\t</CurrentUserProvider>\r\n\t\t\t\t</RouterContextProvider>\r\n\t\t\t</AppSignProvider>\r\n\t\t// </InstallingTheme>\r\n\t\t,\r\n\t\tdocument.getElementById('root')\r\n\t);\r\n};\r\n"],"sourceRoot":""}