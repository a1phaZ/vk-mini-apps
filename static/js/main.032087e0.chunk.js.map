{"version":3,"sources":["hooks/useLocalStorage.js","contexts/routerContext.js","hooks/useApi.js","contexts/appSign.js","contexts/currentUser.js","panels/Authorization.js","panels/Profile.js","handlers/prepare.js","panels/ColoredSum.js","components/Calendar.js","components/mainMenu/MenuItem.js","components/mainMenu/MainMenu.js","panels/Receipt/index.js","panels/Receipt/receipt.js","components/search/index.js","components/search/SearchComponent.js","panels/Balance.js","panels/AddDay.js","components/Modal.js","App.js","components/InstallingTheme.js","components/CurrentUserChecker.js","index.js","hooks/useCompareSign.js"],"names":["key","initialValue","useState","localStorage","getItem","value","setValue","useEffect","setItem","initialState","view","panel","popout","error","reducer","state","action","type","payload","RouterContext","createContext","url","isLoading","setIsLoading","response","setResponse","setError","options","setOptions","useLocalStorage","token","useContext","dispatch","_apiBase","doApiFetch","useCallback","method","params","bodyFields","headers","Authorization","qString","queryString","stringify","uri","a","async","fetch","mode","body","JSON","then","res","ok","Error","statusText","json","r","catch","e","AppSignContext","CurrentUserContext","p","go","goView","password","setPassword","confirmPassword","setConfirmPassword","formError","setFormError","useApi","vkUserId","startFetchData","setStartFetchData","currentUserState","setCurrentUserState","setToken","isLoggedIn","currentUser","name","phone","email","length","status","message","user","id","onChange","target","Math","max","parseInt","toString","slice","icon","header","top","align","size","onClick","stretched","currentTarget","dataset","to","data-to","Profile","setEmail","setPhone","setName","kktPassword","setKktPassword","fetchToFns","setFetchToFns","canBack","setCanBack","osName","platform","bridge","subscribe","detail","data","update","left","IOS","bottom","placeholder","send","console","log","Prepare","str","dt","sum","fn","i","fp","match","monthName","Date","getMonth","getDate","getFullYear","n","Intl","NumberFormat","style","currency","format","arr","map","item","totalSum","reduce","previousValue","currentValue","income","ts","items","ColoredSum","fs","stl","color","fontSize","prepare","Calendar","setDateFromCalendar","currentDate","setCurrentDate","before","subMonths","asideContent","addMonths","textAlign","fontWeight","locale","ru","toLocaleUpperCase","MenuItem","title","data-view","data-mode","MainMenu","contextOpened","setContextOpened","toggleContext","aside","transform","opened","onClose","Receipt","isSearch","receiptItem","index","className","price","quantity","dateTime","date","totalSumWithParams","SearchComponent","receipts","search","setSearch","searchTarget","setSearchTarget","searchResult","setSearchResult","time","receipt","forEach","push","timeEnd","filter","toLowerCase","indexOf","_id","Balance","setReceiptFromBalance","onClickActiveModal","initialFetch","setInitialFetch","setReceipts","totalReceiptSum","display","flexDirection","justifyContent","paddingTop","flex","paddingRight","width","height","fill","paddingLeft","expandable","indicator","AddDay","m","d","setDate","setQuantity","setPrice","setIncome","snackbar","setSnackbar","osname","modifiers","properties","layout","backgroundColor","checked","disabled","Modal","App","routerContext","activeModal","setActiveModal","modal","setModal","setReceipt","modalBack","right","activeView","onTransition","activePanel","InstallingTheme","children","schemeAttribute","document","createAttribute","scheme","attributes","setNamedItem","CurrentUserChecker","doFetch","ReactDOM","render","urlParams","setUrlParams","setVkUserId","matchUrlParams","setMatch","qs","parse","vk_user_id","ordered","Object","keys","sort","stringParams","paramsHash","crypto","createHmac","digest","replace","sign","useCompareSign","setParams","setState","window","location","Provider","useReducer","getElementById"],"mappings":"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","file":"static/js/main.032087e0.chunk.js","sourcesContent":["import { useState, useEffect } from 'react';\r\n\r\nexport default (key, initialValue = '') => {\r\n  const [value, setValue] = useState(() => {\r\n    return localStorage.getItem(key) || initialValue;\r\n  });\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem(key, value)\r\n  }, [value, key]);\r\n\r\n  return [value, setValue];\r\n}\r\n","import React, { createContext, useReducer } from 'react';\r\nimport {PopoutWrapper, ScreenSpinner} from \"@vkontakte/vkui\";\r\n\r\nconst initialState = {\r\n\tview: 'authorization',\r\n\tpanel: 'authorization.login',\r\n\tpopout: null,\r\n  error: null\r\n};\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'SET_VIEW':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tview: action.payload.view,\r\n\t\t\t\tpanel: `${action.payload.view}.${action.payload.panel}`\r\n\t\t\t};\r\n\t\tcase 'SET_PANEL':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpanel: `${state.view}.${action.payload.panel}`\r\n\t\t\t};\r\n\t\tcase 'SHOW_LOADING':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpopout: (\r\n\t\t\t\t\t<PopoutWrapper>\r\n\t\t\t\t\t\t<ScreenSpinner />\r\n\t\t\t\t\t</PopoutWrapper>\r\n\t\t\t\t)\r\n\t\t\t};\r\n\t\tcase 'HIDE_LOADING':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpopout: null\r\n\t\t\t};\r\n    case 'SET_ERROR':\r\n      return {\r\n        ...state,\r\n        error: action.payload.error\r\n      }\r\n    case 'UNSET_ERROR' :\r\n      return {\r\n        ...state,\r\n        error: null\r\n      }\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n};\r\n\r\nexport const RouterContext = createContext();\r\n\r\nexport const RouterContextProvider = ({ children }) => {\r\n\tconst value = useReducer(reducer, initialState);\r\n\treturn (\r\n\t\t<RouterContext.Provider value={value}>\r\n\t\t\t{children}\r\n\t\t</RouterContext.Provider>\r\n\t)\r\n};","import { useState, useEffect, useCallback, useContext } from 'react';\r\nimport useLocalStorage from \"./useLocalStorage\";\r\nimport queryString from 'query-string';\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nexport default url => {\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [response, setResponse] = useState(null);\r\n\tconst [error, setError] = useState(null);\r\n\tconst [options, setOptions] = useState({});\r\n\tconst [token] = useLocalStorage('token');\r\n\tconst [,dispatch] = useContext(RouterContext);\r\n\tconst _apiBase = `http://localhost:3000/api`;\r\n\t// const _apiBase = `https://35.238.182.107:8080/api`;\r\n\r\n\tconst doApiFetch = useCallback((options = {}) => {\r\n\t\tsetOptions(options);\r\n\t\tsetIsLoading(true);\r\n\t\tdispatch({ type: 'SHOW_LOADING' });\r\n\t}, [dispatch]);\r\n\r\n\tconst { method = 'GET', params, ...bodyFields} = options;\r\n\tuseEffect(() => {\r\n\t\tif (!isLoading) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst headers = {\r\n\t\t\t'Content-Type': 'application/json',\r\n\t\t\tAuthorization: token ? `Token ${token}` : '',\r\n\t\t};\r\n\r\n\t\tconst qString = params ? queryString.stringify(params) : null;\r\n\r\n\t\tconst uri = qString ? `${_apiBase}${url}?${qString}` : `${_apiBase}${url}`;\r\n\r\n\t\tconst fetchData = async () => {\r\n\t\t\tawait fetch(uri, {\r\n\t\t\t\tmethod,\r\n\t\t\t\tmode: 'cors',\r\n\t\t\t\theaders,\r\n\t\t\t\tbody: method !== 'GET' ? JSON.stringify(bodyFields) : null,\r\n\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tif (!res.ok) throw Error(res.statusText);\r\n\t\t\t\t\treturn res.json();\r\n\t\t\t\t})\r\n\t\t\t\t.then(r => {\r\n\t\t\t\t\tsetIsLoading(false);\r\n\t\t\t\t\tdispatch({ type: 'HIDE_LOADING' });\r\n\t\t\t\t\tsetResponse(r);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\tsetIsLoading(false);\r\n\t\t\t\t\tdispatch({ type: 'HIDE_LOADING' });\r\n\t\t\t\t\tdispatch({type: 'SET_ERROR', payload: {error: e}});\r\n\t\t\t\t\tsetError(e);\r\n\t\t\t\t});\r\n\t\t};\r\n\r\n\t\tfetchData();\r\n\t}, [isLoading, bodyFields, method, url, _apiBase, token, params, dispatch]);\r\n\treturn [{isLoading, response, error}, doApiFetch];\r\n}\r\n","import React, { useState, createContext, useEffect } from 'react';\r\nimport useCompareSign from \"../hooks/useCompareSign\";\r\n\r\nexport const AppSignContext = createContext([{}, () => {}]);\r\n\r\nexport const AppSignProvider = ({ children }) => {\r\n  const [{vkUserId, matchUrlParams}, setParams] = useCompareSign();\r\n  const [state, setState] = useState({\r\n    vkUserId: null,\r\n    matchUrlParams: false\r\n  });\r\n\r\n  useEffect(()=>{\r\n    setParams(window.location.search.slice(1));\r\n  }, [setParams]);\r\n\r\n  useEffect(() => {\r\n    if (!vkUserId) return;\r\n    setState({vkUserId, matchUrlParams});\r\n  }, [vkUserId, matchUrlParams]);\r\n\r\n  return (\r\n    <AppSignContext.Provider value={[state, setState]}>\r\n      {children}\r\n    </AppSignContext.Provider>\r\n  )\r\n};","import React, { createContext, useState } from 'react';\r\n\r\nexport const CurrentUserContext = createContext([{}, p => {}]);\r\n\r\nexport const CurrentUserProvider = ({ children }) => {\r\n\tconst [state, setState] = useState({\r\n\t\tisLoading: false,\r\n\t\tisLoggedIn: null,\r\n\t\tcurrentUser: null\r\n\t});\r\n\treturn (\r\n\t\t<CurrentUserContext.Provider value={[state, setState]}>\r\n\t\t\t{children}\r\n\t\t</CurrentUserContext.Provider>\r\n\t)\r\n};\r\n","import React, {Fragment, useState, useEffect, useContext} from 'react';\r\nimport {Div, FormLayout, FormLayoutGroup, Input, Placeholder, FormStatus} from \"@vkontakte/vkui\";\r\nimport PanelHeader from \"@vkontakte/vkui/dist/components/PanelHeader/PanelHeader\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Icon56LockOutline from '@vkontakte/icons/dist/56/lock_outline';\r\nimport Icon56UserAddOutline from '@vkontakte/icons/dist/56/user_add_outline';\r\nimport useApi from \"../hooks/useApi\";\r\nimport {AppSignContext} from \"../contexts/appSign\";\r\nimport {CurrentUserContext} from \"../contexts/currentUser\";\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nconst Authorization = ({go, goView, type}) => {\r\n\tconst [password, setPassword] = useState('');\r\n\tconst [confirmPassword, setConfirmPassword] = useState('');\r\n\tconst [formError, setFormError] = useState(null);\r\n\tconst [{response, error}, doApiFetch] = useApi(`/users/${type}`);\r\n\tconst [{vkUserId}] = useContext(AppSignContext);\r\n\tconst [startFetchData, setStartFetchData] = useState(false);\r\n\tconst [currentUserState, setCurrentUserState] = useContext(CurrentUserContext);\r\n\tconst [, setToken] = useLocalStorage('token');\r\n\tconst [,dispatch] = useContext(RouterContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!currentUserState.isLoggedIn) return;\r\n\t\tconst {name, phone, email, password} = currentUserState.currentUser;\r\n\t\tif (!name || !phone || !email || !password) {\r\n\t\t\tdispatch({type: 'SET_VIEW', payload: { view: 'profile', panel: 'edit'}});\r\n\t\t} else {\r\n\t\t\tdispatch({type: 'SET_VIEW', payload: { view: 'balance', panel: 'home'}})\r\n\t\t}\r\n\t},[currentUserState, dispatch]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (type === 'login') return;\r\n\r\n\t\tif ((password.length !== confirmPassword.length)) {\r\n\t\t\tsetFormError(null);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (password !== confirmPassword) {\r\n\t\t\tsetFormError({status: 'Ошибка валидации', message: 'Пароли не совпадают. Проверьте ввод и повторите попытку.'});\r\n\t\t}\r\n\t}, [password, confirmPassword, type]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (!startFetchData) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'POST',\r\n\t\t\tuser: {\r\n\t\t\t\tid: +vkUserId,\r\n\t\t\t\tpassword: password\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdoApiFetch(body);\r\n\t\tsetStartFetchData(false);\r\n\t},[startFetchData, doApiFetch, password, vkUserId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\r\n\t\tif (!response.user && response.error) {\r\n\t\t\tsetFormError(response.error);\r\n\t\t} else {\r\n\t\t\tsetToken(response.user.token);\r\n\t\t}\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!response.user,\r\n\t\t\tcurrentUser: response.user || null\r\n\t\t}));\r\n\r\n\t}, [response, setCurrentUserState, go, goView, setToken]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!error) return;\r\n\t\tsetFormError(error);\r\n\t}, [error]);\r\n\r\n\tconst onChange = (e) => {\r\n\t\te.target.value = Math.max(0, parseInt(e.target.value) ).toString().slice(0,4);\r\n\t\tif (e.target.name === 'password') {\r\n\t\t\tsetPassword(e.target.value);\r\n\t\t} else {\r\n\t\t\tsetConfirmPassword(e.target.value);\r\n\t\t}\r\n\t};\r\n\r\n\tconst formStatus = () => {\r\n\t\tif (!formError) return null;\r\n\t\treturn (\r\n\t\t\t<FormStatus header={formError.status} mode=\"error\">\r\n\t\t\t\t{formError.message}\r\n\t\t\t</FormStatus>\r\n\t\t)\r\n\t};\r\n\r\n\tconst formButtonClick = async () => {\r\n\t\tsetStartFetchData(true);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>{type === 'login' ? 'Авторизация' : 'Регистрация'}</PanelHeader>\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={type === 'login' ? <Icon56LockOutline /> : <Icon56UserAddOutline />}\r\n\t\t\t\theader={type === 'login' ? 'Введите пароль' : 'Придумайте пароль'}\r\n\t\t\t>\r\n\t\t\t\t<FormLayout>\r\n\t\t\t\t\t{formStatus()}\r\n\t\t\t\t\t<FormLayoutGroup top={'Введите пароль'}>\r\n\t\t\t\t\t\t<Input name={'password'} type={'number'} onChange = {onChange} align=\"center\" value={password}/>\r\n\t\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype !== 'login'\r\n\t\t\t\t\t\t\t?\r\n\t\t\t\t\t\t\t<FormLayoutGroup top={'Повторите пароль'}>\r\n\t\t\t\t\t\t\t\t<Input type={'number'} name={'confirmPassword'} onChange = {onChange} align=\"center\" value={confirmPassword}/>\r\n\t\t\t\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<Button size=\"l\" onClick={formButtonClick}>{type === 'login' ? 'Авторизация' : 'Регистрация'}</Button>\r\n\t\t\t\t</FormLayout>\r\n\t\t\t</Placeholder>\r\n\t\t\t<Div>\r\n\t\t\t\t<Button\r\n\t\t\t\t\tstretched\r\n\t\t\t\t\tmode=\"tertiary\"\r\n\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\tdispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.to}});\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tdata-to={type === 'login' ? 'register' : 'login'}\r\n\t\t\t\t>{type === 'login' ? 'Нет пароля?' : 'Есть пароль?'}</Button>\r\n\t\t\t</Div>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Authorization;\r\n","import React, {useState, useEffect, Fragment, useContext} from 'react';\r\nimport {\r\n\tFormLayout,\r\n\tIOS,\r\n\tPanelHeader,\r\n\tplatform,\r\n\tPanelHeaderButton, Button, Input, FormLayoutGroup, FormStatus\r\n} from '@vkontakte/vkui';\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\nimport useApi from \"../hooks/useApi\";\r\nimport {CurrentUserContext} from \"../contexts/currentUser\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nconst Profile = () =>{\r\n\tconst [email, setEmail] = useState('');\r\n\tconst [phone, setPhone] = useState('');\r\n\tconst [name, setName] = useState('');\r\n\tconst [kktPassword, setKktPassword] = useState('');\r\n\tconst [fetchToFns, setFetchToFns] = useState(false);\r\n\tconst [canBack, setCanBack] = useState(true);\r\n\t//TODO Использовать {response, error} чтобы делать переход или показывать ошибки\r\n\tconst [{response}, doApiFetch] = useApi(`/users/profile`);\r\n\tconst [startFetchData, setStartFetchData] = useState(false);\r\n\tconst [currentUserState, setCurrentUserState] = useContext(CurrentUserContext);\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tconst osName = platform();\r\n\r\n\tuseEffect(()=>{\r\n\t\t//TODO Перейти с connect на bridge!!!!\r\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'VKWebAppGetPersonalCardResult':\r\n\t\t\t\t\tsetEmail(data.email);\r\n\t\t\t\t\tsetPhone(data.phone);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst { email, name, phone, password } = currentUserState.currentUser;\r\n\t\tsetEmail(email || '');\r\n\t\tsetName(name || '');\r\n\t\tsetPhone(phone || '');\r\n\t\tsetKktPassword(password || '');\r\n\t\tsetCanBack(!!email && !!name && !!phone && !!password);\r\n\t}, [currentUserState]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (!startFetchData) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'PUT',\r\n\t\t\tupdate: {\r\n\t\t\t\temail,\r\n\t\t\t\tphone,\r\n\t\t\t\tname,\r\n\t\t\t\tkktPassword\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdoApiFetch(body);\r\n\t\tsetStartFetchData(false);\r\n\t},[startFetchData, doApiFetch, email, phone, name, kktPassword]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tconst { user } = response;\r\n\t\tif (!user.name || !user.phone || !user.email || !user.password) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!response.user,\r\n\t\t\tcurrentUser: response.user || null\r\n\t\t}));\r\n\t\tdispatch({type: 'SET_VIEW', payload: { view: 'balance', panel: 'home'}});\r\n\t}, [response, dispatch, setCurrentUserState]);\r\n\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={canBack && <PanelHeaderButton onClick={() => {\r\n\t\t\t\t\tdispatch({type: 'SET_VIEW', payload: {view: 'balance', panel: 'home'}})\r\n\t\t\t\t}}>\r\n\t\t\t\t\t{osName === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}\r\n\t\t\t\t</PanelHeaderButton>}\r\n\t\t\t>\r\n\t\t\t\tПрофиль\r\n\t\t\t</PanelHeader>\r\n\t\t\t<FormLayout>\r\n\t\t\t\t{fetchToFns && <FormStatus header=\"Запрос на получение пароля успешно отправлен\" mode=\"default\">\r\n\t\t\t\t\tПароль должен придти к вам в смс. Введите пароль в соответствующее поле. Если пароль не пришел повторите попытку позже.\r\n\t\t\t\t</FormStatus>}\r\n\t\t\t\t<Input\r\n\t\t\t\t\ttype={'text'}\r\n\t\t\t\t\ttop={'Имя'}\r\n\t\t\t\t\tname={'name'}\r\n\t\t\t\t\tvalue={name}\r\n\t\t\t\t\tonChange={(e) => {setName(e.target.value)}}\r\n\t\t\t\t/>\r\n\t\t\t\t<FormLayoutGroup top=\"E-mail и Телефон\" bottom=\"Эти данные можно получить через персональные карточки Вконтакте. Они нужны для того, чтобы получить пароль от ФНС для расшифровки чеков.\">\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'email'}\r\n\t\t\t\t\t\ttop={'e-mail'}\r\n\t\t\t\t\t\tname={'email'}\r\n\t\t\t\t\t\tplaceholder={'Введите e-mail'}\r\n\t\t\t\t\t\tvalue={email}\r\n\t\t\t\t\t\tonChange={(e) => {setEmail(e.target.value)}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'phone'}\r\n\t\t\t\t\t\ttop={'Телефон'}\r\n\t\t\t\t\t\tname={'phone'}\r\n\t\t\t\t\t\tvalue={phone}\r\n\t\t\t\t\t\tplaceholder={'Введите телефон'}\r\n\t\t\t\t\t\tonChange={(e) => {setPhone(e.target.value)}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Button size=\"xl\" onClick={() => {\r\n\t\t\t\t\t\t//TODO Перейти с connect на bridge!!!!\r\n\t\t\t\t\t\tbridge.send(\"VKWebAppGetPersonalCard\", {\"type\": [\"phone\", \"email\"]});\r\n\t\t\t\t\t\tconsole.log('bridge.send(\"VKWebAppGetPersonalCard\", {\"type\": [\"phone\", \"email\"]});');\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t\tПолучить данные из VK\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t<FormLayoutGroup top={'Пароль от ФНС'}>\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'number'}\r\n\t\t\t\t\t\ttop={'Пароль от ФНС'}\r\n\t\t\t\t\t\tplaceholder={'Введите пароль ФНС'}\r\n\t\t\t\t\t\tname={'kktPassword'}\r\n\t\t\t\t\t\tvalue={kktPassword}\r\n\t\t\t\t\t\tonChange={(e) => {setKktPassword(e.target.value)}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Button size=\"xl\" onClick={() => {\r\n\t\t\t\t\t\tsetFetchToFns(true);\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t\tПолучить пароль от ФНС\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</FormLayoutGroup>\r\n\r\n\t\t\t\t<Button size=\"xl\" mode=\"commerce\" onClick={() => {\r\n\t\t\t\t\tsetStartFetchData(true);\r\n\t\t\t\t}}>\r\n\t\t\t\t\tОбновить профиль пользователя\r\n\t\t\t\t</Button>\r\n\t\t\t</FormLayout>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Profile;\r\n","export default class Prepare {\r\n\t/**\r\n\t * Преобразование qr кода\r\n\t * @param str\r\n\t * @returns {{dt: *, fn: *, i: *, sum: *, fp: *}}\r\n\t */\r\n\tstatic qr (str){\r\n\t\tlet dt, sum, fn, i, fp;\r\n\r\n\t\tif (str) {\r\n\t\t\t[, dt, sum, fn, i, fp] = str.match(/t=(\\w{8}T\\w+)&s=(\\w+\\.*\\w+)&fn=(\\w+)&i=(\\w+)&fp=(\\w+)/);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tdt,\r\n\t\t\tsum,\r\n\t\t\tfn,\r\n\t\t\ti,\r\n\t\t\tfp\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Преобразование даты\r\n\t * @param str\r\n\t * @returns {string}\r\n\t */\r\n\tstatic date(str) {\r\n\t\tconst dt = new Date(str);\r\n\t\tlet monthName;\r\n\t\tswitch (dt.getMonth() + 1) {\r\n\t\t\tcase 1:\r\n\t\t\t\tmonthName = 'января';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tmonthName = 'февраля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tmonthName = 'марта';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tmonthName = 'апреля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tmonthName = 'мая';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tmonthName = 'июня';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7:\r\n\t\t\t\tmonthName = 'июля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8:\r\n\t\t\t\tmonthName = 'августа';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 9:\r\n\t\t\t\tmonthName = 'сентября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 10:\r\n\t\t\t\tmonthName = 'октября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 11:\r\n\t\t\t\tmonthName = 'ноября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 12:\r\n\t\t\t\tmonthName = 'декабря';\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn `${dt.getDate()} ${monthName} ${dt.getFullYear()}`;\r\n\t}\r\n\r\n\t/**\r\n\t * Преобразование суммы\r\n\t * @param n\r\n\t * @returns {string}\r\n\t */\r\n\tstatic sum(n) {\r\n\t\treturn new Intl.NumberFormat('ru-RU', {style: 'currency', currency: 'RUB'}).format(n / 100);\r\n\t}\r\n\r\n\t/**\r\n\t * Расчет общей суммы\r\n\t * @param arr\r\n\t * @returns {number}\r\n\t */\r\n\tstatic totalReceiptSum(arr) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\treturn arr.map((item) => {\r\n\t\t\treturn item.sum || item.totalSum;\r\n\t\t}).reduce(reducer);\r\n\t}\r\n\r\n\tstatic totalSumWithParams(arr) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\treturn arr.map((item) => {\r\n\t\t\tconst {income, sum} = item;\r\n\t\t\tif (income) return sum;\r\n\t\t\treturn -1*sum;\r\n\t\t}).reduce(reducer);\r\n\t}\r\n\r\n\t/**\r\n\t * Подсчет суммарных доходов / расходов\r\n\t * @param arr\r\n\t * @param income\r\n\t * @returns {number}\r\n\t */\r\n\tstatic totalSum(arr, income) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\tconst ts = arr.map(items => {\r\n\t\t\treturn items.items.map(item => {\r\n\t\t\t\tif (income) {\r\n\t\t\t\t\treturn item.income ? item.sum : 0\r\n\t\t\t\t}\r\n\t\t\t\treturn !item.income ? item.sum : 0\r\n\t\t\t}).reduce(reducer)\r\n\t\t}).reduce(reducer);\r\n\t\treturn income ? ts : -1 * ts;\r\n\t}\r\n}","import React from 'react';\r\nimport prepare from \"../handlers/prepare\";\r\n\r\nconst ColoredSum = ({sum, fs}) => {\r\n\tconst stl = sum >= 0 ? {color: '#28a745', fontSize: fs} : {color: '#dc3545', fontSize: fs};\r\n\treturn(\r\n\t\t<span style={stl}>{prepare.sum(sum)}</span>\r\n\t)\r\n};\r\n\r\nexport default ColoredSum;\r\n","import React, { useState, useEffect } from 'react';\r\nimport {format, addMonths, subMonths} from 'date-fns';\r\nimport { ru } from 'date-fns/locale'\r\nimport {Group, List, Cell, Button} from \"@vkontakte/vkui\";\r\nimport Icon24BrowserBack from '@vkontakte/icons/dist/24/browser_back';\r\nimport Icon24BrowserForward from '@vkontakte/icons/dist/24/browser_forward';\r\n\r\nconst Calendar = ({setDateFromCalendar}) => {\r\n  const [currentDate, setCurrentDate] = useState(new Date());\r\n  const dateFormat = 'LLLL yyyy';\r\n\r\n  useEffect(() => {\r\n    setDateFromCalendar(currentDate);\r\n  }, [currentDate, setDateFromCalendar]);\r\n\r\n  const nextMonth = () => {\r\n    setCurrentDate(addMonths(currentDate, 1));\r\n  };\r\n\r\n  const prevMonth = () => {\r\n    setCurrentDate(subMonths(currentDate, 1));\r\n  };\r\n\r\n  return(\r\n    <Group>\r\n      <List>\r\n        <Cell\r\n          before={<Button onClick={prevMonth} mode={'secondary'}><Icon24BrowserBack /></Button>}\r\n          asideContent={<Button onClick={nextMonth} mode={'secondary'}><Icon24BrowserForward /></Button>}\r\n          style={{textAlign: 'center', fontWeight: 'bold'}}\r\n        >\r\n          {format(currentDate, dateFormat, {locale: ru}).toLocaleUpperCase()}\r\n        </Cell>\r\n      </List>\r\n    </Group>\r\n  )\r\n};\r\n\r\nexport default Calendar;","import React from 'react';\r\nimport Cell from \"@vkontakte/vkui/dist/components/Cell/Cell\";\r\n\r\nconst MenuItem = ({before, onClick = () => {}, view, mode, title}) => {\r\n\treturn (\r\n\t\t<Cell\r\n\t\t\tbefore={before}\r\n\t\t\tonClick={onClick}\r\n\t\t\tdata-view={view}\r\n\t\t\tdata-mode={mode}\r\n\t\t>\r\n\t\t\t{title}\r\n\t\t</Cell>\r\n\t)\r\n}\r\n\r\nexport default MenuItem;\r\n","import React, {Fragment, useContext, useState} from 'react';\r\nimport PanelHeader from \"@vkontakte/vkui/dist/components/PanelHeader/PanelHeader\";\r\nimport {List, PanelHeaderContent, PanelHeaderContext, Separator} from \"@vkontakte/vkui\";\r\nimport Cell from \"@vkontakte/vkui/dist/components/Cell/Cell\";\r\n\r\nimport Icon16Dropdown from '@vkontakte/icons/dist/16/dropdown';\r\nimport Icon28UsersOutline from '@vkontakte/icons/dist/28/user_outline';\r\nimport Icon28SettingsOutline from '@vkontakte/icons/dist/28/settings_outline';\r\nimport Icon28MoneyCircleOutline from '@vkontakte/icons/dist/28/money_circle_outline';\r\nimport {RouterContext} from \"../../contexts/routerContext\";\r\nimport MenuItem from \"./MenuItem\";\r\n\r\nconst MainMenu = () => {\r\n\tconst [contextOpened, setContextOpened] = useState(false);\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\r\n\tconst toggleContext = () => {\r\n\t\tsetContextOpened(!contextOpened);\r\n\t}\r\n\r\n\tconst selectMenu = (e) => {\r\n\t\tconst {view, mode} = e.currentTarget.dataset;\r\n\t\tdispatch({type: 'SET_VIEW', payload: {view: view, panel: mode}});\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\t<PanelHeaderContent\r\n\t\t\t\t\taside={<Icon16Dropdown style={{ transform: `rotate(${contextOpened ? '180deg' : '0'})` }} />}\r\n\t\t\t\t\tonClick={toggleContext}\r\n\t\t\t\t>\r\n\t\t\t\t\tBalance\r\n\t\t\t\t</PanelHeaderContent>\r\n\t\t\t</PanelHeader>\r\n\t\t\t<PanelHeaderContext opened={contextOpened} onClose={toggleContext}>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t<MenuItem\r\n\t\t\t\t\t\tbefore={<Icon28UsersOutline />}\r\n\t\t\t\t\t\tonClick={selectMenu}\r\n\t\t\t\t\t\tview={'profile'}\r\n\t\t\t\t\t\tmode={'edit'}\r\n\t\t\t\t\t\ttitle={'Профиль пользователя'}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<MenuItem\r\n\t\t\t\t\t\tbefore={<Icon28SettingsOutline />}\r\n\t\t\t\t\t\t// onClick={selectMenu}\r\n\t\t\t\t\t\tview={'settings'}\r\n\t\t\t\t\t\tmode={'edit'}\r\n\t\t\t\t\t\ttitle={'Настройки приложения *'}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<MenuItem\r\n\t\t\t\t\t\tbefore={<Icon28MoneyCircleOutline />}\r\n\t\t\t\t\t\t// onClick={selectMenu}\r\n\t\t\t\t\t\tview={'donation'}\r\n\t\t\t\t\t\tmode={'donate'}\r\n\t\t\t\t\t\ttitle={'На кофе разработчику*'}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Separator />\r\n\t\t\t\t\t<Cell>\r\n\t\t\t\t\t\t* в разработке\r\n\t\t\t\t\t</Cell>\r\n\t\t\t\t</List>\r\n\t\t\t</PanelHeaderContext>\r\n\t\t</Fragment>\r\n\t)\r\n}\r\n\r\nexport default MainMenu;\r\n","import Receipt from \"./receipt\";\r\n\r\nexport default Receipt;\r\n","import React, {Fragment} from 'react';\r\nimport {Separator} from \"@vkontakte/vkui\";\r\nimport prepare from \"../../handlers/prepare\";\r\nimport ColoredSum from \"../ColoredSum\";\r\n\r\nimport './receipt.css';\r\nimport FormLayout from \"@vkontakte/vkui/dist/components/FormLayout/FormLayout\";\r\n\r\nconst Receipt = ({items, id, isSearch=false}) => {\r\n\tconst receiptItem = (items.map((item, index) => {\r\n\t\tconst sum = item.income ? item.sum : (-1) * item.sum ;\r\n\r\n\t\treturn(\r\n\t\t\t<div key={index} className={'receipt-item'}>\r\n\t\t\t\t<span className={'receipt-item-name'}>{item.name}</span>\r\n\t\t\t\t{item.price && !isSearch ? <span className={'receipt-item-price'}>{prepare.sum(item.price)}</span> : null}\r\n\t\t\t\t{item.quantity && !isSearch ? <span className={'receipt-item-quantity'}>{item.quantity}</span> : null}\r\n\t\t\t\t{item.dateTime && isSearch ? <span className={'receipt-item-dateTime'}>{prepare.date(item.dateTime)}</span> : null}\r\n\t\t\t\t{sum ? <span className={'receipt-item-sum'}>{<ColoredSum sum={sum}/>}</span> : null}\r\n\t\t\t</div>\r\n\t\t)\r\n\t}));\r\n\r\n\treturn(\r\n\t\t<FormLayout id={id} className={'receipt-item-wrapper'}>\r\n\t\t\t<div className={'receipt-item'}>\r\n\t\t\t\t<span className={'receipt-item-name'}>Наименование</span>\r\n\t\t\t\t{!isSearch ?\r\n\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t<span  className={'receipt-item-price'}>Цена</span>\r\n\t\t\t\t\t\t<span  className={'receipt-item-quantity'}>Кол-во</span>\r\n\t\t\t\t\t</Fragment> :\r\n\t\t\t\t\t<span className={'receipt-item-dateTime'}>Дата</span>\r\n\t\t\t\t}\r\n\t\t\t\t<span className={'receipt-item-sum'}>Сумма</span>\r\n\t\t\t</div>\r\n\t\t\t<Separator />\r\n\t\t\t{receiptItem}\r\n\t\t\t<Separator />\r\n\t\t\t<div className={'receipt-total'}>\r\n\t\t\t\t<span className={''}>Итого:</span>\r\n\t\t\t\t<span><ColoredSum sum={prepare.totalSumWithParams(items)}/></span>\r\n\t\t\t</div>\r\n\t\t</FormLayout>\r\n\t)\r\n};\r\n\r\nexport default Receipt;","import SearchComponent from \"./SearchComponent\";\r\n\r\nexport default SearchComponent;\r\n","import React, {Fragment, useState, useEffect} from 'react';\r\nimport {Search} from \"@vkontakte/vkui\";\r\nimport Receipt from \"../../panels/Receipt\";\r\nimport Group from \"@vkontakte/vkui/dist/components/Group/Group\";\r\n\r\nconst SearchComponent = ({ receipts }) => {\r\n  const [search, setSearch] = useState('');\r\n  const [searchTarget, setSearchTarget] = useState([]);\r\n  const [searchResult, setSearchResult] = useState([]);\r\n\r\n  const onSearchChange = (e) => {\r\n    setSearch(e.target.value.toLowerCase());\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!receipts) return;\r\n    let arr = [];\r\n    console.time('prepare array');\r\n    const tmp = receipts.map((receipt) => {\r\n      let dateTime = receipt.dateTime;\r\n      return receipt.items.map((item) => {\r\n        item.dateTime = dateTime;\r\n        return item;\r\n      });\r\n    });\r\n    tmp.forEach((item) => {\r\n      arr.push(...item);\r\n    });\r\n    console.timeEnd('prepare array');\r\n    setSearchTarget(arr);\r\n  }, [receipts]);\r\n\r\n  useEffect(() => {\r\n    if (!search) {\r\n      setSearchResult([]);\r\n      return;\r\n    }\r\n    setSearchResult(searchTarget.filter(({name}) => name.toLowerCase().indexOf(search) > -1));\r\n  }, [search, searchTarget]);\r\n\r\n  return (\r\n    <Fragment>\r\n      <Search value={search} onChange={onSearchChange}/>\r\n      <Group title='Поиск'>\r\n        {\r\n          searchResult.length > 0 && <Receipt id={searchResult._id} isSearch={true} items={searchResult}/>\r\n        }\r\n      </Group>\r\n    </Fragment>\r\n  )\r\n};\r\n\r\nexport default SearchComponent;\r\n","import React, {useState, useEffect, Fragment, useContext, useCallback} from 'react';\r\nimport useApi from \"../hooks/useApi\";\r\nimport {List, Placeholder, Separator} from \"@vkontakte/vkui\";\r\nimport ColoredSum from \"./ColoredSum\";\r\nimport prepare from \"../handlers/prepare\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Group from \"@vkontakte/vkui/dist/components/Group/Group\";\r\nimport Cell from \"@vkontakte/vkui/dist/components/Cell/Cell\";\r\nimport Icon56GoodsCollection from '@vkontakte/icons/dist/56/goods_collection';\r\nimport Icon16Up from '@vkontakte/icons/dist/16/up';\r\nimport Icon16Down from '@vkontakte/icons/dist/16/down';\r\n\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport Calendar from \"../components/Calendar\";\r\nimport {format} from 'date-fns';\r\nimport MainMenu from \"../components/mainMenu/MainMenu\";\r\nimport SearchComponent from \"../components/search\";\r\n\r\nconst Balance = ({setReceiptFromBalance, onClickActiveModal}) => {\r\n\tconst viewTitle = 'Баланс';\r\n\tconst [initialFetch, setInitialFetch] = useState(true);\r\n\tconst [currentDate, setCurrentDate] = useState(new Date());\r\n\tconst [receipts, setReceipts] = useState([]);\r\n\tconst [{response}, doApiFetch] = useApi('/day');\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tconst dateFormat = 'yyyy-MM-dd';\r\n\r\n\tconst setDateFromCalendar = useCallback((date) => {\r\n\t\tsetCurrentDate(date);\r\n\t\tsetInitialFetch(true);\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!initialFetch) return;\r\n\t\tdoApiFetch({\r\n\t\t\tparams: {\r\n\t\t\t\tdate: format(currentDate, dateFormat)\r\n\t\t\t}\r\n\t\t});\r\n\t\tsetInitialFetch(false);\r\n\t}, [initialFetch, setInitialFetch, doApiFetch, currentDate]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tsetReceipts(response);\r\n\t}, [response, setReceiptFromBalance]);\r\n\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<MainMenu title={viewTitle} />\r\n\t\t\t<SearchComponent receipts={receipts} />\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={<Icon56GoodsCollection />}\r\n\t\t\t\theader={<ColoredSum sum={prepare.totalReceiptSum(receipts)} fs={'2em'}/>}\r\n\t\t\t\taction={<Button size=\"l\" onClick={(e)=>{\r\n\t\t\t\t\tdispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.to}});\r\n\t\t\t\t}} data-to={'add'}>Добавить доход / расход</Button>}\r\n\t\t\t>\r\n\t\t\t\tДобавляйте доходы/расходы\r\n\t\t\t</Placeholder>\r\n\t\t\t<Separator/>\r\n\t\t\t<div style={{\r\n\t\t\t\tdisplay: 'flex',\r\n\t\t\t\tflexDirection: 'row',\r\n\t\t\t\tjustifyContent: 'space-between',\r\n\t\t\t\tpaddingTop: '1em',\r\n\t\t\t}}>\r\n\t\t\t\t<div style={{flex: '0 1 50%', display: 'flex',justifyContent: 'flex-end',}}>\r\n\t\t\t\t\t<div style={{display: 'flex', flexDirection: 'column', paddingRight: '10px'}}>\r\n\t\t\t\t\t\t<span style={{color: '#6F6F6F', fontSize: '0.7em', textAlign: 'end'}}>Доходы</span>\r\n\t\t\t\t\t\t<ColoredSum sum={prepare.totalSum(receipts, true)} fs={'1.4em'}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<Icon16Up width={16} height={40} fill={'#28a745'}/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style={{flex: '0 1 50%', display: 'flex',justifyContent: 'flex-start',}}>\r\n\t\t\t\t\t<Icon16Down width={16} height={40} fill={'#dc3545'}/>\r\n\t\t\t\t\t<div style={{display: 'flex', flexDirection: 'column', paddingLeft: '10px'}}>\r\n\t\t\t\t\t\t<span style={{color: '#6F6F6F', fontSize: '0.7em'}}>Расходы</span>\r\n\t\t\t\t\t\t<ColoredSum sum={prepare.totalSum(receipts, false)} fs={'1.4em'}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<Group title='Чеки'>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t<Calendar setDateFromCalendar={setDateFromCalendar}/>\r\n\t\t\t\t\t{receipts.map((receipt, index) => {\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\texpandable\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\tonClickActiveModal('modal-page');\r\n\t\t\t\t\t\t\t\t\tsetReceiptFromBalance(receipt);\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tdata-to={receipt._id}\r\n\t\t\t\t\t\t\t\tindicator={<ColoredSum sum={receipt.totalSum}/>}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{prepare.date(receipt.dateTime)}\r\n\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t})}\r\n\t\t\t\t</List>\r\n\t\t\t</Group>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Balance;\r\n","import React, {useState, useEffect, useContext, Fragment} from 'react';\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\r\nimport FormLayout from \"@vkontakte/vkui/dist/components/FormLayout/FormLayout\";\r\nimport Input from \"@vkontakte/vkui/dist/components/Input/Input\";\r\nimport PanelHeaderButton from \"@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton\";\r\nimport {IOS, platform, Snackbar} from \"@vkontakte/vkui\";\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Checkbox from \"@vkontakte/vkui/dist/components/Checkbox/Checkbox\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Icon24Qr from '@vkontakte/icons/dist/24/qr';\r\nimport PanelHeaderContent from \"@vkontakte/vkui/dist/components/PanelHeaderContent/PanelHeaderContent\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport useApi from \"../hooks/useApi\";\r\nimport Avatar from \"@vkontakte/vkui/dist/components/Avatar/Avatar\";\r\nimport Icon16Done from '@vkontakte/icons/dist/16/done';\r\n\r\nconst AddDay = () => {\r\n  const SUCCESS_MESSAGE = 'Добавление прошло успешно';\r\n  const [name, setName] = useState('');\r\n  const [date, setDate] = useState(() => {\r\n    const date = new Date();\r\n    const m = date.getMonth()+1 > 9 ? date.getMonth()+1 : `0${date.getMonth()+1}`;\r\n    const d = date.getDate() > 9 ? date.getDate() : `0${date.getDate()}`;\r\n    return `${date.getFullYear()}-${m}-${d}`;\r\n  });\r\n  const [quantity, setQuantity] = useState(1);\r\n  const [price, setPrice] = useState('');\r\n  const [income, setIncome] = useState(false);\r\n  const [snackbar, setSnackbar] = useState(null);\r\n  const [, dispatch] = useContext(RouterContext);\r\n  const [{response}, doApiFetch] = useApi('/day');\r\n  const [startFetchData, setStartFetchData] = useState(false);\r\n  const osname = platform();\r\n\r\n  useEffect(() => {\r\n    if (!startFetchData) return;\r\n    const body = {\r\n      method: 'POST',\r\n      date: date,\r\n      items: [\r\n        {\r\n          name,\r\n          quantity,\r\n          price: price * 100,\r\n          sum: price * 100 * quantity,\r\n          income,\r\n          modifiers: [],\r\n          properties: [],\r\n        }\r\n      ]\r\n    };\r\n    doApiFetch(body);\r\n\r\n    setName('');\r\n    setQuantity(1);\r\n    setIncome(false);\r\n    setPrice('');\r\n    setStartFetchData(false);\r\n  }, [startFetchData, setStartFetchData, date, doApiFetch, income, name, price, quantity]);\r\n\r\n  useEffect(() => {\r\n    if (!response) return;\r\n    setSnackbar(<Snackbar\r\n      layout=\"vertical\"\r\n      onClose={() => setSnackbar(null)}\r\n      before={<Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon16Done fill=\"#fff\" width={14} height={14} /></Avatar>}\r\n    >\r\n      {SUCCESS_MESSAGE}\r\n    </Snackbar>)\r\n  }, [response]);\r\n\r\n  return(\r\n    <Fragment>\r\n      <PanelHeader\r\n        left={\r\n          <PanelHeaderButton key={'back'} onClick={(e) => {\r\n            dispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.to}});\r\n          }} data-to={'home'}>{osname === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}</PanelHeaderButton>\r\n        }\r\n      >\r\n        <PanelHeaderContent\r\n          before={<PanelHeaderButton key={'qr'}><Icon24Qr /></PanelHeaderButton>}\r\n        >\r\n          Добавление записи\r\n        </PanelHeaderContent>\r\n      </PanelHeader>\r\n      <FormLayout>\r\n        <Input\r\n          type={'date'}\r\n          top={'Дата'}\r\n          name={'date'}\r\n          value={date}\r\n          onChange={(e)=>{setDate(e.currentTarget.value)}}\r\n        />\r\n        <Input\r\n          type={'text'}\r\n          top={'Название'}\r\n          name={'name'}\r\n          value={name}\r\n          onChange={(e)=>{setName(e.currentTarget.value)}}\r\n        />\r\n        <Input\r\n          type={'number'}\r\n          top={'Количество'}\r\n          name={'quantity'}\r\n          value={quantity}\r\n          onChange={(e)=>{setQuantity(e.currentTarget.value)}}\r\n        />\r\n        <Input\r\n          type={'number'}\r\n          top={'Цена'}\r\n          name={'price'}\r\n          value={price}\r\n          onChange={(e)=>{setPrice(e.currentTarget.value)}}\r\n        />\r\n        <Checkbox\r\n          name={'income'}\r\n          checked={income}\r\n          onChange={(e)=>{setIncome(e.currentTarget.checked)}}\r\n        >Доход</Checkbox>\r\n\r\n        <Button\r\n          size=\"xl\"\r\n          disabled={!date || !name || !quantity || !price}\r\n          mode={income ? \"commerce\" : \"destructive\"}\r\n          onClick={() => {setStartFetchData(true)}}\r\n        >\r\n          Добавить {income ? \"доход\" : \"расход\"}\r\n        </Button>\r\n      </FormLayout>\r\n\r\n      {snackbar}\r\n    </Fragment>\r\n  )\r\n};\r\n\r\nexport default AddDay;","import React from 'react';\r\nimport {List} from \"@vkontakte/vkui\";\r\nimport Receipt from \"../panels/Receipt\";\r\n\r\nconst Modal = ({receipt}) => {\r\n\treturn (\r\n\t\t<List>\r\n\t\t\t<Receipt id={receipt._id} dateTime={receipt.dateTime} items={receipt.items}/>\r\n\t\t</List>\r\n\t)\r\n};\r\n\r\nexport default Modal;","import React, {useContext, useState, useEffect, useCallback} from 'react';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport {Root, Panel, View, platform, ModalRoot, ModalPage, ModalPageHeader, IOS} from \"@vkontakte/vkui\";\r\nimport Authorization from \"./panels/Authorization\";\r\nimport Profile from \"./panels/Profile\";\r\nimport {RouterContext} from \"./contexts/routerContext\";\r\nimport Balance from \"./panels/Balance\";\r\nimport AddDay from \"./panels/AddDay\";\r\nimport Modal from \"./components/Modal\";\r\nimport PanelHeaderButton from \"@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton\";\r\nimport prepare from \"./handlers/prepare\";\r\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\r\nimport Icon24Dismiss from '@vkontakte/icons/dist/24/dismiss';\r\n\r\nconst App = () => {\r\n\tconst [routerContext] = useContext(RouterContext);\r\n\tconst [activeModal, setActiveModal] = useState(null);\r\n\tconst [modal, setModal] = useState(null);\r\n\tconst [receipt, setReceipt] = useState(null);\r\n\r\n\tconst modalBack = useCallback(() => {\r\n\t\tsetActiveModal(null);\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!receipt) return;\r\n\t\tconst osName = platform();\r\n\t\tsetModal(\r\n\t\t\t<ModalRoot activeModal={activeModal} onClose={modalBack}>\r\n\t\t\t\t<ModalPage\r\n\t\t\t\t\tid={'modal-page'}\r\n\t\t\t\t\tonClose={modalBack}\r\n\t\t\t\t\theader={\r\n\t\t\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\t\t\tleft={osName !== IOS && <PanelHeaderButton onClick={modalBack}><Icon24Cancel /></PanelHeaderButton>}\r\n\t\t\t\t\t\t\tright={osName === IOS && <PanelHeaderButton onClick={modalBack}>{osName === IOS ? 'Готово' : <Icon24Dismiss />}</PanelHeaderButton>}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{prepare.date(receipt.dateTime)}\r\n\t\t\t\t\t\t</ModalPageHeader>\r\n\t\t\t\t\t}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Modal onClose={modalBack} receipt={receipt}/>\r\n\t\t\t\t</ModalPage>\r\n\t\t\t</ModalRoot>\r\n\t\t);\r\n\t}, [receipt, activeModal, modalBack]);\r\n\r\n\treturn (\r\n\t\t<Root activeView={routerContext.view} popout={routerContext.popout} modal={modal} onTransition={null}>\r\n\t\t\t<View id={'authorization'} activePanel={routerContext.panel}>\r\n\t\t\t\t<Panel id={'authorization.login'}>\r\n\t\t\t\t\t<Authorization type={'login'} />\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'authorization.register'}>\r\n\t\t\t\t\t<Authorization type={'register'} />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'profile'} activePanel={routerContext.panel}>\r\n\t\t\t\t<Panel id={'profile.edit'}>\r\n\t\t\t\t\t<Profile />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'balance'} activePanel={routerContext.panel} >\r\n\t\t\t\t<Panel id={'balance.home'}>\r\n\t\t\t\t\t<Balance\r\n\t\t\t\t\t\tsetReceiptFromBalance={setReceipt}\r\n\t\t\t\t\t\tonClickActiveModal={setActiveModal}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'balance.add'}>\r\n\t\t\t\t\t<AddDay />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t</Root>\r\n\t);\r\n};\r\n\r\nexport default App;\r\n","import { useEffect } from 'react';\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\n\r\nconst InstallingTheme = ({ children }) => {\r\n\r\n\tuseEffect(() => {\r\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\r\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\r\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\r\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\r\n\t\t\t}\r\n\t\t});\r\n\t}, []);\r\n\r\n\treturn (children)\r\n};\r\n\r\nexport default InstallingTheme;\r\n","import { useEffect, useContext } from 'react';\r\nimport useApi from \"../hooks/useApi\";\r\nimport { CurrentUserContext } from '../contexts/currentUser';\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\n\r\nconst CurrentUserChecker = ({ children }) => {\r\n\tconst [{response}, doFetch] = useApi('/users/profile');\r\n\tconst [, setCurrentUserState] = useContext(CurrentUserContext);\r\n\tconst [token] = useLocalStorage('token');\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!token) {\r\n\t\t\tsetCurrentUserState(state => ({\r\n\t\t\t\t...state,\r\n\t\t\t\tisLoggedIn: false\r\n\t\t\t}));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdoFetch();\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: true\r\n\t\t}))\r\n\t}, [doFetch, setCurrentUserState, token]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!response.user,\r\n\t\t\tcurrentUser: response.user || null\r\n\t\t}));\r\n\r\n\t}, [response, setCurrentUserState]);\r\n\treturn children;\r\n};\r\n\r\nexport default CurrentUserChecker;\r\n","import 'core-js/features/map';\r\nimport 'core-js/features/set';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport App from './App';\r\nimport {CurrentUserProvider} from \"./contexts/currentUser\";\r\nimport {AppSignProvider} from \"./contexts/appSign\";\r\nimport InstallingTheme from \"./components/InstallingTheme\";\r\nimport CurrentUserChecker from \"./components/CurrentUserChecker\";\r\nimport {RouterContextProvider} from \"./contexts/routerContext\";\r\n// import registerServiceWorker from './sw';\r\n\r\n// Init VK  Mini App\r\nbridge.send('VKWebAppInit', {});\r\n\r\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\r\n// расскомментируйте строку с registerServiceWorker();\r\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\r\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\r\n// registerServiceWorker();\r\n\r\nReactDOM.render(\r\n\t<InstallingTheme>\r\n\t\t<AppSignProvider>\r\n\t\t\t<RouterContextProvider>\r\n\t\t\t\t<CurrentUserProvider>\r\n\t\t\t\t\t<CurrentUserChecker>\r\n\t\t\t\t\t\t<App />\r\n\t\t\t\t\t</CurrentUserChecker>\r\n\t\t\t\t</CurrentUserProvider>\r\n\t\t\t</RouterContextProvider>\r\n\t\t</AppSignProvider>\r\n\t</InstallingTheme>\r\n\t,\r\n\tdocument.getElementById('root')\r\n);\r\n","import { useState, useEffect } from 'react';\r\nimport qs from 'querystring';\r\nimport crypto from 'crypto';\r\n\r\nexport default () => {\r\n\tconst [urlParams, setUrlParams] = useState('');\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [vkUserId, setVkUserId] = useState(null);\r\n\tconst [matchUrlParams, setMatch] = useState(false);\r\n\r\n\tconst setParams = (urlParams = '') => {\r\n\t\tsetUrlParams(urlParams);\r\n\t\tsetIsLoading(true);\r\n\t};\r\n\r\n\tuseEffect(() =>{\r\n\t\tif( !isLoading ) return;\r\n\r\n\t\tconst params = qs.parse(urlParams);\r\n\r\n\t\tif (!params) return;\r\n\r\n\t\tsetVkUserId(params.vk_user_id);\r\n\r\n\t\tconst ordered = {};\r\n\t\tObject.keys(params).sort().forEach((key) => {\r\n\t\t\tif (key.slice(0, 3) === 'vk_') {\r\n\t\t\t\tordered[key] = params[key];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst stringParams = qs.stringify(ordered);\r\n\t\tconst paramsHash = crypto\r\n\t\t\t.createHmac('sha256', 'Zs6DYRE8Z2mZ44LfciKW')\r\n\t\t\t.update(stringParams)\r\n\t\t\t.digest()\r\n\t\t\t.toString('base64')\r\n\t\t\t.replace(/\\+/g, '-')\r\n\t\t\t.replace(/\\//g, '_')\r\n\t\t\t.replace(/=$/, '');\r\n\r\n\t\tsetMatch(paramsHash === params.sign);\r\n\t}, [isLoading, urlParams]);\r\n\r\n\treturn [{vkUserId, matchUrlParams}, setParams];\r\n}"],"sourceRoot":""}