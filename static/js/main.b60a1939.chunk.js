(this["webpackJsonpvk-mini-apps-empty"]=this["webpackJsonpvk-mini-apps-empty"]||[]).push([[0],{285:function(e,t,a){e.exports=a(485)},387:function(e,t,a){},401:function(e,t,a){},407:function(e,t){},409:function(e,t){},442:function(e,t){},443:function(e,t){},485:function(e,t,a){"use strict";a.r(t);a(286),a(312),a(314),a(315),a(317),a(318),a(319),a(320),a(321),a(322),a(323),a(324),a(326),a(327),a(328),a(329),a(330),a(331),a(332),a(333),a(334),a(335),a(337),a(338),a(339),a(340),a(341),a(342),a(343),a(344),a(345),a(346),a(347),a(348),a(349),a(350),a(351),a(352),a(353),a(354);var n=a(0),r=a.n(n),c=a(207),l=a.n(c),o=a(30),i=a.n(o),u=a(4),s=(a(362),a(2)),m=a(67),d=a.n(m),p=a(94),E=a(66),f=a.n(E),b=a(50),O=a.n(b),y=a(215),g=a.n(y),j=a(216),v=a.n(j),h=a(242),S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=Object(n.useState)((function(){return localStorage.getItem(e)||t})),r=Object(u.a)(a,2),c=r[0],l=r[1];return Object(n.useEffect)((function(){localStorage.setItem(e,c)}),[c,e]),[c,l]},T=a(217),_=a.n(T),w=a(8),C=function(e,t){window.history.pushState({view:e,panel:t},"".concat(e,".").concat(t),"#".concat(e,".").concat(t))},k={view:"authorization",panel:"authorization.login",popout:null,error:null,password:"",confirmPassword:"",vkUser:{id:null,matchUrlParams:!1},currentUser:null,isLoggedIn:!1,receipts:[],item:null,currentDate:new Date,modal:null},I=function(e,t){switch(t.type){case"SET_VIEW":return C(t.payload.view,t.payload.panel),Object(w.a)({},e,{view:t.payload.view,panel:"".concat(t.payload.view,".").concat(t.payload.panel),item:null});case"SET_PANEL":return C(e.view,t.payload.panel),Object(w.a)({},e,{password:"",confirmPassword:"",panel:"".concat(e.view,".").concat(t.payload.panel),item:null});case"SHOW_LOADING":return Object(w.a)({},e,{popout:r.a.createElement(s.y,null,r.a.createElement(s.A,null))});case"HIDE_LOADING":return Object(w.a)({},e,{popout:null});case"SET_POPOUT":return Object(w.a)({},e,{popout:t.payload.popout});case"SET_ERROR":return Object(w.a)({},e,{error:t.payload.error});case"UNSET_ERROR":return Object(w.a)({},e,{error:null});case"SET_PASSWORD":return Object(w.a)({},e,{password:e.password.length<4?e.password+t.payload.digit:e.password});case"SET_CONFIRM_PASSWORD":return Object(w.a)({},e,{confirmPassword:e.confirmPassword.length<4?e.confirmPassword+t.payload.digit:e.confirmPassword});case"UNSET_PASSWORD":return Object(w.a)({},e,{password:"",confirmPassword:""});case"SET_VK_USER":return Object(w.a)({},e,{vkUser:{id:t.payload.id,matchUrlParams:t.payload.match}});case"SET_USER":return Object(w.a)({},e,{currentUser:t.payload.user,isLoggedIn:t.payload.isLoggedIn});case"SET_RECEIPTS":return Object(w.a)({},e,{receipts:t.payload.receipts});case"SET_DATE":return Object(w.a)({},e,{currentDate:t.payload.date});case"SET_ITEM_TO_EDIT":return C("balance","balance.add"),Object(w.a)({},e,{item:t.payload.item,view:"balance",panel:"balance.add",modal:null});case"HIDE_MODAL":return Object(w.a)({},e,{modal:null});case"SHOW_MODAL":return Object(w.a)({},e,{modal:t.payload.modal});default:return e}},R=Object(n.createContext)(),P=function(e){var t=e.children,a=Object(n.useReducer)(I,k);return r.a.createElement(R.Provider,{value:a},t)},L=function(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),r=a[0],c=a[1],l=Object(n.useState)(null),o=Object(u.a)(l,2),i=o[0],s=o[1],m=Object(n.useState)(null),E=Object(u.a)(m,2),f=E[0],b=E[1],O=Object(n.useState)({}),y=Object(u.a)(O,2),g=y[0],j=y[1],v=S("token"),T=Object(u.a)(v,1)[0],w=Object(n.useContext)(R),C=Object(u.a)(w,2)[1],k="https://balance.z-labz.ru:8080/api",I=Object(n.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};j(e),s(null),c(!0),C({type:"SHOW_LOADING"})}),[C]),P=g.method,L=void 0===P?"GET":P,x=g.params,D=Object(h.a)(g,["method","params"]);return Object(n.useEffect)((function(){if(r){var t={"Content-Type":"application/json",Authorization:T?"Token ".concat(T):""},a=x?_.a.stringify(x):null,n=a?"".concat(k).concat(e,"?").concat(a):"".concat(k).concat(e);(function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,{method:L,mode:"cors",headers:t,body:"GET"!==L?JSON.stringify(D):null}).then((function(e){return e.json()})).then((function(e){if(e.error)throw Error(e.error.message);c(!1),C({type:"HIDE_LOADING"}),s(e)})).catch((function(e){c(!1),C({type:"HIDE_LOADING"}),C({type:"SET_ERROR",payload:{error:e}}),b(e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}}),[r,D,L,e,k,T,x,C]),[{isLoading:r,response:i,error:f},I]},x=a(218),D=a.n(x),A=(a(387),function(e){var t=e.confirm,a=void 0!==t&&t,c=Object(n.useContext)(R),l=Object(u.a)(c,2)[1],o=[{item:"1"},{item:"2"},{item:"3"},{item:"4"},{item:"5"},{item:"6"},{item:"7"},{item:"8"},{item:"9"},{item:null},{item:"0"},{item:r.a.createElement(D.a,null),onClick:function(){l({type:"UNSET_PASSWORD"})},mode:"destructive"}],i=function(e){l(a?{type:"SET_CONFIRM_PASSWORD",payload:{digit:e.currentTarget.dataset.digit}}:{type:"SET_PASSWORD",payload:{digit:e.currentTarget.dataset.digit}})},m=o.map((function(e,t){return r.a.createElement("div",{className:"digit",key:t},e.item&&r.a.createElement(s.b,{size:"xl",mode:e.mode||"secondary","data-digit":e.item,onClick:e.onClick||i},r.a.createElement("b",null,e.item)))}));return r.a.createElement("div",{className:"dialer"},m)}),N=function(e){var t=e.type,a=Object(n.useState)(null),c=Object(u.a)(a,2),l=c[0],o=c[1],i=L("/users/".concat(t)),m=Object(u.a)(i,2),E=m[0],b=E.response,y=E.error,j=m[1],h=Object(n.useState)(!1),T=Object(u.a)(h,2),_=T[0],w=T[1],C=S("token"),k=Object(u.a)(C,2)[1],I=Object(n.useContext)(R),P=Object(u.a)(I,2),x=P[0],D=P[1];Object(n.useEffect)((function(){x.isLoggedIn&&D({type:"SET_VIEW",payload:{view:"balance",panel:"home"}})}),[x,D]),Object(n.useEffect)((function(){x.password.length===x.confirmPassword.length&&(x.password.length||x.confirmPassword.length)?x.password!==x.confirmPassword&&o({status:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438",message:"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0432\u0432\u043e\u0434 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443."}):o(null)}),[x.password,x.confirmPassword,t]),Object(n.useEffect)((function(){if(_){var e={method:"POST",user:{id:+x.vkUser.id,password:x.password}};j(e),w(!1),D({type:"UNSET_PASSWORD"})}}),[_,j,x.password,x.vkUser.id,D]),Object(n.useEffect)((function(){b&&(!b.user&&b.error?o(b.error):k(b.user.token),D({type:"SET_USER",payload:{user:b.user||null,isLoggedIn:!!b.user}}))}),[b,k,D]),Object(n.useEffect)((function(){y&&o({message:y.message})}),[y]);var N=function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:w(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=x.password.replace(/[0-9]/g,"*")||"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",F=x.confirmPassword.replace(/[0-9]/g,"*")||"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c";return r.a.createElement(n.Fragment,null,r.a.createElement(f.a,null,"login"===t?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),r.a.createElement(s.x,{icon:"login"===t?r.a.createElement(g.a,null):r.a.createElement(v.a,null),header:function(){var e;return e=4!==x.password.length||"login"===t?U:F,r.a.createElement("b",null,e)}()},r.a.createElement(s.i,null,l?r.a.createElement(s.k,{header:l.status,mode:"error"},l.message):null),4!==x.password.length||"login"===t?x.password.length+" \u0438\u0437 4":x.confirmPassword.length+" \u0438\u0437 4"),r.a.createElement(A,{confirm:4===x.password.length}),r.a.createElement(s.i,{style:{textAlign:"center"}},"login"===t&&4===x.password.length&&r.a.createElement(O.a,{size:"xl",mode:"commerce",onClick:N},"login"===t?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),"login"!==t&&x.password&&x.confirmPassword&&x.password===x.confirmPassword&&r.a.createElement(O.a,{mode:"commerce",size:"xl",onClick:N},"login"===t?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f")),r.a.createElement(s.f,null,r.a.createElement(O.a,{stretched:!0,mode:"tertiary",onClick:function(e){D({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"login"===t?"register":"login"},"login"===t?"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f":"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f")))},U=a(95),F=a.n(U),W=a(96),M=a.n(W),z=a(82),V=a.n(z),H=a(44),G=a.n(H),K={email:"",phone:"",name:"",kktPassword:""},q=function(e,t){switch(t.type){case"SET_EMAIL":return Object(w.a)({},e,{email:t.payload.email});case"SET_PHONE":return Object(w.a)({},e,{phone:t.payload.phone});case"SET_NAME":return Object(w.a)({},e,{name:t.payload.name});case"SET_PASSWORD":return Object(w.a)({},e,{kktPassword:t.payload.password});case"INIT":var a=t.payload.currentUser,n=a.email,r=a.name,c=a.phone,l=a.password;return Object(w.a)({},e,{email:n||"",name:r||"",phone:c||"",kktPassword:l||""});default:return e}},B=function(){var e=Object(n.useState)(!1),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(null),o=Object(u.a)(l,2),m=o[0],d=o[1],p=Object(n.useState)(!0),E=Object(u.a)(p,2),f=E[0],b=E[1],O=Object(n.useState)(""),y=Object(u.a)(O,2),g=y[0],j=y[1],v=L("/users/profile"),h=Object(u.a)(v,2),S=h[0].response,T=h[1],_=L("/fns/password"),w=Object(u.a)(_,2),C=w[0],k=w[1],I=Object(n.useState)(!1),P=Object(u.a)(I,2),x=P[0],D=P[1],A=Object(n.useContext)(R),N=Object(u.a)(A,2),U=N[0],W=N[1],z=Object(n.useReducer)(q,K),H=Object(u.a)(z,2),B=H[0],J=H[1],Q=Object(s.K)();Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppGetPersonalCardResult":J({type:"SET_EMAIL",payload:{email:n.email}}),J({type:"SET_PHONE",payload:{email:n.phone}}),console.log("profile",n);break;case"VKWebAppGetPersonalCardFailed":console.log("profile error",n)}}))}),[]),Object(n.useEffect)((function(){f&&(J({type:"INIT",payload:{currentUser:U.currentUser}}),b(!1))}),[U,f]),Object(n.useEffect)((function(){x&&(T({method:"PUT",update:B}),D(!1))}),[x,T,B]),Object(n.useEffect)((function(){if(a){var e={};"restore"!==g&&(e.name=B.name,e.email=B.email),e.params={type:g},e.phone=B.phone.replace(/[ ()-]/g,""),e.phone=e.phone.replace(/^[8]/g,"+7"),e.method="POST",k(e),c(!1)}}),[a,g,k,B]),Object(n.useEffect)((function(){S&&(W({type:"SET_USER",payload:{user:S.user||null,isLoggedIn:!!S.user}}),W({type:"SET_VIEW",payload:{view:"balance",panel:"home"}}))}),[S,W]),Object(n.useEffect)((function(){C.response&&d(r.a.createElement(s.E,{layout:"vertical",onClose:function(){return d(null)},before:r.a.createElement(V.a,{size:24,style:{backgroundColor:"var(--accent)"}},r.a.createElement(G.a,{fill:"#fff",width:14,height:14}))},C.response.message))}),[C.response]);var Y=function(){i.a.send("VKWebAppGetPersonalCard",{type:["phone","email"]})};return r.a.createElement(n.Fragment,null,r.a.createElement(s.u,{left:r.a.createElement(s.v,{onClick:function(){W({type:"SET_VIEW",payload:{view:"balance",panel:"home"}})}},Q===s.n?r.a.createElement(F.a,null):r.a.createElement(M.a,null))},"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"),r.a.createElement(s.i,{style:{paddingBottom:40}},r.a.createElement(s.o,{type:"text",top:"\u0418\u043c\u044f",name:"name",value:B.name,onChange:function(e){J({type:"SET_NAME",payload:{name:e.currentTarget.value}})}}),r.a.createElement(s.j,{top:"E-mail \u0438 \u0422\u0435\u043b\u0435\u0444\u043e\u043d",bottom:"\u042d\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0439\u0442\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044e \u0432 \u0441\u0435\u0440\u0432\u0438\u0441\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0447\u0435\u043a\u043e\u0432 \u0424\u041d\u0421.\r \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u0434\u0430\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e \u0447\u0435\u043a\u0430\u043c \u043f\u0440\u0438 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 QR \u043a\u043e\u0434\u0430"},r.a.createElement(s.o,{type:"email",top:"e-mail",name:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 e-mail",value:B.email,onChange:function(e){J({type:"SET_EMAIL",payload:{email:e.currentTarget.value}})},onClick:Y}),r.a.createElement(s.o,{type:"phone",top:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",name:"phone",value:B.phone,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043b\u0435\u0444\u043e\u043d",onChange:function(e){e.target.value.replace(/^[8]/,"+7"),J({type:"SET_PHONE",payload:{phone:e.currentTarget.value}})},onClick:Y})),r.a.createElement(s.j,{top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",bottom:'\u0415\u0441\u043b\u0438 \u0432\u044b \u043a\u043e\u0433\u0434\u0430-\u043b\u0438\u0431\u043e \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c \u0432 \u0441\u0435\u0440\u0432\u0438\u0441\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0447\u0435\u043a\u043e\u0432 \u0424\u041d\u0421, \u043d\u043e \u0437\u0430\u0431\u044b\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u043d\u0430\u0436\u043c\u0438\u0442\u0435 "\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c". \u0415\u0441\u043b\u0438 \u043d\u0435 \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043f\u043e \u043a\u0430\u043a\u0438\u043c \u0442\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0430\u043c, \u043e\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u043f\u043e\u043b\u0435 \u0432\u0432\u043e\u0434\u0430 \u043f\u0430\u0440\u043e\u043b\u044f \u043f\u0443\u0441\u0442\u044b\u043c, \u043d\u043e \u0442\u043e\u0433\u0434\u0430 \u0443 \u0432\u0430\u0441 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0447\u0435\u043a\u0438 \u0438 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0443 \u043f\u043e \u0447\u0435\u043a\u0430\u043c'},r.a.createElement(s.o,{type:"number",top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c \u0424\u041d\u0421",name:"kktPassword",value:B.kktPassword,onChange:function(e){J({type:"SET_PASSWORD",payload:{password:e.currentTarget.value}})}}),r.a.createElement(s.f,{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(s.b,{size:"l","data-type":"signup",onClick:function(e){j(e.currentTarget.dataset.type),c(!0)},style:{margin:"0px",width:"49%"}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"),r.a.createElement(s.b,{size:"l","data-type":"restore",onClick:function(e){j(e.currentTarget.dataset.type),c(!0)},style:{margin:"0px",width:"49%"}},"\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"))),r.a.createElement(s.h,{style:{marginBottom:"1em"},vertical:"bottom"},r.a.createElement(s.b,{size:"xl",mode:"commerce",onClick:function(){D(!0)}},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c"))),m)},J=a(219),Q=a(220),Y=function(){function e(){Object(J.a)(this,e)}return Object(Q.a)(e,null,[{key:"qr",value:function(e){try{var t,a,n,r,c;if(e){var l=e.match(/t=(\w{8}T\w+)&s=(\w+\.*\w+)&fn=(\w+)&i=(\w+)&fp=(\w+)/),o=Object(u.a)(l,6);t=o[1],a=o[2],n=o[3],r=o[4],c=o[5]}return{dt:t,sum:a.replace(/[.]/g,""),fn:n,i:r,fp:c}}catch(i){return console.log(i),{error:{message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0447\u0442\u0435\u043d\u0438\u044f QR \u043a\u043e\u0434\u0430"}}}}},{key:"date",value:function(e){var t,a=new Date(e);switch(a.getMonth()+1){case 1:t="\u044f\u043d\u0432\u0430\u0440\u044f";break;case 2:t="\u0444\u0435\u0432\u0440\u0430\u043b\u044f";break;case 3:t="\u043c\u0430\u0440\u0442\u0430";break;case 4:t="\u0430\u043f\u0440\u0435\u043b\u044f";break;case 5:t="\u043c\u0430\u044f";break;case 6:t="\u0438\u044e\u043d\u044f";break;case 7:t="\u0438\u044e\u043b\u044f";break;case 8:t="\u0430\u0432\u0433\u0443\u0441\u0442\u0430";break;case 9:t="\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f";break;case 10:t="\u043e\u043a\u0442\u044f\u0431\u0440\u044f";break;case 11:t="\u043d\u043e\u044f\u0431\u0440\u044f";break;case 12:t="\u0434\u0435\u043a\u0430\u0431\u0440\u044f"}return"".concat(a.getDate()," ").concat(t," ").concat(a.getFullYear())}},{key:"sum",value:function(e){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e/100)}},{key:"totalReceiptSum",value:function(e){if(0===e.length)return 0;return e.map((function(e){return e.sum||e.totalSum})).reduce((function(e,t){return e+t}))}},{key:"totalSumWithParams",value:function(e){if(0===e.length)return 0;return e.map((function(e){var t=e.income,a=e.sum;return t?a:-1*a})).reduce((function(e,t){return e+t}))}},{key:"totalSum",value:function(e,t){if(0===e.length)return 0;var a=function(e,t){return e+t},n=e.map((function(e){return e.items.map((function(e){return t?e.income?e.sum:0:e.income?0:e.sum})).reduce(a)})).reduce(a);return t?n:-1*n}}]),e}(),Z=function(e){var t=e.sum,a=e.fs,n=t>=0?{color:"#28a745",fontSize:a}:{color:"#dc3545",fontSize:a};return r.a.createElement("span",{style:n},Y.sum(t))},$=a(99),X=a.n($),ee=a(226),te=a.n(ee),ae=a(221),ne=a.n(ae),re=a(222),ce=a.n(re),le=a(223),oe=a.n(le),ie=a(488),ue=a(243),se=a(487),me=a(489),de=a(224),pe=a.n(de),Ee=a(225),fe=a.n(Ee),be=function(){var e=Object(n.useContext)(R),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(ie.a)(new Date,"yyyy.M")<=Object(ie.a)(a.currentDate,"yyyy.M");return r.a.createElement(s.l,null,r.a.createElement(s.p,null,r.a.createElement(s.c,{before:r.a.createElement(s.b,{onClick:function(){c({type:"SET_DATE",payload:{date:Object(se.a)(a.currentDate,1)}})},mode:"secondary"},r.a.createElement(pe.a,null)),asideContent:r.a.createElement(s.b,{disabled:l,onClick:function(){c({type:"SET_DATE",payload:{date:Object(ue.a)(a.currentDate,1)}})},mode:"secondary"},r.a.createElement(fe.a,null)),style:{textAlign:"center",fontWeight:"bold"}},Object(ie.a)(a.currentDate,"LLLL yyyy",{locale:me.a}).toLocaleUpperCase())))},Oe=a(41),ye=(a(401),a(98)),ge=a.n(ye),je=function(e){var t=e.items,a=e.id,c=e.isSearch,l=void 0!==c&&c,o=Object(n.useContext)(R),i=Object(u.a)(o,2)[1],m=t.map((function(e,t){var a=e.income?e.sum:-1*e.sum,c=function(e){return e&&e.definition?e.definition.definition:null}(e);return r.a.createElement(n.Fragment,{key:t},r.a.createElement("div",{className:"receipt-item",onClick:function(){i({type:"SET_ITEM_TO_EDIT",payload:{item:e}})}},r.a.createElement("span",{className:"receipt-item-name"},c||e.name),e.price&&!l?r.a.createElement("span",{className:"receipt-item-price"},Y.sum(e.price)):null,e.quantity&&!l?r.a.createElement("span",{className:"receipt-item-quantity"},e.quantity):null,e.dateTime&&l?r.a.createElement("span",{className:"receipt-item-dateTime"},Y.date(e.dateTime)):null,a?r.a.createElement("span",{className:"receipt-item-sum"},r.a.createElement(Z,{sum:a})):null))}));return r.a.createElement(ge.a,{id:a,className:"receipt-item-wrapper"},r.a.createElement("div",{className:"receipt-item"},r.a.createElement("span",{className:"receipt-item-name"},"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),l?r.a.createElement("span",{className:"receipt-item-dateTime"},"\u0414\u0430\u0442\u0430"):r.a.createElement(n.Fragment,null,r.a.createElement("span",{className:"receipt-item-price"},"\u0426\u0435\u043d\u0430"),r.a.createElement("span",{className:"receipt-item-quantity"},"\u041a\u043e\u043b-\u0432\u043e")),r.a.createElement("span",{className:"receipt-item-sum"},"\u0421\u0443\u043c\u043c\u0430")),r.a.createElement(s.C,null),m,r.a.createElement(s.C,null),r.a.createElement("div",{className:"receipt-total"},r.a.createElement("span",{className:""},"\u0418\u0442\u043e\u0433\u043e:"),r.a.createElement("span",null,r.a.createElement(Z,{sum:Y.totalSumWithParams(t)}))))},ve=function(e){var t=e.receipts,a=Object(n.useState)(""),c=Object(u.a)(a,2),l=c[0],o=c[1],i=Object(n.useState)([]),m=Object(u.a)(i,2),d=m[0],p=m[1],E=Object(n.useState)([]),f=Object(u.a)(E,2),b=f[0],O=f[1];return Object(n.useEffect)((function(){if(t){var e=[];t.map((function(e){var t=e.dateTime;return e.items.map((function(e){return e.dateTime=t,e}))})).forEach((function(t){e.push.apply(e,Object(Oe.a)(t))})),p(e)}}),[t]),Object(n.useEffect)((function(){O(l?d.filter((function(e){return e.name.toLowerCase().indexOf(l)>-1})):[])}),[l,d]),r.a.createElement(n.Fragment,null,r.a.createElement(s.B,{value:l,onChange:function(e){o(e.target.value.toLowerCase())}}),r.a.createElement(X.a,{title:"\u041f\u043e\u0438\u0441\u043a"},b.length>0&&r.a.createElement(je,{id:b._id,isSearch:!0,items:b})))},he=function(e){var t=e.setReceiptFromBalance,a=Object(n.useState)(!0),c=Object(u.a)(a,2),l=c[0],o=c[1],i=Object(n.useState)(!1),m=Object(u.a)(i,2),d=m[0],p=m[1],E=Object(n.useContext)(R),b=Object(u.a)(E,2),y=b[0],g=b[1],j=L("/day"),v=Object(u.a)(j,2),h=v[0],S=h.response,T=h.isLoading,_=v[1];return Object(n.useEffect)((function(){l&&(_({params:{date:Object(ie.a)(y.currentDate,"yyyy-MM-dd")}}),o(!1))}),[l,o,_,y.currentDate]),Object(n.useEffect)((function(){o(!0),p(!0)}),[y.currentDate]),Object(n.useEffect)((function(){S&&(p(!1),g({type:"SET_RECEIPTS",payload:{receipts:S}}))}),[S,g]),Object(n.useEffect)((function(){if(d&&!T&&S&&!S.length&&Object(ie.a)(y.currentDate,"yyyy.M")===Object(ie.a)(new Date,"yyyy.M")){var e=r.a.createElement(s.a,{actions:[{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,mode:"cancel"},{title:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043e\u0441\u0442\u0430\u0442\u043e\u043a",autoclose:!0,action:function(){return g({type:"SET_PANEL",payload:{panel:"add"}})}}],onClose:function(){return g({type:"SET_POPOUT",payload:{popout:null}})}},r.a.createElement("h2",null,"\u0417\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043c\u0435\u0441\u044f\u0446 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0435\u0442"),r.a.createElement("p",null,"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u043e\u0441\u0442\u0430\u0442\u043e\u043a \u0434\u0435\u043d\u0435\u0436\u043d\u044b\u0445 \u0441\u0440\u0435\u0434\u0441\u0442\u0432, \u0434\u043b\u044f \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0439 \u043a\u0430\u043b\u044c\u043a\u0443\u043b\u044f\u0446\u0438\u0438 \u0431\u0430\u043b\u0430\u043d\u0441\u0430"));g({type:"SET_POPOUT",payload:{popout:e}})}}),[d,T,g,S,y.currentDate]),r.a.createElement(n.Fragment,null,r.a.createElement(f.a,null,r.a.createElement(s.w,{aside:r.a.createElement(s.e,{size:"s",mode:"primary"},"0.8.14")},"\u0411\u0430\u043b\u0430\u043d\u0441")),r.a.createElement(ve,{receipts:y.receipts}),r.a.createElement(s.x,{icon:r.a.createElement(ne.a,null),header:r.a.createElement(Z,{sum:Y.totalReceiptSum(y.receipts),fs:"2em"}),action:r.a.createElement(O.a,{size:"l",onClick:function(e){g({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"add"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0445\u043e\u0434 / \u0440\u0430\u0441\u0445\u043e\u0434")},"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439\u0442\u0435 \u0434\u043e\u0445\u043e\u0434\u044b/\u0440\u0430\u0441\u0445\u043e\u0434\u044b"),r.a.createElement(s.C,null),r.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",paddingTop:"1em"}},r.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-end"}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingRight:"10px"}},r.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em",textAlign:"end"}},"\u0414\u043e\u0445\u043e\u0434\u044b"),r.a.createElement(Z,{sum:Y.totalSum(y.receipts,!0),fs:"1.4em"})),r.a.createElement(ce.a,{width:16,height:40,fill:"#28a745"})),r.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-start"}},r.a.createElement(oe.a,{width:16,height:40,fill:"#dc3545"}),r.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingLeft:"10px"}},r.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em"}},"\u0420\u0430\u0441\u0445\u043e\u0434\u044b"),r.a.createElement(Z,{sum:Y.totalSum(y.receipts,!1),fs:"1.4em"})))),r.a.createElement(X.a,{title:"\u0427\u0435\u043a\u0438"},r.a.createElement(s.p,null,r.a.createElement(be,null),y.receipts.map((function(e,a){return r.a.createElement(te.a,{key:a,expandable:!0,onClick:function(){g({type:"SHOW_MODAL",payload:{modal:"modal-page"}}),t(e)},"data-to":e._id,indicator:r.a.createElement(Z,{sum:e.totalSum})},Y.date(e.dateTime))})))))},Se=a(83),Te=a.n(Se),_e=a(68),we=a.n(_e),Ce=a(230),ke=a.n(Ce),Ie=a(227),Re=a.n(Ie),Pe=a(229),Le=a.n(Pe),xe=a(228),De=a.n(xe),Ae=function(e){var t=e.message,a=e.isError,c=e.onClose,l=Object(n.useState)(null),o=Object(u.a)(l,2),i=o[0],m=o[1],d=Object(n.useContext)(R),p=Object(u.a)(d,2)[1];return Object(n.useEffect)((function(){m(r.a.createElement(s.E,{layout:"vertical",onClose:c,before:a?r.a.createElement(V.a,{size:24,style:{backgroundColor:"var(--destructive)"}},r.a.createElement(De.a,{fill:"#fff",width:18,height:18})):r.a.createElement(V.a,{size:24,style:{backgroundColor:"var(--accent)"}},r.a.createElement(G.a,{fill:"#fff",width:18,height:18}))},t))}),[m,p,a,t,c]),i},Ne=function(){var e=Object(n.useContext)(R),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)((function(){return a.item||null})),o=Object(u.a)(l,2),m=o[0],d=o[1],p=Object(n.useState)((function(){return(null===m||void 0===m?void 0:m.name)||""})),E=Object(u.a)(p,2),b=E[0],y=E[1],g=Object(n.useState)((function(){var e=(null===m||void 0===m?void 0:m.dateTime)||new Date;return Object(ie.a)(new Date(e),"yyyy-MM-dd")})),j=Object(u.a)(g,2),v=j[0],h=j[1],S=Object(n.useState)((function(){return(null===m||void 0===m?void 0:m.quantity)||1})),T=Object(u.a)(S,2),_=T[0],C=T[1],k=Object(n.useState)(!0),I=Object(u.a)(k,2),P=I[0],x=I[1],D=Object(n.useState)((function(){return(null===m||void 0===m?void 0:m.price)/100||""})),A=Object(u.a)(D,2),N=A[0],U=A[1],W=Object(n.useState)(!0),z=Object(u.a)(W,2),V=z[0],H=z[1],G=Object(n.useState)((function(){return(null===m||void 0===m?void 0:m.income)||!1})),K=Object(u.a)(G,2),q=K[0],B=K[1],J=Object(n.useState)((function(){return(null===m||void 0===m?void 0:m.description)||""})),Q=Object(u.a)(J,2),Z=Q[0],$=Q[1],X=Object(n.useState)((function(){return(null===m||void 0===m?void 0:m.groups)||[]})),ee=Object(u.a)(X,2),te=ee[0],ae=ee[1],ne=Object(n.useState)(null),re=Object(u.a)(ne,2),ce=re[0],le=re[1],oe=Object(n.useState)(null),ue=Object(u.a)(oe,2),se=ue[0],me=ue[1],de=L("/day"),pe=Object(u.a)(de,2),Ee=pe[0],fe=Ee.response,be=Ee.error,Oe=pe[1],ye=L("/day/receipt"),je=Object(u.a)(ye,2),ve=je[0],he=je[1],Se=Object(n.useState)(!1),_e=Object(u.a)(Se,2),Ce=_e[0],Ie=_e[1],Pe=Object(n.useState)(!1),xe=Object(u.a)(Pe,2),De=xe[0],Ne=xe[1],Ue=Object(n.useState)(!1),Fe=Object(u.a)(Ue,2),We=Fe[0],Me=Fe[1],ze=Object(s.K)(),Ve=Object(n.useCallback)((function(){c({type:"UNSET_ERROR"}),le(null)}),[c]);Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppOpenCodeReaderResult":me(n.code_data);break;case"VKWebAppOpenCodeReaderFailed":console.log("add day error",n)}}))}),[]),Object(n.useEffect)((function(){if(Ce){var e={method:"POST",date:v,items:[{name:b,quantity:_,price:100*N,sum:100*N*_,income:q,modifiers:[],properties:[],description:Z,groups:te,canDelete:!0}]};e.method=m?"PUT":e.method,e.method=We?"DELETE":e.method,m&&m._id&&(e.id=m._id),Oe(e),d(null),y(""),C(1),B(!1),U(""),Ie(!1),$(""),ae([]),Me(!1)}}),[Ce,Ie,v,Oe,q,b,N,m,_,Z,te,We]),Object(n.useEffect)((function(){fe&&le(r.a.createElement(Ae,{message:"\u0423\u0441\u043f\u0435\u0448\u043d\u043e",isError:!1,onClose:Ve}))}),[fe,Ve]),Object(n.useEffect)((function(){if(se){var e=Y.qr(se);if(e.error){var t=e.error;return c({type:"SET_ERROR",payload:{error:t}}),me(null),void Ne(!1)}var a=Object(w.a)({method:"POST"},e);he(a)}}),[se,he,De,c]),Object(n.useEffect)((function(){ve.response&&ve.response._id&&(le(r.a.createElement(Ae,{message:"\u0423\u0441\u043f\u0435\u0448\u043d\u043e",isError:!1,onClose:Ve})),Ne(!1),me(null))}),[ve.response,he,se,Ve]),Object(n.useEffect)((function(){a.error&&(c({type:"SET_ERROR",payload:{error:ve.error||be}}),le(r.a.createElement(Ae,{message:a.error.message,isError:!0,onClose:Ve})),Ne(!1),me(null))}),[ve.error,be,c,a.error,Ve]);var He=r.a.createElement(s.a,{actions:[{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,mode:"cancel"},{title:"\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c",autoclose:!0,action:function(){return c({type:"SET_VIEW",payload:{view:"profile",panel:"edit"}})}}],onClose:function(){return c({type:"SET_POPOUT",payload:{popout:null}})}},r.a.createElement("h2",null,"\u041d\u0435\u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d \u043f\u0440\u043e\u0444\u0438\u043b\u044c"),r.a.createElement("p",null,"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f QR \u043a\u043e\u0434\u043e\u0432 \u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u043e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043f\u043e \u0447\u0435\u043a\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0437\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c, \u0432\u0432\u0435\u0441\u0442\u0438 email, \u0442\u0435\u043b\u0435\u0444\u043e\u043d \u0438 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0424\u041d\u0421.")),Ge=r.a.createElement(s.a,{actions:[{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,mode:"cancel"},{title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",autoclose:!0,mode:"destructive",action:function(){Me(!0),Ie(!0)}}],onClose:function(){return c({type:"SET_POPOUT",payload:{popout:null}})}},r.a.createElement("h2",null,"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435"),r.a.createElement("p",null,"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c? \u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0439\u0434\u0435\u0442 \u0431\u0435\u0437\u0432\u043e\u0437\u0432\u0440\u0430\u0442\u043d\u043e. \u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e \u0431\u0443\u0434\u0435\u0442 \u043d\u0435\u043b\u044c\u0437\u044f."));return r.a.createElement(n.Fragment,null,r.a.createElement(f.a,{left:r.a.createElement(we.a,{key:"back",onClick:function(e){c({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"home"},ze===s.n?r.a.createElement(F.a,null):r.a.createElement(M.a,null))},r.a.createElement(Le.a,{before:i.a.supports("VKWebAppOpenCodeReader")&&r.a.createElement(we.a,{key:"qr","data-to":"qr",onClick:function(){c({type:"UNSET_ERROR"}),a.currentUser.email&&a.currentUser.phone&&a.currentUser.password?i.a.send("VKWebAppOpenCodeReader",{}):c({type:"SET_POPOUT",payload:{popout:He}})}},r.a.createElement(Re.a,null))},m?"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 '".concat(m.name,"'"):"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c")),r.a.createElement(ge.a,{style:{paddingBottom:40}},function(e){return e?null:r.a.createElement(Te.a,{type:"date",top:"\u0414\u0430\u0442\u0430",name:"date",value:v,onChange:function(e){e.currentTarget.value&&h(e.currentTarget.value)}})}(m),r.a.createElement(ke.a,{name:"income",checked:q,onChange:function(e){return B(e.currentTarget.checked)}},"\u0414\u043e\u0445\u043e\u0434"),r.a.createElement(Te.a,{type:"text",top:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"name",value:b,onChange:function(e){y(e.currentTarget.value)}}),r.a.createElement(Te.a,{className:"number-input",type:"number",top:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",name:"quantity",pattern:"[0-9]*[.,]?[0-9]+",value:_,status:P?"valid":"error",bottom:P?null:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435",onChange:function(e){x(e.currentTarget.validity.valid),C(e.currentTarget.value)},step:"0.000000001"}),r.a.createElement(Te.a,{className:"number-input",type:"number",top:"\u0426\u0435\u043d\u0430",name:"price",pattern:"[0-9.]*",value:N,status:V?"valid":"error",bottom:V?null:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435",onChange:function(e){H(e.currentTarget.validity.valid),U(e.currentTarget.value)},step:"0.001"}),!q&&r.a.createElement(s.I,{top:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",placeholder:"\u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u044b \u043f\u043e\u0442\u0440\u0430\u0442\u0438\u043b\u0438 \u043d\u0430 \u044d\u0442\u043e \u0434\u0435\u043d\u044c\u0433\u0438?",name:"description",value:Z,onChange:function(e){return $(e.currentTarget.value)}}),(null===m||void 0===m?void 0:m.canDelete)&&r.a.createElement(O.a,{size:"xl",mode:"destructive",onClick:function(){c({type:"SET_POPOUT",payload:{popout:Ge}})}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c ",q?"\u0434\u043e\u0445\u043e\u0434":"\u0440\u0430\u0441\u0445\u043e\u0434"),r.a.createElement(s.h,{style:{marginBottom:"1em"},vertical:"bottom"},m?r.a.createElement(O.a,{size:"xl",disabled:!v||!b||!_||!N,mode:"commerce",onClick:function(){return Ie(!0)}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"):r.a.createElement(O.a,{size:"xl",disabled:!v||!b||!_||!N,mode:"commerce",onClick:function(){Ie(!0)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c ",q?"\u0434\u043e\u0445\u043e\u0434":"\u0440\u0430\u0441\u0445\u043e\u0434"))),ce)},Ue=function(e){var t=e.receipt;return r.a.createElement(s.p,null,r.a.createElement(je,{id:t._id,dateTime:t.dateTime,items:t.items}))},Fe=a(80),We=a.n(Fe),Me=a(231),ze=a.n(Me),Ve=a(232),He=a.n(Ve),Ge=a(233),Ke=a.n(Ge),qe=a(234),Be=a.n(qe),Je=a(235),Qe=a.n(Je),Ye=a(236),Ze=a.n(Ye),$e=function(){return r.a.createElement(n.Fragment,null,r.a.createElement(s.u,null,"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0430"),r.a.createElement(s.x,null,"\u0420\u0430\u0437\u0434\u0435\u043b \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435"))},Xe=a(237),et=a.n(Xe),tt=function(){var e=Object(n.useContext)(R),t=Object(u.a)(e,2),a=t[0],c=t[1],l=L("/day"),o=Object(u.a)(l,2),m=o[0],d=m.response,p=m.error,E=o[1],f=Object(s.K)(),b=Object(n.useState)((function(){var e=new Date,t=e.getMonth()+1>9?e.getMonth()+1:"0".concat(e.getMonth()+1),a=e.getDate()>9?e.getDate():"0".concat(e.getDate());return"".concat(e.getFullYear(),"-").concat(t,"-").concat(a)})),O=Object(u.a)(b,1)[0],y=Object(n.useState)(null),g=Object(u.a)(y,2),j=g[0],v=g[1];Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppOpenPayFormResult":if(n.status){console.log("\u041f\u043b\u0430\u0442\u0435\u0436 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d");var r={method:"POST",date:O,items:[{name:"\u041f\u043e\u043c\u043e\u0449\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0443 Balance",quantity:1,price:100*n.amount,sum:100*n.amount,income:!1,modifiers:[],properties:[{transactionId:n.transaction_id}]}]};E(r)}break;case"VKWebAppOpenPayFormFailed":console.log("profile error",n)}}))}));var h=Object(n.useCallback)((function(){c({type:"UNSET_ERROR"}),v(null)}),[c]);return Object(n.useEffect)((function(){d&&v(r.a.createElement(Ae,{message:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u043f\u043e\u043c\u043e\u0449\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0443!",isError:!1,onClose:h}))}),[d,h]),Object(n.useEffect)((function(){a.error&&(c({type:"SET_ERROR",payload:{error:p}}),v(r.a.createElement(Ae,{message:a.error.message,isError:!0,onClose:h})))}),[p,c,a.error,h]),r.a.createElement(n.Fragment,null,r.a.createElement(s.u,null,"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e"),f!==s.n&&r.a.createElement(s.l,null,r.a.createElement(s.m,{mode:"secondary"},"\u041f\u043e\u043c\u043e\u0449\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0443"),r.a.createElement(s.D,{"data-panel":"catalog",expandable:!0,before:r.a.createElement(et.a,null),onClick:function(){i.a.send("VKWebAppOpenPayForm",{app_id:7252987,action:"pay-to-user",params:{amount:100,description:"\u041d\u0430 \u043a\u043e\u0444\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443",user_id:3479465}})}},"\u041d\u0430 \u043a\u043e\u0444\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443")),j)},at=a(238),nt=a.n(at),rt=a(134),ct=a.n(rt),lt=a(239),ot=a.n(lt),it={catalog:[],filteredCatalog:[],catalogToSave:new Set,filterItems:[],editedElementId:"",openFilter:!1,filterRules:[]},ut=function(e,t){switch(t.type){case"SET_CATALOG":var a=e.filterRules.map((function(t){return e.catalog.filter((function(e){return e.definition===t&&e}))})).flat();return Object(w.a)({},e,{catalog:t.payload.catalog,filteredCatalog:a&&a.length>0?a:t.payload.catalog,filterRules:a&&a.length>0?e.filterRules:[],catalogToSave:new Set,editedElementId:""});case"SET_EDITED_ELEMENT":return Object(w.a)({},e,{editedElementId:t.payload.id});case"FILL_SAVE_CATALOG":var n,r=e.catalog.findIndex((function(e){return e._id===t.payload.id}));t.payload.definition&&((n=e.catalog[r]).definition=t.payload.definition);var c=new Set(e.catalogToSave);return c.add(n),Object(w.a)({},e,{catalogToSave:c});case"ERASE_FILTER_RULES":return Object(w.a)({},e,{filterRules:[],openFilter:!1,filteredCatalog:e.catalog});case"SET_FILTER_ITEMS":var l=e.catalog.map((function(e){return e.definition?e.definition:"*\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438"})).reduce((function(e,t){return e.includes(t)?e:[].concat(Object(Oe.a)(e),[t])}),[]);return Object(w.a)({},e,{filterItems:l});case"SET_FILTER_RULES":var o=e.filterRules,i=e.filterRules.length>0?e.filteredCatalog:[];if(t.payload.checked){o=[].concat(Object(Oe.a)(o),[t.payload.definition]);var u=e.catalog.filter((function(e){return e.definition===t.payload.definition}));i=[].concat(Object(Oe.a)(i),Object(Oe.a)(u))}else o.splice(o.findIndex((function(e){return e===t.payload.definition})),1),i=o.map((function(t){return e.catalog.filter((function(e){return e.definition===t&&e}))})).flat();return Object(w.a)({},e,{filteredCatalog:i,filterRules:o});case"OPEN_FILTER":return Object(w.a)({},e,{openFilter:!0});case"CLOSE_FILTER":return Object(w.a)({},e,{openFilter:!1});default:return e}},st=function(){var e=Object(n.useReducer)(ut,it),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(""),o=Object(u.a)(l,2),i=o[0],m=o[1],d=L("/catalog".concat(i)),p=Object(u.a)(d,2),E=p[0].response,f=p[1],b=Object(n.useState)(!0),O=Object(u.a)(b,2),y=O[0],g=O[1],j=Object(n.useState)("get"),v=Object(u.a)(j,1)[0],h=a.filteredCatalog.map((function(e,t){return r.a.createElement(n.Fragment,{key:t},r.a.createElement(s.z,{"data-id":e._id,multiline:!0,caption:e.name,after:r.a.createElement(nt.a,null),bottom:a.editedElementId===e._id&&r.a.createElement(s.o,{id:a.editedElementId,type:"text",defaultValue:e.definition,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0443",onChange:function(e){c({type:"FILL_SAVE_CATALOG",payload:{id:a.editedElementId,definition:e.target.value}})}}),onClick:function(e){c({type:"SET_EDITED_ELEMENT",payload:{id:e.currentTarget.dataset.id}})},actions:r.a.createElement(n.Fragment,null,r.a.createElement(s.b,{disabled:!0,style:{display:"none"}},r.a.createElement(ct.a,null)),r.a.createElement(s.b,{disabled:!0,style:{display:"none"},mode:"secondary"},r.a.createElement(ct.a,null)))},r.a.createElement("b",null,e.definition?e.definition:"\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438")))})),S=a.filterItems.map((function(e,t){var n="*\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438"!==e?a.filterRules.includes(e):a.filterRules.includes(void 0);return r.a.createElement(s.D,{key:t,after:r.a.createElement(s.F,{"data-definition":e,onChange:function(e){var t=e.currentTarget.dataset.definition,a=e.currentTarget.checked;c({type:"SET_FILTER_RULES",payload:{checked:a,definition:"*\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438"!==t?t:void 0}})},defaultChecked:n})},e)}));Object(n.useEffect)((function(){a.editedElementId&&document.getElementById(a.editedElementId).focus()}),[a.editedElementId]),Object(n.useEffect)((function(){if(i||y){var e={};y&&(e.params={a:v}),i&&(e.method="PUT",e.update=Object(Oe.a)(a.catalogToSave)),f(e)}}),[i,a.catalogToSave,f,y,v]),Object(n.useEffect)((function(){E&&(c({type:"SET_CATALOG",payload:{catalog:E}}),c({type:"SET_FILTER_ITEMS"}),m(""),g(!1))}),[E]);var T={paddingTop:0!==a.filterRules.length&&60,paddingBottom:(0!==Object(Oe.a)(a.catalogToSave).length||0!==a.filterRules.length&&a.openFilter)&&60},_={paddingRight:10,paddingLeft:10,marginBottom:"1em",marginTop:"1em"};return r.a.createElement(n.Fragment,null,r.a.createElement(s.u,{left:r.a.createElement(s.v,{onClick:function(){a.openFilter?c({type:"CLOSE_FILTER"}):c({type:"OPEN_FILTER"})}},r.a.createElement(ot.a,null))},a.openFilter?"\u0424\u0438\u043b\u044c\u0442\u0440":"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a"),r.a.createElement(s.l,{style:T},a.openFilter?S:h),0!==a.filterRules.length&&r.a.createElement(s.h,{style:_,vertical:"top"},r.a.createElement(s.C,{wide:!0}),r.a.createElement(s.b,{mode:"destructive",size:"xl",onClick:function(){c({type:"ERASE_FILTER_RULES"})}},"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440")),0!==Object(Oe.a)(a.catalogToSave).length&&r.a.createElement(s.h,{style:_,vertical:"bottom"},r.a.createElement(s.C,{wide:!0}),r.a.createElement(s.b,{mode:"commerce",size:"xl",onClick:function(){m("/update")}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f")),0!==a.filterRules.length&&a.openFilter&&r.a.createElement(s.h,{style:_,vertical:"bottom"},r.a.createElement(s.C,{wide:!0}),r.a.createElement(s.b,{mode:"commerce",size:"xl",onClick:function(){c({type:"CLOSE_FILTER"})}},"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440")))},mt=a(240),dt=a.n(mt),pt={shoppingList:[],shoppingItem:{text:"",done:!1},date:new Date},Et=function(e,t){switch(t.type){case"INITIAL_SHOPPING_LIST":return Object(w.a)({},e,{shoppingList:t.payload.list});case"SET_SHOPPING_ITEM":return Object(w.a)({},e,{shoppingItem:{text:t.payload.text,done:!1}});case"ADD_ITEM":var a=e.shoppingList;return e.shoppingItem.text?Object(w.a)({},e,{shoppingList:[].concat(Object(Oe.a)(a),[e.shoppingItem]),shoppingItem:{text:"",done:!1}}):e;case"DELETE_ITEM":var n=e.shoppingList;return n.splice(t.payload.index,1),Object(w.a)({},e,{shoppingList:n});case"SET_DONE":var r=e.shoppingList;return r[t.payload.index].done=!r[t.payload.index].done,Object(w.a)({},e,{shoppingList:r});default:return e}},ft=function(){var e=S("shoppingList",JSON.stringify([])),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useReducer)(Et,pt),o=Object(u.a)(l,2),i=o[0],m=o[1],d=i.shoppingList.map((function(e,t){return r.a.createElement(s.D,{key:t,after:r.a.createElement(dt.a,{"data-index":t,onClick:function(e){m({type:"DELETE_ITEM",payload:{index:e.currentTarget.dataset.index}})}})},r.a.createElement(s.d,{defaultChecked:e.done,"data-index":t,style:{textDecoration:e.done&&"line-through"},onChange:function(e){m({type:"SET_DONE",payload:{index:e.currentTarget.dataset.index}})}},e.text))}));return Object(n.useEffect)((function(){m({type:"INITIAL_SHOPPING_LIST",payload:{list:JSON.parse(a)}})}),[a]),Object(n.useEffect)((function(){0!==i.shoppingList.length&&c(JSON.stringify(i.shoppingList))}),[c,i]),r.a.createElement(n.Fragment,null,r.a.createElement(s.u,null,"\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043a\u0443\u043f\u043e\u043a"),r.a.createElement(s.i,{onSubmit:function(e){e.preventDefault(),m({type:"ADD_ITEM"})}},r.a.createElement(s.o,{type:"text",top:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",name:"shopping-item",value:i.shoppingItem.text,onChange:function(e){m({type:"SET_SHOPPING_ITEM",payload:{text:e.currentTarget.value}})},placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"})),r.a.createElement(s.l,null,i.shoppingList.length>0?d:r.a.createElement(s.x,null,"\u0412\u0430\u0448 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043a\u0443\u043f\u043e\u043a \u043f\u0443\u0441\u0442.")))},bt=function(){var e=Object(n.useContext)(R),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(null),o=Object(u.a)(l,2),i=o[0],m=o[1],d=Object(n.useState)(null),p=Object(u.a)(d,2),E=p[0],f=p[1],b=Object(n.useState)(null),O=Object(u.a)(b,2),y=O[0],g=O[1],j=Object(n.useCallback)((function(){c({type:"HIDE_MODAL"})}),[c]);Object(n.useEffect)((function(){window.onpopstate=function(e){c({type:"SET_VIEW",payload:{panel:e.state.panel,view:e.state.view}})}}),[c]),Object(n.useEffect)((function(){if(y){var e=Object(s.K)();f(r.a.createElement(s.s,{activeModal:a.modal,onClose:j},r.a.createElement(s.q,{id:"modal-page",onClose:j,header:r.a.createElement(s.r,{left:e!==s.n&&r.a.createElement(we.a,{onClick:j},r.a.createElement(We.a,null)),right:e===s.n&&r.a.createElement(we.a,{onClick:j},e===s.n?"\u0413\u043e\u0442\u043e\u0432\u043e":r.a.createElement(ze.a,null))},Y.date(y.dateTime))},r.a.createElement(Ue,{onClose:j,receipt:y}))))}}),[y,i,j,a.modal]);var v=function(e){c({type:"SET_VIEW",payload:{view:e.currentTarget.dataset.story,panel:e.currentTarget.dataset.panel}})},h=a.currentUser&&r.a.createElement(s.G,null,r.a.createElement(s.H,{onClick:v,selected:"balance"===a.view&&"balance.home"===a.panel,"data-story":"balance","data-panel":"home",text:"\u0411\u0430\u043b\u0430\u043d\u0441"},r.a.createElement(He.a,null)),r.a.createElement(s.H,{onClick:v,selected:"list"===a.view,"data-story":"list","data-panel":"list",text:"\u041f\u043e\u043a\u0443\u043f\u043a\u0438"},r.a.createElement(Ze.a,null)),r.a.createElement(s.H,{onClick:v,selected:"balance"===a.view&&"balance.add"===a.panel,"data-story":"balance","data-panel":"add",text:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"},r.a.createElement(Qe.a,null)),r.a.createElement(s.H,{onClick:v,selected:"profile"===a.view,"data-story":"profile","data-panel":"edit",text:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"},r.a.createElement(Be.a,null)),r.a.createElement(s.H,{onClick:v,selected:"more"===a.view,"data-story":"more","data-panel":"more",text:"\u0415\u0449\u0451"},r.a.createElement(Ke.a,null)));return r.a.createElement(s.g,{activeStory:a.view,tabbar:h},r.a.createElement(s.J,{id:"authorization",activePanel:a.panel,popout:a.popout},r.a.createElement(s.t,{id:"authorization.login"},r.a.createElement(N,{type:"login"})),r.a.createElement(s.t,{id:"authorization.register"},r.a.createElement(N,{type:"register"}))),r.a.createElement(s.J,{id:"profile",activePanel:a.panel,popout:a.popout},r.a.createElement(s.t,{id:"profile.edit"},r.a.createElement(B,null))),r.a.createElement(s.J,{id:"balance",activePanel:a.panel,popout:a.popout,modal:E},r.a.createElement(s.t,{id:"balance.home"},r.a.createElement(he,{setReceiptFromBalance:g,onClickActiveModal:m})),r.a.createElement(s.t,{id:"balance.add"},r.a.createElement(Ne,{item:a.item}))),r.a.createElement(s.J,{id:"analytics",activePanel:a.panel,popout:a.popout},r.a.createElement(s.t,{id:"analytics.home"},r.a.createElement($e,null))),r.a.createElement(s.J,{id:"more",activePanel:a.panel,popout:a.popout},r.a.createElement(s.t,{id:"more.more"},r.a.createElement(tt,null)),r.a.createElement(s.t,{id:"more.catalog"},r.a.createElement(st,null))),r.a.createElement(s.J,{id:"list",activePanel:a.panel,popout:a.popout},r.a.createElement(s.t,{id:"list.list"},r.a.createElement(ft,null))))},Ot=Object(n.createContext)([{},function(e){}]),yt=function(e){var t=e.children,a=Object(n.useState)({isLoading:!1,isLoggedIn:null,currentUser:null}),c=Object(u.a)(a,2),l=c[0],o=c[1];return r.a.createElement(Ot.Provider,{value:[l,o]},t)},gt=a(135),jt=a.n(gt),vt=a(241),ht=a.n(vt),St=function(e){var t=e.children,a=Object(n.useContext)(R),r=Object(u.a)(a,2)[1],c=function(){var e=Object(n.useState)(""),t=Object(u.a)(e,2),a=t[0],r=t[1],c=Object(n.useState)(!1),l=Object(u.a)(c,2),o=l[0],i=l[1],s=Object(n.useState)(null),m=Object(u.a)(s,2),d=m[0],p=m[1],E=Object(n.useState)(!1),f=Object(u.a)(E,2),b=f[0],O=f[1];return Object(n.useEffect)((function(){if(o){var e=jt.a.parse(a);if(e){p(e.vk_user_id);var t={};Object.keys(e).sort().forEach((function(a){"vk_"===a.slice(0,3)&&(t[a]=e[a])}));var n=jt.a.stringify(t),r=ht.a.createHmac("sha256","Zs6DYRE8Z2mZ44LfciKW").update(n).digest().toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=$/,"");O(r===e.sign)}}}),[o,a]),[{vkUserId:d,matchUrlParams:b},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";r(e),i(!0)}]}(),l=Object(u.a)(c,2),o=l[0],i=o.vkUserId,s=o.matchUrlParams,m=l[1];return Object(n.useEffect)((function(){m(window.location.search.slice(1))}),[m]),Object(n.useEffect)((function(){i&&r({type:"SET_VK_USER",payload:{id:i,match:s}})}),[i,s,r]),t},Tt=function(e){var t=e.children,a=L("/users/profile"),r=Object(u.a)(a,2),c=r[0].response,l=r[1],o=L("/users/find"),i=Object(u.a)(o,2),s=i[0],m=i[1],d=Object(n.useContext)(R),p=Object(u.a)(d,2),E=p[0],f=p[1],b=S("token"),O=Object(u.a)(b,1)[0];return Object(n.useEffect)((function(){!O&&E.vkUser.matchUrlParams&&E.vkUser.id&&(m({params:{id:E.vkUser.id}}),f({type:"SHOW_LOADING"}))}),[O,E.vkUser.matchUrlParams,E.vkUser.id,f,m]),Object(n.useEffect)((function(){s.response&&(s.response.result?f({type:"SET_VIEW",payload:{view:"authorization",panel:"login"}}):f({type:"SET_VIEW",payload:{view:"authorization",panel:"register"}}),f({type:"HIDE_LOADING"}))}),[s.response,f]),Object(n.useEffect)((function(){O&&E.vkUser.matchUrlParams?(l(),f({type:"SHOW_LOADING"})):f({type:"SET_USER",payload:{user:null,isLoggedIn:!1}})}),[l,O,E.vkUser.matchUrlParams,f]),Object(n.useEffect)((function(){if(c){var e=c.user.vk_id.toString()===E.vkUser.id?c.user:null;f({type:"SET_USER",payload:{user:e,isLoggedIn:!!e}})}}),[c,E.vkUser.id,f]),t};i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;if("VKWebAppUpdateConfig"===a){var r=document.createAttribute("scheme");r.value=n.scheme?n.scheme:"client_light",document.body.attributes.setNamedItem(r)}})),i.a.send("VKWebAppInit"),window.onload=function(){l.a.render(r.a.createElement(P,null,r.a.createElement(St,null,r.a.createElement(yt,null,r.a.createElement(Tt,null,r.a.createElement(bt,null))))),document.getElementById("root"))}}},[[285,1,2]]]);
//# sourceMappingURL=main.b60a1939.chunk.js.map