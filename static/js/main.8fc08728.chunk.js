(this["webpackJsonpvk-mini-apps-empty"]=this["webpackJsonpvk-mini-apps-empty"]||[]).push([[0],{236:function(e,t,n){e.exports=n(416)},327:function(e,t){},329:function(e,t){},362:function(e,t){},363:function(e,t){},416:function(e,t,n){"use strict";n.r(t);n(237),n(263),n(265),n(266),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(277),n(278),n(279),n(280),n(281),n(282),n(283),n(284),n(285),n(286),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(299),n(300),n(301),n(302),n(303),n(304),n(305);var a=n(0),c=n.n(a),r=n(102),o=n.n(r),i=n(39),u=n.n(i),l=n(9),s=(n(313),n(17)),f=n(103),b=n.n(f),m=n(172),d=n(178),j=n(177),O=n.n(j),g=n(105),h=n.n(g),p=n(173),v=n.n(p),E=n(174),S=n.n(E),k=n(179),y=n(104),I=n.n(y),w=n(175),U=n.n(w),C=Object(a.createContext)([{},function(){}]),z=Object(a.createContext)([{},function(e){}]),P=n(176),x=n.n(P),L=function(e){var t=e.go,n=e.type,r=e.loadIndicator,o=Object(a.useState)(""),i=Object(l.a)(o,2),u=i[0],f=i[1],j=Object(a.useState)(""),g=Object(l.a)(j,2),p=g[0],E=g[1],y=Object(a.useState)(null),I=Object(l.a)(y,2),w=I[0],U=I[1],P=function(e){var t=Object(a.useState)(!1),n=Object(l.a)(t,2),c=n[0],r=n[1],o=Object(a.useState)(null),i=Object(l.a)(o,2),u=i[0],s=i[1],f=Object(a.useState)(null),b=Object(l.a)(f,2),m=b[0],d=b[1],j=Object(a.useState)({}),O=Object(l.a)(j,2),g=O[0],h=O[1],p="http://localhost:3000/api",v=Object(a.useCallback)((function(e){h(e),r(!0)}),[]),E=g.method,S=g.token,y=Object(k.a)(g,["method","token"]);return Object(a.useEffect)((function(){if(c){var t={"Content-Type":"application/json",Authorization:S?"Token ".concat(S):""};fetch("".concat(p).concat(e),{method:E,mode:"cors",headers:t,body:"GET"!==E?JSON.stringify(y):null}).then((function(e){return e.json()})).then((function(e){r(!1),s(e)})).catch((function(e){r(!1),d(e)}))}}),[c,y,E,e,p,S]),[{isLoading:c,response:u,error:m},v]}("/users/".concat(n)),L=Object(l.a)(P,2),T=L[0],V=T.response,_=T.error,A=L[1],J=Object(a.useContext)(C),K=Object(l.a)(J,1)[0].vkUserId,W=Object(a.useState)(!1),Z=Object(l.a)(W,2),N=Z[0],B=Z[1],D=Object(a.useContext)(z),F=Object(l.a)(D,2)[1];Object(a.useEffect)((function(){"login"!==n&&(u.length===p.length?u!==p&&U({status:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438",message:"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0432\u0432\u043e\u0434 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443."}):U(null))}),[u,p,n]),Object(a.useEffect)((function(){N&&(A({method:"POST",user:{id:+K,password:u}}),B(!1))}),[N,A,u,K]),Object(a.useEffect)((function(){V&&(!V.user&&V.error&&U(V.error),F((function(e){return Object(d.a)({},e,{isLoading:!1,isLoggedIn:!!V.user,currentUser:V.user||null})})),r(null))}),[V,F,r]),Object(a.useEffect)((function(){_&&(U(_),r(null))}),[_,r]);var G=function(e){e.target.value=Math.max(0,parseInt(e.target.value)).toString().slice(0,4),"password"===e.target.name?f(e.target.value):E(e.target.value)},H=function(){var e=Object(m.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B(!0),r(c.a.createElement(x.a,{size:"large"}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return c.a.createElement(a.Fragment,null,c.a.createElement(O.a,null,"login"===n?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),c.a.createElement(s.g,{icon:"login"===n?c.a.createElement(v.a,null):c.a.createElement(S.a,null),header:"login"===n?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c":"\u041f\u0440\u0438\u0434\u0443\u043c\u0430\u0439\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.b,null,w?c.a.createElement(s.d,{header:w.status,mode:"error"},w.message):null,c.a.createElement(s.c,{top:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.e,{name:"password",type:"number",onChange:G,align:"center",value:u})),"login"!==n?c.a.createElement(s.c,{top:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.e,{type:"number",name:"confirmPassword",onChange:G,align:"center",value:p})):null,c.a.createElement(h.a,{size:"l",onClick:H},"login"===n?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"))),c.a.createElement(s.a,null,c.a.createElement(h.a,{stretched:!0,mode:"tertiary",onClick:t,"data-to":"login"===n?"authorization.registration":"authorization.login"},"login"===n?"\u041d\u0435\u0442 \u043f\u0430\u0440\u043e\u043b\u044f?":"\u0415\u0441\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c?")))},T=function(){var e=Object(a.useState)("authorization.login"),t=Object(l.a)(e,2),n=t[0],r=t[1],o=Object(a.useState)("authorization"),i=Object(l.a)(o,2),u=i[0],f=i[1],b=Object(a.useState)(null),m=Object(l.a)(b,2),d=m[0],j=m[1],O=function(e){r(e.currentTarget.dataset.to)},g=function(e){f(e.currentTarget.dataset.to)},h=function(e){j(e)};return c.a.createElement(s.h,{activeView:u},c.a.createElement(s.i,{id:"authorization",activePanel:n,popout:d},c.a.createElement(s.f,{id:"authorization.login"},c.a.createElement(L,{go:O,type:"login",goView:g,loadIndicator:h})),c.a.createElement(s.f,{id:"authorization.registration"},c.a.createElement(L,{go:O,type:"register",goView:g,loadIndicator:h}))))},V=function(e){var t=e.children;return Object(a.useEffect)((function(){u.a.subscribe((function(e){var t=e.detail,n=t.type,a=t.data;if("VKWebAppUpdateConfig"===n){var c=document.createAttribute("scheme");c.value=a.scheme?a.scheme:"client_light",document.body.attributes.setNamedItem(c)}}))}),[]),t};u.a.send("VKWebAppInit"),o.a.render(c.a.createElement(V,null,c.a.createElement((function(e){var t=e.children,n=function(){var e=Object(a.useState)(""),t=Object(l.a)(e,2),n=t[0],c=t[1],r=Object(a.useState)(!1),o=Object(l.a)(r,2),i=o[0],u=o[1],s=Object(a.useState)(null),f=Object(l.a)(s,2),b=f[0],m=f[1],d=Object(a.useState)(!1),j=Object(l.a)(d,2),O=j[0],g=j[1];return Object(a.useEffect)((function(){if(i){var e=I.a.parse(n);if(e){m(e.vk_user_id);var t={};Object.keys(e).sort().forEach((function(n){"vk_"===n.slice(0,3)&&(t[n]=e[n])}));var a=I.a.stringify(t),c=U.a.createHmac("sha256","Zs6DYRE8Z2mZ44LfciKW").update(a).digest().toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=$/,"");g(c===e.sign)}}}),[i,n]),[{vkUserId:b,matchUrlParams:O},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";c(e),u(!0)}]}(),r=Object(l.a)(n,2),o=r[0],i=o.vkUserId,u=o.matchUrlParams,s=r[1],f=Object(a.useState)({vkUserId:null,matchUrlParams:!1}),b=Object(l.a)(f,2),m=b[0],d=b[1];return Object(a.useEffect)((function(){s(window.location.search.slice(1))}),[s]),Object(a.useEffect)((function(){i&&d({vkUserId:i,matchUrlParams:u})}),[i,u]),c.a.createElement(C.Provider,{value:[m,d]},t)}),null,c.a.createElement((function(e){var t=e.children,n=Object(a.useState)({isLoading:!1,isLoggedIn:null,currentUser:null}),r=Object(l.a)(n,2),o=r[0],i=r[1];return c.a.createElement(z.Provider,{value:[o,i]},t)}),null,c.a.createElement(T,null)))),document.getElementById("root"))}},[[236,1,2]]]);
//# sourceMappingURL=main.8fc08728.chunk.js.map