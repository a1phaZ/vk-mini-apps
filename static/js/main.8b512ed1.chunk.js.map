{"version":3,"sources":["hooks/useLocalStorage.js","contexts/routerContext.js","hooks/useApi.js","contexts/appSign.js","hooks/useCompareSign.js","contexts/currentUser.js","components/Dialer.js","panels/Authorization.js","panels/Profile.js","handlers/prepare.js","components/ColoredSum.js","components/Calendar.js","components/Receipt/index.js","components/Receipt/receipt.js","components/search/index.js","components/search/SearchComponent.js","panels/Balance.js","components/CustomSnackbar.js","panels/AddDay.js","components/Modal.js","panels/Registration.js","panels/Analytics.js","panels/More.js","panels/Catalog.js","panels/ShoppingList.js","App.js","components/CurrentUserChecker.js","index.js"],"names":["key","initialValue","useState","localStorage","getItem","value","setValue","useEffect","setItem","initialState","view","panel","popout","error","password","confirmPassword","reducer","state","action","type","payload","length","digit","RouterContext","createContext","RouterContextProvider","children","useReducer","Provider","url","isLoading","setIsLoading","response","setResponse","setError","options","setOptions","useLocalStorage","token","useContext","dispatch","_apiBase","process","doApiFetch","useCallback","method","params","bodyFields","headers","Authorization","qString","queryString","stringify","uri","a","fetch","mode","body","JSON","then","res","json","r","Error","message","catch","e","fetchData","AppSignContext","AppSignProvider","urlParams","setUrlParams","vkUserId","setVkUserId","matchUrlParams","setMatch","qs","parse","vk_user_id","ordered","Object","keys","sort","forEach","slice","stringParams","paramsHash","crypto","createHmac","update","digest","toString","replace","sign","useCompareSign","setParams","setState","window","location","search","CurrentUserContext","p","CurrentUserProvider","isLoggedIn","currentUser","Dialer","confirm","onClick","currentTarget","dataset","dialer","item","map","index","className","size","data-digit","go","goView","formError","setFormError","useApi","startFetchData","setStartFetchData","currentUserState","setCurrentUserState","setToken","name","phone","email","status","user","id","formButtonClick","loginPassString","confPassString","icon","header","style","textAlign","stretched","to","data-to","Profile","setEmail","setPhone","setName","kktPassword","setKktPassword","fetchToFns","setFetchToFns","canBack","setCanBack","snackbar","setSnackbar","fnsPasswordType","setFnsPasswordType","fnsResponse","doFnsFetch","osName","platform","bridge","subscribe","detail","data","console","log","layout","onClose","before","backgroundColor","fill","width","height","left","IOS","top","onChange","target","bottom","placeholder","send","display","justifyContent","data-type","margin","Prepare","str","dt","sum","fn","i","fp","match","monthName","Date","getMonth","getDate","getFullYear","n","Intl","NumberFormat","currency","format","arr","totalSum","reduce","previousValue","currentValue","income","ts","items","ColoredSum","fs","stl","color","fontSize","prepare","Calendar","setDateFromCalendar","currentDate","setCurrentDate","subMonths","asideContent","addMonths","fontWeight","locale","ru","toLocaleUpperCase","Receipt","isSearch","receiptItem","definition","setDefinition","price","quantity","dateTime","date","totalSumWithParams","SearchComponent","receipts","setSearch","searchTarget","setSearchTarget","searchResult","setSearchResult","receipt","push","filter","toLowerCase","indexOf","title","_id","Balance","setReceiptFromBalance","onClickActiveModal","initialFetch","setInitialFetch","setReceipts","fetching","setFetching","aside","totalReceiptSum","flexDirection","paddingTop","flex","paddingRight","paddingLeft","onRefresh","isFetching","expandable","indicator","CustomSnackBar","isError","AddDay","m","d","setDate","setQuantity","setPrice","setIncome","qr","setQR","routerContext","checkReceipt","setCheckReceipt","osname","code_data","modifiers","properties","preparedQR","supports","checked","disabled","Modal","Registration","step","setStep","registerMarkup","Analytics","More","data-panel","catalog","filteredCatalog","catalogToSave","Set","filterItems","editedElementId","openFilter","filterRules","filteredCatalogAfterResponse","rule","flat","element","findIndex","set","add","uniq","includes","rules","filterByRule","splice","Catalog","updateStr","setUpdateStr","catalogList","data-id","multiline","caption","after","defaultValue","actions","filterList","defaultChecked","undefined","data-definition","document","getElementById","focus","paddingBottom","fixedLayoutStyle","vertical","wide","shoppingList","shoppingItem","text","done","list","ShoppingList","setList","data-index","textDecoration","onSubmit","preventDefault","App","activeModal","setActiveModal","modal","setModal","setReceipt","currentUserContext","modalBack","right","onStoryChange","story","tb","selected","data-story","activeStory","tabbar","activePanel","CurrentUserChecker","doFetch","vk_id","schemeAttribute","createAttribute","scheme","attributes","setNamedItem","onload","ReactDOM","render"],"mappings":"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","file":"static/js/main.8b512ed1.chunk.js","sourcesContent":["import { useState, useEffect } from 'react';\r\n\r\nexport default (key, initialValue = '') => {\r\n  const [value, setValue] = useState(() => {\r\n    return localStorage.getItem(key) || initialValue;\r\n  });\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem(key, value)\r\n  }, [value, key]);\r\n\r\n  return [value, setValue];\r\n}\r\n","import React, { createContext, useReducer } from 'react';\r\nimport {PopoutWrapper, ScreenSpinner} from \"@vkontakte/vkui\";\r\n\r\nconst initialState = {\r\n\tview: 'authorization',\r\n\tpanel: 'authorization.login',\r\n\tpopout: null,\r\n  error: null,\r\n  password: '',\r\n  confirmPassword: ''\r\n};\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'SET_VIEW':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tview: action.payload.view,\r\n\t\t\t\tpanel: `${action.payload.view}.${action.payload.panel}`\r\n\t\t\t};\r\n\t\tcase 'SET_PANEL':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpassword: '',\r\n\t\t\t\tconfirmPassword: '',\r\n\t\t\t\tpanel: `${state.view}.${action.payload.panel}`\r\n\t\t\t};\r\n\t\tcase 'SHOW_LOADING':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpopout: (\r\n\t\t\t\t\t<PopoutWrapper>\r\n\t\t\t\t\t\t<ScreenSpinner />\r\n\t\t\t\t\t</PopoutWrapper>\r\n\t\t\t\t)\r\n\t\t\t};\r\n\t\tcase 'HIDE_LOADING':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpopout: null\r\n\t\t\t};\r\n    case 'SET_ERROR':\r\n      return {\r\n        ...state,\r\n        error: action.payload.error\r\n      }\r\n    case 'UNSET_ERROR' :\r\n      return {\r\n        ...state,\r\n        error: null\r\n      }\r\n    case 'SET_PASSWORD':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpassword: state.password.length < 4 ? state.password+action.payload.digit : state.password\r\n\t\t\t}\r\n\t\tcase 'SET_CONFIRM_PASSWORD':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tconfirmPassword: state.confirmPassword.length < 4 ? state.confirmPassword+action.payload.digit : state.confirmPassword\r\n\t\t\t}\r\n\t\tcase 'UNSET_PASSWORD':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpassword: '',\r\n\t\t\t\tconfirmPassword: ''\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n};\r\n\r\nexport const RouterContext = createContext();\r\n\r\nexport const RouterContextProvider = ({ children }) => {\r\n\tconst value = useReducer(reducer, initialState);\r\n\treturn (\r\n\t\t<RouterContext.Provider value={value}>\r\n\t\t\t{children}\r\n\t\t</RouterContext.Provider>\r\n\t)\r\n};","import { useState, useEffect, useCallback, useContext } from 'react';\r\nimport useLocalStorage from \"./useLocalStorage\";\r\nimport queryString from 'query-string';\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nexport default url => {\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [response, setResponse] = useState(null);\r\n\tconst [error, setError] = useState(null);\r\n\tconst [options, setOptions] = useState({});\r\n\tconst [token] = useLocalStorage('token');\r\n\tconst [,dispatch] = useContext(RouterContext);\r\n\tconst _apiBase = process.env.NODE_ENV !== 'development' ? process.env.REACT_APP_BASEURL : process.env.REACT_APP_BASEURL_DEV;\r\n\t// const _apiBase = `https://35.238.182.107:8080/api`; `http://localhost:3000/api`\r\n\r\n\tconst doApiFetch = useCallback((options = {}) => {\r\n\t\tsetOptions(options);\r\n\t\tsetIsLoading(true);\r\n\t\tdispatch({ type: 'SHOW_LOADING' });\r\n\t}, [dispatch]);\r\n\r\n\tconst { method = 'GET', params, ...bodyFields} = options;\r\n\tuseEffect(() => {\r\n\t\tif (!isLoading) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst headers = {\r\n\t\t\t'Content-Type': 'application/json',\r\n\t\t\tAuthorization: token ? `Token ${token}` : '',\r\n\t\t};\r\n\r\n\t\tconst qString = params ? queryString.stringify(params) : null;\r\n\r\n\t\tconst uri = qString ? `${_apiBase}${url}?${qString}` : `${_apiBase}${url}`;\r\n\r\n\t\tconst fetchData = async () => {\r\n\t\t\tawait fetch(uri, {\r\n\t\t\t\tmethod,\r\n\t\t\t\tmode: 'cors',\r\n\t\t\t\theaders,\r\n\t\t\t\tbody: method !== 'GET' ? JSON.stringify(bodyFields) : null,\r\n\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\t// console.log(res.json());\r\n\t\t\t\t\t// if (!res.ok) throw Error(res.statusText);\r\n\t\t\t\t\treturn res.json();\r\n\t\t\t\t})\r\n\t\t\t\t.then(r => {\r\n\t\t\t\t\tif (r.error) {throw Error(r.error.message);}\r\n\t\t\t\t\tsetIsLoading(false);\r\n\t\t\t\t\tdispatch({ type: 'HIDE_LOADING' });\r\n\t\t\t\t\tsetResponse(r);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\tsetIsLoading(false);\r\n\t\t\t\t\tdispatch({ type: 'HIDE_LOADING' });\r\n\t\t\t\t\tdispatch({type: 'SET_ERROR', payload: {error: e}});\r\n\t\t\t\t\tsetError(e);\r\n\t\t\t\t});\r\n\t\t};\r\n\r\n\t\tfetchData();\r\n\t}, [isLoading, bodyFields, method, url, _apiBase, token, params, dispatch]);\r\n\treturn [{isLoading, response, error}, doApiFetch];\r\n}\r\n","import React, { useState, createContext, useEffect } from 'react';\r\nimport useCompareSign from \"../hooks/useCompareSign\";\r\n\r\nexport const AppSignContext = createContext([{}, () => {}]);\r\n\r\nexport const AppSignProvider = ({ children }) => {\r\n  const [{vkUserId, matchUrlParams}, setParams] = useCompareSign();\r\n  const [state, setState] = useState({\r\n    vkUserId: null,\r\n    matchUrlParams: false\r\n  });\r\n\r\n  useEffect(()=>{\r\n    setParams(window.location.search.slice(1));\r\n  }, [setParams]);\r\n\r\n  useEffect(() => {\r\n    if (!vkUserId) return;\r\n    setState({vkUserId, matchUrlParams});\r\n  }, [vkUserId, matchUrlParams]);\r\n\r\n  return (\r\n    <AppSignContext.Provider value={[state, setState]}>\r\n      {children}\r\n    </AppSignContext.Provider>\r\n  )\r\n};","import { useState, useEffect } from 'react';\r\nimport qs from 'querystring';\r\nimport crypto from 'crypto';\r\n\r\nexport default () => {\r\n\tconst [urlParams, setUrlParams] = useState('');\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [vkUserId, setVkUserId] = useState(null);\r\n\tconst [matchUrlParams, setMatch] = useState(false);\r\n\r\n\tconst setParams = (urlParams = '') => {\r\n\t\tsetUrlParams(urlParams);\r\n\t\tsetIsLoading(true);\r\n\t};\r\n\r\n\tuseEffect(() =>{\r\n\t\tif( !isLoading ) return;\r\n\r\n\t\tconst params = qs.parse(urlParams);\r\n\r\n\t\tif (!params) return;\r\n\r\n\t\tsetVkUserId(params.vk_user_id);\r\n\r\n\t\tconst ordered = {};\r\n\t\tObject.keys(params).sort().forEach((key) => {\r\n\t\t\tif (key.slice(0, 3) === 'vk_') {\r\n\t\t\t\tordered[key] = params[key];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst stringParams = qs.stringify(ordered);\r\n\t\tconst paramsHash = crypto\r\n\t\t\t.createHmac('sha256', process.env.REACT_APP_VK)\r\n\t\t\t.update(stringParams)\r\n\t\t\t.digest()\r\n\t\t\t.toString('base64')\r\n\t\t\t.replace(/\\+/g, '-')\r\n\t\t\t.replace(/\\//g, '_')\r\n\t\t\t.replace(/=$/, '');\r\n\r\n\t\tsetMatch(paramsHash === params.sign);\r\n\t}, [isLoading, urlParams]);\r\n\r\n\treturn [{vkUserId, matchUrlParams}, setParams];\r\n}","import React, { createContext, useState } from 'react';\r\n\r\nexport const CurrentUserContext = createContext([{}, p => {}]);\r\n\r\nexport const CurrentUserProvider = ({ children }) => {\r\n\tconst [state, setState] = useState({\r\n\t\tisLoading: false,\r\n\t\tisLoggedIn: null,\r\n\t\tcurrentUser: null\r\n\t});\r\n\treturn (\r\n\t\t<CurrentUserContext.Provider value={[state, setState]}>\r\n\t\t\t{children}\r\n\t\t</CurrentUserContext.Provider>\r\n\t)\r\n};\r\n","import React, { Fragment, useReducer, useContext } from 'react';\nimport { Button } from \"@vkontakte/vkui\";\nimport {RouterContext} from \"../contexts/routerContext\";\nimport './dialer.component.css';\n\nconst Dialer = ({confirm = false}) => {\n\tconst [state, dispatch] = useContext(RouterContext);\n\tconst digits = [\n\t\t{item: '1'}, \n\t\t{item: '2'},\n\t\t{item: '3'},\n\t\t{item: '4'},\n\t\t{item: '5'},\n\t\t{item: '6'},\n\t\t{item: '7'},\n\t\t{item: '8'},\n\t\t{item: '9'},\n\t\t{item: null},\n\t\t{item: '0'},\n\t\t{\n\t\t\titem: '<-',\n\t\t\tonClick: () => {dispatch({type: 'UNSET_PASSWORD'})},\n\t\t\tmode: 'destructive'\n\t\t}\n\t]\n\t// const digits = ['1', '2', '3', '4', '5', '6', '7', '8', '9', null, '0', ];\n\tconst onClick = (e) => {\n\t\tif (confirm) {\n\t\t\tdispatch({type: 'SET_CONFIRM_PASSWORD', payload: {digit: e.currentTarget.dataset.digit}})\n\t\t} else {\n\t\t\tdispatch({type: 'SET_PASSWORD', payload: {digit: e.currentTarget.dataset.digit}})\t\n\t\t}\n\t}\n\tconst dialer = digits.map((digit, index) => {\n\t\treturn (\n\t\t\t<div className='digit' key={index}>\n\t\t\t\t{\n\t\t\t\t\tdigit.item  \n\t\t\t\t\t && \n\t\t\t\t\t<Button \n\t\t\t\t\t\tsize='xl' \n\t\t\t\t\t\tmode={digit.mode || 'secondary'} \n\t\t\t\t\t\tdata-digit={digit.item} \n\t\t\t\t\t\tonClick={digit.onClick || onClick}\n\t\t\t\t\t>\n\t\t\t\t\t\t{digit.item}\n\t\t\t\t\t</Button>\n\t\t\t\t}\n\t\t\t</div>\n\t\t)\n\t});\n\n\treturn (\n\t\t<div className='dialer'>\n\t\t\t{dialer}\n\t\t</div>\n\t)\n}\n\nexport default Dialer;","import React, {Fragment, useState, useEffect, useContext} from 'react';\r\nimport {Div, FormLayout, FormLayoutGroup, Input, Placeholder, FormStatus} from \"@vkontakte/vkui\";\r\nimport PanelHeader from \"@vkontakte/vkui/dist/components/PanelHeader/PanelHeader\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Icon56LockOutline from '@vkontakte/icons/dist/56/lock_outline';\r\nimport Icon56UserAddOutline from '@vkontakte/icons/dist/56/user_add_outline';\r\nimport useApi from \"../hooks/useApi\";\r\nimport {AppSignContext} from \"../contexts/appSign\";\r\nimport {CurrentUserContext} from \"../contexts/currentUser\";\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport Dialer from '../components/Dialer';\r\n\r\nconst Authorization = ({go, goView, type}) => {\r\n\tconst [password, setPassword] = useState('');\r\n\tconst [confirmPassword, setConfirmPassword] = useState('');\r\n\tconst [formError, setFormError] = useState(null);\r\n\tconst [{response, error}, doApiFetch] = useApi(`/users/${type}`);\r\n\tconst [{vkUserId}] = useContext(AppSignContext);\r\n\tconst [startFetchData, setStartFetchData] = useState(false);\r\n\tconst [currentUserState, setCurrentUserState] = useContext(CurrentUserContext);\r\n\tconst [, setToken] = useLocalStorage('token');\r\n\tconst [state, dispatch] = useContext(RouterContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!currentUserState.isLoggedIn) return;\r\n\t\tconst {name, phone, email, password} = currentUserState.currentUser;\r\n\t\tif (!name || !phone || !email || !password) {\r\n\t\t\tdispatch({type: 'SET_VIEW', payload: { view: 'registration', panel: 'finish'}});\r\n\t\t} else {\r\n\t\t\tdispatch({type: 'SET_VIEW', payload: { view: 'balance', panel: 'home'}})\r\n\t\t}\r\n\t},[currentUserState, dispatch]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (type === 'login') return;\r\n\r\n\t\tif ((state.password.length !== state.confirmPassword.length) || (!state.password.length && !state.confirmPassword.length)) {\r\n\t\t\tsetFormError(null);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (state.password !== state.confirmPassword) {\r\n\t\t\tsetFormError({status: 'Ошибка валидации', message: 'Пароли не совпадают. Проверьте ввод и повторите попытку.'});\r\n\t\t}\r\n\t}, [state.password, state.confirmPassword, type]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (!startFetchData) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'POST',\r\n\t\t\tuser: {\r\n\t\t\t\tid: +vkUserId,\r\n\t\t\t\tpassword: password || state.password\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdoApiFetch(body);\r\n\t\tsetStartFetchData(false);\r\n\t},[startFetchData, doApiFetch, password, state.password, vkUserId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\r\n\t\tif (!response.user && response.error) {\r\n\t\t\tsetFormError(response.error);\r\n\t\t} else {\r\n\t\t\tsetToken(response.user.token);\r\n\t\t}\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!response.user,\r\n\t\t\tcurrentUser: response.user || null\r\n\t\t}));\r\n\r\n\t}, [response, setCurrentUserState, go, goView, setToken]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!error) return;\r\n\t\tsetFormError(error);\r\n\t}, [error]);\r\n\r\n\tconst onChange = (e) => {\r\n\t\te.target.value = Math.max(0, parseInt(e.target.value) ).toString().slice(0,4);\r\n\t\tif (e.target.name === 'password') {\r\n\t\t\tsetPassword(e.target.value);\r\n\t\t} else {\r\n\t\t\tsetConfirmPassword(e.target.value);\r\n\t\t}\r\n\t};\r\n\r\n\tconst formStatus = () => {\r\n\t\tif (!formError) return null;\r\n\t\treturn (\r\n\t\t\t<FormStatus header={formError.status} mode=\"error\">\r\n\t\t\t\t{formError.message}\r\n\t\t\t</FormStatus>\r\n\t\t)\r\n\t};\r\n\r\n\tconst formButtonClick = async () => {\r\n\t\tsetStartFetchData(true);\r\n\t};\r\n\r\n\tconst loginPassString = state.password.replace(/[0-9]/g, '*') || 'Введите пароль'\r\n\tconst confPassString = state.confirmPassword.replace(/[0-9]/g, '*') ||  'Повторите пароль'\r\n\tconst digitCount = () => {\r\n\t\tlet str;\r\n\t\tif (state.password.length !== 4) {\r\n\t\t\tstr = state.password.length+' из 4';\r\n\t\t} else if (type==='login') {\r\n\t\t\tstr = state.password.length+' из 4';\r\n\t\t} else {\r\n\t\t\tstr = state.confirmPassword.length+' из 4';\r\n\t\t}\r\n\t\t// state.password.length !== 4 ? state.password.length+' из 4' : state.confirmPassword.length+' из 4'\r\n\t\treturn str;\r\n\t}\r\n\tconst headerString = () => {\r\n\t\tlet str;\r\n\t\tif (state.password.length !== 4) {\r\n\t\t\tstr = loginPassString;\r\n\t\t} else if (type==='login') {\r\n\t\t\tstr = loginPassString;\r\n\t\t} else {\r\n\t\t\tstr = confPassString;\r\n\t\t}\r\n\t\treturn str;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>{type === 'login' ? 'Введите пароль' : 'Регистрация'}</PanelHeader>\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={type === 'login' ? <Icon56LockOutline /> : <Icon56UserAddOutline />}\r\n\t\t\t\theader={headerString()/*state.password.length !== 4 ? loginPassString : confPassString*/}\r\n\t\t\t>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype !== 'login'\r\n\t\t\t\t\t\t\t?\r\n\t\t\t\t\t\t\t<FormLayout>\r\n\t\t\t\t\t\t\t\t{formStatus()}\r\n\t\t\t\t\t\t\t</FormLayout>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t}\r\n\t\t\t\t{digitCount()}\r\n\t\t\t</Placeholder>\r\n\t\t\t<Dialer confirm={(state.password.length === 4)} />\r\n\t\t\t<FormLayout style={{textAlign: 'center'}}>\r\n\t\t\t{\r\n\t\t\t\t(type === 'login' && state.password.length === 4)\r\n\t\t\t\t&& \r\n\t\t\t\t\t<Button size=\"xl\" mode='commerce' onClick={formButtonClick}>{type === 'login' ? 'Авторизация' : 'Регистрация'}</Button>\r\n\t\t\t}\r\n\t\t\t{\r\n\t\t\t\t(type !== 'login' && state.password && state.confirmPassword && state.password === state.confirmPassword)\r\n\t\t\t\t&& \r\n\t\t\t\t\r\n\t\t\t\t\t<Button mode='commerce' size=\"xl\" onClick={formButtonClick}>{type === 'login' ? 'Авторизация' : 'Регистрация'}</Button>\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\t</FormLayout>\r\n\t\t\t<Div>\r\n\t\t\t\t<Button\r\n\t\t\t\t\tstretched\r\n\t\t\t\t\tmode=\"tertiary\"\r\n\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\tdispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.to}});\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tdata-to={type === 'login' ? 'register' : 'login'}\r\n\t\t\t\t>{type === 'login' ? 'Регистрация' : 'Авторизация'}</Button>\r\n\t\t\t</Div>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Authorization;\r\n","import React, {useState, useEffect, Fragment, useContext} from 'react';\r\nimport {\r\n\tFormLayout,\r\n\tIOS,\r\n\tPanelHeader,\r\n\tplatform,\r\n\tPanelHeaderButton, Button, Input, FormLayoutGroup, FormStatus, Snackbar,\r\n\tDiv\r\n} from '@vkontakte/vkui';\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\nimport useApi from \"../hooks/useApi\";\r\nimport {CurrentUserContext} from \"../contexts/currentUser\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport Avatar from \"@vkontakte/vkui/dist/components/Avatar/Avatar\";\r\nimport Icon16Done from '@vkontakte/icons/dist/16/done';\r\n\r\nconst Profile = () =>{\r\n\tconst [email, setEmail] = useState('');\r\n\tconst [phone, setPhone] = useState('');\r\n\tconst [name, setName] = useState('');\r\n\tconst [kktPassword, setKktPassword] = useState('');\r\n\tconst [fetchToFns, setFetchToFns] = useState(false);\r\n\tconst [canBack, setCanBack] = useState(true);\r\n\tconst [snackbar, setSnackbar] = useState(null);\r\n\tconst [fnsPasswordType, setFnsPasswordType] = useState('');\r\n\tconst [{response}, doApiFetch] = useApi(`/users/profile`);\r\n\tconst [fnsResponse, doFnsFetch] = useApi(`/fns/password`);\r\n\tconst [startFetchData, setStartFetchData] = useState(false);\r\n\tconst [currentUserState, setCurrentUserState] = useContext(CurrentUserContext);\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tconst osName = platform();\r\n\r\n\tuseEffect(()=>{\r\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'VKWebAppGetPersonalCardResult':\r\n\t\t\t\t\tsetEmail(data.email);\r\n\t\t\t\t\tsetPhone(data.phone);\r\n\t\t\t\t\tconsole.log('profile', data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'VKWebAppGetPersonalCardFailed':\r\n\t\t\t\t\tconsole.log('profile error', data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst { email, name, phone, password } = currentUserState.currentUser;\r\n\t\tsetEmail(email || '');\r\n\t\tsetName(name || '');\r\n\t\tsetPhone(phone || '');\r\n\t\tsetKktPassword(password || '');\r\n\t\tsetCanBack(!!email && !!name && !!phone && !!password);\r\n\t}, [currentUserState]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (!startFetchData) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'PUT',\r\n\t\t\tupdate: {\r\n\t\t\t\temail,\r\n\t\t\t\tphone,\r\n\t\t\t\tname,\r\n\t\t\t\tkktPassword\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdoApiFetch(body);\r\n\t\tsetStartFetchData(false);\r\n\t},[startFetchData, doApiFetch, email, phone, name, kktPassword]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!fetchToFns) return;\r\n\t\tlet body = {};\r\n\r\n\t\tif (fnsPasswordType !== 'restore') {\r\n\t\t\tbody.name = name;\r\n\t\t\tbody.email = email;\r\n\t\t}\r\n\r\n\t\tbody.params = {\r\n\t\t\ttype: fnsPasswordType\r\n\t\t};\r\n\r\n\t\tbody.phone = phone.replace(/[ ()-]/g, '');\r\n\t\tbody.phone = body.phone.replace(/^[8]/g, '+7');\r\n\t\tbody.method = 'POST';\r\n\r\n\t\tdoFnsFetch(body);\r\n\t\tsetFetchToFns(false);\r\n\t}, [fetchToFns, fnsPasswordType, doFnsFetch, name, email, phone]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tconst { user } = response;\r\n\t\tif (!user.name || !user.phone || !user.email || !user.password) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!response.user,\r\n\t\t\tcurrentUser: response.user || null\r\n\t\t}));\r\n\t\tdispatch({type: 'SET_VIEW', payload: { view: 'balance', panel: 'home'}});\r\n\t}, [response, dispatch, setCurrentUserState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!fnsResponse.response) return;\r\n\t\tsetSnackbar(\r\n\t\t\t<Snackbar\r\n\t\t\t\tlayout=\"vertical\"\r\n\t\t\t\tonClose={() => setSnackbar(null)}\r\n\t\t\t\tbefore={<Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon16Done fill=\"#fff\" width={14} height={14} /></Avatar>}\r\n\t\t\t>\r\n\t\t\t\t{fnsResponse.response.message}\r\n\t\t\t</Snackbar>\r\n\t\t)\r\n\t}, [fnsResponse.response]);\r\n\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={canBack && <PanelHeaderButton onClick={() => {\r\n\t\t\t\t\tdispatch({type: 'SET_VIEW', payload: {view: 'balance', panel: 'home'}})\r\n\t\t\t\t}}>\r\n\t\t\t\t\t{osName === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}\r\n\t\t\t\t</PanelHeaderButton>}\r\n\t\t\t>\r\n\t\t\t\t{canBack ? 'Профиль' : 'Регистрация'}\r\n\t\t\t</PanelHeader>\r\n\t\t\t<FormLayout>\r\n\t\t\t\t{\r\n\t\t\t\t\t!canBack && <FormStatus header=\"Разъяснение\" mode=\"default\">\r\n\t\t\t\t\t\tПриложение позволяет считывать данные по чекам.\r\n\t\t\t\t\t\tНи какие данные о ваших покупках не передаются в налоговую.\r\n\t\t\t\t\t</FormStatus>\r\n\t\t\t\t}\r\n\t\t\t\t<Input\r\n\t\t\t\t\ttype={'text'}\r\n\t\t\t\t\ttop={'Имя'}\r\n\t\t\t\t\tname={'name'}\r\n\t\t\t\t\tvalue={name}\r\n\t\t\t\t\tonChange={(e) => {setName(e.target.value)}}\r\n\t\t\t\t/>\r\n\t\t\t\t<FormLayoutGroup top=\"E-mail и Телефон\" bottom=\"Эти данные можно получить через персональные карточки Вконтакте. Они нужны для того, чтобы получить пароль от ФНС для расшифровки чеков.\">\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'email'}\r\n\t\t\t\t\t\ttop={'e-mail'}\r\n\t\t\t\t\t\tname={'email'}\r\n\t\t\t\t\t\tplaceholder={'Введите e-mail'}\r\n\t\t\t\t\t\tvalue={email}\r\n\t\t\t\t\t\tonChange={(e) => {setEmail(e.target.value)}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'phone'}\r\n\t\t\t\t\t\ttop={'Телефон'}\r\n\t\t\t\t\t\tname={'phone'}\r\n\t\t\t\t\t\tvalue={phone}\r\n\t\t\t\t\t\tplaceholder={'Введите телефон'}\r\n\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\te.target.value.replace(/^[8]/, '+7');\r\n\t\t\t\t\t\t\tsetPhone(e.target.value);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Button size=\"xl\" onClick={() => {\r\n\t\t\t\t\t\tbridge.send(\"VKWebAppGetPersonalCard\", {\"type\": [\"phone\", \"email\"]});\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t\tПолучить данные из VK\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t<FormLayoutGroup top={'Пароль от ФНС'} bottom={'Если не хотите получать пароль по каким то причинам, введите 0 в поле ввода пароля'}>\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'number'}\r\n\t\t\t\t\t\ttop={'Пароль от ФНС'}\r\n\t\t\t\t\t\tplaceholder={'Введите пароль ФНС'}\r\n\t\t\t\t\t\tname={'kktPassword'}\r\n\t\t\t\t\t\tvalue={kktPassword}\r\n\t\t\t\t\t\tonChange={(e) => {setKktPassword(e.target.value)}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Div  style={{display: 'flex', justifyContent:'space-between'}}>\r\n\t\t\t\t\t\t<Button size='l' data-type={'signup'} onClick={(e) => {\r\n\t\t\t\t\t\t\tsetFnsPasswordType(e.currentTarget.dataset.type);\r\n\t\t\t\t\t\t\tsetFetchToFns(true);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tstyle={{margin: '0px', width: '49%'}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tПолучить пароль\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t<Button size='l' data-type={'restore'} onClick={(e) => {\r\n\t\t\t\t\t\t\tsetFnsPasswordType(e.currentTarget.dataset.type);\r\n\t\t\t\t\t\t\tsetFetchToFns(true);\r\n\t\t\t\t\t\t}} style={{margin: '0px', width: '49%'}}\t>\r\n\t\t\t\t\t\t\tВосстановить пароль\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</Div>\r\n\t\t\t\t</FormLayoutGroup>\r\n\r\n\t\t\t\t<Button size=\"xl\" mode=\"commerce\" onClick={() => {\r\n\t\t\t\t\tsetStartFetchData(true);\r\n\t\t\t\t}}>\r\n\t\t\t\t\t{canBack ? 'Обновить профиль' : 'Завершить регистрацию'}\r\n\t\t\t\t</Button>\r\n\t\t\t</FormLayout>\r\n\t\t\t{snackbar}\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Profile;\r\n","export default class Prepare {\r\n\t/**\r\n\t * Преобразование qr кода\r\n\t * @param str\r\n\t * @returns {{dt: *, fn: *, i: *, sum: *, fp: *}}\r\n\t */\r\n\tstatic qr (str){\r\n\t\ttry {\r\n\t\t\tlet dt, sum, fn, i, fp;\r\n\r\n\t\t\tif (str) {\r\n\t\t\t\t[, dt, sum, fn, i, fp] = str.match(/t=(\\w{8}T\\w+)&s=(\\w+\\.*\\w+)&fn=(\\w+)&i=(\\w+)&fp=(\\w+)/);\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdt,\r\n\t\t\t\tsum: sum.replace(/[.]/g, ''),\r\n\t\t\t\tfn,\r\n\t\t\t\ti,\r\n\t\t\t\tfp\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log(e);\r\n\t\t\treturn {\r\n\t\t\t\terror: {\r\n\t\t\t\t\tmessage: 'Ошибка чтения QR кода'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Преобразование даты\r\n\t * @param str\r\n\t * @returns {string}\r\n\t */\r\n\tstatic date(str) {\r\n\t\tconst dt = new Date(str);\r\n\t\tlet monthName;\r\n\t\tswitch (dt.getMonth() + 1) {\r\n\t\t\tcase 1:\r\n\t\t\t\tmonthName = 'января';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tmonthName = 'февраля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tmonthName = 'марта';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tmonthName = 'апреля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tmonthName = 'мая';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tmonthName = 'июня';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7:\r\n\t\t\t\tmonthName = 'июля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8:\r\n\t\t\t\tmonthName = 'августа';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 9:\r\n\t\t\t\tmonthName = 'сентября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 10:\r\n\t\t\t\tmonthName = 'октября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 11:\r\n\t\t\t\tmonthName = 'ноября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 12:\r\n\t\t\t\tmonthName = 'декабря';\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn `${dt.getDate()} ${monthName} ${dt.getFullYear()}`;\r\n\t}\r\n\r\n\t/**\r\n\t * Преобразование суммы\r\n\t * @param n\r\n\t * @returns {string}\r\n\t */\r\n\tstatic sum(n) {\r\n\t\treturn new Intl.NumberFormat('ru-RU', {style: 'currency', currency: 'RUB'}).format(n / 100);\r\n\t}\r\n\r\n\t/**\r\n\t * Расчет общей суммы\r\n\t * @param arr\r\n\t * @returns {number}\r\n\t */\r\n\tstatic totalReceiptSum(arr) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\treturn arr.map((item) => {\r\n\t\t\treturn item.sum || item.totalSum;\r\n\t\t}).reduce(reducer);\r\n\t}\r\n\r\n\tstatic totalSumWithParams(arr) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\treturn arr.map((item) => {\r\n\t\t\tconst {income, sum} = item;\r\n\t\t\tif (income) return sum;\r\n\t\t\treturn -1*sum;\r\n\t\t}).reduce(reducer);\r\n\t}\r\n\r\n\t/**\r\n\t * Подсчет суммарных доходов / расходов\r\n\t * @param arr\r\n\t * @param income\r\n\t * @returns {number}\r\n\t */\r\n\tstatic totalSum(arr, income) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\tconst ts = arr.map(items => {\r\n\t\t\treturn items.items.map(item => {\r\n\t\t\t\tif (income) {\r\n\t\t\t\t\treturn item.income ? item.sum : 0\r\n\t\t\t\t}\r\n\t\t\t\treturn !item.income ? item.sum : 0\r\n\t\t\t}).reduce(reducer)\r\n\t\t}).reduce(reducer);\r\n\t\treturn income ? ts : -1 * ts;\r\n\t}\r\n}","import React from 'react';\r\nimport prepare from \"../handlers/prepare\";\r\n\r\nconst ColoredSum = ({sum, fs}) => {\r\n\tconst stl = sum >= 0 ? {color: '#28a745', fontSize: fs} : {color: '#dc3545', fontSize: fs};\r\n\treturn(\r\n\t\t<span style={stl}>{prepare.sum(sum)}</span>\r\n\t)\r\n};\r\n\r\nexport default ColoredSum;\r\n","import React, { useState, useEffect } from 'react';\r\nimport {format, addMonths, subMonths} from 'date-fns';\r\nimport { ru } from 'date-fns/locale'\r\nimport {Group, List, Cell, Button} from \"@vkontakte/vkui\";\r\nimport Icon24BrowserBack from '@vkontakte/icons/dist/24/browser_back';\r\nimport Icon24BrowserForward from '@vkontakte/icons/dist/24/browser_forward';\r\n\r\nconst Calendar = ({setDateFromCalendar}) => {\r\n  const [currentDate, setCurrentDate] = useState(new Date());\r\n  const dateFormat = 'LLLL yyyy';\r\n\r\n  useEffect(() => {\r\n    setDateFromCalendar(currentDate);\r\n  }, [currentDate, setDateFromCalendar]);\r\n\r\n  const nextMonth = () => {\r\n    setCurrentDate(addMonths(currentDate, 1));\r\n  };\r\n\r\n  const prevMonth = () => {\r\n    setCurrentDate(subMonths(currentDate, 1));\r\n  };\r\n\r\n  return(\r\n    <Group>\r\n      <List>\r\n        <Cell\r\n          before={<Button onClick={prevMonth} mode={'secondary'}><Icon24BrowserBack /></Button>}\r\n          asideContent={<Button onClick={nextMonth} mode={'secondary'}><Icon24BrowserForward /></Button>}\r\n          style={{textAlign: 'center', fontWeight: 'bold'}}\r\n        >\r\n          {format(currentDate, dateFormat, {locale: ru}).toLocaleUpperCase()}\r\n        </Cell>\r\n      </List>\r\n    </Group>\r\n  )\r\n};\r\n\r\nexport default Calendar;","import Receipt from \"./receipt\";\r\n\r\nexport default Receipt;\r\n","import React, {Fragment} from 'react';\r\nimport {Separator} from \"@vkontakte/vkui\";\r\nimport prepare from \"../../handlers/prepare\";\r\nimport ColoredSum from \"../ColoredSum\";\r\n\r\nimport './receipt.css';\r\nimport FormLayout from \"@vkontakte/vkui/dist/components/FormLayout/FormLayout\";\r\n\r\nconst Receipt = ({items, id, isSearch=false}) => {\r\n\tconst setDefinition = (item) => {\r\n\t\tif (!item || !item.definition) return null;\r\n\t\tconst {definition} = item.definition;\r\n\t\treturn definition;\r\n\t}\r\n\tconst receiptItem = (items.map((item, index) => {\r\n\t\tconst sum = item.income ? item.sum : (-1) * item.sum ;\r\n\r\n\t\tconst definition = setDefinition(item);// = item && item.definition.definition ? item.definition.definition : null;\r\n\r\n\r\n\t\treturn(\r\n\t\t\t<Fragment key={index}>\r\n\t\t\t\t<div className={'receipt-item'} >\r\n\t\t\t\t\t<span className={'receipt-item-name'}>{definition ? definition : item.name}</span>\r\n\t\t\t\t\t{item.price && !isSearch ? <span className={'receipt-item-price'}>{prepare.sum(item.price)}</span> : null}\r\n\t\t\t\t\t{item.quantity && !isSearch ? <span className={'receipt-item-quantity'}>{item.quantity}</span> : null}\r\n\t\t\t\t\t{item.dateTime && isSearch ? <span className={'receipt-item-dateTime'}>{prepare.date(item.dateTime)}</span> : null}\r\n\t\t\t\t\t{sum ? <span className={'receipt-item-sum'}>{<ColoredSum sum={sum}/>}</span> : null}\r\n\t\t\t\t</div>\r\n\t\t\t</Fragment>\r\n\t\t)\r\n\t}));\r\n\r\n\treturn(\r\n\t\t<FormLayout id={id} className={'receipt-item-wrapper'}>\r\n\t\t\t<div className={'receipt-item'}>\r\n\t\t\t\t<span className={'receipt-item-name'}>Наименование</span>\r\n\t\t\t\t{!isSearch ?\r\n\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t<span  className={'receipt-item-price'}>Цена</span>\r\n\t\t\t\t\t\t<span  className={'receipt-item-quantity'}>Кол-во</span>\r\n\t\t\t\t\t</Fragment> :\r\n\t\t\t\t\t<span className={'receipt-item-dateTime'}>Дата</span>\r\n\t\t\t\t}\r\n\t\t\t\t<span className={'receipt-item-sum'}>Сумма</span>\r\n\t\t\t</div>\r\n\t\t\t<Separator />\r\n\t\t\t{receiptItem}\r\n\t\t\t<Separator />\r\n\t\t\t<div className={'receipt-total'}>\r\n\t\t\t\t<span className={''}>Итого:</span>\r\n\t\t\t\t<span><ColoredSum sum={prepare.totalSumWithParams(items)}/></span>\r\n\t\t\t</div>\r\n\t\t</FormLayout>\r\n\t)\r\n};\r\n\r\nexport default Receipt;","import SearchComponent from \"./SearchComponent\";\r\n\r\nexport default SearchComponent;\r\n","import React, {Fragment, useState, useEffect} from 'react';\r\nimport {Search} from \"@vkontakte/vkui\";\r\nimport Receipt from \"../Receipt\";\r\nimport Group from \"@vkontakte/vkui/dist/components/Group/Group\";\r\n\r\nconst SearchComponent = ({ receipts }) => {\r\n  const [search, setSearch] = useState('');\r\n  const [searchTarget, setSearchTarget] = useState([]);\r\n  const [searchResult, setSearchResult] = useState([]);\r\n\r\n  const onSearchChange = (e) => {\r\n    setSearch(e.target.value.toLowerCase());\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!receipts) return;\r\n    let arr = [];\r\n    const tmp = receipts.map((receipt) => {\r\n      let dateTime = receipt.dateTime;\r\n      return receipt.items.map((item) => {\r\n        item.dateTime = dateTime;\r\n        return item;\r\n      });\r\n    });\r\n    tmp.forEach((item) => {\r\n      arr.push(...item);\r\n    });\r\n    setSearchTarget(arr);\r\n  }, [receipts]);\r\n\r\n  useEffect(() => {\r\n    if (!search) {\r\n      setSearchResult([]);\r\n      return;\r\n    }\r\n    setSearchResult(searchTarget.filter(({name}) => name.toLowerCase().indexOf(search) > -1));\r\n  }, [search, searchTarget]);\r\n\r\n  return (\r\n    <Fragment>\r\n      <Search value={search} onChange={onSearchChange}/>\r\n      <Group title='Поиск'>\r\n        {\r\n          searchResult.length > 0 && <Receipt id={searchResult._id} isSearch={true} items={searchResult}/>\r\n        }\r\n      </Group>\r\n    </Fragment>\r\n  )\r\n};\r\n\r\nexport default SearchComponent;\r\n","import React, {useState, useEffect, Fragment, useContext, useCallback} from 'react';\r\nimport useApi from \"../hooks/useApi\";\r\nimport {List, PanelHeaderContent, Placeholder, PullToRefresh, Separator, Counter} from \"@vkontakte/vkui\";\r\nimport ColoredSum from \"../components/ColoredSum\";\r\nimport prepare from \"../handlers/prepare\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Group from \"@vkontakte/vkui/dist/components/Group/Group\";\r\nimport Cell from \"@vkontakte/vkui/dist/components/Cell/Cell\";\r\nimport Icon56GoodsCollection from '@vkontakte/icons/dist/56/goods_collection';\r\nimport Icon16Up from '@vkontakte/icons/dist/16/up';\r\nimport Icon16Down from '@vkontakte/icons/dist/16/down';\r\n\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport Calendar from \"../components/Calendar\";\r\nimport {format} from 'date-fns';\r\nimport SearchComponent from \"../components/search\";\r\nimport PanelHeader from \"@vkontakte/vkui/dist/components/PanelHeader/PanelHeader\";\r\n\r\nconst Balance = ({setReceiptFromBalance, onClickActiveModal}) => {\r\n\tconst viewTitle = 'Баланс';\r\n\tconst [initialFetch, setInitialFetch] = useState(true);\r\n\tconst [currentDate, setCurrentDate] = useState(new Date());\r\n\tconst [receipts, setReceipts] = useState([]);\r\n\tconst [fetching, setFetching] = useState(false);\r\n\tconst [{response}, doApiFetch] = useApi('/day');\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tconst dateFormat = 'yyyy-MM-dd';\r\n\r\n\tconst setDateFromCalendar = useCallback((date) => {\r\n\t\tsetCurrentDate(date);\r\n\t\tsetInitialFetch(true);\r\n\t}, []);\r\n\r\n\tconst onRefresh = () => {\r\n\t\tsetFetching(true);\r\n\t\tsetInitialFetch(true);\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!initialFetch) return;\r\n\t\tdoApiFetch({\r\n\t\t\tparams: {\r\n\t\t\t\tdate: format(currentDate, dateFormat)\r\n\t\t\t}\r\n\t\t});\r\n\t\tsetInitialFetch(false);\r\n\t\tsetFetching(false);\r\n\t}, [initialFetch, setInitialFetch, doApiFetch, currentDate]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tsetReceipts(response);\r\n\t}, [response, setReceiptFromBalance]);\r\n\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\t<PanelHeaderContent\r\n\t\t\t\t\taside={<Counter size={'s'} mode={'primary'}>{process.env.REACT_APP_VERSION}</Counter>}\r\n\t\t\t\t\t//aside={<Icon16Dropdown style={{ transform: `rotate(${contextOpened ? '180deg' : '0'})` }} />}\r\n\t\t\t\t\t// onClick={toggleContext}\r\n\t\t\t\t>\r\n\t\t\t\t\t{viewTitle}\r\n\t\t\t\t</PanelHeaderContent>\r\n\t\t\t</PanelHeader>\r\n\t\t\t{/*<MainMenu title={viewTitle} />*/}\r\n\t\t\t<SearchComponent receipts={receipts} />\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={<Icon56GoodsCollection />}\r\n\t\t\t\theader={<ColoredSum sum={prepare.totalReceiptSum(receipts)} fs={'2em'}/>}\r\n\t\t\t\taction={<Button size=\"l\" onClick={(e)=>{\r\n\t\t\t\t\tdispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.to}});\r\n\t\t\t\t}} data-to={'add'}>Добавить доход / расход</Button>}\r\n\t\t\t>\r\n\t\t\t\tДобавляйте доходы/расходы\r\n\t\t\t</Placeholder>\r\n\t\t\t<Separator/>\r\n\t\t\t<div style={{\r\n\t\t\t\tdisplay: 'flex',\r\n\t\t\t\tflexDirection: 'row',\r\n\t\t\t\tjustifyContent: 'space-between',\r\n\t\t\t\tpaddingTop: '1em',\r\n\t\t\t}}>\r\n\t\t\t\t<div style={{flex: '0 1 50%', display: 'flex',justifyContent: 'flex-end',}}>\r\n\t\t\t\t\t<div style={{display: 'flex', flexDirection: 'column', paddingRight: '10px'}}>\r\n\t\t\t\t\t\t<span style={{color: '#6F6F6F', fontSize: '0.7em', textAlign: 'end'}}>Доходы</span>\r\n\t\t\t\t\t\t<ColoredSum sum={prepare.totalSum(receipts, true)} fs={'1.4em'}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<Icon16Up width={16} height={40} fill={'#28a745'}/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style={{flex: '0 1 50%', display: 'flex',justifyContent: 'flex-start',}}>\r\n\t\t\t\t\t<Icon16Down width={16} height={40} fill={'#dc3545'}/>\r\n\t\t\t\t\t<div style={{display: 'flex', flexDirection: 'column', paddingLeft: '10px'}}>\r\n\t\t\t\t\t\t<span style={{color: '#6F6F6F', fontSize: '0.7em'}}>Расходы</span>\r\n\t\t\t\t\t\t<ColoredSum sum={prepare.totalSum(receipts, false)} fs={'1.4em'}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<PullToRefresh onRefresh={onRefresh} isFetching={fetching} >\r\n\t\t\t\t<Group title='Чеки'>\r\n\t\t\t\t\t<List>\r\n\t\t\t\t\t\t<Calendar setDateFromCalendar={setDateFromCalendar}/>\r\n\t\t\t\t\t\t{receipts.map((receipt, index) => {\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\texpandable\r\n\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\tonClickActiveModal('modal-page');\r\n\t\t\t\t\t\t\t\t\t\tsetReceiptFromBalance(receipt);\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\tdata-to={receipt._id}\r\n\t\t\t\t\t\t\t\t\tindicator={<ColoredSum sum={receipt.totalSum}/>}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{prepare.date(receipt.dateTime)}\r\n\t\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</List>\r\n\t\t\t\t</Group>\r\n\t\t\t</PullToRefresh>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Balance;\r\n","import React, {useState, useEffect, useContext} from 'react';\r\nimport Avatar from \"@vkontakte/vkui/dist/components/Avatar/Avatar\";\r\nimport {Snackbar} from \"@vkontakte/vkui\";\r\nimport Icon16Done from '@vkontakte/icons/dist/16/done';\r\nimport Icon28ErrorOutline from '@vkontakte/icons/dist/28/error_outline';\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nconst CustomSnackBar = ({message, isError, onClose}) => {\r\n\tconst [snackbar, setSnackbar] = useState(null);\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tuseEffect(() => {\r\n\t\tsetSnackbar(<Snackbar\r\n\t\t\tlayout=\"vertical\"\r\n\t\t\tonClose={onClose}\r\n\t\t\tbefore={\r\n\t\t\t\tisError\r\n\t\t\t\t\t? <Avatar size={24} style={{backgroundColor: 'var(--destructive)'}}><Icon28ErrorOutline fill=\"#fff\" width={18} height={18} /></Avatar>\r\n\t\t\t\t\t: <Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon16Done fill=\"#fff\" width={18} height={18} /></Avatar>\r\n\t\t\t}\r\n\t\t>\r\n\t\t\t{message}\r\n\t\t</Snackbar>)\r\n\t}, [setSnackbar, dispatch, isError, message, onClose]);\r\n\treturn(\r\n\t\tsnackbar\r\n\t)\r\n};\r\n\r\nexport default CustomSnackBar;\r\n","import React, {useState, useEffect, useContext, Fragment, useCallback} from 'react';\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\r\nimport FormLayout from \"@vkontakte/vkui/dist/components/FormLayout/FormLayout\";\r\nimport Input from \"@vkontakte/vkui/dist/components/Input/Input\";\r\nimport PanelHeaderButton from \"@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton\";\r\nimport {IOS, platform} from \"@vkontakte/vkui\";\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Checkbox from \"@vkontakte/vkui/dist/components/Checkbox/Checkbox\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Icon24Qr from '@vkontakte/icons/dist/24/qr';\r\nimport PanelHeaderContent from \"@vkontakte/vkui/dist/components/PanelHeaderContent/PanelHeaderContent\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport useApi from \"../hooks/useApi\";\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport prepare from \"../handlers/prepare\";\r\nimport CustomSnackBar from \"../components/CustomSnackbar\";\r\n\r\nconst AddDay = () => {\r\n  const SUCCESS_MESSAGE = 'Добавление прошло успешно';\r\n  const [name, setName] = useState('');\r\n  const [date, setDate] = useState(() => {\r\n    const date = new Date();\r\n    const m = date.getMonth()+1 > 9 ? date.getMonth()+1 : `0${date.getMonth()+1}`;\r\n    const d = date.getDate() > 9 ? date.getDate() : `0${date.getDate()}`;\r\n    return `${date.getFullYear()}-${m}-${d}`;\r\n  });\r\n  const [quantity, setQuantity] = useState(1);\r\n  const [price, setPrice] = useState('');\r\n  const [income, setIncome] = useState(false);\r\n  const [snackbar, setSnackbar] = useState(null);\r\n  const [qr, setQR] = useState(null);\r\n  const [routerContext, dispatch] = useContext(RouterContext);\r\n  const [{response, error}, doApiFetch] = useApi('/day');\r\n  const [receipts, doFnsFetch] = useApi('/day/receipt');\r\n  const [startFetchData, setStartFetchData] = useState(false);\r\n  const [checkReceipt, setCheckReceipt] = useState(false);\r\n  const osname = platform();\r\n\r\n  const onClose = useCallback(() => {\r\n    dispatch({ type: 'UNSET_ERROR'});\r\n    setSnackbar(null);\r\n  }, [dispatch]);\r\n\r\n  /***\r\n   * Подписываемся на события\r\n   */\r\n  useEffect(()=>{\r\n    bridge.subscribe(({ detail: { type, data }}) => {\r\n      switch (type) {\r\n        case 'VKWebAppOpenCodeReaderResult':\r\n          setQR(data.code_data);\r\n          break;\r\n        case 'VKWebAppOpenCodeReaderFailed':\r\n          console.log('add day error', data);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  /***\r\n   * Добавляем данные на сервер\r\n   */\r\n  useEffect(() => {\r\n    if (!startFetchData) return;\r\n    const body = {\r\n      method: 'POST',\r\n      date: date,\r\n      items: [\r\n        {\r\n          name,\r\n          quantity,\r\n          price: price * 100,\r\n          sum: price * 100 * quantity,\r\n          income,\r\n          modifiers: [],\r\n          properties: [],\r\n        }\r\n      ]\r\n    };\r\n    doApiFetch(body);\r\n\r\n    setName('');\r\n    setQuantity(1);\r\n    setIncome(false);\r\n    setPrice('');\r\n    setStartFetchData(false);\r\n  }, [startFetchData, setStartFetchData, date, doApiFetch, income, name, price, quantity]);\r\n\r\n  /**\r\n   * Выводим сообщение об успехе\r\n   */\r\n  useEffect(() => {\r\n    if (!response) return;\r\n    setSnackbar(<CustomSnackBar message={SUCCESS_MESSAGE} isError={false} onClose={onClose}/>)\r\n  }, [response, onClose]);\r\n\r\n  /**\r\n   * Добавление QR кода\r\n   */\r\n  useEffect(() => {\r\n    if (!qr) return;\r\n\r\n    const preparedQR = prepare.qr(qr);\r\n\r\n    if (preparedQR.error) {\r\n      const e = preparedQR.error;\r\n      dispatch({ type: 'SET_ERROR', payload: { error: e }});\r\n      setQR(null);\r\n      setCheckReceipt(false);\r\n      return;\r\n    }\r\n\r\n    // const action = checkReceipt ? 'receive' : 'check';\r\n\r\n    const body = {\r\n      method: 'POST',\r\n      ...preparedQR\r\n    }\r\n    doFnsFetch(body);\r\n  }, [qr, doFnsFetch, checkReceipt, dispatch]);\r\n\r\n  /**\r\n   * Костыль. Проверка есть ли тело в ответе от ФНС. Сохраняем чек на сервере\r\n   */\r\n  useEffect(() => {\r\n    if (!receipts.response) return;\r\n    // setCheckReceipt(receipts.response.check);\r\n    // if (receipts.response.statusCode === 202) {\r\n    //   const body = {\r\n    //     method: 'POST',\r\n    //     ...prepare.qr(qr),\r\n    //     params: {\r\n    //       action: 'receive'\r\n    //     }\r\n    //   }\r\n    //   doFnsFetch(body);\r\n    // }\r\n    if (receipts.response._id) {\r\n      setSnackbar(<CustomSnackBar message={SUCCESS_MESSAGE} isError={false} onClose={onClose}/>)\r\n      setCheckReceipt(false);\r\n      setQR(null);\r\n    }\r\n  }, [receipts.response, doFnsFetch, qr, onClose]);\r\n\r\n  /**\r\n   * Вывод сообщения об ощибке\r\n   */\r\n  useEffect(() => {\r\n    if (!routerContext.error) return;\r\n    dispatch({\r\n      type: 'SET_ERROR',\r\n      payload: {\r\n        error: receipts.error || error\r\n      }\r\n    })\r\n    setSnackbar(<CustomSnackBar message={routerContext.error.message} isError={true} onClose={onClose}/>);\r\n    setCheckReceipt(false);\r\n    setQR(null);\r\n\r\n  }, [receipts.error, error, dispatch, routerContext.error, onClose]);\r\n\r\n  return(\r\n    <Fragment>\r\n      <PanelHeader\r\n        left={\r\n          <PanelHeaderButton key={'back'} onClick={(e) => {\r\n            dispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.to}});\r\n          }} data-to={'home'}>{osname === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}</PanelHeaderButton>\r\n        }\r\n      >\r\n        <PanelHeaderContent\r\n          before={\r\n            bridge.supports('VKWebAppOpenCodeReader') &&\r\n            <PanelHeaderButton\r\n              key={'qr'}\r\n              data-to={'qr'}\r\n              onClick={() => {\r\n                dispatch({ type: 'UNSET_ERROR'});\r\n                bridge.send('VKWebAppOpenCodeReader', {});\r\n              }}\r\n            ><Icon24Qr /></PanelHeaderButton>\r\n          }\r\n        >\r\n          Добавление записи\r\n        </PanelHeaderContent>\r\n      </PanelHeader>\r\n      <FormLayout>\r\n        <Input\r\n          type={'date'}\r\n          top={'Дата'}\r\n          name={'date'}\r\n          value={date}\r\n          onChange={(e)=>{setDate(e.currentTarget.value)}}\r\n        />\r\n        <Input\r\n          type={'text'}\r\n          top={'Название'}\r\n          name={'name'}\r\n          value={name}\r\n          onChange={(e)=>{setName(e.currentTarget.value)}}\r\n        />\r\n        <Input\r\n          type={'number'}\r\n          top={'Количество'}\r\n          name={'quantity'}\r\n          value={quantity}\r\n          onChange={(e)=>{setQuantity(e.currentTarget.value)}}\r\n        />\r\n        <Input\r\n          type={'number'}\r\n          top={'Цена'}\r\n          name={'price'}\r\n          value={price}\r\n          onChange={(e)=>{setPrice(e.currentTarget.value)}}\r\n        />\r\n        <Checkbox\r\n          name={'income'}\r\n          checked={income}\r\n          onChange={(e)=>{setIncome(e.currentTarget.checked)}}\r\n        >Доход</Checkbox>\r\n\r\n        <Button\r\n          size=\"xl\"\r\n          disabled={!date || !name || !quantity || !price}\r\n          mode={income ? \"commerce\" : \"destructive\"}\r\n          onClick={() => {setStartFetchData(true)}}\r\n        >\r\n          Добавить {income ? \"доход\" : \"расход\"}\r\n        </Button>\r\n      </FormLayout>\r\n\r\n      {snackbar}\r\n    </Fragment>\r\n  )\r\n};\r\n\r\nexport default AddDay;","import React from 'react';\r\nimport {List} from \"@vkontakte/vkui\";\r\nimport Receipt from \"./Receipt\";\r\n\r\nconst Modal = ({receipt}) => {\r\n\treturn (\r\n\t\t<List>\r\n\t\t\t<Receipt id={receipt._id} dateTime={receipt.dateTime} items={receipt.items}/>\r\n\t\t</List>\r\n\t)\r\n};\r\n\r\nexport default Modal;","import React, {useState, useEffect, Fragment, useContext} from 'react';\r\nimport {\r\n  Button,\r\n  Div,\r\n  FormLayout,\r\n  FormLayoutGroup,\r\n  Input,\r\n  IOS,\r\n  PanelHeader,\r\n  PanelHeaderButton, platform,\r\n  Snackbar\r\n} from \"@vkontakte/vkui\";\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport useApi from \"../hooks/useApi\";\r\nimport Avatar from \"@vkontakte/vkui/dist/components/Avatar/Avatar\";\r\nimport {CurrentUserContext} from \"../contexts/currentUser\";\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport Icon16Done from '@vkontakte/icons/dist/16/done';\r\n\r\nconst Registration = () => {\r\n  const [email, setEmail] = useState('');\r\n  const [phone, setPhone] = useState('');\r\n  const [name, setName] = useState('');\r\n  const [kktPassword, setKktPassword] = useState('');\r\n  const [step, setStep] = useState(0);\r\n  const [fnsPasswordType, setFnsPasswordType] = useState('');\r\n  const [fetchToFns, setFetchToFns] = useState(false);\r\n  const [, dispatch] = useContext(RouterContext);\r\n  const [{response}, doApiFetch] = useApi(`/users/profile`);\r\n  const [fnsResponse, doFnsFetch] = useApi(`/fns/password`);\r\n  const [startFetchData, setStartFetchData] = useState(false);\r\n  const [, setCurrentUserState] = useContext(CurrentUserContext);\r\n  const [snackbar, setSnackbar] = useState(null);\r\n  const osName = platform();\r\n\r\n  useEffect(()=>{\r\n    bridge.subscribe(({ detail: { type, data }}) => {\r\n      switch (type) {\r\n        case 'VKWebAppGetPersonalCardResult':\r\n          setEmail(data.email);\r\n          setPhone(data.phone);\r\n          break;\r\n        case 'VKWebAppGetPersonalCardFailed':\r\n          console.log('profile error', data);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  useEffect(()=>{\r\n    if (!startFetchData) return;\r\n    const body = {\r\n      method: 'PUT',\r\n      update: {\r\n        email,\r\n        phone,\r\n        name,\r\n        kktPassword\r\n      }\r\n    };\r\n\r\n    doApiFetch(body);\r\n    setStartFetchData(false);\r\n  },[startFetchData, doApiFetch, email, phone, name, kktPassword]);\r\n\r\n  useEffect(() => {\r\n    if (!fetchToFns) return;\r\n    let body = {};\r\n\r\n    if (fnsPasswordType !== 'restore') {\r\n      body.name = name;\r\n      body.email = email;\r\n    }\r\n\r\n    body.params = {\r\n      type: fnsPasswordType\r\n    };\r\n\r\n    body.phone = phone.replace(/[ ()-]/g, '');\r\n    body.phone = body.phone.replace(/^[8]/g, '+7');\r\n    body.method = 'POST';\r\n\r\n    doFnsFetch(body);\r\n    setFetchToFns(false);\r\n  }, [fetchToFns, fnsPasswordType, doFnsFetch, name, email, phone]);\r\n\r\n  useEffect(() => {\r\n    if (!response) return;\r\n    const { user } = response;\r\n    if (!user.name || !user.phone || !user.email || !user.password) {\r\n      return;\r\n    }\r\n    setCurrentUserState(state => ({\r\n      ...state,\r\n      isLoading: false,\r\n      isLoggedIn: !!response.user,\r\n      currentUser: response.user || null\r\n    }));\r\n    dispatch({type: 'SET_VIEW', payload: { view: 'balance', panel: 'home'}});\r\n  }, [response, dispatch, setCurrentUserState]);\r\n\r\n  useEffect(() => {\r\n    if (!fnsResponse.response) return;\r\n    setSnackbar(\r\n      <Snackbar\r\n        layout=\"vertical\"\r\n        onClose={() => setSnackbar(null)}\r\n        before={<Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon16Done fill=\"#fff\" width={14} height={14} /></Avatar>}\r\n      >\r\n        {fnsResponse.response.message}\r\n      </Snackbar>\r\n    )\r\n  }, [fnsResponse.response]);\r\n\r\n  const registerMarkup = (step) => {\r\n    switch (step) {\r\n      case 0:\r\n        return (\r\n          <FormLayoutGroup top={'Введите своё имя'}>\r\n            <Input\r\n              type={'text'}\r\n              top={'Имя'}\r\n              name={'name'}\r\n              value={name}\r\n              onChange={(e) => {setName(e.target.value)}}\r\n            />\r\n            <Button\r\n              size=\"xl\"\r\n              mode=\"commerce\"\r\n              disabled={!name}\r\n              onClick={() => {\r\n                setStep(1);\r\n              }}\r\n            >\r\n              Продолжить\r\n            </Button>\r\n          </FormLayoutGroup>\r\n        );\r\n      case 1:\r\n        return (\r\n          <FormLayoutGroup top=\"E-mail и Телефон\" bottom=\"Эти данные можно получить через персональные карточки Вконтакте. Они нужны для того, чтобы получить пароль от ФНС для расшифровки чеков.\">\r\n            <Input\r\n              type={'email'}\r\n              top={'e-mail'}\r\n              name={'email'}\r\n              placeholder={'Введите e-mail'}\r\n              value={email}\r\n              onChange={(e) => {setEmail(e.target.value)}}\r\n            />\r\n            <Input\r\n              type={'phone'}\r\n              top={'Телефон'}\r\n              name={'phone'}\r\n              value={phone}\r\n              placeholder={'Введите телефон'}\r\n              onChange={(e) => {\r\n                e.target.value.replace(/^[8]/, '+7');\r\n                setPhone(e.target.value);\r\n              }}\r\n            />\r\n            <Button size=\"xl\" onClick={() => {\r\n              bridge.send(\"VKWebAppGetPersonalCard\", {\"type\": [\"phone\", \"email\"]});\r\n            }}>\r\n              Получить данные из VK\r\n            </Button>\r\n            <Button\r\n              size=\"xl\"\r\n              mode=\"commerce\"\r\n              disabled={!email || !phone}\r\n              onClick={() => {\r\n                setStep(2);\r\n              }}\r\n            >\r\n              Продолжить\r\n            </Button>\r\n          </FormLayoutGroup>\r\n        );\r\n      case 2:\r\n        return (\r\n          <FormLayoutGroup top={'Пароль от ФНС'} bottom={'Если Вы, по каким то причинам, не хотите получать пароль - введите 0 в поле ввода пароля'}>\r\n            <Input\r\n              type={'number'}\r\n              top={'Пароль от ФНС'}\r\n              placeholder={'Введите пароль ФНС'}\r\n              name={'kktPassword'}\r\n              value={kktPassword}\r\n              onChange={(e) => {setKktPassword(e.target.value)}}\r\n            />\r\n            <Div  style={{display: 'flex', justifyContent:'space-between'}}>\r\n              <Button size='l' data-type={'signup'} onClick={(e) => {\r\n                setFnsPasswordType(e.currentTarget.dataset.type);\r\n                setFetchToFns(true);\r\n              }}\r\n                      style={{margin: '0px', width: '49%'}}\r\n              >\r\n                Получить пароль\r\n              </Button>\r\n              <Button size='l' data-type={'restore'} onClick={(e) => {\r\n                setFnsPasswordType(e.currentTarget.dataset.type);\r\n                setFetchToFns(true);\r\n              }} style={{margin: '0px', width: '49%'}}\t>\r\n                Восстановить пароль\r\n              </Button>\r\n            </Div>\r\n            <Button\r\n              size=\"xl\"\r\n              mode=\"commerce\"\r\n              disabled={!email && !phone}\r\n              onClick={() => {\r\n                setStartFetchData(true);\r\n              }}\r\n            >\r\n              Завершить\r\n            </Button>\r\n          </FormLayoutGroup>\r\n        )\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Fragment>\r\n      <PanelHeader\r\n        left={<PanelHeaderButton onClick={() => {\r\n          dispatch({type: 'SET_VIEW', payload: {view: 'balance', panel: 'home'}})\r\n        }}>\r\n          {osName === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}\r\n        </PanelHeaderButton>}\r\n      >\r\n        Регистрация({step + 1}/3)\r\n      </PanelHeader>\r\n      <FormLayout>\r\n        {registerMarkup(step)}\r\n      </FormLayout>\r\n      {snackbar}\r\n    </Fragment>\r\n  )\r\n}\r\n\r\nexport default Registration;\r\n","import React, {Fragment} from 'react';\r\nimport {PanelHeader, Placeholder} from '@vkontakte/vkui';\r\n\r\nconst Analytics = () => {\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\tАналитика\r\n\t\t\t</PanelHeader>\r\n\t\t\t<Placeholder>\r\n\t\t\t\tРаздел находится в разработке\r\n\t\t\t</Placeholder>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Analytics;","import React, {Fragment, useContext} from 'react';\r\nimport {Group, PanelHeader, Header, SimpleCell} from '@vkontakte/vkui';\r\nimport Icon28ListOutline from '@vkontakte/icons/dist/28/list_outline';\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nconst More = () => {\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tconst onCellClick = (e) => {\r\n\t\tdispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.panel }});\r\n\t}\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\tДополнительно\r\n\t\t\t</PanelHeader>\r\n\t\t\t<Group>\r\n\t\t\t\t<Header mode={'secondary'}>Дополнительно</Header>\r\n\t\t\t\t<SimpleCell\r\n\t\t\t\t\tdata-panel={'catalog'}\r\n\t\t\t\t\texpandable\r\n\t\t\t\t\tbefore={<Icon28ListOutline />}\r\n\t\t\t\t\tonClick = {onCellClick}\r\n\t\t\t\t>\r\n\t\t\t\t\tСправочник\r\n\t\t\t\t</SimpleCell>\r\n\t\t\t</Group>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default More;","import React, {Fragment, useEffect, useState, useReducer} from 'react';\r\nimport {\r\n\tPanelHeader,\r\n\tFixedLayout,\r\n\tGroup,\r\n\tRichCell,\r\n\tButton, Input, Separator, PanelHeaderButton, SimpleCell, Switch\r\n} from '@vkontakte/vkui';\r\nimport useApi from \"../hooks/useApi\";\r\nimport Icon28EditOutline from '@vkontakte/icons/dist/28/edit_outline';\r\nimport Icon16Cancel from '@vkontakte/icons/dist/16/cancel';\r\nimport Icon24Filter from '@vkontakte/icons/dist/24/filter';\r\n\r\nconst initialState = {\r\n\tcatalog: [],\r\n\tfilteredCatalog: [],\r\n\tcatalogToSave: new Set(),\r\n\tfilterItems: [],\r\n\teditedElementId: '',\r\n\topenFilter: false,\r\n\tfilterRules: []\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'SET_CATALOG':\r\n\r\n\t\t\tconst filteredCatalogAfterResponse = state.filterRules.map((rule) => {\r\n\t\t\t\treturn state.catalog.filter((item) => {\r\n\t\t\t\t\treturn item.definition === rule && item;\r\n\t\t\t\t});\r\n\t\t\t}).flat();\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tcatalog: action.payload.catalog,\r\n\t\t\t\tfilteredCatalog: filteredCatalogAfterResponse && filteredCatalogAfterResponse.length > 0 ? filteredCatalogAfterResponse : action.payload.catalog,\r\n\t\t\t\tfilterRules: filteredCatalogAfterResponse && filteredCatalogAfterResponse.length > 0 ? state.filterRules : [],\r\n\t\t\t\tcatalogToSave: new Set(),\r\n\t\t\t\teditedElementId: ''\r\n\t\t\t}\r\n\t\tcase 'SET_EDITED_ELEMENT':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\teditedElementId: action.payload.id\r\n\t\t\t}\r\n\t\tcase 'FILL_SAVE_CATALOG':\r\n\t\t\tlet element;\r\n\t\t\tconst index = state.catalog.findIndex((item) => {\r\n\t\t\t\treturn item._id === action.payload.id;\r\n\t\t\t});\r\n\t\t\tif (action.payload.definition) {\r\n\t\t\t\telement = state.catalog[index];\r\n\t\t\t\telement.definition = action.payload.definition;\r\n\t\t\t}\r\n\t\t\tconst set = new Set(state.catalogToSave);\r\n\t\t\tset.add(element);\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tcatalogToSave: set\r\n\t\t\t}\r\n\t\tcase 'ERASE_FILTER_RULES':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tfilterRules: [],\r\n\t\t\t\topenFilter: false,\r\n\t\t\t\tfilteredCatalog: state.catalog\r\n\t\t\t}\r\n\t\tcase 'SET_FILTER_ITEMS':\r\n\t\t\tconst filterItems = state.catalog.map(item => {\r\n\t\t\t\treturn item.definition ? item.definition : '*Нет расшифровки';\r\n\t\t\t}).reduce((uniq, item) => {\r\n\t\t\t\treturn uniq.includes(item) ? uniq : [ ...uniq, item ];\r\n\t\t\t}, []);\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tfilterItems\r\n\t\t\t}\r\n\t\tcase 'SET_FILTER_RULES':\r\n\t\t\tlet rules = state.filterRules;\r\n\t\t\tlet filteredCatalog = state.filterRules.length > 0 ? state.filteredCatalog : [];\r\n\t\t\tif (action.payload.checked) {\r\n\t\t\t\trules = [...rules, action.payload.definition];\r\n\t\t\t\tconst filterByRule = state.catalog.filter((item) => {\r\n\t\t\t\t\treturn item.definition === action.payload.definition;\r\n\t\t\t\t});\r\n\t\t\t\tfilteredCatalog = [...filteredCatalog, ...filterByRule];\r\n\t\t\t} else {\r\n\t\t\t\trules.splice(rules.findIndex((item) => item === action.payload.definition), 1);\r\n\t\t\t\tfilteredCatalog = rules.map((rule) => {\r\n\t\t\t\t\treturn state.catalog.filter((item) => {\r\n\t\t\t\t\t\treturn item.definition === rule && item;\r\n\t\t\t\t\t});\r\n\t\t\t\t}).flat();\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tfilteredCatalog,\r\n\t\t\t\tfilterRules: rules\r\n\t\t\t}\r\n\t\tcase 'OPEN_FILTER':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\topenFilter: true\r\n\t\t\t}\r\n\t\tcase 'CLOSE_FILTER':\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\topenFilter: false\r\n\t\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nconst Catalog = () => {\r\n\tconst [state, dispatch] = useReducer(reducer, initialState);\r\n\tconst [updateStr, setUpdateStr] = useState('');\r\n\tconst [{response}, doApiFetch] = useApi(`/catalog${updateStr}`);\r\n\tconst [initialFetch, setInitialFetch] = useState(true);\r\n\tconst [action] = useState('get');\r\n\r\n\tconst catalogList = state.filteredCatalog.map((item, i) => {\r\n\t\treturn (\r\n\t\t\t<Fragment key={i}>\r\n\t\t\t\t<RichCell\r\n\t\t\t\t\tdata-id={item._id}\r\n\t\t\t\t\tmultiline\r\n\t\t\t\t\tcaption={item.name}\r\n\t\t\t\t\tafter={<Icon28EditOutline />}\r\n\t\t\t\t\tbottom={\r\n\t\t\t\t\t\tstate.editedElementId === item._id\r\n\t\t\t\t\t\t&&\r\n\t\t\t\t\t\t<Input\r\n\t\t\t\t\t\t\tid={state.editedElementId}\r\n\t\t\t\t\t\t\ttype={'text'}\r\n\t\t\t\t\t\t\tdefaultValue={item.definition}\r\n\t\t\t\t\t\t\tplaceholder={'Введите расшифровку'}\r\n\t\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\t\tdispatch({type: 'FILL_SAVE_CATALOG', payload: {id: state.editedElementId, definition: e.target.value}})\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\tdispatch({type: 'SET_EDITED_ELEMENT', payload: {id: e.currentTarget.dataset.id}});\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tactions={\r\n\t\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t\t<Button disabled style={{display: 'none'}}><Icon16Cancel /></Button>\r\n\t\t\t\t\t\t\t<Button disabled style={{display: 'none'}} mode={'secondary'}><Icon16Cancel /></Button>\r\n\t\t\t\t\t\t</Fragment>\r\n\t\t\t\t\t}>\r\n\t\t\t\t\t<b>{item.definition ? item.definition : 'Нет расшифровки'}</b>\r\n\t\t\t\t</RichCell>\r\n\t\t\t</Fragment>\r\n\t\t)\r\n\t});\r\n\r\n\tconst filterList = state.filterItems.map((item, i) => {\r\n\t\tconst defaultChecked = item !== '*Нет расшифровки' ? state.filterRules.includes(item) : state.filterRules.includes(undefined);\r\n\t\treturn(\r\n\t\t\t<SimpleCell key={i} after={<Switch data-definition={item} onChange={(e) => {\r\n\t\t\t\tconst {definition} = e.currentTarget.dataset;\r\n\t\t\t\tconst {checked} = e.currentTarget;\r\n\t\t\t\tdispatch({type: 'SET_FILTER_RULES', payload: {checked, definition: definition !== '*Нет расшифровки' ? definition : undefined}})\r\n\t\t\t}\r\n\t\t\t} defaultChecked={defaultChecked}/>}>{item}</SimpleCell>\r\n\t\t)\r\n\t});\r\n\r\n\t/**\r\n\t * Задаем фокус на элементе\r\n\t */\r\n\tuseEffect(() => {\r\n\t\tif(!state.editedElementId) return;\r\n\t\tdocument.getElementById(state.editedElementId).focus();\r\n\t},[state.editedElementId]);\r\n\r\n\t/**\r\n\t * Обращение к api\r\n\t */\r\n\tuseEffect(() => {\r\n\t\tif (!updateStr && !initialFetch) return;\r\n\r\n\t\tconst body = {};\r\n\t\tif (initialFetch) {\r\n\t\t\tbody.params = { a: action }\r\n\t\t}\r\n\t\tif (updateStr) {\r\n\t\t\tbody.method = 'PUT';\r\n\t\t\tbody.update = [...state.catalogToSave];\r\n\t\t}\r\n\t\tdoApiFetch(body);\r\n\t}, [updateStr, state.catalogToSave, doApiFetch, initialFetch, action]);\r\n\r\n\t/**\r\n\t * Обрабатываем результат запроса\r\n\t */\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: 'SET_CATALOG', payload: {catalog: response}});\r\n\t\tdispatch({type: 'SET_FILTER_ITEMS'})\r\n\t\tsetUpdateStr('');\r\n\t\tsetInitialFetch(false);\r\n\t}, [response]);\r\n\r\n\tconst style = {\r\n\t\tpaddingTop: state.filterRules.length !== 0 && 60,\r\n\t\tpaddingBottom: ([...state.catalogToSave].length !== 0 || (state.filterRules.length !== 0 && state.openFilter)) && 60\r\n\t}\r\n\r\n\tconst fixedLayoutStyle = {\r\n\t\tpaddingRight: 10,\r\n\t\tpaddingLeft: 10\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={<PanelHeaderButton onClick={() => {\r\n\t\t\t\t\tif (!state.openFilter) {\r\n\t\t\t\t\t\tdispatch({type: 'OPEN_FILTER'});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdispatch({type: 'CLOSE_FILTER'})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}}><Icon24Filter /></PanelHeaderButton>}\r\n\t\t\t>\r\n\t\t\t\tСправочник\r\n\t\t\t</PanelHeader>\r\n\t\t\t<Group style={style}>\r\n\t\t\t\t{!state.openFilter ? catalogList : filterList}\r\n\t\t\t</Group>\r\n\r\n\t\t\t{state.filterRules.length !== 0 && <FixedLayout style={fixedLayoutStyle} vertical=\"top\">\r\n\t\t\t\t<Separator wide/>\r\n\t\t\t\t<Button mode=\"destructive\" size={'xl'} onClick={() => {dispatch({type: 'ERASE_FILTER_RULES'})}}>Сбросить фильтр</Button>\r\n\t\t\t</FixedLayout>}\r\n\r\n\t\t\t{[...state.catalogToSave].length !== 0 && <FixedLayout style={fixedLayoutStyle} vertical=\"bottom\">\r\n\t\t\t\t<Separator wide/>\r\n\t\t\t\t<Button mode=\"commerce\" size={'xl'} onClick={() => {setUpdateStr('/update')}}>Сохранить изменения</Button>\r\n\t\t\t</FixedLayout>}\r\n\r\n\t\t\t{state.filterRules.length !== 0 && state.openFilter && <FixedLayout style={fixedLayoutStyle} vertical=\"bottom\">\r\n\t\t\t\t<Separator wide/>\r\n\t\t\t\t<Button mode=\"commerce\" size={'xl'} onClick={() => {dispatch({type: 'CLOSE_FILTER'})}}>Применить фильтр</Button>\r\n\t\t\t</FixedLayout>}\r\n\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Catalog;\r\n","import React, { useReducer, useEffect, Fragment } from 'react';\r\nimport {Checkbox, FormLayout, Group, Input, PanelHeader, Placeholder, SimpleCell} from \"@vkontakte/vkui\";\r\nimport Icon28DeleteOutline from '@vkontakte/icons/dist/28/delete_outline';\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\n\r\nconst initialState = {\r\n\tshoppingList: [],\r\n\tshoppingItem: {\r\n\t\ttext: '',\r\n\t\tdone: false\r\n\t},\r\n\tdate: new Date()\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'INITIAL_SHOPPING_LIST': {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tshoppingList: action.payload.list,\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'SET_SHOPPING_ITEM': {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tshoppingItem: {\r\n\t\t\t\t\ttext: action.payload.text,\r\n\t\t\t\t\tdone: false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'ADD_ITEM': {\r\n\t\t\tconst {shoppingList} = state;\r\n\t\t\tif (state.shoppingItem.text) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tshoppingList: [...shoppingList, state.shoppingItem],\r\n\t\t\t\t\tshoppingItem: {\r\n\t\t\t\t\t\ttext: '',\r\n\t\t\t\t\t\tdone: false\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn state\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'DELETE_ITEM': {\r\n\t\t\tconst { shoppingList } = state;\r\n\t\t\tshoppingList.splice(action.payload.index, 1);\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tshoppingList\r\n\t\t\t};\r\n\t\t}\r\n\t\tcase 'SET_DONE': {\r\n\t\t\tconst {shoppingList} = state;\r\n\t\t\tshoppingList[action.payload.index].done = !shoppingList[action.payload.index].done;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tshoppingList\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nconst ShoppingList = () => {\r\n\tconst [list, setList] = useLocalStorage('shoppingList', JSON.stringify([]));\r\n\tconst [state, dispatch] = useReducer(reducer, initialState);\r\n\tconst shoppingList = state.shoppingList.map((item, index) => {\r\n\t\treturn(\r\n\t\t\t<SimpleCell key={index} after={<Icon28DeleteOutline data-index={index} onClick={(e) => {dispatch({type: 'DELETE_ITEM', payload: {index: e.currentTarget.dataset.index}})}} />}>\r\n\t\t\t\t<Checkbox\r\n\t\t\t\t\tdefaultChecked={item.done}\r\n\t\t\t\t\tdata-index={index}\r\n\t\t\t\t\tstyle={{textDecoration: item.done && 'line-through'}}\r\n\t\t\t\t\tonChange={\r\n\t\t\t\t\t\t(e) => {\r\n\t\t\t\t\t\t\tdispatch({type: 'SET_DONE', payload: {index: e.currentTarget.dataset.index}})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t>\r\n\t\t\t\t\t{item.text}\r\n\t\t\t\t</Checkbox>\r\n\t\t\t</SimpleCell>\r\n\t\t)\r\n\t});\r\n\tuseEffect(() => {\r\n\t\tdispatch({type: 'INITIAL_SHOPPING_LIST', payload: { list: JSON.parse(list)}});\r\n\t}, [list]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (state.shoppingList.length === 0) return;\r\n\t\tsetList(JSON.stringify(state.shoppingList));\r\n\t}, [setList, state]);\r\n\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>Список покупок</PanelHeader>\r\n\t\t\t<FormLayout\r\n\t\t\t\tonSubmit={(e) => {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tdispatch({type: 'ADD_ITEM'});\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<Input\r\n\t\t\t\t\ttype={'text'}\r\n\t\t\t\t\ttop={'Наименование'}\r\n\t\t\t\t\tname={'shopping-item'}\r\n\t\t\t\t\tvalue={state.shoppingItem.text}\r\n\t\t\t\t\tonChange={(e) => {dispatch({type: 'SET_SHOPPING_ITEM', payload: {text: e.currentTarget.value}})}}\r\n\t\t\t\t\tplaceholder={'Введите название'}\r\n\t\t\t\t/>\r\n\t\t\t</FormLayout>\r\n\t\t\t<Group>\r\n\t\t\t\t{ state.shoppingList.length > 0\r\n\t\t\t\t\t?\r\n\t\t\t\t\tshoppingList\r\n\t\t\t\t\t:\r\n\t\t\t\t\t<Placeholder>\r\n\t\t\t\t\t\tВаш список покупок пуст.\r\n\t\t\t\t\t</Placeholder>\r\n\t\t\t\t}\r\n\t\t\t</Group>\r\n\t\t</Fragment>\r\n\t)\r\n}\r\n\r\nexport default ShoppingList;\r\n","import React, {useContext, useState, useEffect, useCallback} from 'react';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport {Panel, View, platform, ModalRoot, ModalPage, ModalPageHeader, IOS, Epic, Tabbar, TabbarItem} from \"@vkontakte/vkui\";\r\nimport Authorization from \"./panels/Authorization\";\r\nimport Profile from \"./panels/Profile\";\r\nimport {RouterContext} from \"./contexts/routerContext\";\r\nimport Balance from \"./panels/Balance\";\r\nimport AddDay from \"./panels/AddDay\";\r\nimport Modal from \"./components/Modal\";\r\nimport PanelHeaderButton from \"@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton\";\r\nimport prepare from \"./handlers/prepare\";\r\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\r\nimport Icon24Dismiss from '@vkontakte/icons/dist/24/dismiss';\r\nimport Registration from \"./panels/Registration\";\r\nimport {CurrentUserContext} from \"./contexts/currentUser\";\r\nimport Icon28MarketOutline from '@vkontakte/icons/dist/28/market_outline';\r\n// import Icon28GraphOutline from '@vkontakte/icons/dist/28/graph_outline';\r\nimport Icon28More from '@vkontakte/icons/dist/28/more';\r\nimport Icon28UserOutline from '@vkontakte/icons/dist/28/user_outline';\r\nimport Icon28AddSquareOutline from '@vkontakte/icons/dist/28/add_square_outline';\r\nimport Icon28ListOutline from '@vkontakte/icons/dist/28/list_outline';\r\nimport Analytics from \"./panels/Analytics\";\r\nimport More from \"./panels/More\";\r\nimport Catalog from \"./panels/Catalog\";\r\nimport ShoppingList from \"./panels/ShoppingList\";\r\n\r\nconst App = () => {\r\n\tconst [routerContext, dispatch] = useContext(RouterContext);\r\n\tconst [activeModal, setActiveModal] = useState(null);\r\n\tconst [modal, setModal] = useState(null);\r\n\tconst [receipt, setReceipt] = useState(null);\r\n\tconst [currentUserContext] = useContext(CurrentUserContext);\r\n\r\n\tconst modalBack = useCallback(() => {\r\n\t\tsetActiveModal(null);\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!receipt) return;\r\n\t\tconst osName = platform();\r\n\t\tsetModal(\r\n\t\t\t<ModalRoot activeModal={activeModal} onClose={modalBack}>\r\n\t\t\t\t<ModalPage\r\n\t\t\t\t\tid={'modal-page'}\r\n\t\t\t\t\tonClose={modalBack}\r\n\t\t\t\t\theader={\r\n\t\t\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\t\t\tleft={osName !== IOS && <PanelHeaderButton onClick={modalBack}><Icon24Cancel /></PanelHeaderButton>}\r\n\t\t\t\t\t\t\tright={osName === IOS && <PanelHeaderButton onClick={modalBack}>{osName === IOS ? 'Готово' : <Icon24Dismiss />}</PanelHeaderButton>}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{prepare.date(receipt.dateTime)}\r\n\t\t\t\t\t\t</ModalPageHeader>\r\n\t\t\t\t\t}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Modal onClose={modalBack} receipt={receipt}/>\r\n\t\t\t\t</ModalPage>\r\n\t\t\t</ModalRoot>\r\n\t\t);\r\n\t}, [receipt, activeModal, modalBack]);\r\n\r\n\tconst onStoryChange = (e) => {\r\n\t\tdispatch({type: 'SET_VIEW', payload: { view: e.currentTarget.dataset.story, panel: e.currentTarget.dataset.panel}});\r\n\t}\r\n\r\n\tconst tb = currentUserContext.currentUser && (<Tabbar>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={routerContext.view === 'balance' && routerContext.panel === 'balance.home'}\r\n\t\t\tdata-story=\"balance\"\r\n\t\t\tdata-panel={'home'}\r\n\t\t\ttext=\"Баланс\"\r\n\t\t><Icon28MarketOutline /></TabbarItem>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={routerContext.view === 'list'}\r\n\t\t\tdata-story=\"list\"\r\n\t\t\tdata-panel={'list'}\r\n\t\t\ttext=\"Список покупок\"\r\n\t\t><Icon28ListOutline /></TabbarItem>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={routerContext.view === 'balance' && routerContext.panel === 'balance.add'}\r\n\t\t\tdata-story=\"balance\"\r\n\t\t\tdata-panel=\"add\"\r\n\t\t\ttext=\"Добавить\"\r\n\t\t><Icon28AddSquareOutline /></TabbarItem>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={routerContext.view === 'profile'}\r\n\t\t\tdata-story=\"profile\"\r\n\t\t\tdata-panel={'edit'}\r\n\t\t\ttext=\"Профиль\"\r\n\t\t><Icon28UserOutline /></TabbarItem>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={routerContext.view === 'more'}\r\n\t\t\tdata-story=\"more\"\r\n\t\t\tdata-panel={'more'}\r\n\t\t\ttext=\"Ещё\"\r\n\t\t><Icon28More /></TabbarItem>\r\n\t</Tabbar>)\r\n\r\n\treturn (\r\n\t\t<Epic activeStory={routerContext.view}\r\n\t\t\t\t\ttabbar={tb}\r\n\t\t>\r\n\t\t\t<View id={'authorization'} activePanel={routerContext.panel} popout={routerContext.popout}>\r\n\t\t\t\t<Panel id={'authorization.login'}>\r\n\t\t\t\t\t<Authorization type={'login'} />\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'authorization.register'}>\r\n\t\t\t\t\t<Authorization type={'register'} />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'profile'} activePanel={routerContext.panel} popout={routerContext.popout}>\r\n\t\t\t\t<Panel id={'profile.edit'}>\r\n\t\t\t\t\t<Profile />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'registration'} activePanel={routerContext.panel} popout={routerContext.popout}>\r\n\t\t\t\t<Panel id={'registration.finish'}>\r\n\t\t\t\t\t<Registration />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'balance'} activePanel={routerContext.panel} popout={routerContext.popout} modal={modal}>\r\n\t\t\t\t<Panel id={'balance.home'}>\r\n\t\t\t\t\t<Balance\r\n\t\t\t\t\t\tsetReceiptFromBalance={setReceipt}\r\n\t\t\t\t\t\tonClickActiveModal={setActiveModal}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'balance.add'}>\r\n\t\t\t\t\t<AddDay />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'analytics'} activePanel={routerContext.panel} popout={routerContext.popout}>\r\n\t\t\t\t<Panel id={'analytics.home'}>\r\n\t\t\t\t\t<Analytics />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'more'} activePanel={routerContext.panel} popout={routerContext.popout}>\r\n\t\t\t\t<Panel id={'more.more'}>\r\n\t\t\t\t\t<More />\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'more.catalog'}>\r\n\t\t\t\t\t<Catalog />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'list'} activePanel={routerContext.panel} popout={routerContext.popout}>\r\n\t\t\t\t<Panel id={'list.list'}>\r\n\t\t\t\t\t<ShoppingList />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t</Epic>\r\n\t);\r\n};\r\n\r\nexport default App;\r\n","import { useEffect, useContext } from 'react';\r\nimport useApi from \"../hooks/useApi\";\r\nimport { CurrentUserContext } from '../contexts/currentUser';\r\nimport { AppSignContext } from \"../contexts/appSign\";\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\n\r\nconst CurrentUserChecker = ({ children }) => {\r\n\tconst [{response}, doFetch] = useApi('/users/profile');\r\n\tconst [, setCurrentUserState] = useContext(CurrentUserContext);\r\n\tconst [{vkUserId, matchUrlParams}] = useContext(AppSignContext);\r\n\tconst [token] = useLocalStorage('token');\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!token || !matchUrlParams) {\r\n\t\t\tsetCurrentUserState(state => ({\r\n\t\t\t\t...state,\r\n\t\t\t\tisLoggedIn: false\r\n\t\t\t}));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdoFetch();\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: true\r\n\t\t}))\r\n\t}, [doFetch, setCurrentUserState, token, matchUrlParams]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\r\n\t\tconst user = response.user.vk_id.toString() === vkUserId ? response.user : null;\r\n\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!user,\r\n\t\t\tcurrentUser: user\r\n\t\t}));\r\n\r\n\t}, [response, setCurrentUserState, vkUserId]);\r\n\treturn children;\r\n};\r\n\r\nexport default CurrentUserChecker;\r\n","import 'core-js/features/map';\r\nimport 'core-js/features/set';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport App from './App';\r\nimport {CurrentUserProvider} from \"./contexts/currentUser\";\r\nimport {AppSignProvider} from \"./contexts/appSign\";\r\nimport CurrentUserChecker from \"./components/CurrentUserChecker\";\r\nimport {RouterContextProvider} from \"./contexts/routerContext\";\r\n// import InstallingTheme from \"./components/InstallingTheme\";\r\n// import * as eruda from 'eruda';\r\n// import registerServiceWorker from './sw';\r\n\r\n// const el = document.createElement('div');\r\n// document.body.appendChild(el);\r\n//\r\n// eruda.init({\r\n//   container: el,\r\n//   tool: ['console', 'elements']\r\n// });\r\n\r\nbridge.subscribe(({ detail: { type, data }}) => {\r\n\tif (type === 'VKWebAppUpdateConfig') {\r\n\t\tconst schemeAttribute = document.createAttribute('scheme');\r\n\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\r\n\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\r\n\t}\r\n});\r\n\r\n// Init VK  Mini App\r\nbridge.send('VKWebAppInit');\r\n\r\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\r\n// расскомментируйте строку с registerServiceWorker();\r\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\r\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\r\n// registerServiceWorker();\r\n\r\nwindow.onload = () => {\r\n\tReactDOM.render(\r\n\t\t// <InstallingTheme>\r\n\t\t\t<AppSignProvider>\r\n\t\t\t\t<RouterContextProvider>\r\n\t\t\t\t\t<CurrentUserProvider>\r\n\t\t\t\t\t\t<CurrentUserChecker>\r\n\t\t\t\t\t\t\t<App/>\r\n\r\n\t\t\t\t\t\t</CurrentUserChecker>\r\n\t\t\t\t\t</CurrentUserProvider>\r\n\t\t\t\t</RouterContextProvider>\r\n\t\t\t</AppSignProvider>\r\n\t\t// </InstallingTheme>\r\n\t\t,\r\n\t\tdocument.getElementById('root')\r\n\t);\r\n};\r\n"],"sourceRoot":""}