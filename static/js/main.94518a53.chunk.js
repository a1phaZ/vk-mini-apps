(this["webpackJsonpvk-mini-apps-empty"]=this["webpackJsonpvk-mini-apps-empty"]||[]).push([[0],{270:function(e,t,a){e.exports=a(459)},375:function(e,t){},377:function(e,t){},410:function(e,t){},411:function(e,t){},456:function(e,t,a){},459:function(e,t,a){"use strict";a.r(t);a(271),a(297),a(299),a(300),a(302),a(303),a(304),a(305),a(306),a(307),a(308),a(309),a(311),a(312),a(313),a(314),a(315),a(316),a(317),a(318),a(319),a(320),a(322),a(323),a(324),a(325),a(326),a(327),a(328),a(329),a(330),a(331),a(332),a(333),a(334),a(335),a(336),a(337),a(338),a(339);var n=a(0),c=a.n(n),r=a(55),l=a.n(r),o=a(32),u=a.n(o),i=a(3),s=(a(347),a(4)),m=a(80),f=a.n(m),d=a(31),p=a(66),b=a.n(p),E=a(62),O=a.n(E),j=a(203),v=a.n(j),g=a(204),h=a.n(g),y=a(224),S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=Object(n.useState)((function(){return localStorage.getItem(e)||t})),c=Object(i.a)(a,2),r=c[0],l=c[1];return Object(n.useEffect)((function(){localStorage.setItem(e,r)}),[r,e]),[r,l]},k=a(205),C=a.n(k),w={view:"authorization",panel:"authorization.login",popout:null,error:null},x=function(e,t){switch(t.type){case"SET_VIEW":return Object(d.a)({},e,{view:t.payload.view,panel:"".concat(t.payload.view,".").concat(t.payload.panel)});case"SET_PANEL":return Object(d.a)({},e,{panel:"".concat(e.view,".").concat(t.payload.panel)});case"SHOW_LOADING":return Object(d.a)({},e,{popout:c.a.createElement(s.t,null,c.a.createElement(s.v,null))});case"HIDE_LOADING":return Object(d.a)({},e,{popout:null});case"SET_ERROR":return Object(d.a)({},e,{error:t.payload.error});case"UNSET_ERROR":return Object(d.a)({},e,{error:null});default:return e}},T=Object(n.createContext)(),I=function(e){var t=Object(n.useState)(!1),a=Object(i.a)(t,2),c=a[0],r=a[1],l=Object(n.useState)(null),o=Object(i.a)(l,2),u=o[0],s=o[1],m=Object(n.useState)(null),d=Object(i.a)(m,2),p=d[0],b=d[1],E=Object(n.useState)({}),O=Object(i.a)(E,2),j=O[0],v=O[1],g=S("token"),h=Object(i.a)(g,1)[0],k=Object(n.useContext)(T),w=Object(i.a)(k,2)[1],x="http://localhost:3000/api",I=Object(n.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v(e),r(!0),w({type:"SHOW_LOADING"})}),[w]),L=j.method,N=void 0===L?"GET":L,A=j.params,_=Object(y.a)(j,["method","params"]);return Object(n.useEffect)((function(){if(c){var t={"Content-Type":"application/json",Authorization:h?"Token ".concat(h):""},a=A?C.a.stringify(A):null,n=a?"".concat(x).concat(e,"?").concat(a):"".concat(x).concat(e);f.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.awrap(fetch(n,{method:N,mode:"cors",headers:t,body:"GET"!==N?JSON.stringify(_):null}).then((function(e){if(!e.ok)throw Error(e.statusText);return e.json()})).then((function(e){r(!1),w({type:"HIDE_LOADING"}),s(e)})).catch((function(e){r(!1),w({type:"HIDE_LOADING"}),w({type:"SET_ERROR",payload:{error:e}}),b(e)})));case 2:case"end":return e.stop()}}))}}),[c,_,N,e,x,h,A,w]),[{isLoading:c,response:u,error:p},I]},L=a(128),N=a.n(L),A=a(206),_=a.n(A),P=Object(n.createContext)([{},function(){}]),R=Object(n.createContext)([{},function(e){}]),D=function(e){var t=e.go,a=e.goView,r=e.type,l=Object(n.useState)(""),o=Object(i.a)(l,2),u=o[0],m=o[1],p=Object(n.useState)(""),E=Object(i.a)(p,2),j=E[0],g=E[1],y=Object(n.useState)(null),k=Object(i.a)(y,2),C=k[0],w=k[1],x=I("/users/".concat(r)),L=Object(i.a)(x,2),N=L[0],A=N.response,_=N.error,D=L[1],F=Object(n.useContext)(P),U=Object(i.a)(F,1)[0].vkUserId,z=Object(n.useState)(!1),W=Object(i.a)(z,2),V=W[0],K=W[1],M=Object(n.useContext)(R),q=Object(i.a)(M,2),G=q[0],H=q[1],B=S("token"),J=Object(i.a)(B,2)[1],Y=Object(n.useContext)(T),Z=Object(i.a)(Y,2)[1];Object(n.useEffect)((function(){if(G.isLoggedIn){var e=G.currentUser,t=e.name,a=e.phone,n=e.email,c=e.password;Z(t&&a&&n&&c?{type:"SET_VIEW",payload:{view:"balance",panel:"home"}}:{type:"SET_VIEW",payload:{view:"profile",panel:"edit"}})}}),[G,Z]),Object(n.useEffect)((function(){"login"!==r&&(u.length===j.length?u!==j&&w({status:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438",message:"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0432\u0432\u043e\u0434 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443."}):w(null))}),[u,j,r]),Object(n.useEffect)((function(){V&&(D({method:"POST",user:{id:+U,password:u}}),K(!1))}),[V,D,u,U]),Object(n.useEffect)((function(){A&&(!A.user&&A.error?w(A.error):J(A.user.token),H((function(e){return Object(d.a)({},e,{isLoading:!1,isLoggedIn:!!A.user,currentUser:A.user||null})})))}),[A,H,t,a,J]),Object(n.useEffect)((function(){_&&w(_)}),[_]);var $=function(e){e.target.value=Math.max(0,parseInt(e.target.value)).toString().slice(0,4),"password"===e.target.name?m(e.target.value):g(e.target.value)};return c.a.createElement(n.Fragment,null,c.a.createElement(b.a,null,"login"===r?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),c.a.createElement(s.s,{icon:"login"===r?c.a.createElement(v.a,null):c.a.createElement(h.a,null),header:"login"===r?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c":"\u041f\u0440\u0438\u0434\u0443\u043c\u0430\u0439\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.d,null,C?c.a.createElement(s.f,{header:C.status,mode:"error"},C.message):null,c.a.createElement(s.e,{top:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.i,{name:"password",type:"number",onChange:$,align:"center",value:u})),"login"!==r?c.a.createElement(s.e,{top:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},c.a.createElement(s.i,{type:"number",name:"confirmPassword",onChange:$,align:"center",value:j})):null,c.a.createElement(O.a,{size:"l",onClick:function(){return f.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:K(!0);case 1:case"end":return e.stop()}}))}},"login"===r?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"))),c.a.createElement(s.c,null,c.a.createElement(O.a,{stretched:!0,mode:"tertiary",onClick:function(e){Z({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"login"===r?"register":"login"},"login"===r?"\u041d\u0435\u0442 \u043f\u0430\u0440\u043e\u043b\u044f?":"\u0415\u0441\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c?")))},F=a(90),U=a.n(F),z=a(91),W=a.n(z),V=function(){var e=Object(n.useState)(""),t=Object(i.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)(""),o=Object(i.a)(l,2),m=o[0],f=o[1],p=Object(n.useState)(""),b=Object(i.a)(p,2),E=b[0],O=b[1],j=Object(n.useState)(""),v=Object(i.a)(j,2),g=v[0],h=v[1],y=Object(n.useState)(!1),S=Object(i.a)(y,2),k=S[0],C=S[1],w=Object(n.useState)(!0),x=Object(i.a)(w,2),L=x[0],N=x[1],A=I("/users/profile"),_=Object(i.a)(A,2),P=_[0].response,D=_[1],F=Object(n.useState)(!1),z=Object(i.a)(F,2),V=z[0],K=z[1],M=Object(n.useContext)(R),q=Object(i.a)(M,2),G=q[0],H=q[1],B=Object(n.useContext)(T),J=Object(i.a)(B,2)[1],Y=Object(s.A)();return Object(n.useEffect)((function(){u.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppGetPersonalCardResult":r(n.email),f(n.phone),console.log("profile",n);break;case"VKWebAppGetPersonalCardFailed":console.log("profile error",n)}}))}),[]),Object(n.useEffect)((function(){var e=G.currentUser,t=e.email,a=e.name,n=e.phone,c=e.password;r(t||""),O(a||""),f(n||""),h(c||""),N(!!t&&!!a&&!!n&&!!c)}),[G]),Object(n.useEffect)((function(){V&&(D({method:"PUT",update:{email:a,phone:m,name:E,kktPassword:g}}),K(!1))}),[V,D,a,m,E,g]),Object(n.useEffect)((function(){if(P){var e=P.user;e.name&&e.phone&&e.email&&e.password&&(H((function(e){return Object(d.a)({},e,{isLoading:!1,isLoggedIn:!!P.user,currentUser:P.user||null})})),J({type:"SET_VIEW",payload:{view:"balance",panel:"home"}}))}}),[P,J,H]),c.a.createElement(n.Fragment,null,c.a.createElement(s.o,{left:L&&c.a.createElement(s.p,{onClick:function(){J({type:"SET_VIEW",payload:{view:"balance",panel:"home"}})}},Y===s.h?c.a.createElement(U.a,null):c.a.createElement(W.a,null))},"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"),c.a.createElement(s.d,null,k&&c.a.createElement(s.f,{header:"\u0417\u0430\u043f\u0440\u043e\u0441 \u043d\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d",mode:"default"},"\u041f\u0430\u0440\u043e\u043b\u044c \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0440\u0438\u0434\u0442\u0438 \u043a \u0432\u0430\u043c \u0432 \u0441\u043c\u0441. \u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c \u0432 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0435 \u043f\u043e\u043b\u0435. \u0415\u0441\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u043d\u0435 \u043f\u0440\u0438\u0448\u0435\u043b \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443 \u043f\u043e\u0437\u0436\u0435."),c.a.createElement(s.i,{type:"text",top:"\u0418\u043c\u044f",name:"name",value:E,onChange:function(e){O(e.target.value)}}),c.a.createElement(s.e,{top:"E-mail \u0438 \u0422\u0435\u043b\u0435\u0444\u043e\u043d",bottom:"\u042d\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0447\u0435\u0440\u0435\u0437 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0412\u043a\u043e\u043d\u0442\u0430\u043a\u0442\u0435. \u041e\u043d\u0438 \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421 \u0434\u043b\u044f \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438 \u0447\u0435\u043a\u043e\u0432."},c.a.createElement(s.i,{type:"email",top:"e-mail",name:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 e-mail",value:a,onChange:function(e){r(e.target.value)}}),c.a.createElement(s.i,{type:"phone",top:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",name:"phone",value:m,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043b\u0435\u0444\u043e\u043d",onChange:function(e){f(e.target.value)}}),c.a.createElement(s.a,{size:"xl",onClick:function(){u.a.send("VKWebAppAllowNotifications",{})}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 VK")),c.a.createElement(s.e,{top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421"},c.a.createElement(s.i,{type:"number",top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c \u0424\u041d\u0421",name:"kktPassword",value:g,onChange:function(e){h(e.target.value)}}),c.a.createElement(s.a,{size:"xl",onClick:function(){C(!0)}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421")),c.a.createElement(s.a,{size:"xl",mode:"commerce",onClick:function(){K(!0)}},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f")))},K=a(207),M=a(208),q=function(){function e(){Object(K.a)(this,e)}return Object(M.a)(e,null,[{key:"qr",value:function(e){var t,a,n,c,r;if(e){var l=e.match(/t=(\w{8}T\w+)&s=(\w+\.*\w+)&fn=(\w+)&i=(\w+)&fp=(\w+)/),o=Object(i.a)(l,6);t=o[1],a=o[2],n=o[3],c=o[4],r=o[5]}return{dt:t,sum:a,fn:n,i:c,fp:r}}},{key:"date",value:function(e){var t,a=new Date(e);switch(a.getMonth()+1){case 1:t="\u044f\u043d\u0432\u0430\u0440\u044f";break;case 2:t="\u0444\u0435\u0432\u0440\u0430\u043b\u044f";break;case 3:t="\u043c\u0430\u0440\u0442\u0430";break;case 4:t="\u0430\u043f\u0440\u0435\u043b\u044f";break;case 5:t="\u043c\u0430\u044f";break;case 6:t="\u0438\u044e\u043d\u044f";break;case 7:t="\u0438\u044e\u043b\u044f";break;case 8:t="\u0430\u0432\u0433\u0443\u0441\u0442\u0430";break;case 9:t="\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f";break;case 10:t="\u043e\u043a\u0442\u044f\u0431\u0440\u044f";break;case 11:t="\u043d\u043e\u044f\u0431\u0440\u044f";break;case 12:t="\u0434\u0435\u043a\u0430\u0431\u0440\u044f"}return"".concat(a.getDate()," ").concat(t," ").concat(a.getFullYear())}},{key:"sum",value:function(e){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e/100)}},{key:"totalReceiptSum",value:function(e){if(0===e.length)return 0;return e.map((function(e){return e.sum||e.totalSum})).reduce((function(e,t){return e+t}))}},{key:"totalSumWithParams",value:function(e){if(0===e.length)return 0;return e.map((function(e){var t=e.income,a=e.sum;return t?a:-1*a})).reduce((function(e,t){return e+t}))}},{key:"totalSum",value:function(e,t){if(0===e.length)return 0;var a=function(e,t){return e+t},n=e.map((function(e){return e.items.map((function(e){return t?e.income?e.sum:0:e.income?0:e.sum})).reduce(a)})).reduce(a);return t?n:-1*n}}]),e}(),G=function(e){var t=e.sum,a=e.fs,n=t>=0?{color:"#28a745",fontSize:a}:{color:"#dc3545",fontSize:a};return c.a.createElement("span",{style:n},q.sum(t))},H=a(94),B=a.n(H),J=a(67),Y=a.n(J),Z=a(209),$=a.n(Z),Q=a(210),X=a.n(Q),ee=a(211),te=a.n(ee),ae=a(225),ne=a(461),ce=a(462),re=a(463),le=a(212),oe=a.n(le),ue=a(213),ie=a.n(ue),se=function(e){var t=e.setDateFromCalendar,a=Object(n.useState)(new Date),r=Object(i.a)(a,2),l=r[0],o=r[1];Object(n.useEffect)((function(){t(l)}),[l,t]);return c.a.createElement(s.g,null,c.a.createElement(s.j,null,c.a.createElement(s.b,{before:c.a.createElement(s.a,{onClick:function(){o(Object(ne.a)(l,1))},mode:"secondary"},c.a.createElement(oe.a,null)),asideContent:c.a.createElement(s.a,{onClick:function(){o(Object(ae.a)(l,1))},mode:"secondary"},c.a.createElement(ie.a,null)),style:{textAlign:"center",fontWeight:"bold"}},Object(ce.a)(l,"LLLL yyyy",{locale:re.a}).toLocaleUpperCase())))},me=a(214),fe=a.n(me),de=a(215),pe=a.n(de),be=a(216),Ee=a.n(be),Oe=a(217),je=a.n(Oe),ve=function(e){var t=e.before,a=e.onClick,n=void 0===a?function(){}:a,r=e.view,l=e.mode,o=e.title;return c.a.createElement(Y.a,{before:t,onClick:n,"data-view":r,"data-mode":l},o)},ge=function(){var e=Object(n.useState)(!1),t=Object(i.a)(e,2),a=t[0],r=t[1],l=Object(n.useContext)(T),o=Object(i.a)(l,2)[1],u=function(){r(!a)};return c.a.createElement(n.Fragment,null,c.a.createElement(b.a,null,c.a.createElement(s.q,{aside:c.a.createElement(fe.a,{style:{transform:"rotate(".concat(a?"180deg":"0",")")}}),onClick:u},"Balance")),c.a.createElement(s.r,{opened:a,onClose:u},c.a.createElement(s.j,null,c.a.createElement(ve,{before:c.a.createElement(pe.a,null),onClick:function(e){var t=e.currentTarget.dataset,a=t.view,n=t.mode;o({type:"SET_VIEW",payload:{view:a,panel:n}})},view:"profile",mode:"edit",title:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"}),c.a.createElement(ve,{before:c.a.createElement(Ee.a,null),view:"settings",mode:"edit",title:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f *"}),c.a.createElement(ve,{before:c.a.createElement(je.a,null),view:"donation",mode:"donate",title:"\u041d\u0430 \u043a\u043e\u0444\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443*"}),c.a.createElement(s.x,null),c.a.createElement(Y.a,null,"* \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435"))))},he=a(223),ye=(a(456),a(93)),Se=a.n(ye),ke=function(e){var t=e.items,a=e.id,r=e.isSearch,l=void 0!==r&&r,o=t.map((function(e,t){var a=e.income?e.sum:-1*e.sum;return c.a.createElement("div",{key:t,className:"receipt-item"},c.a.createElement("span",{className:"receipt-item-name"},e.name),e.price&&!l?c.a.createElement("span",{className:"receipt-item-price"},q.sum(e.price)):null,e.quantity&&!l?c.a.createElement("span",{className:"receipt-item-quantity"},e.quantity):null,e.dateTime&&l?c.a.createElement("span",{className:"receipt-item-dateTime"},q.date(e.dateTime)):null,a?c.a.createElement("span",{className:"receipt-item-sum"},c.a.createElement(G,{sum:a})):null)}));return c.a.createElement(Se.a,{id:a,className:"receipt-item-wrapper"},c.a.createElement("div",{className:"receipt-item"},c.a.createElement("span",{className:"receipt-item-name"},"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),l?c.a.createElement("span",{className:"receipt-item-dateTime"},"\u0414\u0430\u0442\u0430"):c.a.createElement(n.Fragment,null,c.a.createElement("span",{className:"receipt-item-price"},"\u0426\u0435\u043d\u0430"),c.a.createElement("span",{className:"receipt-item-quantity"},"\u041a\u043e\u043b-\u0432\u043e")),c.a.createElement("span",{className:"receipt-item-sum"},"\u0421\u0443\u043c\u043c\u0430")),c.a.createElement(s.x,null),o,c.a.createElement(s.x,null),c.a.createElement("div",{className:"receipt-total"},c.a.createElement("span",{className:""},"\u0418\u0442\u043e\u0433\u043e:"),c.a.createElement("span",null,c.a.createElement(G,{sum:q.totalSumWithParams(t)}))))},Ce=function(e){var t=e.receipts,a=Object(n.useState)(""),r=Object(i.a)(a,2),l=r[0],o=r[1],u=Object(n.useState)([]),m=Object(i.a)(u,2),f=m[0],d=m[1],p=Object(n.useState)([]),b=Object(i.a)(p,2),E=b[0],O=b[1];return Object(n.useEffect)((function(){if(t){var e=[];console.time("prepare array"),t.map((function(e){var t=e.dateTime;return e.items.map((function(e){return e.dateTime=t,e}))})).forEach((function(t){e.push.apply(e,Object(he.a)(t))})),console.timeEnd("prepare array"),d(e)}}),[t]),Object(n.useEffect)((function(){O(l?f.filter((function(e){return e.name.toLowerCase().indexOf(l)>-1})):[])}),[l,f]),c.a.createElement(n.Fragment,null,c.a.createElement(s.w,{value:l,onChange:function(e){o(e.target.value.toLowerCase())}}),c.a.createElement(B.a,{title:"\u041f\u043e\u0438\u0441\u043a"},E.length>0&&c.a.createElement(ke,{id:E._id,isSearch:!0,items:E})))},we=function(e){var t=e.setReceiptFromBalance,a=e.onClickActiveModal,r=Object(n.useState)(!0),l=Object(i.a)(r,2),o=l[0],u=l[1],m=Object(n.useState)(new Date),f=Object(i.a)(m,2),d=f[0],p=f[1],b=Object(n.useState)([]),E=Object(i.a)(b,2),j=E[0],v=E[1],g=I("/day"),h=Object(i.a)(g,2),y=h[0].response,S=h[1],k=Object(n.useContext)(T),C=Object(i.a)(k,2)[1],w=Object(n.useCallback)((function(e){p(e),u(!0)}),[]);return Object(n.useEffect)((function(){o&&(S({params:{date:Object(ce.a)(d,"yyyy-MM-dd")}}),u(!1))}),[o,u,S,d]),Object(n.useEffect)((function(){y&&v(y)}),[y,t]),c.a.createElement(n.Fragment,null,c.a.createElement(ge,{title:"\u0411\u0430\u043b\u0430\u043d\u0441"}),c.a.createElement(Ce,{receipts:j}),c.a.createElement(s.s,{icon:c.a.createElement($.a,null),header:c.a.createElement(G,{sum:q.totalReceiptSum(j),fs:"2em"}),action:c.a.createElement(O.a,{size:"l",onClick:function(e){C({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"add"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0445\u043e\u0434 / \u0440\u0430\u0441\u0445\u043e\u0434")},"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439\u0442\u0435 \u0434\u043e\u0445\u043e\u0434\u044b/\u0440\u0430\u0441\u0445\u043e\u0434\u044b"),c.a.createElement(s.x,null),c.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",paddingTop:"1em"}},c.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-end"}},c.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingRight:"10px"}},c.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em",textAlign:"end"}},"\u0414\u043e\u0445\u043e\u0434\u044b"),c.a.createElement(G,{sum:q.totalSum(j,!0),fs:"1.4em"})),c.a.createElement(X.a,{width:16,height:40,fill:"#28a745"})),c.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-start"}},c.a.createElement(te.a,{width:16,height:40,fill:"#dc3545"}),c.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingLeft:"10px"}},c.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em"}},"\u0420\u0430\u0441\u0445\u043e\u0434\u044b"),c.a.createElement(G,{sum:q.totalSum(j,!1),fs:"1.4em"})))),c.a.createElement(B.a,{title:"\u0427\u0435\u043a\u0438"},c.a.createElement(s.j,null,c.a.createElement(se,{setDateFromCalendar:w}),j.map((function(e,n){return c.a.createElement(Y.a,{key:n,expandable:!0,onClick:function(){a("modal-page"),t(e)},"data-to":e._id,indicator:c.a.createElement(G,{sum:e.totalSum})},q.date(e.dateTime))})))))},xe=a(81),Te=a.n(xe),Ie=a(68),Le=a.n(Ie),Ne=a(221),Ae=a.n(Ne),_e=a(218),Pe=a.n(_e),Re=a(220),De=a.n(Re),Fe=a(219),Ue=a.n(Fe),ze=a(61),We=a.n(ze),Ve=function(){var e=Object(n.useState)(""),t=Object(i.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)((function(){var e=new Date,t=e.getMonth()+1>9?e.getMonth()+1:"0".concat(e.getMonth()+1),a=e.getDate()>9?e.getDate():"0".concat(e.getDate());return"".concat(e.getFullYear(),"-").concat(t,"-").concat(a)})),o=Object(i.a)(l,2),m=o[0],f=o[1],d=Object(n.useState)(1),p=Object(i.a)(d,2),E=p[0],j=p[1],v=Object(n.useState)(""),g=Object(i.a)(v,2),h=g[0],y=g[1],S=Object(n.useState)(!1),k=Object(i.a)(S,2),C=k[0],w=k[1],x=Object(n.useState)(null),L=Object(i.a)(x,2),N=L[0],A=L[1],_=Object(n.useState)(null),P=Object(i.a)(_,2)[1],R=Object(n.useContext)(T),D=Object(i.a)(R,2)[1],F=I("/day"),z=Object(i.a)(F,2),V=z[0].response,K=z[1],M=Object(n.useState)(!1),q=Object(i.a)(M,2),G=q[0],H=q[1],B=Object(s.A)();return Object(n.useEffect)((function(){u.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppOpenCodeReaderResult":P(n.code_data),console.log("add day",n);break;case"VKWebAppOpenCodeReaderFailed":console.log("add day error",n)}}))}),[]),Object(n.useEffect)((function(){G&&(K({method:"POST",date:m,items:[{name:a,quantity:E,price:100*h,sum:100*h*E,income:C,modifiers:[],properties:[]}]}),r(""),j(1),w(!1),y(""),H(!1))}),[G,H,m,K,C,a,h,E]),Object(n.useEffect)((function(){V&&A(c.a.createElement(s.y,{layout:"vertical",onClose:function(){return A(null)},before:c.a.createElement(Ue.a,{size:24,style:{backgroundColor:"var(--accent)"}},c.a.createElement(We.a,{fill:"#fff",width:14,height:14}))},"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0448\u043b\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e"))}),[V]),c.a.createElement(n.Fragment,null,c.a.createElement(b.a,{left:c.a.createElement(Le.a,{key:"back",onClick:function(e){D({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"home"},B===s.h?c.a.createElement(U.a,null):c.a.createElement(W.a,null))},c.a.createElement(De.a,{before:c.a.createElement(Le.a,{key:"qr",onClick:function(){u.a.send("VKWebAppOpenCodeReader",{})}},c.a.createElement(Pe.a,null))},"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438")),c.a.createElement(Se.a,null,c.a.createElement(Te.a,{type:"date",top:"\u0414\u0430\u0442\u0430",name:"date",value:m,onChange:function(e){f(e.currentTarget.value)}}),c.a.createElement(Te.a,{type:"text",top:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"name",value:a,onChange:function(e){r(e.currentTarget.value)}}),c.a.createElement(Te.a,{type:"number",top:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",name:"quantity",value:E,onChange:function(e){j(e.currentTarget.value)}}),c.a.createElement(Te.a,{type:"number",top:"\u0426\u0435\u043d\u0430",name:"price",value:h,onChange:function(e){y(e.currentTarget.value)}}),c.a.createElement(Ae.a,{name:"income",checked:C,onChange:function(e){w(e.currentTarget.checked)}},"\u0414\u043e\u0445\u043e\u0434"),c.a.createElement(O.a,{size:"xl",disabled:!m||!a||!E||!h,mode:C?"commerce":"destructive",onClick:function(){H(!0)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c ",C?"\u0434\u043e\u0445\u043e\u0434":"\u0440\u0430\u0441\u0445\u043e\u0434")),N)},Ke=function(e){var t=e.receipt;return c.a.createElement(s.j,null,c.a.createElement(ke,{id:t._id,dateTime:t.dateTime,items:t.items}))},Me=a(79),qe=a.n(Me),Ge=a(222),He=a.n(Ge),Be=function(){var e=Object(n.useContext)(T),t=Object(i.a)(e,1)[0],a=Object(n.useState)(null),r=Object(i.a)(a,2),l=r[0],o=r[1],u=Object(n.useState)(null),m=Object(i.a)(u,2),f=m[0],d=m[1],p=Object(n.useState)(null),b=Object(i.a)(p,2),E=b[0],O=b[1],j=Object(n.useCallback)((function(){o(null)}),[]);return Object(n.useEffect)((function(){if(E){var e=Object(s.A)();d(c.a.createElement(s.m,{activeModal:l,onClose:j},c.a.createElement(s.k,{id:"modal-page",onClose:j,header:c.a.createElement(s.l,{left:e!==s.h&&c.a.createElement(Le.a,{onClick:j},c.a.createElement(qe.a,null)),right:e===s.h&&c.a.createElement(Le.a,{onClick:j},e===s.h?"\u0413\u043e\u0442\u043e\u0432\u043e":c.a.createElement(He.a,null))},q.date(E.dateTime))},c.a.createElement(Ke,{onClose:j,receipt:E}))))}}),[E,l,j]),c.a.createElement(s.u,{activeView:t.view,popout:t.popout,modal:f,onTransition:null},c.a.createElement(s.z,{id:"authorization",activePanel:t.panel},c.a.createElement(s.n,{id:"authorization.login"},c.a.createElement(D,{type:"login"})),c.a.createElement(s.n,{id:"authorization.register"},c.a.createElement(D,{type:"register"}))),c.a.createElement(s.z,{id:"profile",activePanel:t.panel},c.a.createElement(s.n,{id:"profile.edit"},c.a.createElement(V,null))),c.a.createElement(s.z,{id:"balance",activePanel:t.panel},c.a.createElement(s.n,{id:"balance.home"},c.a.createElement(we,{setReceiptFromBalance:O,onClickActiveModal:o})),c.a.createElement(s.n,{id:"balance.add"},c.a.createElement(Ve,null))))},Je=function(e){var t=e.children;return Object(n.useEffect)((function(){u.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;if("VKWebAppUpdateConfig"===a){var c=document.createAttribute("scheme");c.value=n.scheme?n.scheme:"client_light",document.body.attributes.setNamedItem(c)}}))}),[]),t},Ye=function(e){var t=e.children,a=I("/users/profile"),c=Object(i.a)(a,2),r=c[0].response,l=c[1],o=Object(n.useContext)(R),u=Object(i.a)(o,2)[1],s=S("token"),m=Object(i.a)(s,1)[0];return Object(n.useEffect)((function(){m?(l(),u((function(e){return Object(d.a)({},e,{isLoading:!0})}))):u((function(e){return Object(d.a)({},e,{isLoggedIn:!1})}))}),[l,u,m]),Object(n.useEffect)((function(){r&&u((function(e){return Object(d.a)({},e,{isLoading:!1,isLoggedIn:!!r.user,currentUser:r.user||null})}))}),[r,u]),t};u.a.send("VKWebAppInit",{}).then((function(e){return console.log(e)})).catch((function(e){return console.log(e)})),l.a.render(c.a.createElement(Je,null,c.a.createElement((function(e){var t=e.children,a=function(){var e=Object(n.useState)(""),t=Object(i.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)(!1),l=Object(i.a)(r,2),o=l[0],u=l[1],s=Object(n.useState)(null),m=Object(i.a)(s,2),f=m[0],d=m[1],p=Object(n.useState)(!1),b=Object(i.a)(p,2),E=b[0],O=b[1];return Object(n.useEffect)((function(){if(o){var e=N.a.parse(a);if(e){d(e.vk_user_id);var t={};Object.keys(e).sort().forEach((function(a){"vk_"===a.slice(0,3)&&(t[a]=e[a])}));var n=N.a.stringify(t),c=_.a.createHmac("sha256","Zs6DYRE8Z2mZ44LfciKW").update(n).digest().toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=$/,"");O(c===e.sign)}}}),[o,a]),[{vkUserId:f,matchUrlParams:E},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";c(e),u(!0)}]}(),r=Object(i.a)(a,2),l=r[0],o=l.vkUserId,u=l.matchUrlParams,s=r[1],m=Object(n.useState)({vkUserId:null,matchUrlParams:!1}),f=Object(i.a)(m,2),d=f[0],p=f[1];return Object(n.useEffect)((function(){s(window.location.search.slice(1))}),[s]),Object(n.useEffect)((function(){o&&p({vkUserId:o,matchUrlParams:u})}),[o,u]),c.a.createElement(P.Provider,{value:[d,p]},t)}),null,c.a.createElement((function(e){var t=e.children,a=Object(n.useReducer)(x,w);return c.a.createElement(T.Provider,{value:a},t)}),null,c.a.createElement((function(e){var t=e.children,a=Object(n.useState)({isLoading:!1,isLoggedIn:null,currentUser:null}),r=Object(i.a)(a,2),l=r[0],o=r[1];return c.a.createElement(R.Provider,{value:[l,o]},t)}),null,c.a.createElement(Ye,null,c.a.createElement(Be,null)))))),document.getElementById("root"))}},[[270,1,2]]]);
//# sourceMappingURL=main.94518a53.chunk.js.map