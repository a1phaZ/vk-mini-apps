{"version":3,"sources":["handlers/prepare.js","panels/ColoredSum.js","panels/Receipt/index.js","panels/Receipt/receipt.js","panels/Home.js","panels/Profile.js","panels/Info.js","services/api.js","App.js","index.js"],"names":["Prepare","str","dt","sum","fn","i","fp","match","monthName","Date","getMonth","getDate","getFullYear","n","Intl","NumberFormat","style","currency","format","arr","totalSum","totalSumArr","map","item","length","ColoredSum","stl","color","prepare","Receipt","items","id","receiptItem","dateTime","setActiveModal","index","income","title","name","key","price","indicator","quantity","Home","state","activeModal","modalHistory","modalBack","indexOf","splice","push","setState","this","props","receipts","fetchedUser","qr","go","popout","osName","platform","modal","receipt","_id","onClose","header","left","IOS","onClick","right","date","activePanel","before","photo_200","src","description","city","first_name","last_name","fontSize","fontWeight","totalReceiptSum","expandable","e","currentTarget","dataset","to","data-to","size","level","connect","send","Component","Profile","useState","email","setEmail","phone","setPhone","useEffect","subscribe","detail","type","data","Info","Api","_apiBase","method","uri","body","token","bodyFields","headers","Authorization","fetch","mode","JSON","stringify","res","ok","err","Error","subMessage","json","callApi","App","apiService","ApiService","setActivePanel","setUser","setToken","setError","setPopout","setQR","onData","user","console","log","onError","error","schemeAttribute","document","createAttribute","value","scheme","attributes","setNamedItem","code_data","a","async","sendPromise","vk_user","userCurrent","then","catch","userLogin","userRegister","fetchData","QR","activeStory","tabbar","selected","height","width","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.b1af5de9.chunk.js","sourcesContent":["export default class Prepare {\r\n\tstatic qr (str){\r\n\t\tlet dt, sum, fn, i, fp;\r\n\r\n\t\tif (str) {\r\n\t\t\t[, dt, sum, fn, i, fp] = str.match(/t=(\\w{8}T\\w+)&s=(\\w+\\.*\\w+)&fn=(\\w+)&i=(\\w+)&fp=(\\w+)/);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tdt,\r\n\t\t\tsum,\r\n\t\t\tfn,\r\n\t\t\ti,\r\n\t\t\tfp\r\n\t\t}\r\n\t}\r\n\r\n\tstatic date(str) {\r\n\t\tconst dt = new Date(str);\r\n\t\tlet monthName;\r\n\t\tswitch (dt.getMonth() + 1) {\r\n\t\t\tcase 1:\r\n\t\t\t\tmonthName = 'января';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tmonthName = 'февраля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tmonthName = 'марта';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tmonthName = 'апреля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tmonthName = 'мая';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tmonthName = 'июня';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7:\r\n\t\t\t\tmonthName = 'июля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8:\r\n\t\t\t\tmonthName = 'августа';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 9:\r\n\t\t\t\tmonthName = 'сентября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 10:\r\n\t\t\t\tmonthName = 'октября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 11:\r\n\t\t\t\tmonthName = 'ноября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 12:\r\n\t\t\t\tmonthName = 'декабря';\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn `${dt.getDate()} ${monthName} ${dt.getFullYear()}`;\r\n\t}\r\n\r\n\tstatic sum(n) {\r\n\t\treturn new Intl.NumberFormat('ru-RU', {style: 'currency', currency: 'RUB'}).format(n / 100);\r\n\t}\r\n\r\n\tstatic totalReceiptSum(arr) {\r\n\t\tlet totalSum = 0;\r\n\t\tconst totalSumArr = arr.map((item) => {\r\n\t\t\treturn item.totalSum;\r\n\t\t});\r\n\t\tfor (let i=0; i<totalSumArr.length; i++) {\r\n\t\t\ttotalSum += totalSumArr[i];\r\n\t\t}\r\n\t\treturn totalSum;\r\n\t}\r\n}","import React from 'react';\r\nimport prepare from \"../handlers/prepare\";\r\n\r\nconst ColoredSum = ({sum}) => {\r\n\tconst stl = sum > 0 ? {color: '#28a745'} : {color: '#dc3545'};\r\n\treturn(\r\n\t\t<span style={stl}>{prepare.sum(sum)}</span>\r\n\t)\r\n};\r\n\r\nexport default ColoredSum;\r\n","import Receipt from \"./receipt\";\r\n\r\nexport default Receipt;\r\n","import React from 'react';\r\nimport {Group, List} from \"@vkontakte/vkui\";\r\nimport Cell from \"@vkontakte/vkui/dist/components/Cell/Cell\";\r\nimport prepare from \"../../handlers/prepare\";\r\nimport ColoredSum from \"../ColoredSum\";\r\n\r\nconst Receipt = ({items, id, dateTime, setActiveModal}) => {\r\n\tconst receiptItem = (items.map((item, index) => {\r\n\t\tconst sum = item.income ? item.sum : (-1) * item.sum ;\r\n\r\n\t\treturn(\r\n\t\t\t<Group title={item.name} key={index}>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t{item.price ? <Cell indicator={prepare.sum(item.price)}>Цена</Cell> : null}\r\n\t\t\t\t\t{item.quantity ? <Cell indicator={item.quantity}>Кол-во</Cell> : null}\r\n\t\t\t\t\t<Cell\r\n\t\t\t\t\t\tindicator={<ColoredSum sum={sum}/>}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tСумма\r\n\t\t\t\t\t</Cell>\r\n\t\t\t\t</List>\r\n\t\t\t</Group>\r\n\t\t)\r\n\t}));\r\n\r\n\treturn(\r\n\t\t<Group id={id}>\r\n\t\t\t{receiptItem}\r\n\t\t</Group>\r\n\t)\r\n};\r\n\r\nexport default Receipt;","import React, {Component} from 'react';\r\nimport {\r\n\tList,\r\n\tModalPage,\r\n\tModalRoot,\r\n\tModalPageHeader,\r\n\tHeaderButton,\r\n\tIOS,\r\n\tplatform\r\n} from '@vkontakte/vkui';\r\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\r\nimport Button from '@vkontakte/vkui/dist/components/Button/Button';\r\nimport Group from '@vkontakte/vkui/dist/components/Group/Group';\r\nimport Cell from '@vkontakte/vkui/dist/components/Cell/Cell';\r\nimport Div from '@vkontakte/vkui/dist/components/Div/Div';\r\nimport Avatar from '@vkontakte/vkui/dist/components/Avatar/Avatar';\r\nimport connect from \"@vkontakte/vk-connect\";\r\nimport prepare from \"../handlers/prepare\";\r\nimport ColoredSum from \"./ColoredSum\";\r\nimport View from \"@vkontakte/vkui/dist/components/View/View\";\r\nimport Receipt from \"./Receipt\";\r\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\r\nimport Icon24Dismiss from '@vkontakte/icons/dist/24/dismiss';\r\n\r\nexport default class Home extends Component {\r\n\tstate = {\r\n\t\tactiveModal: null,\r\n\t\tmodalHistory: [],\r\n\t};\r\n\r\n\tmodalBack = () => {\r\n\t\tthis.setActiveModal(this.state.modalHistory[this.state.modalHistory.length - 2]);\r\n\t};\r\n\r\n\tsetActiveModal = (activeModal) => {\r\n\r\n\t\tactiveModal = activeModal || null;\r\n\t\tlet modalHistory = this.state.modalHistory ? [...this.state.modalHistory] : [];\r\n\r\n\t\tif (activeModal === null) {\r\n\t\t\tmodalHistory = [];\r\n\t\t} else if (modalHistory.indexOf(activeModal) !== -1) {\r\n\t\t\tmodalHistory = modalHistory.splice(0, modalHistory.indexOf(activeModal)+1);\r\n\t\t} else {\r\n\t\t\tmodalHistory.push(activeModal);\r\n\t\t}\r\n\r\n\t\tthis.setState({\r\n\t\t\tactiveModal,\r\n\t\t\tmodalHistory\r\n\t\t});\r\n\t};\r\n\r\n\trender() {\r\n\t\tconst { receipts, fetchedUser, qr, go, popout, id} = this.props;\r\n\t\tconst osName = platform();\r\n\t\tconst modal = (\r\n\t\t\t<ModalRoot activeModal={this.state.activeModal}>\r\n\t\t\t\t{receipts.map((receipt, index) => {\r\n\t\t\t\t\treturn(\r\n\t\t\t\t\t\t<ModalPage\r\n\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\tid={receipt._id}\r\n\t\t\t\t\t\t\tonClose={this.modalBack}\r\n\t\t\t\t\t\t\theader={\r\n\t\t\t\t\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\t\t\t\t\tleft={osName !== IOS && <HeaderButton onClick={this.modalBack}><Icon24Cancel /></HeaderButton>}\r\n\t\t\t\t\t\t\t\t\tright={osName === IOS && <HeaderButton onClick={this.modalBack}>{osName === IOS ? 'Готово' : <Icon24Dismiss />}</HeaderButton>}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{prepare.date(receipt.dateTime)}\r\n\t\t\t\t\t\t\t\t</ModalPageHeader>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<List>\r\n\t\t\t\t\t\t\t\t<Receipt id={receipt._id} dateTime={receipt.dateTime} items={receipt.items}/>\r\n\t\t\t\t\t\t\t</List>\r\n\t\t\t\t\t\t</ModalPage>\r\n\r\n\t\t\t\t\t)\r\n\t\t\t\t})}\r\n\t\t\t</ModalRoot>\r\n\t\t);\r\n\r\n\t\treturn (\r\n\t\t\t<View id='home' activePanel='home' popout={popout} modal={modal}>\r\n\t\t\t\t<Panel id={id}>\r\n\t\t\t\t\t<PanelHeader>Баланс</PanelHeader>\r\n\t\t\t\t\t{fetchedUser &&\r\n\t\t\t\t\t<Group title=\"User Data Fetched with VK Connect\">\r\n\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\tbefore={fetchedUser.photo_200 ? <Avatar src={fetchedUser.photo_200}/> : null}\r\n\t\t\t\t\t\t\tdescription={fetchedUser.city && fetchedUser.city.title ? fetchedUser.city.title : ''}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{`${fetchedUser.first_name} ${fetchedUser.last_name}`}\r\n\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t</Group>}\r\n\r\n\t\t\t\t\t<Group title='Баланс'>\r\n\t\t\t\t\t\t<Div style={{fontSize: '200%', fontWeight: 'bold'}}>\r\n\t\t\t\t\t\t\t<ColoredSum sum={prepare.totalReceiptSum(receipts)} />\r\n\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t</Group>\r\n\r\n\t\t\t\t\t<Group title='Чеки'>\r\n\t\t\t\t\t\t<List>\r\n\t\t\t\t\t\t\t{receipts.map((receipt, index) => {\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\t\texpandable\r\n\t\t\t\t\t\t\t\t\t\tonClick={(e) => this.setActiveModal(e.currentTarget.dataset.to)}\r\n\t\t\t\t\t\t\t\t\t\tdata-to={receipt._id}\r\n\t\t\t\t\t\t\t\t\t\tindicator={<ColoredSum sum={receipt.totalSum}/>}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t{prepare.date(receipt.dateTime)}\r\n\t\t\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t</List>\r\n\t\t\t\t\t</Group>\r\n\r\n\t\t\t\t\t<Group title=\"Profile\">\r\n\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t<Button size=\"xl\" level=\"2\" onClick={go} data-to=\"profile\">\r\n\t\t\t\t\t\t\t\tProfile\r\n\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t</Group>\r\n\r\n\t\t\t\t\t<Group title=\"QR Reader\">\r\n\t\t\t\t\t\t<Div>\r\n\t\t\t\t\t\t\t<Button size=\"xl\" level=\"2\" onClick={() => {\r\n\t\t\t\t\t\t\t\tconnect.send(\"VKWebAppOpenCodeReader\", {});\r\n\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\tOpen QR reader\r\n\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t\t\t<li>{`qr.dt = ${qr.dt}`}</li>\r\n\t\t\t\t\t\t\t\t\t<li>{`qr.sum = ${qr.sum}`}</li>\r\n\t\t\t\t\t\t\t\t\t<li>{`qr.fn = ${qr.fn}`}</li>\r\n\t\t\t\t\t\t\t\t\t<li>{`qr.i = ${qr.i}`}</li>\r\n\t\t\t\t\t\t\t\t\t<li>{`qr.fp = ${qr.fp}`}</li>\r\n\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t</Group>\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t)\r\n\t}\r\n\r\n}","import React, {useState, useEffect} from 'react';\r\nimport {\r\n\tFormLayout,\r\n\tIOS,\r\n\tPanel,\r\n\tPanelHeader,\r\n\tplatform,\r\n\tHeaderButton,\r\n\tGroup, List, InfoRow, Cell, Button\r\n} from '@vkontakte/vkui';\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport connect from \"@vkontakte/vk-connect\";\r\nimport Avatar from \"@vkontakte/vkui/dist/components/Avatar/Avatar\";\r\n\r\nconst Profile = ({id, go, fetchedUser}) =>{\r\n\tconst [email, setEmail] = useState('');\r\n\tconst [phone, setPhone] = useState('');\r\n\tconst osName = platform();\r\n\r\n\tuseEffect(()=>{\r\n\t\tconnect.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'VKWebAppGetPersonalCardResult':\r\n\t\t\t\t\tsetEmail(data.email);\r\n\t\t\t\t\tsetPhone(data.phone);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}, []);\r\n\treturn(\r\n\t\t<Panel id={id} >\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={<HeaderButton onClick={go} data-to=\"home\">\r\n\t\t\t\t\t{osName === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}\r\n\t\t\t\t</HeaderButton>}\r\n\t\t\t>\r\n\t\t\t\tПрофиль\r\n\t\t\t</PanelHeader>\r\n\t\t\t{fetchedUser &&\r\n\t\t\t<Group title={fetchedUser.id}>\r\n\t\t\t\t<Cell\r\n\t\t\t\t\tbefore={fetchedUser.photo_200 ? <Avatar src={fetchedUser.photo_200}/> : null}\r\n\t\t\t\t\tdescription={fetchedUser.city && fetchedUser.city.title ? fetchedUser.city.title : ''}\r\n\t\t\t\t>\r\n\t\t\t\t\t{`${fetchedUser.first_name} ${fetchedUser.last_name}`}\r\n\t\t\t\t</Cell>\r\n\t\t\t</Group>}\r\n\t\t\t<FormLayout>\r\n\t\t\t\t<Group>\r\n\t\t\t\t\t<List>\r\n\t\t\t\t\t\t<Cell>\r\n\t\t\t\t\t\t\t<InfoRow title='E-mail'>\r\n\t\t\t\t\t\t\t\t{email ? email : 'Необходимо получить email'}\r\n\t\t\t\t\t\t\t</InfoRow>\r\n\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t<Cell>\r\n\t\t\t\t\t\t\t<InfoRow title='Телефон'>\r\n\t\t\t\t\t\t\t\t{phone ? phone : 'Необходимо получить телефон'}\r\n\t\t\t\t\t\t\t</InfoRow>\r\n\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t</List>\r\n\t\t\t\t</Group>\r\n\t\t\t\t<Button size=\"xl\" level=\"2\" onClick={() => {\r\n\t\t\t\t\tconnect.send(\"VKWebAppGetPersonalCard\", {\"type\": [\"phone\", \"email\"]});\r\n\t\t\t\t}}>\r\n\t\t\t\t\tПолучить данные из VK\r\n\t\t\t\t</Button>\r\n\t\t\t</FormLayout>\r\n\t\t</Panel>\r\n\t)\r\n};\r\n\r\nexport default Profile;\r\n","import React from 'react';\r\nimport {Panel, PanelHeader} from '@vkontakte/vkui';\r\nimport Icon28InfoOutline from '@vkontakte/icons/dist/28/info_outline';\r\n\r\nconst Info = ({id}) => {\r\n\treturn (\r\n\t\t<Panel id={id}>\r\n\t\t\t<PanelHeader before={<Icon28InfoOutline />}>Информация</PanelHeader>\r\n\t\t</Panel>\r\n\t)\r\n};\r\n\r\nexport default Info;","export default class Api {\r\n  _apiBase = `http://localhost:3000/api`;\r\n\r\n  async callApi(method, uri, body) {\r\n    const { token, ...bodyFields} = body;\r\n    const headers = {\r\n      'Content-Type': 'application/json',\r\n      Authorization: token ? `Token ${token}` : '',\r\n    };\r\n    const res = await fetch(`${this._apiBase}${uri}`, {\r\n      method,\r\n      mode: 'cors',\r\n      headers,\r\n      body: method !== 'GET' ? JSON.stringify(bodyFields) : null,\r\n    });\r\n\r\n    if (!res.ok) {\r\n      const err = new Error(`Ошибка Авторизации`);\r\n      err.subMessage = 'Неверное имя пользователя или пароль';\r\n      throw err;\r\n    }\r\n\r\n    return await res.json();\r\n  }\r\n\r\n  //TODO Дописать вызов api\r\n  /**\r\n   * User api\r\n   */\r\n  async userLogin(body) {\r\n    return await this.callApi('POST', '/users/login', body);\r\n  }\r\n\r\n  async userRegister(body) {\r\n    return await this.callApi('POST', '/users', body);\r\n  }\r\n\r\n  async userCurrent(body) {\r\n    return await this.callApi('GET', '/users/current', body);\r\n  }\r\n\r\n  async userUpdate(body) {\r\n    return await this.callApi('PUT', '/users/current', body);\r\n  }\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport connect from '@vkontakte/vk-connect';\r\nimport View from '@vkontakte/vkui/dist/components/View/View';\r\nimport ScreenSpinner from '@vkontakte/vkui/dist/components/ScreenSpinner/ScreenSpinner';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\n\r\nimport {Epic, Tabbar, TabbarItem} from \"@vkontakte/vkui\";\r\nimport Icon28HomeOutline from '@vkontakte/icons/dist/28/home_outline';\r\nimport Icon28User from '@vkontakte/icons/dist/28/user';\r\nimport Icon24Qr from '@vkontakte/icons/dist/24/qr';\r\nimport Icon28InfoOutline from '@vkontakte/icons/dist/28/info_outline';\r\n\r\nimport Home from './panels/Home';\r\nimport Profile from \"./panels/Profile\";\r\nimport Info from \"./panels/Info\";\r\nimport Receipt from \"./panels/Receipt\";\r\nimport prepare from \"./handlers/prepare\";\r\nimport ApiService from './services/api';\r\n\r\nconst App = () => {\r\n\tconst apiService = new ApiService();\r\n\tconst [activePanel, setActivePanel] = useState('home');\r\n\tconst [fetchedUser, setUser] = useState(null);\r\n\tconst [token, setToken] = useState(null);\r\n\tconst [error, setError] = useState(null);\r\n\tconst [popout, setPopout] = useState(<ScreenSpinner size='large' />);\r\n\t// const [popout, setPopout] = useState(null);\r\n\tconst [qr, setQR] = useState('');\r\n\tconst [receipts, setReceipts] = useState([\r\n\t\t{\r\n\t\t\t\"_id\" : \"5ddf911573e0c321bc89f1ef\",\r\n\t\t\t\"receipts\" : [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"fn\" : \"9289000100521868\",\r\n\t\t\t\t\t\"fd\" : \"12691\",\r\n\t\t\t\t\t\"fp\" : \"339287482\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t\"userId\" : \"5dce89f495636e23345b7d34\",\r\n\t\t\t\"dateTime\" : \"2019-11-12T00:00:00.000\",\r\n\t\t\t\"items\" : [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5ddf911573e0c321bc89f1f0\",\r\n\t\t\t\t\t\"name\" : \"test\",\r\n\t\t\t\t\t\"sum\" : 1000,\r\n\t\t\t\t\t\"income\" : true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5de8e27933db3f375c2daa20\",\r\n\t\t\t\t\t\"sum\" : 490,\r\n\t\t\t\t\t\"quantity\" : 1,\r\n\t\t\t\t\t\"name\" : \"Пакет-майка Магнит\",\r\n\t\t\t\t\t\"price\" : 490\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5de8e27933db3f375c2daa1f\",\r\n\t\t\t\t\t\"sum\" : 5490,\r\n\t\t\t\t\t\"quantity\" : 1,\r\n\t\t\t\t\t\"name\" : \"4 СЕЗОНА Рагу овощное 0,4кг(Западный ХК ООО):20\",\r\n\t\t\t\t\t\"price\" : 5490\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5de8e27933db3f375c2daa1e\",\r\n\t\t\t\t\t\"sum\" : 22038,\r\n\t\t\t\t\t\"quantity\" : 1.225,\r\n\t\t\t\t\t\"name\" : \"Скумбрия с/м уп (вес):6\",\r\n\t\t\t\t\t\"price\" : 17990\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5de8e27933db3f375c2daa1d\",\r\n\t\t\t\t\t\"sum\" : 4490,\r\n\t\t\t\t\t\"quantity\" : 1,\r\n\t\t\t\t\t\"name\" : \"КРАСКИ ЛЕТА Соте 400 г п/уп(Русская овощная компания):8\",\r\n\t\t\t\t\t\"price\" : 4490\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5de8e27933db3f375c2daa1c\",\r\n\t\t\t\t\t\"sum\" : 3490,\r\n\t\t\t\t\t\"quantity\" : 1,\r\n\t\t\t\t\t\"name\" : \"MR RICCO Organic Майонез переп яйца 67% 375г д/п(Нэфис):12\",\r\n\t\t\t\t\t\"price\" : 3490\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5de8e27933db3f375c2daa1b\",\r\n\t\t\t\t\t\"sum\" : 6490,\r\n\t\t\t\t\t\"quantity\" : 1,\r\n\t\t\t\t\t\"name\" : \"Творог обезжиренный Вемол 0,5% 0,25кг конт (ЗАО \\\"Вемол\\\") :18\",\r\n\t\t\t\t\t\"price\" : 6490\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5de8e27933db3f375c2daa1a\",\r\n\t\t\t\t\t\"sum\" : 6490,\r\n\t\t\t\t\t\"quantity\" : 1,\r\n\t\t\t\t\t\"name\" : \"Сметана 15% 0,45кг ф/п (Молкомбинат Кунгурский)\",\r\n\t\t\t\t\t\"price\" : 6490\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5de8e27933db3f375c2daa19\",\r\n\t\t\t\t\t\"sum\" : 7780,\r\n\t\t\t\t\t\"quantity\" : 2,\r\n\t\t\t\t\t\"name\" : \"Молоко паст 2,5% 1л ф/п (МаСКо):15\",\r\n\t\t\t\t\t\"price\" : 3890\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5de8e27933db3f375c2daa18\",\r\n\t\t\t\t\t\"sum\" : 4790,\r\n\t\t\t\t\t\"quantity\" : 1,\r\n\t\t\t\t\t\"name\" : \"Яйцо столовое С1 10шт бокс :20\",\r\n\t\t\t\t\t\"price\" : 4790\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t\"totalSum\" : -60548,\r\n\t\t\t\"__v\" : 0\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"_id\" : \"5de8d0037a0bbc1cd8169744\",\r\n\t\t\t\"receipts\" : [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"fn\" : \"9280440300403604\",\r\n\t\t\t\t\t\"fd\" : \"8950\",\r\n\t\t\t\t\t\"fp\" : \"0648032311\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t\"userId\" : \"5dce89f495636e23345b7d34\",\r\n\t\t\t\"dateTime\" : \"2019-11-29T00:00:00.000\",\r\n\t\t\t\"totalSum\" : -3663,\r\n\t\t\t\"items\" : [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5de8d0037a0bbc1cd8169746\",\r\n\t\t\t\t\t\"sum\" : 1063,\r\n\t\t\t\t\t\"price\" : 1063,\r\n\t\t\t\t\t\"quantity\" : 1,\r\n\t\t\t\t\t\"name\" : \"Услуга питания\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5de8d0037a0bbc1cd8169745\",\r\n\t\t\t\t\t\"sum\" : 2600,\r\n\t\t\t\t\t\"price\" : 2600,\r\n\t\t\t\t\t\"quantity\" : 1,\r\n\t\t\t\t\t\"name\" : \"Услуга питания\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t\"__v\" : 0\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"_id\" : \"5ddf912273e0c321bc89f1f5\",\r\n\t\t\t\"receipts\" : [],\r\n\t\t\t\"userId\" : \"5dce89f495636e23345b7d34\",\r\n\t\t\t\"dateTime\" : \"2019-11-15T00:00:00.000\",\r\n\t\t\t\"items\" : [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5ddf912273e0c321bc89f1f6\",\r\n\t\t\t\t\t\"name\" : \"test\",\r\n\t\t\t\t\t\"sum\" : 1000000,\r\n\t\t\t\t\t\"income\" : true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"modifiers\" : [],\r\n\t\t\t\t\t\"properties\" : [],\r\n\t\t\t\t\t\"_id\" : \"5ddf99d96db8bf32044d2009\",\r\n\t\t\t\t\t\"name\" : \"test\",\r\n\t\t\t\t\t\"sum\" : 1500000,\r\n\t\t\t\t\t\"income\" : true\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t\"totalSum\" : 2500000,\r\n\t\t\t\"__v\" : 0\r\n\t\t}\r\n\t]);\r\n\r\n\tconst onData = user => {\r\n\t\tconsole.log(user);\r\n\t\tsetUser(user);\r\n\t\tsetToken(user.token);\r\n\t\tsetError(null);\r\n\t\tsetPopout(null);\r\n\t};\r\n\r\n\tconst onError = error => {\r\n\t\tconsole.log(error);\r\n\t\tsetUser(null);\r\n\t\tsetToken(null);\r\n\t\tsetError(error);\r\n\t\tsetPopout(null);\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tconnect.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'VKWebAppUpdateConfig':\r\n\t\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\r\n\t\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\r\n\t\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'VKWebAppOpenCodeReaderResult':\r\n\t\t\t\t\tsetQR(data.code_data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t\t/**\r\n\t\t * Получаем данные о пользователе\r\n\t\t * */\r\n\t\tasync function fetchData() {\r\n\t\t\tconst vk_user = await connect.sendPromise('VKWebAppGetUserInfo');\r\n\t\t\t/**\r\n\t\t\t * Если есть токен, то пытаемся авторизоваться\r\n\t\t\t * Если нет, пытаемся залогиниться\r\n\t\t\t * Если пользователя нет на сервере - регистрируемся\r\n\t\t\t * */\r\n\t\t\tif (vk_user.id) {\r\n\t\t\t\tif (token) {\r\n\t\t\t\t\tawait apiService.userCurrent({token})\r\n\t\t\t\t\t\t.then(user => onData(user))\r\n\t\t\t\t\t\t.catch(err => onError(err));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst body = {\r\n\t\t\t\t\t\tuser:{\r\n\t\t\t\t\t\t\tid: vk_user.id,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\tawait apiService.userLogin(body)\r\n\t\t\t\t\t\t.then(async user => {\r\n\t\t\t\t\t\t\tif (user) {\r\n\t\t\t\t\t\t\t\tonData(user)\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconst user = await apiService.userRegister(body);\r\n\t\t\t\t\t\t\t\tonData(user);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch(err => onError(err));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst error = new Error('Неполучен пользователь vkontakte');\r\n\t\t\t\tonError(error);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfetchData();\r\n\t}, []);\r\n\r\n\tconst QR = prepare.qr(qr);\r\n\r\n\tconst go = e => {\r\n\t\tsetActivePanel(e.currentTarget.dataset.to);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Epic activeStory={activePanel} tabbar={\r\n\t\t\t<Tabbar>\r\n\t\t\t\t<TabbarItem\r\n\t\t\t\t\tselected={activePanel === 'home'}\r\n\t\t\t\t\tonClick={go}\r\n\t\t\t\t\tdata-to='home'\r\n\t\t\t\t>\r\n\t\t\t\t\t<Icon28HomeOutline />\r\n\t\t\t\t</TabbarItem>\r\n\t\t\t\t<TabbarItem\r\n\t\t\t\t\tonClick={() => {connect.send(\"VKWebAppOpenCodeReader\", {});}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Icon24Qr height={28} width={28}/>\r\n\t\t\t\t</TabbarItem>\r\n\t\t\t\t<TabbarItem\r\n\t\t\t\t\tselected={activePanel === 'profile'}\r\n\t\t\t\t\tonClick={go}\r\n\t\t\t\t\tdata-to='profile'\r\n\t\t\t\t>\r\n\t\t\t\t\t<Icon28User />\r\n\t\t\t\t</TabbarItem>\r\n\t\t\t\t<TabbarItem\r\n\t\t\t\t\tselected={activePanel === 'info'}\r\n\t\t\t\t\tonClick={go}\r\n\t\t\t\t\tdata-to='info'\r\n\t\t\t\t>\r\n\t\t\t\t\t<Icon28InfoOutline />\r\n\t\t\t\t</TabbarItem>\r\n\t\t\t</Tabbar>\r\n\t\t}>\r\n\t\t\t<Home\r\n\t\t\t\tid='home'\r\n\t\t\t\tfetchedUser={fetchedUser}\r\n\t\t\t\tgo={go}\r\n\t\t\t\tqr={QR}\r\n\t\t\t\treceipts={receipts}\r\n\t\t\t\tpopout={popout}\r\n\t\t\t/>\r\n\t\t\t<View id='profile' activePanel='profile' popout={popout}>\r\n\t\t\t\t<Profile id='profile' go={go} fetchedUser={fetchedUser}/>\r\n\t\t\t</View>\r\n\t\t\t<View id='info' activePanel='info' popout={popout}>\r\n\t\t\t\t<Info id='info' go={go}/>\r\n\t\t\t</View>\r\n\r\n\t\t</Epic>\r\n\t);\r\n};\r\n\r\nexport default App;\r\n\r\n","import 'core-js/features/map';\r\nimport 'core-js/features/set';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport connect from '@vkontakte/vk-connect';\r\nimport App from './App';\r\n// import registerServiceWorker from './sw';\r\n\r\n// Init VK  Mini App\r\nconnect.send('VKWebAppInit');\r\n\r\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\r\n// расскомментируйте строку с registerServiceWorker();\r\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\r\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\r\n// registerServiceWorker();\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n"],"sourceRoot":""}