(this["webpackJsonpvk-mini-apps-empty"]=this["webpackJsonpvk-mini-apps-empty"]||[]).push([[0],{165:function(e,t,n){e.exports=n(264)},264:function(e,t,n){"use strict";n.r(t);n(166),n(192),n(194),n(195),n(197),n(198),n(199),n(200),n(201),n(202),n(203),n(204),n(206),n(207),n(208),n(209),n(210),n(211),n(212),n(213),n(214),n(215),n(217),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234);var r=n(0),a=n.n(r),c=n(38),i=n.n(c),u=n(26),s=n.n(u),o=n(8),d=n.n(o),f=n(27),p=n(17),m=n(98),l=n.n(m),b=(n(243),n(43)),h=(n(251),n(253),n(254),n(255),n(95)),y=n.n(h),k=n(96),v=n.n(k),O=n(97),w=n.n(O),x=n(48),j=n(49),_=function(){function e(){Object(x.a)(this,e)}return Object(j.a)(e,null,[{key:"qr",value:function(e){var t,n,r,a,c;if(e){var i=e.match(/t=(\w{8}T\w+)&s=(\w+\.*\w+)&fn=(\w+)&i=(\w+)&fp=(\w+)/),u=Object(p.a)(i,6);t=u[1],n=u[2],r=u[3],a=u[4],c=u[5]}return{dt:t,sum:n,fn:r,i:a,fp:c}}},{key:"date",value:function(e){var t,n=new Date(e);switch(n.getMonth()+1){case 1:t="\u044f\u043d\u0432\u0430\u0440\u044f";break;case 2:t="\u0444\u0435\u0432\u0440\u0430\u043b\u044f";break;case 3:t="\u043c\u0430\u0440\u0442\u0430";break;case 4:t="\u0430\u043f\u0440\u0435\u043b\u044f";break;case 5:t="\u043c\u0430\u044f";break;case 6:t="\u0438\u044e\u043d\u044f";break;case 7:t="\u0438\u044e\u043b\u044f";break;case 8:t="\u0430\u0432\u0433\u0443\u0441\u0442\u0430";break;case 9:t="\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f";break;case 10:t="\u043e\u043a\u0442\u044f\u0431\u0440\u044f";break;case 11:t="\u043d\u043e\u044f\u0431\u0440\u044f";break;case 12:t="\u0434\u0435\u043a\u0430\u0431\u0440\u044f"}return"".concat(n.getDate()," ").concat(t," ").concat(n.getFullYear())}},{key:"sum",value:function(e){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e/100)}},{key:"totalReceiptSum",value:function(e){for(var t=0,n=e.map((function(e){return e.totalSum})),r=0;r<n.length;r++)t+=n[r];return t}},{key:"totalIncomeSum",value:function(e){var t=function(e,t){return e+t};return e.map((function(e){return e.items.map((function(e){return e.income?e.sum:0})).reduce(t)})).reduce(t)}},{key:"totalOutcomeSum",value:function(e){var t=function(e,t){return e+t};return-1*e.map((function(e){return e.items.map((function(e){return e.income?0:e.sum})).reduce(t)})).reduce(t)}}]),e}(),E=n(100),S=function(){function e(){Object(x.a)(this,e),this._apiBase="http://localhost:3000/api"}return Object(j.a)(e,[{key:"callApi",value:function(){var e=Object(f.a)(d.a.mark((function e(t,n,r){var a,c,i,u,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.token,c=Object(E.a)(r,["token"]),i={"Content-Type":"application/json",Authorization:a?"Token ".concat(a):""},e.next=4,fetch("".concat(this._apiBase).concat(n),{method:t,mode:"cors",headers:i,body:"GET"!==t?JSON.stringify(c):null});case 4:if((u=e.sent).ok){e.next=9;break}throw(s=new Error("\u041e\u0448\u0438\u0431\u043a\u0430 \u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438")).subMessage="\u041d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c",s;case 9:return e.next=11,u.json();case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"userLogin",value:function(){var e=Object(f.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callApi("POST","/users/login",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"userRegister",value:function(){var e=Object(f.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callApi("POST","/users",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"userCurrent",value:function(){var e=Object(f.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callApi("GET","/users/current",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"userUpdate",value:function(){var e=Object(f.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callApi("PUT","/users/current",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),g=function(e){var t=e.sum,n=e.fs,r=t>0?{color:"#28a745",fontSize:n}:{color:"#dc3545",fontSize:n};return a.a.createElement("span",{style:r},_.sum(t))},T=n(99),q=n.n(T),A=function(){var e=new S,t=Object(r.useState)("home"),n=Object(p.a)(t,2),c=n[0],i=(n[1],Object(r.useState)(null)),u=Object(p.a)(i,2),o=(u[0],u[1]),m=Object(r.useState)(null),h=Object(p.a)(m,2),k=h[0],O=h[1],x=Object(r.useState)(null),j=Object(p.a)(x,2),E=(j[0],j[1]),T=Object(r.useState)(null),A=Object(p.a)(T,2),I=(A[0],A[1]),C=Object(r.useState)(""),R=Object(p.a)(C,2),U=R[0],B=R[1],P=Object(r.useState)([{_id:"5ddf911573e0c321bc89f1ef",receipts:[{fn:"9289000100521868",fd:"12691",fp:"339287482"}],userId:"5dce89f495636e23345b7d34",dateTime:"2019-11-12T00:00:00.000",items:[{modifiers:[],properties:[],_id:"5ddf911573e0c321bc89f1f0",name:"test",sum:1e3,income:!0},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa20",sum:490,quantity:1,name:"\u041f\u0430\u043a\u0435\u0442-\u043c\u0430\u0439\u043a\u0430 \u041c\u0430\u0433\u043d\u0438\u0442",price:490},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa1f",sum:5490,quantity:1,name:"4 \u0421\u0415\u0417\u041e\u041d\u0410 \u0420\u0430\u0433\u0443 \u043e\u0432\u043e\u0449\u043d\u043e\u0435 0,4\u043a\u0433(\u0417\u0430\u043f\u0430\u0434\u043d\u044b\u0439 \u0425\u041a \u041e\u041e\u041e):20",price:5490},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa1e",sum:22038,quantity:1.225,name:"\u0421\u043a\u0443\u043c\u0431\u0440\u0438\u044f \u0441/\u043c \u0443\u043f (\u0432\u0435\u0441):6",price:17990},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa1d",sum:4490,quantity:1,name:"\u041a\u0420\u0410\u0421\u041a\u0418 \u041b\u0415\u0422\u0410 \u0421\u043e\u0442\u0435 400 \u0433 \u043f/\u0443\u043f(\u0420\u0443\u0441\u0441\u043a\u0430\u044f \u043e\u0432\u043e\u0449\u043d\u0430\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044f):8",price:4490},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa1c",sum:3490,quantity:1,name:"MR RICCO Organic \u041c\u0430\u0439\u043e\u043d\u0435\u0437 \u043f\u0435\u0440\u0435\u043f \u044f\u0439\u0446\u0430 67% 375\u0433 \u0434/\u043f(\u041d\u044d\u0444\u0438\u0441):12",price:3490},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa1b",sum:6490,quantity:1,name:'\u0422\u0432\u043e\u0440\u043e\u0433 \u043e\u0431\u0435\u0437\u0436\u0438\u0440\u0435\u043d\u043d\u044b\u0439 \u0412\u0435\u043c\u043e\u043b 0,5% 0,25\u043a\u0433 \u043a\u043e\u043d\u0442 (\u0417\u0410\u041e "\u0412\u0435\u043c\u043e\u043b") :18',price:6490},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa1a",sum:6490,quantity:1,name:"\u0421\u043c\u0435\u0442\u0430\u043d\u0430 15% 0,45\u043a\u0433 \u0444/\u043f (\u041c\u043e\u043b\u043a\u043e\u043c\u0431\u0438\u043d\u0430\u0442 \u041a\u0443\u043d\u0433\u0443\u0440\u0441\u043a\u0438\u0439)",price:6490},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa19",sum:7780,quantity:2,name:"\u041c\u043e\u043b\u043e\u043a\u043e \u043f\u0430\u0441\u0442 2,5% 1\u043b \u0444/\u043f (\u041c\u0430\u0421\u041a\u043e):15",price:3890},{modifiers:[],properties:[],_id:"5de8e27933db3f375c2daa18",sum:4790,quantity:1,name:"\u042f\u0439\u0446\u043e \u0441\u0442\u043e\u043b\u043e\u0432\u043e\u0435 \u04211 10\u0448\u0442 \u0431\u043e\u043a\u0441 :20",price:4790}],totalSum:-60548,__v:0},{_id:"5de8d0037a0bbc1cd8169744",receipts:[{fn:"9280440300403604",fd:"8950",fp:"0648032311"}],userId:"5dce89f495636e23345b7d34",dateTime:"2019-11-29T00:00:00.000",totalSum:-3663,items:[{modifiers:[],properties:[],_id:"5de8d0037a0bbc1cd8169746",sum:1063,price:1063,quantity:1,name:"\u0423\u0441\u043b\u0443\u0433\u0430 \u043f\u0438\u0442\u0430\u043d\u0438\u044f"},{modifiers:[],properties:[],_id:"5de8d0037a0bbc1cd8169745",sum:2600,price:2600,quantity:1,name:"\u0423\u0441\u043b\u0443\u0433\u0430 \u043f\u0438\u0442\u0430\u043d\u0438\u044f"}],__v:0},{_id:"5ddf912273e0c321bc89f1f5",receipts:[],userId:"5dce89f495636e23345b7d34",dateTime:"2019-11-15T00:00:00.000",items:[{modifiers:[],properties:[],_id:"5ddf912273e0c321bc89f1f6",name:"test",sum:1e6,income:!0},{modifiers:[],properties:[],_id:"5ddf99d96db8bf32044d2009",name:"test",sum:15e5,income:!0}],totalSum:25e5,__v:0}]),z=Object(p.a)(P,2),K=z[0],V=(z[1],function(e){console.log(e),o(e),O(e.token),E(null),I(null)}),W=function(e){console.log(e),o(null),O(null),E(e),I(null)};Object(r.useEffect)((function(){function t(){return(t=Object(f.a)(d.a.mark((function t(){var n,r,a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.sendPromise("VKWebAppGetUserInfo");case 2:if(!(n=t.sent).id){t.next=14;break}if(!k){t.next=9;break}return t.next=7,e.userCurrent({token:k}).then((function(e){return V(e)})).catch((function(e){return W(e)}));case 7:t.next=12;break;case 9:return r={user:{id:n.id}},t.next=12,e.userLogin(r).then(function(){var t=Object(f.a)(d.a.mark((function t(n){var a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}V(n),t.next=8;break;case 4:return t.next=6,e.userRegister(r);case 6:a=t.sent,V(a);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(e){return W(e)}));case 12:t.next=16;break;case 14:a=new Error("\u041d\u0435\u043f\u043e\u043b\u0443\u0447\u0435\u043d \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c vkontakte"),W(a);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}s.a.subscribe((function(e){var t=e.detail,n=t.type,r=t.data;switch(n){case"VKWebAppUpdateConfig":var a=document.createAttribute("scheme");a.value=r.scheme?r.scheme:"client_light",document.body.attributes.setNamedItem(a);break;case"VKWebAppOpenCodeReaderResult":B(r.code_data)}})),function(){t.apply(this,arguments)}()}),[]);_.qr(U);return a.a.createElement(l.a,{activePanel:c},a.a.createElement(b.a,{id:"home"},a.a.createElement(b.b,null,"Balance"),a.a.createElement(b.c,{icon:a.a.createElement(y.a,null),header:a.a.createElement(g,{sum:_.totalReceiptSum(K),fs:"2em"}),action:a.a.createElement(q.a,{size:"l"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0445\u043e\u0434 / \u0440\u0430\u0441\u0445\u043e\u0434")},"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439\u0442\u0435 \u0434\u043e\u0445\u043e\u0434\u044b/\u0440\u0430\u0441\u0445\u043e\u0434\u044b"),a.a.createElement(b.d,null),a.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",border:"1px solid black"}},a.a.createElement("div",{style:{flex:"1 1 auto",display:"flex",justifyContent:"flex-end"}},a.a.createElement(g,{sum:_.totalIncomeSum(K),fs:"1.4em"}),a.a.createElement(v.a,{width:28,height:28,fill:"#28a745"})),a.a.createElement("div",{style:{flex:"1 1 auto",display:"flex",justifyContent:"flex-start"}},a.a.createElement(w.a,{width:28,height:28,fill:"#dc3545"}),a.a.createElement(g,{sum:_.totalOutcomeSum(K),fs:"1.4em"})))))};s.a.send("VKWebAppInit"),i.a.render(a.a.createElement(A,null),document.getElementById("root"))}},[[165,1,2]]]);
//# sourceMappingURL=main.5c22bc3b.chunk.js.map