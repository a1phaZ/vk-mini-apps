(this["webpackJsonpvk-mini-apps-empty"]=this["webpackJsonpvk-mini-apps-empty"]||[]).push([[0],{285:function(e,t,a){e.exports=a(485)},387:function(e,t,a){},401:function(e,t,a){},407:function(e,t){},409:function(e,t){},442:function(e,t){},443:function(e,t){},485:function(e,t,a){"use strict";a.r(t);a(286),a(312),a(314),a(315),a(317),a(318),a(319),a(320),a(321),a(322),a(323),a(324),a(326),a(327),a(328),a(329),a(330),a(331),a(332),a(333),a(334),a(335),a(337),a(338),a(339),a(340),a(341),a(342),a(343),a(344),a(345),a(346),a(347),a(348),a(349),a(350),a(351),a(352),a(353),a(354);var n=a(0),r=a.n(n),c=a(207),l=a.n(c),o=a(30),i=a.n(o),s=a(4),u=(a(362),a(3)),m=a(67),d=a.n(m),p=a(94),E=a(66),f=a.n(E),b=a(58),O=a.n(b),g=a(215),y=a.n(g),j=a(216),h=a.n(j),v=a(241),S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=Object(n.useState)((function(){return localStorage.getItem(e)||t})),r=Object(s.a)(a,2),c=r[0],l=r[1];return Object(n.useEffect)((function(){localStorage.setItem(e,c)}),[c,e]),[c,l]},T=a(217),_=a.n(T),k=a(12),C={view:"authorization",panel:"authorization.login",popout:null,error:null,password:"",confirmPassword:"",vkUser:{id:null,matchUrlParams:!1},currentUser:null,isLoggedIn:!1},w=function(e,t){switch(t.type){case"SET_VIEW":return Object(k.a)({},e,{view:t.payload.view,panel:"".concat(t.payload.view,".").concat(t.payload.panel)});case"SET_PANEL":return Object(k.a)({},e,{password:"",confirmPassword:"",panel:"".concat(e.view,".").concat(t.payload.panel)});case"SHOW_LOADING":return Object(k.a)({},e,{popout:r.a.createElement(u.y,null,r.a.createElement(u.B,null))});case"HIDE_LOADING":return Object(k.a)({},e,{popout:null});case"SET_POPOUT":return Object(k.a)({},e,{popout:t.payload.popout});case"SET_ERROR":return Object(k.a)({},e,{error:t.payload.error});case"UNSET_ERROR":return Object(k.a)({},e,{error:null});case"SET_PASSWORD":return Object(k.a)({},e,{password:e.password.length<4?e.password+t.payload.digit:e.password});case"SET_CONFIRM_PASSWORD":return Object(k.a)({},e,{confirmPassword:e.confirmPassword.length<4?e.confirmPassword+t.payload.digit:e.confirmPassword});case"UNSET_PASSWORD":return Object(k.a)({},e,{password:"",confirmPassword:""});case"SET_VK_USER":return Object(k.a)({},e,{vkUser:{id:t.payload.id,matchUrlParams:t.payload.match}});case"SET_USER":return Object(k.a)({},e,{currentUser:t.payload.user,isLoggedIn:t.payload.isLoggedIn});default:return e}},I=Object(n.createContext)(),R=function(e){var t=e.children,a=Object(n.useReducer)(w,C);return r.a.createElement(I.Provider,{value:a},t)},P=function(e){var t=Object(n.useState)(!1),a=Object(s.a)(t,2),r=a[0],c=a[1],l=Object(n.useState)(null),o=Object(s.a)(l,2),i=o[0],u=o[1],m=Object(n.useState)(null),E=Object(s.a)(m,2),f=E[0],b=E[1],O=Object(n.useState)({}),g=Object(s.a)(O,2),y=g[0],j=g[1],h=S("token"),T=Object(s.a)(h,1)[0],k=Object(n.useContext)(I),C=Object(s.a)(k,2)[1],w="https://balance.z-labz.ru:8080/api",R=Object(n.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};j(e),c(!0),C({type:"SHOW_LOADING"})}),[C]),P=y.method,L=void 0===P?"GET":P,x=y.params,N=Object(v.a)(y,["method","params"]);return Object(n.useEffect)((function(){if(r){var t={"Content-Type":"application/json",Authorization:T?"Token ".concat(T):""},a=x?_.a.stringify(x):null,n=a?"".concat(w).concat(e,"?").concat(a):"".concat(w).concat(e);(function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,{method:L,mode:"cors",headers:t,body:"GET"!==L?JSON.stringify(N):null}).then((function(e){return e.json()})).then((function(e){if(e.error)throw Error(e.error.message);c(!1),C({type:"HIDE_LOADING"}),u(e)})).catch((function(e){c(!1),C({type:"HIDE_LOADING"}),C({type:"SET_ERROR",payload:{error:e}}),b(e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}}),[r,N,L,e,w,T,x,C]),[{isLoading:r,response:i,error:f},R]},L=a(218),x=a.n(L),N=(a(387),function(e){var t=e.confirm,a=void 0!==t&&t,c=Object(n.useContext)(I),l=Object(s.a)(c,2)[1],o=[{item:"1"},{item:"2"},{item:"3"},{item:"4"},{item:"5"},{item:"6"},{item:"7"},{item:"8"},{item:"9"},{item:null},{item:"0"},{item:r.a.createElement(x.a,null),onClick:function(){l({type:"UNSET_PASSWORD"})},mode:"destructive"}],i=function(e){l(a?{type:"SET_CONFIRM_PASSWORD",payload:{digit:e.currentTarget.dataset.digit}}:{type:"SET_PASSWORD",payload:{digit:e.currentTarget.dataset.digit}})},m=o.map((function(e,t){return r.a.createElement("div",{className:"digit",key:t},e.item&&r.a.createElement(u.b,{size:"xl",mode:e.mode||"secondary","data-digit":e.item,onClick:e.onClick||i},r.a.createElement("b",null,e.item)))}));return r.a.createElement("div",{className:"dialer"},m)}),A=function(e){var t=e.type,a=Object(n.useState)(null),c=Object(s.a)(a,2),l=c[0],o=c[1],i=P("/users/".concat(t)),m=Object(s.a)(i,2),E=m[0],b=E.response,g=E.error,j=m[1],v=Object(n.useState)(!1),T=Object(s.a)(v,2),_=T[0],k=T[1],C=S("token"),w=Object(s.a)(C,2)[1],R=Object(n.useContext)(I),L=Object(s.a)(R,2),x=L[0],A=L[1];Object(n.useEffect)((function(){x.isLoggedIn&&A({type:"SET_VIEW",payload:{view:"balance",panel:"home"}})}),[x,A]),Object(n.useEffect)((function(){x.password.length===x.confirmPassword.length&&(x.password.length||x.confirmPassword.length)?x.password!==x.confirmPassword&&o({status:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438",message:"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0432\u0432\u043e\u0434 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443."}):o(null)}),[x.password,x.confirmPassword,t]),Object(n.useEffect)((function(){if(_){var e={method:"POST",user:{id:+x.vkUser.id,password:x.password}};j(e),k(!1),A({type:"UNSET_PASSWORD"})}}),[_,j,x.password,x.vkUser.id,A]),Object(n.useEffect)((function(){b&&(!b.user&&b.error?o(b.error):w(b.user.token),A({type:"SET_USER",payload:{user:b.user||null,isLoggedIn:!!b.user}}))}),[b,w,A]),Object(n.useEffect)((function(){g&&o({message:g.message})}),[g]);var U=function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=x.password.replace(/[0-9]/g,"*")||"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",F=x.confirmPassword.replace(/[0-9]/g,"*")||"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c";return r.a.createElement(n.Fragment,null,r.a.createElement(f.a,null,"login"===t?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),r.a.createElement(u.x,{icon:"login"===t?r.a.createElement(y.a,null):r.a.createElement(h.a,null),header:function(){var e;return e=4!==x.password.length||"login"===t?D:F,r.a.createElement("b",null,e)}()},r.a.createElement(u.i,null,l?r.a.createElement(u.k,{header:l.status,mode:"error"},l.message):null),4!==x.password.length||"login"===t?x.password.length+" \u0438\u0437 4":x.confirmPassword.length+" \u0438\u0437 4"),r.a.createElement(N,{confirm:4===x.password.length}),r.a.createElement(u.i,{style:{textAlign:"center"}},"login"===t&&4===x.password.length&&r.a.createElement(O.a,{size:"xl",mode:"commerce",onClick:U},"login"===t?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),"login"!==t&&x.password&&x.confirmPassword&&x.password===x.confirmPassword&&r.a.createElement(O.a,{mode:"commerce",size:"xl",onClick:U},"login"===t?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f")),r.a.createElement(u.f,null,r.a.createElement(O.a,{stretched:!0,mode:"tertiary",onClick:function(e){A({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"login"===t?"register":"login"},"login"===t?"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f":"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f")))},U=a(95),D=a.n(U),F=a(96),W=a.n(F),M=a(82),z=a.n(M),V=a(44),G=a.n(V),K={email:"",phone:"",name:"",kktPassword:""},H=function(e,t){switch(t.type){case"SET_EMAIL":return Object(k.a)({},e,{email:t.payload.email});case"SET_PHONE":return Object(k.a)({},e,{phone:t.payload.phone});case"SET_NAME":return Object(k.a)({},e,{name:t.payload.name});case"SET_PASSWORD":return Object(k.a)({},e,{kktPassword:t.payload.password});case"INIT":var a=t.payload.currentUser,n=a.email,r=a.name,c=a.phone,l=a.password;return Object(k.a)({},e,{email:n||"",name:r||"",phone:c||"",kktPassword:l||""});default:return e}},q=function(){var e=Object(n.useState)(!1),t=Object(s.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(null),o=Object(s.a)(l,2),m=o[0],d=o[1],p=Object(n.useState)(!0),E=Object(s.a)(p,2),f=E[0],b=E[1],O=Object(n.useState)(""),g=Object(s.a)(O,2),y=g[0],j=g[1],h=P("/users/profile"),v=Object(s.a)(h,2),S=v[0].response,T=v[1],_=P("/fns/password"),k=Object(s.a)(_,2),C=k[0],w=k[1],R=Object(n.useState)(!1),L=Object(s.a)(R,2),x=L[0],N=L[1],A=Object(n.useContext)(I),U=Object(s.a)(A,2),F=U[0],M=U[1],V=Object(n.useReducer)(H,K),q=Object(s.a)(V,2),B=q[0],J=q[1],Y=Object(u.K)();Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppGetPersonalCardResult":J({type:"SET_EMAIL",payload:{email:n.email}}),J({type:"SET_PHONE",payload:{email:n.phone}}),console.log("profile",n);break;case"VKWebAppGetPersonalCardFailed":console.log("profile error",n)}}))}),[]),Object(n.useEffect)((function(){f&&(J({type:"INIT",payload:{currentUser:F.currentUser}}),b(!1))}),[F,f]),Object(n.useEffect)((function(){x&&(T({method:"PUT",update:B}),N(!1))}),[x,T,B]),Object(n.useEffect)((function(){if(a){var e={};"restore"!==y&&(e.name=B.name,e.email=B.email),e.params={type:y},e.phone=B.phone.replace(/[ ()-]/g,""),e.phone=e.phone.replace(/^[8]/g,"+7"),e.method="POST",w(e),c(!1)}}),[a,y,w,B]),Object(n.useEffect)((function(){S&&(M({type:"SET_USER",payload:{user:S.user||null,isLoggedIn:!!S.user}}),M({type:"SET_VIEW",payload:{view:"balance",panel:"home"}}))}),[S,M]),Object(n.useEffect)((function(){C.response&&d(r.a.createElement(u.F,{layout:"vertical",onClose:function(){return d(null)},before:r.a.createElement(z.a,{size:24,style:{backgroundColor:"var(--accent)"}},r.a.createElement(G.a,{fill:"#fff",width:14,height:14}))},C.response.message))}),[C.response]);var Q=function(){i.a.send("VKWebAppGetPersonalCard",{type:["phone","email"]})};return r.a.createElement(n.Fragment,null,r.a.createElement(u.u,{left:r.a.createElement(u.v,{onClick:function(){M({type:"SET_VIEW",payload:{view:"balance",panel:"home"}})}},Y===u.n?r.a.createElement(D.a,null):r.a.createElement(W.a,null))},"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"),r.a.createElement(u.i,{style:{paddingBottom:40}},r.a.createElement(u.o,{type:"text",top:"\u0418\u043c\u044f",name:"name",value:B.name,onChange:function(e){J({type:"SET_NAME",payload:{name:e.currentTarget.value}})}}),r.a.createElement(u.j,{top:"E-mail \u0438 \u0422\u0435\u043b\u0435\u0444\u043e\u043d",bottom:"\u042d\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0439\u0442\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044e \u0432 \u0441\u0435\u0440\u0432\u0438\u0441\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0447\u0435\u043a\u043e\u0432 \u0424\u041d\u0421.\r \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u0434\u0430\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e \u0447\u0435\u043a\u0430\u043c \u043f\u0440\u0438 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 QR \u043a\u043e\u0434\u0430"},r.a.createElement(u.o,{type:"email",top:"e-mail",name:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 e-mail",value:B.email,onChange:function(e){J({type:"SET_EMAIL",payload:{email:e.currentTarget.value}})},onClick:Q}),r.a.createElement(u.o,{type:"phone",top:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",name:"phone",value:B.phone,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043b\u0435\u0444\u043e\u043d",onChange:function(e){e.target.value.replace(/^[8]/,"+7"),J({type:"SET_PHONE",payload:{phone:e.currentTarget.value}})},onClick:Q})),r.a.createElement(u.j,{top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",bottom:'\u0415\u0441\u043b\u0438 \u0432\u044b \u043a\u043e\u0433\u0434\u0430-\u043b\u0438\u0431\u043e \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c \u0432 \u0441\u0435\u0440\u0432\u0438\u0441\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0447\u0435\u043a\u043e\u0432 \u0424\u041d\u0421, \u043d\u043e \u0437\u0430\u0431\u044b\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u043d\u0430\u0436\u043c\u0438\u0442\u0435 "\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c". \u0415\u0441\u043b\u0438 \u043d\u0435 \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043f\u043e \u043a\u0430\u043a\u0438\u043c \u0442\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0430\u043c, \u043e\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u043f\u043e\u043b\u0435 \u0432\u0432\u043e\u0434\u0430 \u043f\u0430\u0440\u043e\u043b\u044f \u043f\u0443\u0441\u0442\u044b\u043c, \u043d\u043e \u0442\u043e\u0433\u0434\u0430 \u0443 \u0432\u0430\u0441 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0447\u0435\u043a\u0438 \u0438 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0443 \u043f\u043e \u0447\u0435\u043a\u0430\u043c'},r.a.createElement(u.o,{type:"number",top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c \u0424\u041d\u0421",name:"kktPassword",value:B.kktPassword,onChange:function(e){J({type:"SET_PASSWORD",payload:{password:e.currentTarget.value}})}}),r.a.createElement(u.f,{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(u.b,{size:"l","data-type":"signup",onClick:function(e){j(e.currentTarget.dataset.type),c(!0)},style:{margin:"0px",width:"49%"}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"),r.a.createElement(u.b,{size:"l","data-type":"restore",onClick:function(e){j(e.currentTarget.dataset.type),c(!0)},style:{margin:"0px",width:"49%"}},"\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"))),r.a.createElement(u.h,{style:{marginBottom:"1em"},vertical:"bottom"},r.a.createElement(u.b,{size:"xl",mode:"commerce",onClick:function(){N(!0)}},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c"))),m)},B=a(219),J=a(220),Y=function(){function e(){Object(B.a)(this,e)}return Object(J.a)(e,null,[{key:"qr",value:function(e){try{var t,a,n,r,c;if(e){var l=e.match(/t=(\w{8}T\w+)&s=(\w+\.*\w+)&fn=(\w+)&i=(\w+)&fp=(\w+)/),o=Object(s.a)(l,6);t=o[1],a=o[2],n=o[3],r=o[4],c=o[5]}return{dt:t,sum:a.replace(/[.]/g,""),fn:n,i:r,fp:c}}catch(i){return console.log(i),{error:{message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0447\u0442\u0435\u043d\u0438\u044f QR \u043a\u043e\u0434\u0430"}}}}},{key:"date",value:function(e){var t,a=new Date(e);switch(a.getMonth()+1){case 1:t="\u044f\u043d\u0432\u0430\u0440\u044f";break;case 2:t="\u0444\u0435\u0432\u0440\u0430\u043b\u044f";break;case 3:t="\u043c\u0430\u0440\u0442\u0430";break;case 4:t="\u0430\u043f\u0440\u0435\u043b\u044f";break;case 5:t="\u043c\u0430\u044f";break;case 6:t="\u0438\u044e\u043d\u044f";break;case 7:t="\u0438\u044e\u043b\u044f";break;case 8:t="\u0430\u0432\u0433\u0443\u0441\u0442\u0430";break;case 9:t="\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f";break;case 10:t="\u043e\u043a\u0442\u044f\u0431\u0440\u044f";break;case 11:t="\u043d\u043e\u044f\u0431\u0440\u044f";break;case 12:t="\u0434\u0435\u043a\u0430\u0431\u0440\u044f"}return"".concat(a.getDate()," ").concat(t," ").concat(a.getFullYear())}},{key:"sum",value:function(e){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e/100)}},{key:"totalReceiptSum",value:function(e){if(0===e.length)return 0;return e.map((function(e){return e.sum||e.totalSum})).reduce((function(e,t){return e+t}))}},{key:"totalSumWithParams",value:function(e){if(0===e.length)return 0;return e.map((function(e){var t=e.income,a=e.sum;return t?a:-1*a})).reduce((function(e,t){return e+t}))}},{key:"totalSum",value:function(e,t){if(0===e.length)return 0;var a=function(e,t){return e+t},n=e.map((function(e){return e.items.map((function(e){return t?e.income?e.sum:0:e.income?0:e.sum})).reduce(a)})).reduce(a);return t?n:-1*n}}]),e}(),Q=function(e){var t=e.sum,a=e.fs,n=t>=0?{color:"#28a745",fontSize:a}:{color:"#dc3545",fontSize:a};return r.a.createElement("span",{style:n},Y.sum(t))},Z=a(99),$=a.n(Z),X=a(226),ee=a.n(X),te=a(221),ae=a.n(te),ne=a(222),re=a.n(ne),ce=a(223),le=a.n(ce),oe=a(242),ie=a(487),se=a(488),ue=a(489),me=a(224),de=a.n(me),pe=a(225),Ee=a.n(pe),fe=function(e){var t=e.setDateFromCalendar,a=Object(n.useState)(new Date),c=Object(s.a)(a,2),l=c[0],o=c[1];Object(n.useEffect)((function(){t(l)}),[l,t]);return r.a.createElement(u.l,null,r.a.createElement(u.p,null,r.a.createElement(u.c,{before:r.a.createElement(u.b,{onClick:function(){o(Object(ie.a)(l,1))},mode:"secondary"},r.a.createElement(de.a,null)),asideContent:r.a.createElement(u.b,{onClick:function(){o(Object(oe.a)(l,1))},mode:"secondary"},r.a.createElement(Ee.a,null)),style:{textAlign:"center",fontWeight:"bold"}},Object(se.a)(l,"LLLL yyyy",{locale:ue.a}).toLocaleUpperCase())))},be=a(41),Oe=(a(401),a(98)),ge=a.n(Oe),ye=function(e){var t=e.items,a=e.id,c=e.isSearch,l=void 0!==c&&c,o=t.map((function(e,t){var a=e.income?e.sum:-1*e.sum,c=function(e){return e&&e.definition?e.definition.definition:null}(e);return r.a.createElement(n.Fragment,{key:t},r.a.createElement("div",{className:"receipt-item"},r.a.createElement("span",{className:"receipt-item-name"},c||e.name),e.price&&!l?r.a.createElement("span",{className:"receipt-item-price"},Y.sum(e.price)):null,e.quantity&&!l?r.a.createElement("span",{className:"receipt-item-quantity"},e.quantity):null,e.dateTime&&l?r.a.createElement("span",{className:"receipt-item-dateTime"},Y.date(e.dateTime)):null,a?r.a.createElement("span",{className:"receipt-item-sum"},r.a.createElement(Q,{sum:a})):null))}));return r.a.createElement(ge.a,{id:a,className:"receipt-item-wrapper"},r.a.createElement("div",{className:"receipt-item"},r.a.createElement("span",{className:"receipt-item-name"},"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),l?r.a.createElement("span",{className:"receipt-item-dateTime"},"\u0414\u0430\u0442\u0430"):r.a.createElement(n.Fragment,null,r.a.createElement("span",{className:"receipt-item-price"},"\u0426\u0435\u043d\u0430"),r.a.createElement("span",{className:"receipt-item-quantity"},"\u041a\u043e\u043b-\u0432\u043e")),r.a.createElement("span",{className:"receipt-item-sum"},"\u0421\u0443\u043c\u043c\u0430")),r.a.createElement(u.D,null),o,r.a.createElement(u.D,null),r.a.createElement("div",{className:"receipt-total"},r.a.createElement("span",{className:""},"\u0418\u0442\u043e\u0433\u043e:"),r.a.createElement("span",null,r.a.createElement(Q,{sum:Y.totalSumWithParams(t)}))))},je=function(e){var t=e.receipts,a=Object(n.useState)(""),c=Object(s.a)(a,2),l=c[0],o=c[1],i=Object(n.useState)([]),m=Object(s.a)(i,2),d=m[0],p=m[1],E=Object(n.useState)([]),f=Object(s.a)(E,2),b=f[0],O=f[1];return Object(n.useEffect)((function(){if(t){var e=[];t.map((function(e){var t=e.dateTime;return e.items.map((function(e){return e.dateTime=t,e}))})).forEach((function(t){e.push.apply(e,Object(be.a)(t))})),p(e)}}),[t]),Object(n.useEffect)((function(){O(l?d.filter((function(e){return e.name.toLowerCase().indexOf(l)>-1})):[])}),[l,d]),r.a.createElement(n.Fragment,null,r.a.createElement(u.C,{value:l,onChange:function(e){o(e.target.value.toLowerCase())}}),r.a.createElement($.a,{title:"\u041f\u043e\u0438\u0441\u043a"},b.length>0&&r.a.createElement(ye,{id:b._id,isSearch:!0,items:b})))},he=function(e){var t=e.setReceiptFromBalance,a=e.onClickActiveModal,c=Object(n.useState)(!0),l=Object(s.a)(c,2),o=l[0],i=l[1],m=Object(n.useState)(new Date),d=Object(s.a)(m,2),p=d[0],E=d[1],b=Object(n.useState)([]),g=Object(s.a)(b,2),y=g[0],j=g[1],h=Object(n.useState)(!1),v=Object(s.a)(h,2),S=v[0],T=v[1],_=P("/day"),k=Object(s.a)(_,2),C=k[0].response,w=k[1],R=Object(n.useContext)(I),L=Object(s.a)(R,2)[1],x=Object(n.useCallback)((function(e){E(e),i(!0)}),[]);return Object(n.useEffect)((function(){o&&(w({params:{date:Object(se.a)(p,"yyyy-MM-dd")}}),i(!1),T(!1))}),[o,i,w,p]),Object(n.useEffect)((function(){C&&j(C)}),[C]),Object(n.useEffect)((function(){if(C&&!C.length&&!y.length&&p.getMonth()===(new Date).getMonth()){var e=r.a.createElement(u.a,{actions:[{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,mode:"cancel"},{title:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043e\u0441\u0442\u0430\u0442\u043e\u043a",autoclose:!0,action:function(){return L({type:"SET_PANEL",payload:{panel:"add"}})}}],onClose:function(){return L({type:"SET_POPOUT",payload:{popout:null}})}},r.a.createElement("h2",null,"\u0417\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043c\u0435\u0441\u044f\u0446 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0435\u0442"),r.a.createElement("p",null,"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u043e\u0441\u0442\u0430\u0442\u043e\u043a \u0434\u0435\u043d\u0435\u0436\u043d\u044b\u0445 \u0441\u0440\u0435\u0434\u0441\u0442\u0432, \u0434\u043b\u044f \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0439 \u043a\u0430\u043b\u044c\u043a\u0443\u043b\u044f\u0446\u0438\u0438 \u0431\u0430\u043b\u0430\u043d\u0441\u0430"));L({type:"SET_POPOUT",payload:{popout:e}})}}),[y.length,L,C,p]),r.a.createElement(n.Fragment,null,r.a.createElement(f.a,null,r.a.createElement(u.w,{aside:r.a.createElement(u.e,{size:"s",mode:"primary"},"0.8.7")},"\u0411\u0430\u043b\u0430\u043d\u0441")),r.a.createElement(je,{receipts:y}),r.a.createElement(u.x,{icon:r.a.createElement(ae.a,null),header:r.a.createElement(Q,{sum:Y.totalReceiptSum(y),fs:"2em"}),action:r.a.createElement(O.a,{size:"l",onClick:function(e){L({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"add"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0445\u043e\u0434 / \u0440\u0430\u0441\u0445\u043e\u0434")},"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439\u0442\u0435 \u0434\u043e\u0445\u043e\u0434\u044b/\u0440\u0430\u0441\u0445\u043e\u0434\u044b"),r.a.createElement(u.D,null),r.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",paddingTop:"1em"}},r.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-end"}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingRight:"10px"}},r.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em",textAlign:"end"}},"\u0414\u043e\u0445\u043e\u0434\u044b"),r.a.createElement(Q,{sum:Y.totalSum(y,!0),fs:"1.4em"})),r.a.createElement(re.a,{width:16,height:40,fill:"#28a745"})),r.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-start"}},r.a.createElement(le.a,{width:16,height:40,fill:"#dc3545"}),r.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingLeft:"10px"}},r.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em"}},"\u0420\u0430\u0441\u0445\u043e\u0434\u044b"),r.a.createElement(Q,{sum:Y.totalSum(y,!1),fs:"1.4em"})))),r.a.createElement(u.z,{onRefresh:function(){T(!0),i(!0)},isFetching:S},r.a.createElement($.a,{title:"\u0427\u0435\u043a\u0438"},r.a.createElement(u.p,null,r.a.createElement(fe,{setDateFromCalendar:x}),y.map((function(e,n){return r.a.createElement(ee.a,{key:n,expandable:!0,onClick:function(){a("modal-page"),t(e)},"data-to":e._id,indicator:r.a.createElement(Q,{sum:e.totalSum})},Y.date(e.dateTime))}))))))},ve=a(83),Se=a.n(ve),Te=a(68),_e=a.n(Te),ke=a(230),Ce=a.n(ke),we=a(227),Ie=a.n(we),Re=a(229),Pe=a.n(Re),Le=a(228),xe=a.n(Le),Ne=function(e){var t=e.message,a=e.isError,c=e.onClose,l=Object(n.useState)(null),o=Object(s.a)(l,2),i=o[0],m=o[1],d=Object(n.useContext)(I),p=Object(s.a)(d,2)[1];return Object(n.useEffect)((function(){m(r.a.createElement(u.F,{layout:"vertical",onClose:c,before:a?r.a.createElement(z.a,{size:24,style:{backgroundColor:"var(--destructive)"}},r.a.createElement(xe.a,{fill:"#fff",width:18,height:18})):r.a.createElement(z.a,{size:24,style:{backgroundColor:"var(--accent)"}},r.a.createElement(G.a,{fill:"#fff",width:18,height:18}))},t))}),[m,p,a,t,c]),i},Ae=function(){var e=Object(n.useState)(""),t=Object(s.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)((function(){var e=new Date,t=e.getMonth()+1>9?e.getMonth()+1:"0".concat(e.getMonth()+1),a=e.getDate()>9?e.getDate():"0".concat(e.getDate());return"".concat(e.getFullYear(),"-").concat(t,"-").concat(a)})),o=Object(s.a)(l,2),m=o[0],d=o[1],p=Object(n.useState)(1),E=Object(s.a)(p,2),b=E[0],g=E[1],y=Object(n.useState)(""),j=Object(s.a)(y,2),h=j[0],v=j[1],S=Object(n.useState)(!1),T=Object(s.a)(S,2),_=T[0],C=T[1],w=Object(n.useState)(null),R=Object(s.a)(w,2),L=R[0],x=R[1],N=Object(n.useState)(null),A=Object(s.a)(N,2),U=A[0],F=A[1],M=Object(n.useContext)(I),z=Object(s.a)(M,2),V=z[0],G=z[1],K=P("/day"),H=Object(s.a)(K,2),q=H[0],B=q.response,J=q.error,Q=H[1],Z=P("/day/receipt"),$=Object(s.a)(Z,2),X=$[0],ee=$[1],te=Object(n.useState)(!1),ae=Object(s.a)(te,2),ne=ae[0],re=ae[1],ce=Object(n.useState)(!1),le=Object(s.a)(ce,2),oe=le[0],ie=le[1],se=Object(u.K)(),ue=Object(n.useCallback)((function(){G({type:"UNSET_ERROR"}),x(null)}),[G]);Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppOpenCodeReaderResult":F(n.code_data);break;case"VKWebAppOpenCodeReaderFailed":console.log("add day error",n)}}))}),[]),Object(n.useEffect)((function(){ne&&(Q({method:"POST",date:m,items:[{name:a,quantity:b,price:100*h,sum:100*h*b,income:_,modifiers:[],properties:[]}]}),c(""),g(1),C(!1),v(""),re(!1))}),[ne,re,m,Q,_,a,h,b]),Object(n.useEffect)((function(){B&&x(r.a.createElement(Ne,{message:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0448\u043b\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e",isError:!1,onClose:ue}))}),[B,ue]),Object(n.useEffect)((function(){if(U){var e=Y.qr(U);if(e.error){var t=e.error;return G({type:"SET_ERROR",payload:{error:t}}),F(null),void ie(!1)}var a=Object(k.a)({method:"POST"},e);ee(a)}}),[U,ee,oe,G]),Object(n.useEffect)((function(){X.response&&X.response._id&&(x(r.a.createElement(Ne,{message:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0448\u043b\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e",isError:!1,onClose:ue})),ie(!1),F(null))}),[X.response,ee,U,ue]),Object(n.useEffect)((function(){V.error&&(G({type:"SET_ERROR",payload:{error:X.error||J}}),x(r.a.createElement(Ne,{message:V.error.message,isError:!0,onClose:ue})),ie(!1),F(null))}),[X.error,J,G,V.error,ue]);var me=r.a.createElement(u.a,{actions:[{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,mode:"cancel"},{title:"\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c",autoclose:!0,action:function(){return G({type:"SET_VIEW",payload:{view:"profile",panel:"edit"}})}}],onClose:function(){return G({type:"SET_POPOUT",payload:{popout:null}})}},r.a.createElement("h2",null,"\u041d\u0435\u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d \u043f\u0440\u043e\u0444\u0438\u043b\u044c"),r.a.createElement("p",null,"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f QR \u043a\u043e\u0434\u043e\u0432 \u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u043e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043f\u043e \u0447\u0435\u043a\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0437\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c, \u0432\u0432\u0435\u0441\u0442\u0438 email, \u0442\u0435\u043b\u0435\u0444\u043e\u043d \u0438 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0424\u041d\u0421."));return r.a.createElement(n.Fragment,null,r.a.createElement(f.a,{left:r.a.createElement(_e.a,{key:"back",onClick:function(e){G({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"home"},se===u.n?r.a.createElement(D.a,null):r.a.createElement(W.a,null))},r.a.createElement(Pe.a,{before:i.a.supports("VKWebAppOpenCodeReader")&&r.a.createElement(_e.a,{key:"qr","data-to":"qr",onClick:function(){G({type:"UNSET_ERROR"}),V.currentUser.email||V.currentUser.phone||V.currentUser.password?G({type:"SET_POPOUT",payload:{popout:me}}):i.a.send("VKWebAppOpenCodeReader",{})}},r.a.createElement(Ie.a,null))},"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438")),r.a.createElement(ge.a,{style:{paddingBottom:40}},r.a.createElement(Se.a,{type:"date",top:"\u0414\u0430\u0442\u0430",name:"date",value:m,onChange:function(e){d(e.currentTarget.value)}}),r.a.createElement(Ce.a,{name:"income",checked:_,onChange:function(e){C(e.currentTarget.checked)}},"\u0414\u043e\u0445\u043e\u0434"),r.a.createElement(Se.a,{type:"text",top:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"name",value:a,onChange:function(e){c(e.currentTarget.value)}}),r.a.createElement(Se.a,{type:"number",top:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",name:"quantity",value:b,onChange:function(e){g(e.currentTarget.value)}}),r.a.createElement(Se.a,{type:"number",top:"\u0426\u0435\u043d\u0430",name:"price",value:h,onChange:function(e){v(e.currentTarget.value)}}),r.a.createElement(u.h,{style:{marginBottom:"1em"},vertical:"bottom"},r.a.createElement(O.a,{size:"xl",disabled:!m||!a||!b||!h,mode:_?"commerce":"destructive",onClick:function(){re(!0)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c ",_?"\u0434\u043e\u0445\u043e\u0434":"\u0440\u0430\u0441\u0445\u043e\u0434"))),L)},Ue=function(e){var t=e.receipt;return r.a.createElement(u.p,null,r.a.createElement(ye,{id:t._id,dateTime:t.dateTime,items:t.items}))},De=a(80),Fe=a.n(De),We=a(231),Me=a.n(We),ze=a(232),Ve=a.n(ze),Ge=a(233),Ke=a.n(Ge),He=a(234),qe=a.n(He),Be=a(235),Je=a.n(Be),Ye=a(100),Qe=a.n(Ye),Ze=function(){return r.a.createElement(n.Fragment,null,r.a.createElement(u.u,null,"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0430"),r.a.createElement(u.x,null,"\u0420\u0430\u0437\u0434\u0435\u043b \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435"))},$e=a(236),Xe=a.n($e),et=function(){var e=Object(n.useContext)(I),t=Object(s.a)(e,2),a=t[0],c=t[1],l=P("/day"),o=Object(s.a)(l,2),m=o[0],d=m.response,p=m.error,E=o[1],f=Object(n.useState)((function(){var e=new Date,t=e.getMonth()+1>9?e.getMonth()+1:"0".concat(e.getMonth()+1),a=e.getDate()>9?e.getDate():"0".concat(e.getDate());return"".concat(e.getFullYear(),"-").concat(t,"-").concat(a)})),b=Object(s.a)(f,1)[0],O=Object(n.useState)(null),g=Object(s.a)(O,2),y=g[0],j=g[1];Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppOpenPayFormResult":if(n.status){console.log("\u041f\u043b\u0430\u0442\u0435\u0436 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d");var r={method:"POST",date:b,items:[{name:"\u041f\u043e\u043c\u043e\u0449\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0443 Balance",quantity:1,price:100*n.amount,sum:100*n.amount*1,income:!1,modifiers:[],properties:[{transactionId:n.transaction_id}]}]};E(r)}break;case"VKWebAppOpenPayFormFailed":console.log("profile error",n)}}))}));var h=Object(n.useCallback)((function(){c({type:"UNSET_ERROR"}),j(null)}),[c]);return Object(n.useEffect)((function(){d&&j(r.a.createElement(Ne,{message:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u043f\u043e\u043c\u043e\u0449\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0443!",isError:!1,onClose:h}))}),[d,h]),Object(n.useEffect)((function(){a.error&&(c({type:"SET_ERROR",payload:{error:p}}),j(r.a.createElement(Ne,{message:a.error.message,isError:!0,onClose:h})))}),[p,c,a.error,h]),r.a.createElement(n.Fragment,null,r.a.createElement(u.u,null,"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e"),r.a.createElement(u.l,null,r.a.createElement(u.m,{mode:"secondary"},"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e"),r.a.createElement(u.E,{"data-panel":"catalog",expandable:!0,before:r.a.createElement(Qe.a,null),onClick:function(e){c({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.panel}})}},"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a")),r.a.createElement(u.l,null,r.a.createElement(u.m,{mode:"secondary"},"\u041f\u043e\u043c\u043e\u0449\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0443"),r.a.createElement(u.E,{"data-panel":"catalog",expandable:!0,before:r.a.createElement(Xe.a,null),onClick:function(){i.a.send("VKWebAppOpenPayForm",{app_id:7252987,action:"pay-to-user",params:{amount:100,description:"\u041d\u0430 \u043a\u043e\u0444\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443",user_id:3479465}})}},"\u041d\u0430 \u043a\u043e\u0444\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443")),y)},tt=a(237),at=a.n(tt),nt=a(135),rt=a.n(nt),ct=a(238),lt=a.n(ct),ot={catalog:[],filteredCatalog:[],catalogToSave:new Set,filterItems:[],editedElementId:"",openFilter:!1,filterRules:[]},it=function(e,t){switch(t.type){case"SET_CATALOG":var a=e.filterRules.map((function(t){return e.catalog.filter((function(e){return e.definition===t&&e}))})).flat();return Object(k.a)({},e,{catalog:t.payload.catalog,filteredCatalog:a&&a.length>0?a:t.payload.catalog,filterRules:a&&a.length>0?e.filterRules:[],catalogToSave:new Set,editedElementId:""});case"SET_EDITED_ELEMENT":return Object(k.a)({},e,{editedElementId:t.payload.id});case"FILL_SAVE_CATALOG":var n,r=e.catalog.findIndex((function(e){return e._id===t.payload.id}));t.payload.definition&&((n=e.catalog[r]).definition=t.payload.definition);var c=new Set(e.catalogToSave);return c.add(n),Object(k.a)({},e,{catalogToSave:c});case"ERASE_FILTER_RULES":return Object(k.a)({},e,{filterRules:[],openFilter:!1,filteredCatalog:e.catalog});case"SET_FILTER_ITEMS":var l=e.catalog.map((function(e){return e.definition?e.definition:"*\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438"})).reduce((function(e,t){return e.includes(t)?e:[].concat(Object(be.a)(e),[t])}),[]);return Object(k.a)({},e,{filterItems:l});case"SET_FILTER_RULES":var o=e.filterRules,i=e.filterRules.length>0?e.filteredCatalog:[];if(t.payload.checked){o=[].concat(Object(be.a)(o),[t.payload.definition]);var s=e.catalog.filter((function(e){return e.definition===t.payload.definition}));i=[].concat(Object(be.a)(i),Object(be.a)(s))}else o.splice(o.findIndex((function(e){return e===t.payload.definition})),1),i=o.map((function(t){return e.catalog.filter((function(e){return e.definition===t&&e}))})).flat();return Object(k.a)({},e,{filteredCatalog:i,filterRules:o});case"OPEN_FILTER":return Object(k.a)({},e,{openFilter:!0});case"CLOSE_FILTER":return Object(k.a)({},e,{openFilter:!1});default:return e}},st=function(){var e=Object(n.useReducer)(it,ot),t=Object(s.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(""),o=Object(s.a)(l,2),i=o[0],m=o[1],d=P("/catalog".concat(i)),p=Object(s.a)(d,2),E=p[0].response,f=p[1],b=Object(n.useState)(!0),O=Object(s.a)(b,2),g=O[0],y=O[1],j=Object(n.useState)("get"),h=Object(s.a)(j,1)[0],v=a.filteredCatalog.map((function(e,t){return r.a.createElement(n.Fragment,{key:t},r.a.createElement(u.A,{"data-id":e._id,multiline:!0,caption:e.name,after:r.a.createElement(at.a,null),bottom:a.editedElementId===e._id&&r.a.createElement(u.o,{id:a.editedElementId,type:"text",defaultValue:e.definition,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0443",onChange:function(e){c({type:"FILL_SAVE_CATALOG",payload:{id:a.editedElementId,definition:e.target.value}})}}),onClick:function(e){c({type:"SET_EDITED_ELEMENT",payload:{id:e.currentTarget.dataset.id}})},actions:r.a.createElement(n.Fragment,null,r.a.createElement(u.b,{disabled:!0,style:{display:"none"}},r.a.createElement(rt.a,null)),r.a.createElement(u.b,{disabled:!0,style:{display:"none"},mode:"secondary"},r.a.createElement(rt.a,null)))},r.a.createElement("b",null,e.definition?e.definition:"\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438")))})),S=a.filterItems.map((function(e,t){var n="*\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438"!==e?a.filterRules.includes(e):a.filterRules.includes(void 0);return r.a.createElement(u.E,{key:t,after:r.a.createElement(u.G,{"data-definition":e,onChange:function(e){var t=e.currentTarget.dataset.definition,a=e.currentTarget.checked;c({type:"SET_FILTER_RULES",payload:{checked:a,definition:"*\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438"!==t?t:void 0}})},defaultChecked:n})},e)}));Object(n.useEffect)((function(){a.editedElementId&&document.getElementById(a.editedElementId).focus()}),[a.editedElementId]),Object(n.useEffect)((function(){if(i||g){var e={};g&&(e.params={a:h}),i&&(e.method="PUT",e.update=Object(be.a)(a.catalogToSave)),f(e)}}),[i,a.catalogToSave,f,g,h]),Object(n.useEffect)((function(){E&&(c({type:"SET_CATALOG",payload:{catalog:E}}),c({type:"SET_FILTER_ITEMS"}),m(""),y(!1))}),[E]);var T={paddingTop:0!==a.filterRules.length&&60,paddingBottom:(0!==Object(be.a)(a.catalogToSave).length||0!==a.filterRules.length&&a.openFilter)&&60},_={paddingRight:10,paddingLeft:10};return r.a.createElement(n.Fragment,null,r.a.createElement(u.u,{left:r.a.createElement(u.v,{onClick:function(){a.openFilter?c({type:"CLOSE_FILTER"}):c({type:"OPEN_FILTER"})}},r.a.createElement(lt.a,null))},"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a"),r.a.createElement(u.l,{style:T},a.openFilter?S:v),0!==a.filterRules.length&&r.a.createElement(u.h,{style:_,vertical:"top"},r.a.createElement(u.D,{wide:!0}),r.a.createElement(u.b,{mode:"destructive",size:"xl",onClick:function(){c({type:"ERASE_FILTER_RULES"})}},"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440")),0!==Object(be.a)(a.catalogToSave).length&&r.a.createElement(u.h,{style:_,vertical:"bottom"},r.a.createElement(u.D,{wide:!0}),r.a.createElement(u.b,{mode:"commerce",size:"xl",onClick:function(){m("/update")}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f")),0!==a.filterRules.length&&a.openFilter&&r.a.createElement(u.h,{style:_,vertical:"bottom"},r.a.createElement(u.D,{wide:!0}),r.a.createElement(u.b,{mode:"commerce",size:"xl",onClick:function(){c({type:"CLOSE_FILTER"})}},"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440")))},ut=a(239),mt=a.n(ut),dt={shoppingList:[],shoppingItem:{text:"",done:!1},date:new Date},pt=function(e,t){switch(t.type){case"INITIAL_SHOPPING_LIST":return Object(k.a)({},e,{shoppingList:t.payload.list});case"SET_SHOPPING_ITEM":return Object(k.a)({},e,{shoppingItem:{text:t.payload.text,done:!1}});case"ADD_ITEM":var a=e.shoppingList;return e.shoppingItem.text?Object(k.a)({},e,{shoppingList:[].concat(Object(be.a)(a),[e.shoppingItem]),shoppingItem:{text:"",done:!1}}):e;case"DELETE_ITEM":var n=e.shoppingList;return n.splice(t.payload.index,1),Object(k.a)({},e,{shoppingList:n});case"SET_DONE":var r=e.shoppingList;return r[t.payload.index].done=!r[t.payload.index].done,Object(k.a)({},e,{shoppingList:r});default:return e}},Et=function(){var e=S("shoppingList",JSON.stringify([])),t=Object(s.a)(e,2),a=t[0],c=t[1],l=Object(n.useReducer)(pt,dt),o=Object(s.a)(l,2),i=o[0],m=o[1],d=i.shoppingList.map((function(e,t){return r.a.createElement(u.E,{key:t,after:r.a.createElement(mt.a,{"data-index":t,onClick:function(e){m({type:"DELETE_ITEM",payload:{index:e.currentTarget.dataset.index}})}})},r.a.createElement(u.d,{defaultChecked:e.done,"data-index":t,style:{textDecoration:e.done&&"line-through"},onChange:function(e){m({type:"SET_DONE",payload:{index:e.currentTarget.dataset.index}})}},e.text))}));return Object(n.useEffect)((function(){m({type:"INITIAL_SHOPPING_LIST",payload:{list:JSON.parse(a)}})}),[a]),Object(n.useEffect)((function(){0!==i.shoppingList.length&&c(JSON.stringify(i.shoppingList))}),[c,i]),r.a.createElement(n.Fragment,null,r.a.createElement(u.u,null,"\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043a\u0443\u043f\u043e\u043a"),r.a.createElement(u.i,{onSubmit:function(e){e.preventDefault(),m({type:"ADD_ITEM"})}},r.a.createElement(u.o,{type:"text",top:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",name:"shopping-item",value:i.shoppingItem.text,onChange:function(e){m({type:"SET_SHOPPING_ITEM",payload:{text:e.currentTarget.value}})},placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"})),r.a.createElement(u.l,null,i.shoppingList.length>0?d:r.a.createElement(u.x,null,"\u0412\u0430\u0448 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043a\u0443\u043f\u043e\u043a \u043f\u0443\u0441\u0442.")))},ft=function(){var e=Object(n.useContext)(I),t=Object(s.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(null),o=Object(s.a)(l,2),i=o[0],m=o[1],d=Object(n.useState)(null),p=Object(s.a)(d,2),E=p[0],f=p[1],b=Object(n.useState)(null),O=Object(s.a)(b,2),g=O[0],y=O[1],j=Object(n.useCallback)((function(){m(null)}),[]);Object(n.useEffect)((function(){if(g){var e=Object(u.K)();f(r.a.createElement(u.s,{activeModal:i,onClose:j},r.a.createElement(u.q,{id:"modal-page",onClose:j,header:r.a.createElement(u.r,{left:e!==u.n&&r.a.createElement(_e.a,{onClick:j},r.a.createElement(Fe.a,null)),right:e===u.n&&r.a.createElement(_e.a,{onClick:j},e===u.n?"\u0413\u043e\u0442\u043e\u0432\u043e":r.a.createElement(Me.a,null))},Y.date(g.dateTime))},r.a.createElement(Ue,{onClose:j,receipt:g}))))}}),[g,i,j]);var h=function(e){c({type:"SET_VIEW",payload:{view:e.currentTarget.dataset.story,panel:e.currentTarget.dataset.panel}})},v=a.currentUser&&r.a.createElement(u.H,null,r.a.createElement(u.I,{onClick:h,selected:"balance"===a.view&&"balance.home"===a.panel,"data-story":"balance","data-panel":"home",text:"\u0411\u0430\u043b\u0430\u043d\u0441"},r.a.createElement(Ve.a,null)),r.a.createElement(u.I,{onClick:h,selected:"list"===a.view,"data-story":"list","data-panel":"list",text:"\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043a\u0443\u043f\u043e\u043a"},r.a.createElement(Qe.a,null)),r.a.createElement(u.I,{onClick:h,selected:"balance"===a.view&&"balance.add"===a.panel,"data-story":"balance","data-panel":"add",text:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"},r.a.createElement(Je.a,null)),r.a.createElement(u.I,{onClick:h,selected:"profile"===a.view,"data-story":"profile","data-panel":"edit",text:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"},r.a.createElement(qe.a,null)),r.a.createElement(u.I,{onClick:h,selected:"more"===a.view,"data-story":"more","data-panel":"more",text:"\u0415\u0449\u0451"},r.a.createElement(Ke.a,null)));return r.a.createElement(u.g,{activeStory:a.view,tabbar:v},r.a.createElement(u.J,{id:"authorization",activePanel:a.panel,popout:a.popout},r.a.createElement(u.t,{id:"authorization.login"},r.a.createElement(A,{type:"login"})),r.a.createElement(u.t,{id:"authorization.register"},r.a.createElement(A,{type:"register"}))),r.a.createElement(u.J,{id:"profile",activePanel:a.panel,popout:a.popout},r.a.createElement(u.t,{id:"profile.edit"},r.a.createElement(q,null))),r.a.createElement(u.J,{id:"balance",activePanel:a.panel,popout:a.popout,modal:E},r.a.createElement(u.t,{id:"balance.home"},r.a.createElement(he,{setReceiptFromBalance:y,onClickActiveModal:m})),r.a.createElement(u.t,{id:"balance.add"},r.a.createElement(Ae,null))),r.a.createElement(u.J,{id:"analytics",activePanel:a.panel,popout:a.popout},r.a.createElement(u.t,{id:"analytics.home"},r.a.createElement(Ze,null))),r.a.createElement(u.J,{id:"more",activePanel:a.panel,popout:a.popout},r.a.createElement(u.t,{id:"more.more"},r.a.createElement(et,null)),r.a.createElement(u.t,{id:"more.catalog"},r.a.createElement(st,null))),r.a.createElement(u.J,{id:"list",activePanel:a.panel,popout:a.popout},r.a.createElement(u.t,{id:"list.list"},r.a.createElement(Et,null))))},bt=Object(n.createContext)([{},function(e){}]),Ot=function(e){var t=e.children,a=Object(n.useState)({isLoading:!1,isLoggedIn:null,currentUser:null}),c=Object(s.a)(a,2),l=c[0],o=c[1];return r.a.createElement(bt.Provider,{value:[l,o]},t)},gt=a(136),yt=a.n(gt),jt=a(240),ht=a.n(jt),vt=function(e){var t=e.children,a=Object(n.useContext)(I),r=Object(s.a)(a,2)[1],c=function(){var e=Object(n.useState)(""),t=Object(s.a)(e,2),a=t[0],r=t[1],c=Object(n.useState)(!1),l=Object(s.a)(c,2),o=l[0],i=l[1],u=Object(n.useState)(null),m=Object(s.a)(u,2),d=m[0],p=m[1],E=Object(n.useState)(!1),f=Object(s.a)(E,2),b=f[0],O=f[1];return Object(n.useEffect)((function(){if(o){var e=yt.a.parse(a);if(e){p(e.vk_user_id);var t={};Object.keys(e).sort().forEach((function(a){"vk_"===a.slice(0,3)&&(t[a]=e[a])}));var n=yt.a.stringify(t),r=ht.a.createHmac("sha256","Zs6DYRE8Z2mZ44LfciKW").update(n).digest().toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=$/,"");O(r===e.sign)}}}),[o,a]),[{vkUserId:d,matchUrlParams:b},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";r(e),i(!0)}]}(),l=Object(s.a)(c,2),o=l[0],i=o.vkUserId,u=o.matchUrlParams,m=l[1];return Object(n.useEffect)((function(){m(window.location.search.slice(1))}),[m]),Object(n.useEffect)((function(){i&&r({type:"SET_VK_USER",payload:{id:i,match:u}})}),[i,u,r]),t},St=function(e){var t=e.children,a=P("/users/profile"),r=Object(s.a)(a,2),c=r[0].response,l=r[1],o=P("/users/find"),i=Object(s.a)(o,2),u=i[0],m=i[1],d=Object(n.useContext)(I),p=Object(s.a)(d,2),E=p[0],f=p[1],b=S("token"),O=Object(s.a)(b,1)[0];return Object(n.useEffect)((function(){!O&&E.vkUser.matchUrlParams&&E.vkUser.id&&(m({params:{id:E.vkUser.id}}),f({type:"SHOW_LOADING"}))}),[O,E.vkUser.matchUrlParams,E.vkUser.id,f,m]),Object(n.useEffect)((function(){u.response&&(u.response.result?f({type:"SET_VIEW",payload:{view:"authorization",panel:"login"}}):f({type:"SET_VIEW",payload:{view:"authorization",panel:"register"}}),f({type:"HIDE_LOADING"}))}),[u.response,f]),Object(n.useEffect)((function(){O&&E.vkUser.matchUrlParams?(l(),f({type:"SHOW_LOADING"})):f({type:"SET_USER",payload:{user:null,isLoggedIn:!1}})}),[l,O,E.vkUser.matchUrlParams,f]),Object(n.useEffect)((function(){if(c){var e=c.user.vk_id.toString()===E.vkUser.id?c.user:null;f({type:"SET_USER",payload:{user:e,isLoggedIn:!!e}})}}),[c,E.vkUser.id,f]),t};i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;if("VKWebAppUpdateConfig"===a){var r=document.createAttribute("scheme");r.value=n.scheme?n.scheme:"client_light",document.body.attributes.setNamedItem(r)}})),i.a.send("VKWebAppInit"),window.onload=function(){l.a.render(r.a.createElement(R,null,r.a.createElement(vt,null,r.a.createElement(Ot,null,r.a.createElement(St,null,r.a.createElement(ft,null))))),document.getElementById("root"))}}},[[285,1,2]]]);
//# sourceMappingURL=main.e0868f16.chunk.js.map