{"version":3,"sources":["contexts/appSign.js","contexts/currentUser.js","views/Authorization.js","hooks/useApi.js","App.js","components/InstallingTheme.js","index.js","hooks/useCompareSign.js"],"names":["AppSignContext","createContext","CurrentUserContext","p","Authorization","go","type","loadIndicator","useState","password","setPassword","confirmPassword","setConfirmPassword","formError","setFormError","url","isLoading","setIsLoading","response","setResponse","error","setError","options","setOptions","_apiBase","doApiFetch","useCallback","method","token","bodyFields","useEffect","headers","fetch","mode","body","JSON","stringify","then","res","json","r","catch","e","useApi","useContext","vkUserId","startFetchData","setStartFetchData","setCurrentUserState","length","status","message","user","id","state","isLoggedIn","currentUser","onInput","target","value","Math","max","parseInt","toString","slice","name","formButtonClick","a","size","icon","header","top","onChange","align","onClick","stretched","data-to","App","activePanel","setActivePanel","activeView","setActiveView","popout","setPopout","currentTarget","dataset","to","changeActiveView","indicator","goView","InstallingTheme","children","connect","subscribe","detail","data","schemeAttribute","document","createAttribute","scheme","attributes","setNamedItem","send","ReactDOM","render","urlParams","setUrlParams","setVkUserId","matchUrlParams","setMatch","params","qs","parse","console","log","vk_user_id","ordered","Object","keys","sort","forEach","key","stringParams","paramsHash","crypto","createHmac","update","digest","replace","sign","useCompareSign","setParams","setState","window","location","search","Provider","getElementById"],"mappings":"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","file":"static/js/main.6f904082.chunk.js","sourcesContent":["import React, { useState, createContext, useEffect } from 'react';\r\nimport useCompareSign from \"../hooks/useCompareSign\";\r\n\r\nexport const AppSignContext = createContext([{}, () => {}]);\r\n\r\nexport const AppSignProvider = ({ children }) => {\r\n  const [{vkUserId, matchUrlParams}, setParams] = useCompareSign();\r\n  const [state, setState] = useState({\r\n    vkUserId: null,\r\n    matchUrlParams: false\r\n  });\r\n\r\n  useEffect(()=>{\r\n    setParams(window.location.search.slice(1));\r\n  }, [setParams]);\r\n\r\n  useEffect(() => {\r\n    if (!vkUserId) return;\r\n    setState({vkUserId, matchUrlParams});\r\n  }, [vkUserId, matchUrlParams]);\r\n\r\n  return (\r\n    <AppSignContext.Provider value={[state, setState]}>\r\n      {children}\r\n    </AppSignContext.Provider>\r\n  )\r\n};","import React, { createContext, useState } from 'react';\r\n\r\nexport const CurrentUserContext = createContext([{}, p => {}]);\r\n\r\nexport const CurrentUserProvider = ({ children }) => {\r\n\tconst [state, setState] = useState({\r\n\t\tisLoading: false,\r\n\t\tisLoggedIn: null,\r\n\t\tcurrentUser: null\r\n\t});\r\n\treturn (\r\n\t\t<CurrentUserContext.Provider value={[state, setState]}>\r\n\t\t\t{children}\r\n\t\t</CurrentUserContext.Provider>\r\n\t)\r\n};\r\n","import React, {Fragment, useState, useEffect, useContext} from 'react';\r\nimport {Div, FormLayout, FormLayoutGroup, Input, Placeholder, FormStatus} from \"@vkontakte/vkui\";\r\nimport PanelHeader from \"@vkontakte/vkui/dist/components/PanelHeader/PanelHeader\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Icon56LockOutline from '@vkontakte/icons/dist/56/lock_outline';\r\nimport Icon56UserAddOutline from '@vkontakte/icons/dist/56/user_add_outline';\r\nimport useApi from \"../hooks/useApi\";\r\nimport {AppSignContext} from \"../contexts/appSign\";\r\nimport {CurrentUserContext} from \"../contexts/currentUser\";\r\nimport ScreenSpinner from '@vkontakte/vkui/dist/components/ScreenSpinner/ScreenSpinner';\r\n\r\nconst Authorization = ({go, type, loadIndicator}) => {\r\n\tconst [password, setPassword] = useState('');\r\n\tconst [confirmPassword, setConfirmPassword] = useState('');\r\n\tconst [formError, setFormError] = useState(null);\r\n\tconst [{response}, doApiFetch] = useApi(`/users/${type}`);\r\n\tconst [{vkUserId}] = useContext(AppSignContext);\r\n\tconst [startFetchData, setStartFetchData] = useState(false);\r\n\tconst [, setCurrentUserState] = useContext(CurrentUserContext);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (type === 'login') return;\r\n\r\n\t\tif ((password.length !== confirmPassword.length)) {\r\n\t\t\tsetFormError(null);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (password !== confirmPassword) {\r\n\t\t\tsetFormError({status: 'Ошибка валидации', message: 'Пароли не совпадают. Проверьте ввод и повторите попытку.'});\r\n\t\t}\r\n\t}, [password, confirmPassword, type]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (!startFetchData) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'POST',\r\n\t\t\tuser: {\r\n\t\t\t\tid: +vkUserId,\r\n\t\t\t\tpassword: password\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdoApiFetch(body);\r\n\t\tsetStartFetchData(false);\r\n\t},[startFetchData, doApiFetch, password, vkUserId]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\r\n\t\tif (!response.user && response.error) {\r\n\t\t\tsetFormError(response.error);\r\n\t\t}\r\n\t\tsetCurrentUserState(state => ({\r\n\t\t\t...state,\r\n\t\t\tisLoading: false,\r\n\t\t\tisLoggedIn: !!response.user,\r\n\t\t\tcurrentUser: response.user || null\r\n\t\t}));\r\n\r\n\t\tloadIndicator(null);\r\n\t}, [response, setCurrentUserState, loadIndicator]);\r\n\r\n\tconst onInput = (e) => {\r\n\t\te.target.value = Math.max(0, parseInt(e.target.value) ).toString().slice(0,4);\r\n\t\tif (e.target.name === 'password') {\r\n\t\t\tsetPassword(e.target.value);\r\n\t\t} else {\r\n\t\t\tsetConfirmPassword(e.target.value);\r\n\t\t}\r\n\t};\r\n\r\n\tconst formStatus = () => {\r\n\t\tif (!formError) return null;\r\n\t\treturn (\r\n\t\t\t<FormStatus header={formError.status} mode=\"error\">\r\n\t\t\t\t{formError.message}\r\n\t\t\t</FormStatus>\r\n\t\t)\r\n\t};\r\n\r\n\tconst formButtonClick = async () => {\r\n\t\tsetStartFetchData(true);\r\n\t\tloadIndicator(<ScreenSpinner size='large' />);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>{type === 'login' ? 'Авторизация' : 'Регистрация'}</PanelHeader>\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={type === 'login' ? <Icon56LockOutline /> : <Icon56UserAddOutline />}\r\n\t\t\t\theader={type === 'login' ? 'Введите пароль' : 'Придумайте пароль'}\r\n\t\t\t>\r\n\t\t\t\t<FormLayout>\r\n\t\t\t\t\t{formStatus()}\r\n\t\t\t\t\t<FormLayoutGroup top={'Введите пароль'}>\r\n\t\t\t\t\t\t<Input name={'password'} type={'number'} onChange = {onInput} align=\"center\" value={password}/>\r\n\t\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype !== 'login'\r\n\t\t\t\t\t\t\t?\r\n\t\t\t\t\t\t\t<FormLayoutGroup top={'Повторите пароль'}>\r\n\t\t\t\t\t\t\t\t<Input type={'number'} name={'confirmPassword'} onChange = {onInput} align=\"center\" value={confirmPassword}/>\r\n\t\t\t\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<Button size=\"l\" onClick={formButtonClick}>{type === 'login' ? 'Авторизация' : 'Регистрация'}</Button>\r\n\t\t\t\t</FormLayout>\r\n\t\t\t</Placeholder>\r\n\t\t\t<Div>\r\n\t\t\t\t<Button\r\n\t\t\t\t\tstretched\r\n\t\t\t\t\tmode=\"tertiary\"\r\n\t\t\t\t\tonClick={go}\r\n\t\t\t\t\tdata-to={type === 'login' ? 'authorization.registration' : 'authorization.login'}\r\n\t\t\t\t>{type === 'login' ? 'Нет пароля?' : 'Есть пароль?'}</Button>\r\n\t\t\t</Div>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Authorization;\r\n","import {useState, useEffect, useCallback} from 'react';\r\n\r\nexport default url => {\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [response, setResponse] = useState(null);\r\n\tconst [error, setError] = useState(null);\r\n\tconst [options, setOptions] = useState({});\r\n\tconst _apiBase = `http://localhost:3000/api`;\r\n\r\n\tconst doApiFetch = useCallback((options) => {\r\n\t\tsetOptions(options);\r\n\t\tsetIsLoading(true);\r\n\t}, []);\r\n\r\n\tconst { method, token, ...bodyFields} = options;\r\n\tuseEffect(() => {\r\n\t\tif (!isLoading) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst headers = {\r\n\t\t\t'Content-Type': 'application/json',\r\n\t\t\t'Authorization': token ? `Token ${token}` : '',\r\n\t\t};\r\n\r\n\t\tfetch(`${_apiBase}${url}`, {\r\n\t\t\tmethod,\r\n\t\t\tmode: 'cors',\r\n\t\t\theaders,\r\n\t\t\tbody: method !== 'GET' ? JSON.stringify(bodyFields) : null,\r\n\t\t})\r\n\t\t\t.then(res => res.json())\r\n\t\t\t.then(r => {\r\n\t\t\t\tsetIsLoading(false);\r\n\t\t\t\tsetResponse(r);\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tsetIsLoading(false);\r\n\t\t\t\tsetError(e);\r\n\t\t\t});\r\n\r\n\t}, [isLoading, bodyFields, method, url, _apiBase, token]);\r\n\treturn [{isLoading, response, error}, doApiFetch];\r\n}\r\n","import React, { useState } from 'react';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport {Root, Panel, View} from \"@vkontakte/vkui\";\r\nimport Authorization from \"./views/Authorization\";\r\n\r\n\r\nconst App = () => {\r\n\tconst [activePanel, setActivePanel] = useState('authorization.login');\r\n\tconst [activeView, setActiveView] = useState('authorization');\r\n\tconst [popout, setPopout] = useState(null);\r\n\t//const [popout, setPopout] = useState(null);\r\n\r\n\tconst go = e => {\r\n\t\tsetActivePanel(e.currentTarget.dataset.to);\r\n\t};\r\n\r\n\tconst changeActiveView = e => {\r\n\t\tsetActiveView(e.currentTarget.dataset.to);\r\n\t};\r\n\r\n\tconst loadIndicator = (indicator) => {\r\n\t\tsetPopout(indicator);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Root activeView={activeView}>\r\n\t\t\t<View id={'authorization'} activePanel={activePanel} popout={popout}>\r\n\t\t\t\t<Panel id={'authorization.login'}>\r\n\t\t\t\t\t<Authorization go={go} type={'login'} goView={changeActiveView} loadIndicator={loadIndicator}/>\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'authorization.registration'}>\r\n\t\t\t\t\t<Authorization go={go} type={'register'} goView={changeActiveView} loadIndicator={loadIndicator}/>\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t</Root>\r\n\t);\r\n};\r\n\r\nexport default App;\r\n","import { useEffect } from 'react';\r\nimport connect from \"@vkontakte/vk-connect\";\r\n\r\nconst InstallingTheme = ({ children }) => {\r\n\r\n\tuseEffect(() => {\r\n\t\tconnect.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\r\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\r\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\r\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\r\n\t\t\t}\r\n\t\t});\r\n\t}, []);\r\n\r\n\treturn (children)\r\n};\r\n\r\nexport default InstallingTheme;\r\n","import 'core-js/features/map';\r\nimport 'core-js/features/set';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport connect from '@vkontakte/vk-connect';\r\nimport App from './App';\r\nimport {CurrentUserProvider} from \"./contexts/currentUser\";\r\nimport {AppSignProvider} from \"./contexts/appSign\";\r\nimport InstallingTheme from \"./components/InstallingTheme\";\r\n// import registerServiceWorker from './sw';\r\n\r\n// Init VK  Mini App\r\nconnect.send('VKWebAppInit');\r\n\r\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\r\n// расскомментируйте строку с registerServiceWorker();\r\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\r\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\r\n// registerServiceWorker();\r\n\r\nReactDOM.render(\r\n\t<InstallingTheme>\r\n\t\t<AppSignProvider>\r\n\t\t\t<CurrentUserProvider>\r\n\t\t\t\t<App />\r\n\t\t\t</CurrentUserProvider>\r\n\t\t</AppSignProvider>\r\n\t</InstallingTheme>\r\n\t,\r\n\tdocument.getElementById('root')\r\n);\r\n","import { useState, useEffect } from 'react';\r\nimport qs from 'querystring';\r\nimport crypto from 'crypto';\r\n\r\nexport default () => {\r\n\tconst [urlParams, setUrlParams] = useState('');\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [vkUserId, setVkUserId] = useState(null);\r\n\tconst [matchUrlParams, setMatch] = useState(false);\r\n\r\n\tconst setParams = (urlParams = '') => {\r\n\t\tsetUrlParams(urlParams);\r\n\t\tsetIsLoading(true);\r\n\t};\r\n\r\n\tuseEffect(() =>{\r\n\t\tif( !isLoading ) return;\r\n\r\n\t\tconst params = qs.parse(urlParams);\r\n\t\tconsole.log(params);\r\n\r\n\t\tif (!params) return;\r\n\r\n\t\tsetVkUserId(params.vk_user_id);\r\n\r\n\t\tconst ordered = {};\r\n\t\tObject.keys(params).sort().forEach((key) => {\r\n\t\t\tif (key.slice(0, 3) === 'vk_') {\r\n\t\t\t\tordered[key] = params[key];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst stringParams = qs.stringify(ordered);\r\n\t\tconst paramsHash = crypto\r\n\t\t\t.createHmac('sha256', 'Zs6DYRE8Z2mZ44LfciKW')\r\n\t\t\t.update(stringParams)\r\n\t\t\t.digest()\r\n\t\t\t.toString('base64')\r\n\t\t\t.replace(/\\+/g, '-')\r\n\t\t\t.replace(/\\//g, '_')\r\n\t\t\t.replace(/=$/, '');\r\n\r\n\t\tsetMatch(paramsHash === params.sign);\r\n\t}, [isLoading, urlParams]);\r\n\r\n\treturn [{vkUserId, matchUrlParams}, setParams];\r\n}"],"sourceRoot":""}