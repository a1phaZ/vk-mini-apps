(this["webpackJsonpvk-mini-apps-empty"]=this["webpackJsonpvk-mini-apps-empty"]||[]).push([[0],{115:function(e,t,a){},282:function(e,t,a){e.exports=a(482)},384:function(e,t,a){},398:function(e,t,a){},404:function(e,t){},406:function(e,t){},439:function(e,t){},440:function(e,t){},482:function(e,t,a){"use strict";a.r(t);a(283),a(309),a(311),a(312),a(314),a(315),a(316),a(317),a(318),a(319),a(320),a(321),a(323),a(324),a(325),a(326),a(327),a(328),a(329),a(330),a(331),a(332),a(334),a(335),a(336),a(337),a(338),a(339),a(340),a(341),a(342),a(343),a(344),a(345),a(346),a(347),a(348),a(349),a(350),a(351);var n=a(0),r=a.n(n),c=a(208),l=a.n(c),o=a(30),i=a.n(o),u=a(4),s=(a(359),a(2)),m=a(67),d=a.n(m),p=a(93),E=a(66),f=a.n(E),b=a(35),O=a.n(b),y=a(216),g=a.n(y),j=a(217),v=a.n(j),h=a(240),S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=Object(n.useState)((function(){return localStorage.getItem(e)||t})),r=Object(u.a)(a,2),c=r[0],l=r[1],o=function(t){l(t),localStorage.setItem(e,t)};return[c,o]},T=a(218),_=a.n(T),w=a(8),k=function(e,t){window.history.pushState({view:e,panel:t},"".concat(e,".").concat(t),"#".concat(e,".").concat(t))},C={view:"authorization",panel:"authorization.login",popout:null,error:null,password:"",confirmPassword:"",vkUser:{id:null,matchUrlParams:!1},currentUser:null,isLoggedIn:!1,receipts:[],item:null,currentDate:new Date,modal:null},I=function(e,t){switch(t.type){case"SET_VIEW":return k(t.payload.view,t.payload.panel),Object(w.a)({},e,{view:t.payload.view,panel:"".concat(t.payload.view,".").concat(t.payload.panel),error:null,item:null});case"SET_PANEL":return k(e.view,t.payload.panel),Object(w.a)({},e,{password:"",confirmPassword:"",panel:"".concat(e.view,".").concat(t.payload.panel),error:null,item:null});case"SHOW_LOADING":return Object(w.a)({},e,{popout:r.a.createElement(s.y,null,r.a.createElement(s.B,null))});case"HIDE_LOADING":return Object(w.a)({},e,{popout:null});case"SET_POPOUT":return Object(w.a)({},e,{popout:t.payload.popout});case"SET_ERROR":return Object(w.a)({},e,{error:t.payload.error});case"UNSET_ERROR":return Object(w.a)({},e,{error:null});case"SET_PASSWORD":return Object(w.a)({},e,{password:e.password.length<4?e.password+t.payload.digit:e.password});case"SET_CONFIRM_PASSWORD":return Object(w.a)({},e,{confirmPassword:e.confirmPassword.length<4?e.confirmPassword+t.payload.digit:e.confirmPassword});case"UNSET_PASSWORD":return Object(w.a)({},e,{password:"",confirmPassword:""});case"SET_VK_USER":return Object(w.a)({},e,{vkUser:{id:t.payload.id,matchUrlParams:t.payload.match}});case"SET_USER":return Object(w.a)({},e,{currentUser:t.payload.user,isLoggedIn:t.payload.isLoggedIn});case"SET_RECEIPTS":return Object(w.a)({},e,{receipts:t.payload.receipts});case"SET_DATE":return Object(w.a)({},e,{currentDate:t.payload.date});case"SET_ITEM_TO_EDIT":return k("balance","balance.add"),Object(w.a)({},e,{item:t.payload.item,view:"balance",panel:"balance.add",modal:null});case"HIDE_MODAL":return Object(w.a)({},e,{modal:null});case"SHOW_MODAL":return Object(w.a)({},e,{modal:t.payload.modal});case"LOGOUT":return Object(w.a)({},e,{view:"authorization",panel:"authorization.login",popout:null,error:null,password:"",confirmPassword:"",currentUser:null,isLoggedIn:!1,receipts:[],item:null,currentDate:new Date,modal:null});default:return e}},R=Object(n.createContext)(),D=function(e){var t=e.children,a=Object(n.useReducer)(I,C);return r.a.createElement(R.Provider,{value:a},t)},L=function(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),r=a[0],c=a[1],l=Object(n.useState)(null),o=Object(u.a)(l,2),i=o[0],s=o[1],m=Object(n.useState)(null),E=Object(u.a)(m,2),f=E[0],b=E[1],O=Object(n.useState)({}),y=Object(u.a)(O,2),g=y[0],j=y[1],v=S("token"),T=Object(u.a)(v,1)[0],w=Object(n.useContext)(R),k=Object(u.a)(w,2)[1],C="https://balance.z-labz.ru:8080/api",I=Object(n.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};j(e),s(null),c(!0),k({type:"SHOW_LOADING"})}),[k]),D=g.method,L=void 0===D?"GET":D,P=g.params,x=Object(h.a)(g,["method","params"]);return Object(n.useEffect)((function(){if(r){var t={"Content-Type":"application/json",Authorization:T?"Token ".concat(T):""},a=P?_.a.stringify(P):null,n=a?"".concat(C).concat(e,"?").concat(a):"".concat(C).concat(e);(function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,{method:L,mode:"cors",headers:t,body:"GET"!==L?JSON.stringify(x):null}).then((function(e){return e.json()})).then((function(e){if(e.error)throw Error(e.error.message);c(!1),k({type:"HIDE_LOADING"}),s(e)})).catch((function(e){c(!1),k({type:"HIDE_LOADING"}),k({type:"SET_ERROR",payload:{error:e}}),b(e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}}),[r,x,L,e,C,T,P,k]),[{isLoading:r,response:i,error:f},I]},P=a(219),x=a.n(P),A=(a(384),function(e){var t=e.confirm,a=void 0!==t&&t,c=Object(n.useContext)(R),l=Object(u.a)(c,2)[1],o=[{item:"1"},{item:"2"},{item:"3"},{item:"4"},{item:"5"},{item:"6"},{item:"7"},{item:"8"},{item:"9"},{item:null},{item:"0"},{item:r.a.createElement(x.a,null),onClick:function(){l({type:"UNSET_PASSWORD"})},mode:"destructive"}],i=function(e){l(a?{type:"SET_CONFIRM_PASSWORD",payload:{digit:e.currentTarget.dataset.digit}}:{type:"SET_PASSWORD",payload:{digit:e.currentTarget.dataset.digit}})},m=o.map((function(e,t){return r.a.createElement("div",{className:"digit",key:t},e.item&&r.a.createElement(s.b,{size:"xl",mode:e.mode||"secondary","data-digit":e.item,onClick:e.onClick||i},r.a.createElement("b",null,e.item)))}));return r.a.createElement("div",{className:"dialer"},m)}),N=function(e){var t=e.type,a=Object(n.useState)(null),c=Object(u.a)(a,2),l=c[0],o=c[1],i=L("/users/".concat(t)),m=Object(u.a)(i,2),E=m[0],b=E.response,y=E.error,j=m[1],h=Object(n.useState)(!1),T=Object(u.a)(h,2),_=T[0],w=T[1],k=S("token"),C=Object(u.a)(k,2)[1],I=Object(n.useContext)(R),D=Object(u.a)(I,2),P=D[0],x=D[1];Object(n.useEffect)((function(){P.isLoggedIn&&x({type:"SET_VIEW",payload:{view:"balance",panel:"home"}})}),[P,x]),Object(n.useEffect)((function(){P.password.length===P.confirmPassword.length&&(P.password.length||P.confirmPassword.length)?P.password!==P.confirmPassword&&o({status:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438",message:"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0432\u0432\u043e\u0434 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443."}):o(null)}),[P.password,P.confirmPassword,t]),Object(n.useEffect)((function(){if(_){var e={method:"POST",user:{id:+P.vkUser.id,password:P.password}};j(e),w(!1),x({type:"UNSET_PASSWORD"})}}),[_,j,P.password,P.vkUser.id,x]),Object(n.useEffect)((function(){b&&(!b.user&&b.error?o(b.error):C(b.user.token),x({type:"SET_USER",payload:{user:b.user||null,isLoggedIn:!!b.user}}))}),[b,C,x]),Object(n.useEffect)((function(){y&&o({message:y.message})}),[y]);var N=function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:w(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=P.password.replace(/[0-9]/g,"*")||"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",F=P.confirmPassword.replace(/[0-9]/g,"*")||"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c";return r.a.createElement(n.Fragment,null,r.a.createElement(f.a,null,"login"===t?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"register"===t?"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f":"\u0421\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"),r.a.createElement(s.x,{icon:"login"===t?r.a.createElement(g.a,null):r.a.createElement(v.a,null),header:function(){var e;return e=4!==P.password.length||"login"===t?U:F,r.a.createElement("b",null,e)}()},r.a.createElement(s.i,null,l?r.a.createElement(s.k,{header:l.status,mode:"error"},l.message):null),4!==P.password.length||"login"===t?P.password.length+" \u0438\u0437 4":P.confirmPassword.length+" \u0438\u0437 4"),r.a.createElement(A,{confirm:4===P.password.length}),r.a.createElement(s.i,{style:{textAlign:"center"}},"login"===t&&4===P.password.length&&r.a.createElement(O.a,{size:"xl",mode:"commerce",onClick:N},"login"===t?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),"login"!==t&&P.password&&P.confirmPassword&&P.password===P.confirmPassword&&r.a.createElement(O.a,{mode:"commerce",size:"xl",onClick:N},"login"===t?"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f":"register"===t?"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f":"\u0421\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c")),r.a.createElement(s.f,null,r.a.createElement(O.a,{stretched:!0,mode:"tertiary",onClick:function(e){x({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"login"===t?"register":"login"},"login"===t?"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f":"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f")),"login"===t&&r.a.createElement(s.f,null,r.a.createElement(O.a,{stretched:!0,mode:"tertiary",onClick:function(e){x({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"restore"},"\u0417\u0430\u0431\u044b\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c?")))},U=a(80),F=a.n(U),M=a(48),z=a.n(M),W=a(220),G=a.n(W),V=function(e){var t=e.message,a=e.isError,c=e.onClose,l=Object(n.useState)(null),o=Object(u.a)(l,2),i=o[0],m=o[1],d=Object(n.useContext)(R),p=Object(u.a)(d,2)[1];return Object(n.useEffect)((function(){m(r.a.createElement(s.F,{layout:"vertical",onClose:c,before:a?r.a.createElement(F.a,{size:24,style:{backgroundColor:"var(--destructive)"}},r.a.createElement(G.a,{fill:"#fff",width:18,height:18})):r.a.createElement(F.a,{size:24,style:{backgroundColor:"var(--accent)"}},r.a.createElement(z.a,{fill:"#fff",width:18,height:18}))},t))}),[m,p,a,t,c]),i},K=(a(115),{email:"",phone:"",name:"",kktPassword:""}),H=function(e,t){switch(t.type){case"SET_EMAIL":return Object(w.a)({},e,{email:t.payload.email});case"SET_PHONE":return Object(w.a)({},e,{phone:t.payload.phone});case"SET_NAME":return Object(w.a)({},e,{name:t.payload.name});case"SET_PASSWORD":return Object(w.a)({},e,{kktPassword:t.payload.password});case"INIT":var a=t.payload.currentUser,n=a.email,r=a.name,c=a.phone,l=a.password;return Object(w.a)({},e,{email:n||"",name:r||"",phone:c||"",kktPassword:l||""});default:return e}},B=function(){var e=Object(n.useState)(!1),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(null),o=Object(u.a)(l,2),m=o[0],d=o[1],p=Object(n.useState)(!0),E=Object(u.a)(p,2),f=E[0],b=E[1],O=Object(n.useState)(""),y=Object(u.a)(O,2),g=y[0],j=y[1],v=L("/users/profile"),h=Object(u.a)(v,2),T=h[0].response,_=h[1],w=L("/fns/password"),k=Object(u.a)(w,2),C=k[0],I=k[1],D=Object(n.useState)(!1),P=Object(u.a)(D,2),x=P[0],A=P[1],N=Object(n.useContext)(R),U=Object(u.a)(N,2),M=U[0],W=U[1],G=Object(n.useReducer)(H,K),B=Object(u.a)(G,2),q=B[0],J=B[1],Q=S("token"),Y=Object(u.a)(Q,2)[1];Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppGetUserInfoResult":J({type:"SET_NAME",payload:{name:"".concat(n.first_name," ").concat(n.last_name)}}),W({type:"HIDE_LOADING"});break;case"VKWebAppGetUserInfoFailed":J({type:"SET_NAME",payload:{name:""}}),W({type:"HIDE_LOADING"}),console.log(n);break;case"VKWebAppGetPersonalCardResult":J({type:"SET_EMAIL",payload:{email:n.email}}),J({type:"SET_PHONE",payload:{phone:n.phone}}),console.log("profile",n);break;case"VKWebAppGetPersonalCardFailed":console.log("profile error",n)}}))}),[W]);var Z=Object(n.useCallback)((function(){W({type:"UNSET_ERROR"}),d(null)}),[W]);Object(n.useEffect)((function(){f&&(J({type:"INIT",payload:{currentUser:M.currentUser}}),""===M.currentUser.name&&(W({type:"SHOW_LOADING"}),i.a.send("VKWebAppGetUserInfo",{})),b(!1))}),[M,f,W]),Object(n.useEffect)((function(){x&&(_({method:"PUT",update:q}),A(!1))}),[x,_,q]),Object(n.useEffect)((function(){if(a){var e={};"restore"!==g&&(e.name=q.name,e.email=q.email),e.params={type:g},e.phone=q.phone.replace(/[ ()-]/g,""),e.phone=e.phone.replace(/^[8]/g,"+7"),e.method="POST",I(e),c(!1)}}),[a,g,I,q]),Object(n.useEffect)((function(){T&&(Y(T.user.token),W({type:"SET_USER",payload:{user:T.user||null,isLoggedIn:!!T.user}}),W({type:"SET_VIEW",payload:{view:"balance",panel:"home"}}))}),[T,W,Y]),Object(n.useEffect)((function(){C.response&&d(r.a.createElement(s.F,{layout:"vertical",onClose:function(){return d(null)},before:r.a.createElement(F.a,{size:24,style:{backgroundColor:"var(--accent)"}},r.a.createElement(z.a,{fill:"#fff",width:14,height:14}))},C.response.message))}),[C.response]),Object(n.useEffect)((function(){M.error&&d(r.a.createElement(V,{message:M.error.message,isError:!0,onClose:Z}))}),[M.error,Z]);var $=function(){i.a.send("VKWebAppGetPersonalCard",{type:["phone","email"]})};return r.a.createElement(n.Fragment,null,r.a.createElement(s.u,null,"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"),r.a.createElement(s.i,{style:{paddingBottom:40}},r.a.createElement(s.o,{type:"text",top:"\u0418\u043c\u044f",name:"name",value:q.name,onChange:function(e){J({type:"SET_NAME",payload:{name:e.currentTarget.value}})}}),r.a.createElement(s.j,{top:"E-mail \u0438 \u0422\u0435\u043b\u0435\u0444\u043e\u043d",bottom:"\u042d\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0439\u0442\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044e \u0432 \u0441\u0435\u0440\u0432\u0438\u0441\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0447\u0435\u043a\u043e\u0432 \u0424\u041d\u0421.\r \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u0434\u0430\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e \u0447\u0435\u043a\u0430\u043c \u043f\u0440\u0438 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 QR \u043a\u043e\u0434\u0430"},r.a.createElement(s.o,{type:"email",top:"e-mail",name:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 e-mail",value:q.email,onChange:function(e){J({type:"SET_EMAIL",payload:{email:e.currentTarget.value}})},onClick:$}),r.a.createElement(s.o,{type:"phone",top:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",name:"phone",value:q.phone,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043b\u0435\u0444\u043e\u043d",onChange:function(e){e.target.value.replace(/^[8]/,"+7"),J({type:"SET_PHONE",payload:{phone:e.currentTarget.value}})},onClick:$})),r.a.createElement(s.j,{top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",bottom:'\u0415\u0441\u043b\u0438 \u0432\u044b \u043a\u043e\u0433\u0434\u0430-\u043b\u0438\u0431\u043e \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c \u0432 \u0441\u0435\u0440\u0432\u0438\u0441\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0447\u0435\u043a\u043e\u0432 \u0424\u041d\u0421, \u043d\u043e \u0437\u0430\u0431\u044b\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u043d\u0430\u0436\u043c\u0438\u0442\u0435 "\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c". \u0415\u0441\u043b\u0438 \u043d\u0435 \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043f\u043e \u043a\u0430\u043a\u0438\u043c \u0442\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0430\u043c, \u043e\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u043f\u043e\u043b\u0435 \u0432\u0432\u043e\u0434\u0430 \u043f\u0430\u0440\u043e\u043b\u044f \u043f\u0443\u0441\u0442\u044b\u043c, \u043d\u043e \u0442\u043e\u0433\u0434\u0430 \u0443 \u0432\u0430\u0441 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0447\u0435\u043a\u0438 \u0438 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0443 \u043f\u043e \u0447\u0435\u043a\u0430\u043c'},r.a.createElement(s.o,{type:"number",top:"\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0442 \u0424\u041d\u0421",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c \u0424\u041d\u0421",name:"kktPassword",value:q.kktPassword,onChange:function(e){J({type:"SET_PASSWORD",payload:{password:e.currentTarget.value}})}}),r.a.createElement(s.f,{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(s.b,{size:"l","data-type":"signup",onClick:function(e){j(e.currentTarget.dataset.type),c(!0)},style:{margin:"0px",width:"49%"},disabled:!(q.email&&q.name&&q.phone)},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),r.a.createElement(s.b,{size:"l","data-type":"restore",onClick:function(e){j(e.currentTarget.dataset.type),c(!0)},style:{margin:"0px",width:"49%"},disabled:!(q.email&&q.name&&q.phone)},"\u0417\u0430\u0431\u044b\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c?"))),r.a.createElement(s.h,{className:"fixed-button",style:{marginBottom:"1em"},vertical:"bottom"},r.a.createElement(s.b,{size:"xl",mode:"commerce",onClick:function(){A(!0)}},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c"))),m)},q=a(94),J=a(95),Q=function(){function e(){Object(q.a)(this,e)}return Object(J.a)(e,null,[{key:"qr",value:function(e){try{var t,a,n,r,c;if(e){var l=e.match(/t=(\w{8}T\w+)&s=(\w+\.*\w+)&fn=(\w+)&i=(\w+)&fp=(\w+)/),o=Object(u.a)(l,6);t=o[1],a=o[2],n=o[3],r=o[4],c=o[5]}return{dt:t,sum:a.replace(/[.]/g,""),fn:n,i:r,fp:c}}catch(i){return console.log(i),{error:{message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0447\u0442\u0435\u043d\u0438\u044f QR \u043a\u043e\u0434\u0430"}}}}},{key:"date",value:function(e){var t,a=new Date(e);switch(a.getMonth()+1){case 1:t="\u044f\u043d\u0432\u0430\u0440\u044f";break;case 2:t="\u0444\u0435\u0432\u0440\u0430\u043b\u044f";break;case 3:t="\u043c\u0430\u0440\u0442\u0430";break;case 4:t="\u0430\u043f\u0440\u0435\u043b\u044f";break;case 5:t="\u043c\u0430\u044f";break;case 6:t="\u0438\u044e\u043d\u044f";break;case 7:t="\u0438\u044e\u043b\u044f";break;case 8:t="\u0430\u0432\u0433\u0443\u0441\u0442\u0430";break;case 9:t="\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f";break;case 10:t="\u043e\u043a\u0442\u044f\u0431\u0440\u044f";break;case 11:t="\u043d\u043e\u044f\u0431\u0440\u044f";break;case 12:t="\u0434\u0435\u043a\u0430\u0431\u0440\u044f"}return"".concat(a.getDate()," ").concat(t," ").concat(a.getFullYear())}},{key:"sum",value:function(e){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e/100)}},{key:"totalReceiptSum",value:function(e){if(0===e.length)return 0;return e.map((function(e){return e.sum||e.totalSum})).reduce((function(e,t){return e+t}))}},{key:"totalSumWithParams",value:function(e){if(0===e.length)return 0;return e.map((function(e){var t=e.income,a=e.sum;return t?a:-1*a})).reduce((function(e,t){return e+t}))}},{key:"totalSum",value:function(e,t){if(0===e.length)return 0;var a=function(e,t){return e+t},n=e.map((function(e){return e.items.map((function(e){return t?e.income?e.sum:0:e.income?0:e.sum})).reduce(a)})).reduce(a);return t?n:-1*n}}]),e}(),Y=function(e){var t=e.sum,a=e.fs,n=t>=0?{color:"#28a745",fontSize:a}:{color:"#dc3545",fontSize:a};return r.a.createElement("span",{style:n},Q.sum(t))},Z=a(98),$=a.n(Z),X=a(226),ee=a.n(X),te=a(221),ae=a.n(te),ne=a(222),re=a.n(ne),ce=a(223),le=a.n(ce),oe=a(485),ie=a(241),ue=a(484),se=a(486),me=a(224),de=a.n(me),pe=a(225),Ee=a.n(pe),fe=function(){var e=Object(n.useContext)(R),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(oe.a)(new Date,"yyyy.M")<=Object(oe.a)(a.currentDate,"yyyy.M");return r.a.createElement(s.l,null,r.a.createElement(s.p,null,r.a.createElement(s.c,{before:r.a.createElement(s.b,{onClick:function(){c({type:"SET_DATE",payload:{date:Object(ue.a)(a.currentDate,1)}})},mode:"secondary"},r.a.createElement(de.a,null)),asideContent:r.a.createElement(s.b,{disabled:l,onClick:function(){c({type:"SET_DATE",payload:{date:Object(ie.a)(a.currentDate,1)}})},mode:"secondary"},r.a.createElement(Ee.a,null)),style:{textAlign:"center",fontWeight:"bold"}},Object(oe.a)(a.currentDate,"LLLL yyyy",{locale:se.a}).toLocaleUpperCase())))},be=a(42),Oe=(a(398),a(97)),ye=a.n(Oe),ge=function(e){var t=e.items,a=e.id,c=e.isSearch,l=void 0!==c&&c,o=Object(n.useContext)(R),i=Object(u.a)(o,2)[1],m=t.map((function(e,t){var a=e.income?e.sum:-1*e.sum,c=function(e){return e&&e.definition?e.definition.definition:null}(e);return r.a.createElement(n.Fragment,{key:t},r.a.createElement("div",{className:"receipt-item",onClick:function(){i({type:"SET_ITEM_TO_EDIT",payload:{item:e}})}},r.a.createElement("span",{className:"receipt-item-name"},c||e.name),e.price&&!l?r.a.createElement("span",{className:"receipt-item-price"},Q.sum(e.price)):null,e.quantity&&!l?r.a.createElement("span",{className:"receipt-item-quantity"},e.quantity):null,e.dateTime&&l?r.a.createElement("span",{className:"receipt-item-dateTime"},Q.date(e.dateTime)):null,a?r.a.createElement("span",{className:"receipt-item-sum"},r.a.createElement(Y,{sum:a})):null))}));return r.a.createElement(ye.a,{id:a,className:"receipt-item-wrapper"},r.a.createElement("div",{className:"receipt-item"},r.a.createElement("span",{className:"receipt-item-name"},"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),l?r.a.createElement("span",{className:"receipt-item-dateTime"},"\u0414\u0430\u0442\u0430"):r.a.createElement(n.Fragment,null,r.a.createElement("span",{className:"receipt-item-price"},"\u0426\u0435\u043d\u0430"),r.a.createElement("span",{className:"receipt-item-quantity"},"\u041a\u043e\u043b-\u0432\u043e")),r.a.createElement("span",{className:"receipt-item-sum"},"\u0421\u0443\u043c\u043c\u0430")),r.a.createElement(s.D,null),m,r.a.createElement(s.D,null),r.a.createElement("div",{className:"receipt-total"},r.a.createElement("span",{className:""},"\u0418\u0442\u043e\u0433\u043e:"),r.a.createElement("span",null,r.a.createElement(Y,{sum:Q.totalSumWithParams(t)}))))},je=function(e){var t=e.receipts,a=Object(n.useState)(""),c=Object(u.a)(a,2),l=c[0],o=c[1],i=Object(n.useState)([]),m=Object(u.a)(i,2),d=m[0],p=m[1],E=Object(n.useState)([]),f=Object(u.a)(E,2),b=f[0],O=f[1];return Object(n.useEffect)((function(){if(t){var e=[];t.map((function(e){var t=e.dateTime;return e.items.map((function(e){return e.dateTime=t,e}))})).forEach((function(t){e.push.apply(e,Object(be.a)(t))})),p(e)}}),[t]),Object(n.useEffect)((function(){O(l?d.filter((function(e){return e.name.toLowerCase().indexOf(l)>-1})):[])}),[l,d]),r.a.createElement(n.Fragment,null,r.a.createElement(s.C,{value:l,onChange:function(e){o(e.target.value.toLowerCase())}}),r.a.createElement($.a,{title:"\u041f\u043e\u0438\u0441\u043a"},b.length>0&&r.a.createElement(ge,{id:b._id,isSearch:!0,items:b})))},ve=function(e){var t=e.setReceiptFromBalance,a=Object(n.useState)(!0),c=Object(u.a)(a,2),l=c[0],o=c[1],i=Object(n.useState)(!1),m=Object(u.a)(i,2),d=m[0],p=m[1],E=Object(n.useContext)(R),b=Object(u.a)(E,2),y=b[0],g=b[1],j=L("/day"),v=Object(u.a)(j,2),h=v[0],S=h.response,T=h.isLoading,_=v[1];return Object(n.useEffect)((function(){l&&(_({params:{date:Object(oe.a)(y.currentDate,"yyyy-MM-dd")}}),o(!1))}),[l,o,_,y.currentDate]),Object(n.useEffect)((function(){o(!0),p(!0)}),[y.currentDate]),Object(n.useEffect)((function(){S&&(p(!1),g({type:"SET_RECEIPTS",payload:{receipts:S}}))}),[S,g]),Object(n.useEffect)((function(){if(d&&!T&&S&&!S.length&&Object(oe.a)(y.currentDate,"yyyy.M")===Object(oe.a)(new Date,"yyyy.M")){var e=r.a.createElement(s.a,{actions:[{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,mode:"cancel"},{title:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c",autoclose:!0,action:function(){return g({type:"SET_PANEL",payload:{panel:"add"}})}}],onClose:function(){return g({type:"SET_POPOUT",payload:{popout:null}})}},r.a.createElement("h2",null,"\u0417\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043c\u0435\u0441\u044f\u0446 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0435\u0442"),r.a.createElement("p",null,"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u043e\u0441\u0442\u0430\u0442\u043e\u043a \u0434\u0435\u043d\u0435\u0436\u043d\u044b\u0445 \u0441\u0440\u0435\u0434\u0441\u0442\u0432, \u0434\u043b\u044f \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0439 \u043a\u0430\u043b\u044c\u043a\u0443\u043b\u044f\u0446\u0438\u0438 \u0431\u0430\u043b\u0430\u043d\u0441\u0430"));g({type:"SET_POPOUT",payload:{popout:e}})}}),[d,T,g,S,y.currentDate]),r.a.createElement(n.Fragment,null,r.a.createElement(f.a,null,r.a.createElement(s.w,{aside:r.a.createElement(s.e,{size:"s",mode:"primary"},"0.8.28")},"\u0411\u0430\u043b\u0430\u043d\u0441")),r.a.createElement(je,{receipts:y.receipts}),r.a.createElement(s.x,{icon:r.a.createElement(ae.a,null),header:r.a.createElement(Y,{sum:Q.totalReceiptSum(y.receipts),fs:"2em"}),action:r.a.createElement(O.a,{size:"l",onClick:function(e){g({type:"SET_PANEL",payload:{panel:e.currentTarget.dataset.to}})},"data-to":"add"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0445\u043e\u0434 / \u0440\u0430\u0441\u0445\u043e\u0434")},"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439\u0442\u0435 \u0434\u043e\u0445\u043e\u0434\u044b/\u0440\u0430\u0441\u0445\u043e\u0434\u044b"),r.a.createElement(s.D,null),r.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",paddingTop:"1em"}},r.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-end"}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingRight:"10px"}},r.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em",textAlign:"end"}},"\u0414\u043e\u0445\u043e\u0434\u044b"),r.a.createElement(Y,{sum:Q.totalSum(y.receipts,!0),fs:"1.4em"})),r.a.createElement(re.a,{width:16,height:40,fill:"#28a745"})),r.a.createElement("div",{style:{flex:"0 1 50%",display:"flex",justifyContent:"flex-start"}},r.a.createElement(le.a,{width:16,height:40,fill:"#dc3545"}),r.a.createElement("div",{style:{display:"flex",flexDirection:"column",paddingLeft:"10px"}},r.a.createElement("span",{style:{color:"#6F6F6F",fontSize:"0.7em"}},"\u0420\u0430\u0441\u0445\u043e\u0434\u044b"),r.a.createElement(Y,{sum:Q.totalSum(y.receipts,!1),fs:"1.4em"})))),r.a.createElement($.a,{title:"\u0427\u0435\u043a\u0438"},r.a.createElement(s.p,null,r.a.createElement(fe,null),y.receipts.map((function(e,a){return r.a.createElement(ee.a,{key:a,expandable:!0,onClick:function(){g({type:"SHOW_MODAL",payload:{modal:"modal-page"}}),t(e)},"data-to":e._id,indicator:r.a.createElement(Y,{sum:e.totalSum})},Q.date(e.dateTime))})))))},he=a(82),Se=a.n(he),Te=a(81),_e=a.n(Te),we=a(227),ke=a.n(we),Ce=function(){function e(){Object(q.a)(this,e)}return Object(J.a)(e,null,[{key:"overSize",value:function(e,t){var a,n=e.target.value;return a=n.indexOf(".")>=0?n.indexOf(".")+3:t,e.target.value.slice(0,a)}},{key:"overDate",value:function(e){var t=new Date(e),a=new Date;return t>a?Object(oe.a)(new Date(a),"yyyy-MM-dd"):Object(oe.a)(new Date(t),"yyyy-MM-dd")}},{key:"typeNumber",value:function(e){"e"!==e.key&&"+"!==e.key&&"-"!==e.key||e.preventDefault(),"."===e.key&&""===e.target.value&&e.preventDefault(),"."===e.key&&e.target.value.includes(".")&&(console.log(e.target.value),e.target.value.slice(0,e.target.value.indexOf("..")),e.preventDefault())}}]),e}(),Ie=function(){var e=Object(n.useContext)(R),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)((function(){return a.item||null})),o=Object(u.a)(l,2),m=o[0],d=o[1],p=Object(n.useState)((function(){return(null===m||void 0===m?void 0:m.name)||""})),E=Object(u.a)(p,2),b=E[0],y=E[1],g=Object(n.useState)((function(){var e=(null===m||void 0===m?void 0:m.dateTime)||new Date;return Object(oe.a)(new Date(e),"yyyy-MM-dd")})),j=Object(u.a)(g,2),v=j[0],h=j[1],S=Object(n.useState)((function(){return(null===m||void 0===m?void 0:m.quantity)||1})),T=Object(u.a)(S,2),_=T[0],k=T[1],C=Object(n.useState)((function(){return(null===m||void 0===m?void 0:m.price)/100||""})),I=Object(u.a)(C,2),D=I[0],P=I[1],x=Object(n.useState)((function(){return(null===m||void 0===m?void 0:m.income)||!1})),A=Object(u.a)(x,2),N=A[0],U=A[1],F=Object(n.useState)((function(){return(null===m||void 0===m?void 0:m.description)||""})),M=Object(u.a)(F,2),z=M[0],W=M[1],G=Object(n.useState)((function(){return(null===m||void 0===m?void 0:m.groups)||[]})),K=Object(u.a)(G,2),H=K[0],B=K[1],q=Object(n.useState)(null),J=Object(u.a)(q,2),Y=J[0],Z=J[1],$=Object(n.useState)(null),X=Object(u.a)($,2),ee=X[0],te=X[1],ae=L("/day"),ne=Object(u.a)(ae,2),re=ne[0],ce=re.response,le=re.error,ie=ne[1],ue=L("/day/receipt"),se=Object(u.a)(ue,2),me=se[0],de=se[1],pe=Object(n.useState)(!1),Ee=Object(u.a)(pe,2),fe=Ee[0],be=Ee[1],Oe=Object(n.useState)(!1),ge=Object(u.a)(Oe,2),je=ge[0],ve=ge[1],he=Object(n.useState)(!1),Te=Object(u.a)(he,2),we=Te[0],Ie=Te[1],Re=Object(n.useState)(!0),De=Object(u.a)(Re,2),Le=De[0],Pe=De[1],xe=Object(n.useState)(!0),Ae=Object(u.a)(xe,2),Ne=Ae[0],Ue=Ae[1],Fe=Object(n.useCallback)((function(){c({type:"UNSET_ERROR"}),Z(null)}),[c]);Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppOpenCodeReaderResult":te(n.code_data);break;case"VKWebAppOpenCodeReaderFailed":console.log("add day error",n)}}))}),[]),Object(n.useEffect)((function(){if(fe){var e={method:"POST",date:v,items:[{name:b,quantity:_,price:100*D,sum:100*D*_,income:N,modifiers:[],properties:[],description:z,groups:H,canDelete:!0}]};e.method=m?"PUT":e.method,e.method=we?"DELETE":e.method,m&&m._id&&(e.id=m._id),ie(e),d(null),y(""),k(1),U(!1),P(""),be(!1),W(""),B([]),Ie(!1)}}),[fe,be,v,ie,N,b,D,m,_,z,H,we]),Object(n.useEffect)((function(){ce&&Z(r.a.createElement(V,{message:"\u0423\u0441\u043f\u0435\u0448\u043d\u043e",isError:!1,onClose:Fe}))}),[ce,Fe]),Object(n.useEffect)((function(){if(ee){var e=Q.qr(ee);if(e.error){var t=e.error;return c({type:"SET_ERROR",payload:{error:t}}),te(null),void ve(!1)}var a=Object(w.a)({method:"POST"},e);de(a)}}),[ee,de,je,c]),Object(n.useEffect)((function(){me.response&&me.response._id&&(Z(r.a.createElement(V,{message:"\u0423\u0441\u043f\u0435\u0448\u043d\u043e",isError:!1,onClose:Fe})),ve(!1),te(null))}),[me.response,de,ee,Fe]),Object(n.useEffect)((function(){a.error&&(c({type:"SET_ERROR",payload:{error:me.error||le}}),Z(r.a.createElement(V,{message:a.error.message,isError:!0,onClose:Fe})),ve(!1),te(null))}),[me.error,le,c,a.error,Fe]);var Me=r.a.createElement(s.a,{actions:[{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,mode:"cancel"},{title:"\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c",autoclose:!0,action:function(){return c({type:"SET_VIEW",payload:{view:"profile",panel:"edit"}})}}],onClose:function(){return c({type:"SET_POPOUT",payload:{popout:null}})}},r.a.createElement("h2",null,"\u041d\u0435\u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d \u043f\u0440\u043e\u0444\u0438\u043b\u044c"),r.a.createElement("p",null,"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f QR \u043a\u043e\u0434\u043e\u0432 \u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u043e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043f\u043e \u0447\u0435\u043a\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0437\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c, \u0432\u0432\u0435\u0441\u0442\u0438 email, \u0442\u0435\u043b\u0435\u0444\u043e\u043d \u0438 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0424\u041d\u0421.")),ze=r.a.createElement(s.a,{actions:[{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,mode:"cancel"},{title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",autoclose:!0,mode:"destructive",action:function(){Ie(!0),be(!0)}}],onClose:function(){return c({type:"SET_POPOUT",payload:{popout:null}})}},r.a.createElement("h2",null,"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435"),r.a.createElement("p",null,"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c? \u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0439\u0434\u0435\u0442 \u0431\u0435\u0437\u0432\u043e\u0437\u0432\u0440\u0430\u0442\u043d\u043e. \u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e \u0431\u0443\u0434\u0435\u0442 \u043d\u0435\u043b\u044c\u0437\u044f."));return r.a.createElement(n.Fragment,null,r.a.createElement(f.a,{left:r.a.createElement(r.a.Fragment,null,i.a.supports("VKWebAppOpenCodeReader")&&r.a.createElement(_e.a,{key:"qr","data-to":"qr",onClick:function(){c({type:"UNSET_ERROR"}),a.currentUser.email&&a.currentUser.phone&&a.currentUser.password?i.a.send("VKWebAppOpenCodeReader",{}):c({type:"SET_POPOUT",payload:{popout:Me}})}},r.a.createElement(ke.a,null)))},m?"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"),r.a.createElement(ye.a,{style:{paddingBottom:40}},function(e){return e?null:r.a.createElement(Se.a,{type:"date",top:"\u0414\u0430\u0442\u0430",name:"date",value:v,onChange:function(e){e.currentTarget.value&&h(Ce.overDate(e.currentTarget.value))}})}(m),r.a.createElement("div",null,r.a.createElement(s.z,{name:"income",value:!1,onChange:function(){U(!1)},defaultChecked:!N},"\u0420\u0430\u0441\u0445\u043e\u0434"),r.a.createElement(s.z,{name:"income",value:!1,onChange:function(){U(!0)},defaultChecked:N},"\u0414\u043e\u0445\u043e\u0434")),r.a.createElement(Se.a,{type:"text",top:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"name",value:b,onChange:function(e){y(Ce.overSize(e,20))},bottom:"\u0412\u0432\u0435\u0434\u0435\u043d\u043e ".concat(b.length," \u0438\u0437 20")}),r.a.createElement(Se.a,{className:"number-input",type:"number",top:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",name:"quantity",value:_,onChange:function(e){k(Ce.overSize(e,6))},onKeyDown:function(e){Pe(e.target.validity.valid),Ce.typeNumber(e)},step:"0.01",bottom:!Le&&"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435",status:!Le&&"error"}),r.a.createElement(Se.a,{className:"number-input",type:"number",top:"\u0426\u0435\u043d\u0430",name:"price",value:D,onChange:function(e){P(Ce.overSize(e,6))},onKeyDown:function(e){Ue(e.target.validity.valid),Ce.typeNumber(e)},step:"0.01",bottom:!Ne&&"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435",status:!Ne&&"error"}),!N&&r.a.createElement(s.J,{top:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",placeholder:"\u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u044b \u043f\u043e\u0442\u0440\u0430\u0442\u0438\u043b\u0438 \u043d\u0430 \u044d\u0442\u043e \u0434\u0435\u043d\u044c\u0433\u0438?",name:"description",value:z,onChange:function(e){return W(Ce.overSize(e,50))},bottom:"\u0412\u0432\u0435\u0434\u0435\u043d\u043e ".concat(z.length," \u0438\u0437 50")}),(null===m||void 0===m?void 0:m.canDelete)&&r.a.createElement(O.a,{size:"xl",mode:"destructive",onClick:function(){c({type:"SET_POPOUT",payload:{popout:ze}})}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c ",N?"\u0434\u043e\u0445\u043e\u0434":"\u0440\u0430\u0441\u0445\u043e\u0434"),r.a.createElement(s.h,{className:"fixed-button",style:{marginBottom:"1em"},vertical:"bottom"},m?r.a.createElement(O.a,{size:"xl",disabled:!v||!b||!_||!D,mode:"commerce",onClick:function(){return be(!0)}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"):r.a.createElement(O.a,{size:"xl",disabled:!v||!b||!_||!D,mode:"commerce",onClick:function(){be(!0)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c ",N?"\u0434\u043e\u0445\u043e\u0434":"\u0440\u0430\u0441\u0445\u043e\u0434"))),Y)},Re=function(e){var t=e.receipt;return r.a.createElement(s.p,null,r.a.createElement(ge,{id:t._id,dateTime:t.dateTime,items:t.items}))},De=a(78),Le=a.n(De),Pe=a(228),xe=a.n(Pe),Ae=a(229),Ne=a.n(Ae),Ue=a(230),Fe=a.n(Ue),Me=a(231),ze=a.n(Me),We=a(232),Ge=a.n(We),Ve=a(233),Ke=a.n(Ve),He=function(){return r.a.createElement(n.Fragment,null,r.a.createElement(s.u,null,"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0430"),r.a.createElement(s.x,null,"\u0420\u0430\u0437\u0434\u0435\u043b \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435"))},Be=a(234),qe=a.n(Be),Je=a(235),Qe=a.n(Je),Ye=function(){var e=Object(n.useContext)(R),t=Object(u.a)(e,2),a=t[0],c=t[1],l=L("/day"),o=Object(u.a)(l,2),m=o[0],d=m.response,p=m.error,E=o[1],f=Object(s.L)(),b=Object(n.useState)((function(){var e=new Date,t=e.getMonth()+1>9?e.getMonth()+1:"0".concat(e.getMonth()+1),a=e.getDate()>9?e.getDate():"0".concat(e.getDate());return"".concat(e.getFullYear(),"-").concat(t,"-").concat(a)})),O=Object(u.a)(b,1)[0],y=Object(n.useState)(null),g=Object(u.a)(y,2),j=g[0],v=g[1],h=S("token"),T=Object(u.a)(h,2)[1];Object(n.useEffect)((function(){i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;switch(a){case"VKWebAppOpenPayFormResult":if(n.status){console.log("\u041f\u043b\u0430\u0442\u0435\u0436 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d");var r={method:"POST",date:O,items:[{name:"\u041f\u043e\u043c\u043e\u0449\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0443 Balance",quantity:1,price:100*n.amount,sum:100*n.amount,income:!1,modifiers:[],properties:[{transactionId:n.transaction_id}]}]};E(r)}break;case"VKWebAppOpenPayFormFailed":console.log("profile error",n)}}))}));var _=Object(n.useCallback)((function(){c({type:"UNSET_ERROR"}),v(null)}),[c]);return Object(n.useEffect)((function(){d&&v(r.a.createElement(V,{message:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u043f\u043e\u043c\u043e\u0449\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0443!",isError:!1,onClose:_}))}),[d,_]),Object(n.useEffect)((function(){a.error&&(c({type:"SET_ERROR",payload:{error:p}}),v(r.a.createElement(V,{message:a.error.message,isError:!0,onClose:_})))}),[p,c,a.error,_]),r.a.createElement(n.Fragment,null,r.a.createElement(s.u,null,"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e"),f!==s.n&&r.a.createElement(s.l,null,r.a.createElement(s.m,{mode:"secondary"},"\u041f\u043e\u043c\u043e\u0449\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0443"),r.a.createElement(s.E,{expandable:!0,before:r.a.createElement(qe.a,null),onClick:function(){i.a.send("VKWebAppOpenPayForm",{app_id:7252987,action:"pay-to-user",params:{amount:100,description:"\u041d\u0430 \u043a\u043e\u0444\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443",user_id:3479465}})}},"\u041d\u0430 \u043a\u043e\u0444\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443")),r.a.createElement(s.l,null,r.a.createElement(s.m,{mode:"secondary"},"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u043e\u043c"),r.a.createElement(s.E,{expandable:!0,before:r.a.createElement(Qe.a,null),onClick:function(){c({type:"LOGOUT"}),T("")}},"\u0412\u044b\u0439\u0442\u0438")),j)},Ze=a(236),$e=a.n(Ze),Xe=a(136),et=a.n(Xe),tt=a(237),at=a.n(tt),nt={catalog:[],filteredCatalog:[],catalogToSave:new Set,filterItems:[],editedElementId:"",openFilter:!1,filterRules:[]},rt=function(e,t){switch(t.type){case"SET_CATALOG":var a=e.filterRules.map((function(t){return e.catalog.filter((function(e){return e.definition===t&&e}))})).flat();return Object(w.a)({},e,{catalog:t.payload.catalog,filteredCatalog:a&&a.length>0?a:t.payload.catalog,filterRules:a&&a.length>0?e.filterRules:[],catalogToSave:new Set,editedElementId:""});case"SET_EDITED_ELEMENT":return Object(w.a)({},e,{editedElementId:t.payload.id});case"FILL_SAVE_CATALOG":var n,r=e.catalog.findIndex((function(e){return e._id===t.payload.id}));t.payload.definition&&((n=e.catalog[r]).definition=t.payload.definition);var c=new Set(e.catalogToSave);return c.add(n),Object(w.a)({},e,{catalogToSave:c});case"ERASE_FILTER_RULES":return Object(w.a)({},e,{filterRules:[],openFilter:!1,filteredCatalog:e.catalog});case"SET_FILTER_ITEMS":var l=e.catalog.map((function(e){return e.definition?e.definition:"*\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438"})).reduce((function(e,t){return e.includes(t)?e:[].concat(Object(be.a)(e),[t])}),[]);return Object(w.a)({},e,{filterItems:l});case"SET_FILTER_RULES":var o=e.filterRules,i=e.filterRules.length>0?e.filteredCatalog:[];if(t.payload.checked){o=[].concat(Object(be.a)(o),[t.payload.definition]);var u=e.catalog.filter((function(e){return e.definition===t.payload.definition}));i=[].concat(Object(be.a)(i),Object(be.a)(u))}else o.splice(o.findIndex((function(e){return e===t.payload.definition})),1),i=o.map((function(t){return e.catalog.filter((function(e){return e.definition===t&&e}))})).flat();return Object(w.a)({},e,{filteredCatalog:i,filterRules:o});case"OPEN_FILTER":return Object(w.a)({},e,{openFilter:!0});case"CLOSE_FILTER":return Object(w.a)({},e,{openFilter:!1});default:return e}},ct=function(){var e=Object(n.useReducer)(rt,nt),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(""),o=Object(u.a)(l,2),i=o[0],m=o[1],d=L("/catalog".concat(i)),p=Object(u.a)(d,2),E=p[0].response,f=p[1],b=Object(n.useState)(!0),O=Object(u.a)(b,2),y=O[0],g=O[1],j=Object(n.useState)("get"),v=Object(u.a)(j,1)[0],h=a.filteredCatalog.map((function(e,t){return r.a.createElement(n.Fragment,{key:t},r.a.createElement(s.A,{"data-id":e._id,multiline:!0,caption:e.name,after:r.a.createElement($e.a,null),bottom:a.editedElementId===e._id&&r.a.createElement(s.o,{id:a.editedElementId,type:"text",defaultValue:e.definition,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0443",onChange:function(e){c({type:"FILL_SAVE_CATALOG",payload:{id:a.editedElementId,definition:e.target.value}})}}),onClick:function(e){c({type:"SET_EDITED_ELEMENT",payload:{id:e.currentTarget.dataset.id}})},actions:r.a.createElement(n.Fragment,null,r.a.createElement(s.b,{disabled:!0,style:{display:"none"}},r.a.createElement(et.a,null)),r.a.createElement(s.b,{disabled:!0,style:{display:"none"},mode:"secondary"},r.a.createElement(et.a,null)))},r.a.createElement("b",null,e.definition?e.definition:"\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438")))})),S=a.filterItems.map((function(e,t){var n="*\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438"!==e?a.filterRules.includes(e):a.filterRules.includes(void 0);return r.a.createElement(s.E,{key:t,after:r.a.createElement(s.G,{"data-definition":e,onChange:function(e){var t=e.currentTarget.dataset.definition,a=e.currentTarget.checked;c({type:"SET_FILTER_RULES",payload:{checked:a,definition:"*\u041d\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u043a\u0438"!==t?t:void 0}})},defaultChecked:n})},e)}));Object(n.useEffect)((function(){a.editedElementId&&document.getElementById(a.editedElementId).focus()}),[a.editedElementId]),Object(n.useEffect)((function(){if(i||y){var e={};y&&(e.params={a:v}),i&&(e.method="PUT",e.update=Object(be.a)(a.catalogToSave)),f(e)}}),[i,a.catalogToSave,f,y,v]),Object(n.useEffect)((function(){E&&(c({type:"SET_CATALOG",payload:{catalog:E}}),c({type:"SET_FILTER_ITEMS"}),m(""),g(!1))}),[E]);var T={paddingTop:0!==a.filterRules.length&&60,paddingBottom:(0!==Object(be.a)(a.catalogToSave).length||0!==a.filterRules.length&&a.openFilter)&&60},_={paddingRight:10,paddingLeft:10,marginBottom:"1em",marginTop:"1em"};return r.a.createElement(n.Fragment,null,r.a.createElement(s.u,{left:r.a.createElement(s.v,{onClick:function(){a.openFilter?c({type:"CLOSE_FILTER"}):c({type:"OPEN_FILTER"})}},r.a.createElement(at.a,null))},a.openFilter?"\u0424\u0438\u043b\u044c\u0442\u0440":"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a"),r.a.createElement(s.l,{style:T},a.openFilter?S:h),0!==a.filterRules.length&&r.a.createElement(s.h,{style:_,vertical:"top"},r.a.createElement(s.D,{wide:!0}),r.a.createElement(s.b,{mode:"destructive",size:"xl",onClick:function(){c({type:"ERASE_FILTER_RULES"})}},"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440")),0!==Object(be.a)(a.catalogToSave).length&&r.a.createElement(s.h,{style:_,vertical:"bottom"},r.a.createElement(s.D,{wide:!0}),r.a.createElement(s.b,{mode:"commerce",size:"xl",onClick:function(){m("/update")}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f")),0!==a.filterRules.length&&a.openFilter&&r.a.createElement(s.h,{style:_,vertical:"bottom"},r.a.createElement(s.D,{wide:!0}),r.a.createElement(s.b,{mode:"commerce",size:"xl",onClick:function(){c({type:"CLOSE_FILTER"})}},"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440")))},lt=a(238),ot=a.n(lt),it={shoppingList:[],shoppingItem:{text:"",done:!1},date:new Date},ut=function(e,t){switch(t.type){case"INITIAL_SHOPPING_LIST":return Object(w.a)({},e,{shoppingList:t.payload.list});case"SET_SHOPPING_ITEM":return Object(w.a)({},e,{shoppingItem:{text:t.payload.text,done:!1}});case"ADD_ITEM":var a=e.shoppingList;return e.shoppingItem.text?Object(w.a)({},e,{shoppingList:[].concat(Object(be.a)(a),[e.shoppingItem]),shoppingItem:{text:"",done:!1}}):e;case"DELETE_ITEM":var n=e.shoppingList;return n.splice(t.payload.index,1),0===n.length&&localStorage.removeItem("shoppingList"),Object(w.a)({},e,{shoppingList:n});case"SET_DONE":var r=e.shoppingList;return r[t.payload.index].done=!r[t.payload.index].done,Object(w.a)({},e,{shoppingList:r});default:return e}},st=function(){var e=S("shoppingList",JSON.stringify([])),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useReducer)(ut,it),o=Object(u.a)(l,2),i=o[0],m=o[1],d=i.shoppingList.map((function(e,t){return r.a.createElement(s.E,{key:t,after:r.a.createElement(ot.a,{"data-index":t,onClick:function(e){m({type:"DELETE_ITEM",payload:{index:e.currentTarget.dataset.index}})}})},r.a.createElement(s.d,{defaultChecked:e.done,"data-index":t,style:{textDecoration:e.done&&"line-through"},onChange:function(e){m({type:"SET_DONE",payload:{index:e.currentTarget.dataset.index}})}},e.text))}));return Object(n.useEffect)((function(){m({type:"INITIAL_SHOPPING_LIST",payload:{list:JSON.parse(a)}})}),[a]),Object(n.useEffect)((function(){0!==i.shoppingList.length&&c(JSON.stringify(i.shoppingList))}),[c,i]),r.a.createElement(n.Fragment,null,r.a.createElement(s.u,null,"\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043a\u0443\u043f\u043e\u043a"),r.a.createElement(s.i,{onSubmit:function(e){e.preventDefault(),m({type:"ADD_ITEM"})}},r.a.createElement(s.o,{type:"text",top:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"shopping-item",value:i.shoppingItem.text,onChange:function(e){m({type:"SET_SHOPPING_ITEM",payload:{text:Ce.overSize(e,20)}})},bottom:"\u0412\u0432\u0435\u0434\u0435\u043d\u043e ".concat(i.shoppingItem.text.length||0," \u0438\u0437 20"),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"}),r.a.createElement(s.h,{className:"fixed-button",style:{marginBottom:"1em"},vertical:"bottom"},r.a.createElement(O.a,{size:"xl",disabled:!i.shoppingItem.text,mode:"commerce",onClick:function(){return m({type:"ADD_ITEM"})}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"))),r.a.createElement(s.l,null,i.shoppingList.length>0?d:r.a.createElement(s.x,null,r.a.createElement("p",null,"\u0412\u0430\u0448 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043a\u0443\u043f\u043e\u043a \u043f\u0443\u0441\u0442."),r.a.createElement("p",null,"\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0412\u0430\u0448 \u0441\u043f\u0438\u0441\u043e\u043a \u0438 ",r.a.createElement("strong",null,"\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e")," \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435\u0441\u044c \u0438\u043c \u0432 \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u0435."),'\u0414\u043b\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0438 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043a\u043d\u043e\u043f\u043a\u0443 "\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"')))},mt=function(){var e=Object(n.useContext)(R),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(null),o=Object(u.a)(l,2),i=o[0],m=o[1],d=Object(n.useState)(null),p=Object(u.a)(d,2),E=p[0],f=p[1],b=Object(n.useState)(null),O=Object(u.a)(b,2),y=O[0],g=O[1],j=Object(n.useCallback)((function(){c({type:"HIDE_MODAL"})}),[c]);Object(n.useEffect)((function(){window.onpopstate=function(e){c({type:"SET_VIEW",payload:{panel:e.state.panel,view:e.state.view}})}}),[c]),Object(n.useEffect)((function(){if(y){var e=Object(s.L)();f(r.a.createElement(s.s,{activeModal:a.modal,onClose:j},r.a.createElement(s.q,{id:"modal-page",onClose:j,header:r.a.createElement(s.r,{left:e!==s.n&&r.a.createElement(_e.a,{onClick:j},r.a.createElement(Le.a,null)),right:e===s.n&&r.a.createElement(_e.a,{onClick:j},e===s.n?"\u0413\u043e\u0442\u043e\u0432\u043e":r.a.createElement(xe.a,null))},Q.date(y.dateTime))},r.a.createElement(Re,{onClose:j,receipt:y}))))}}),[y,i,j,a.modal]);var v=function(e){c({type:"SET_VIEW",payload:{view:e.currentTarget.dataset.story,panel:e.currentTarget.dataset.panel}})},h=a.currentUser&&r.a.createElement(s.H,null,r.a.createElement(s.I,{onClick:v,selected:"balance"===a.view&&"balance.home"===a.panel,"data-story":"balance","data-panel":"home",text:"\u0411\u0430\u043b\u0430\u043d\u0441"},r.a.createElement(Ne.a,null)),r.a.createElement(s.I,{onClick:v,selected:"list"===a.view,"data-story":"list","data-panel":"list",text:"\u041f\u043e\u043a\u0443\u043f\u043a\u0438"},r.a.createElement(Ke.a,null)),r.a.createElement(s.I,{onClick:v,selected:"balance"===a.view&&"balance.add"===a.panel,"data-story":"balance","data-panel":"add",text:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"},r.a.createElement(Ge.a,null)),r.a.createElement(s.I,{onClick:v,selected:"profile"===a.view,"data-story":"profile","data-panel":"edit",text:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"},r.a.createElement(ze.a,null)),r.a.createElement(s.I,{onClick:v,selected:"more"===a.view,"data-story":"more","data-panel":"more",text:"\u0415\u0449\u0451"},r.a.createElement(Fe.a,null)));return r.a.createElement(s.g,{activeStory:a.view,tabbar:h},r.a.createElement(s.K,{id:"authorization",activePanel:a.panel,popout:a.popout},r.a.createElement(s.t,{id:"authorization.login"},r.a.createElement(N,{type:"login"})),r.a.createElement(s.t,{id:"authorization.register"},r.a.createElement(N,{type:"register"})),r.a.createElement(s.t,{id:"authorization.restore"},r.a.createElement(N,{type:"restore"}))),r.a.createElement(s.K,{id:"profile",activePanel:a.panel,popout:a.popout},r.a.createElement(s.t,{id:"profile.edit"},r.a.createElement(B,null))),r.a.createElement(s.K,{id:"balance",activePanel:a.panel,popout:a.popout,modal:E},r.a.createElement(s.t,{id:"balance.home"},r.a.createElement(ve,{setReceiptFromBalance:g,onClickActiveModal:m})),r.a.createElement(s.t,{id:"balance.add"},r.a.createElement(Ie,{item:a.item}))),r.a.createElement(s.K,{id:"analytics",activePanel:a.panel,popout:a.popout},r.a.createElement(s.t,{id:"analytics.home"},r.a.createElement(He,null))),r.a.createElement(s.K,{id:"more",activePanel:a.panel,popout:a.popout},r.a.createElement(s.t,{id:"more.more"},r.a.createElement(Ye,null)),r.a.createElement(s.t,{id:"more.catalog"},r.a.createElement(ct,null))),r.a.createElement(s.K,{id:"list",activePanel:a.panel,popout:a.popout},r.a.createElement(s.t,{id:"list.list"},r.a.createElement(st,null))))},dt=Object(n.createContext)([{},function(e){}]),pt=function(e){var t=e.children,a=Object(n.useState)({isLoading:!1,isLoggedIn:null,currentUser:null}),c=Object(u.a)(a,2),l=c[0],o=c[1];return r.a.createElement(dt.Provider,{value:[l,o]},t)},Et=a(137),ft=a.n(Et),bt=a(239),Ot=a.n(bt),yt=function(e){var t=e.children,a=Object(n.useContext)(R),r=Object(u.a)(a,2)[1],c=function(){var e=Object(n.useState)(""),t=Object(u.a)(e,2),a=t[0],r=t[1],c=Object(n.useState)(!1),l=Object(u.a)(c,2),o=l[0],i=l[1],s=Object(n.useState)(null),m=Object(u.a)(s,2),d=m[0],p=m[1],E=Object(n.useState)(!1),f=Object(u.a)(E,2),b=f[0],O=f[1];return Object(n.useEffect)((function(){if(o){var e=ft.a.parse(a);if(e){p(e.vk_user_id);var t={};Object.keys(e).sort().forEach((function(a){"vk_"===a.slice(0,3)&&(t[a]=e[a])}));var n=ft.a.stringify(t),r=Ot.a.createHmac("sha256","Zs6DYRE8Z2mZ44LfciKW").update(n).digest().toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=$/,"");O(r===e.sign)}}}),[o,a]),[{vkUserId:d,matchUrlParams:b},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";r(e),i(!0)}]}(),l=Object(u.a)(c,2),o=l[0],i=o.vkUserId,s=o.matchUrlParams,m=l[1];return Object(n.useEffect)((function(){m(window.location.search.slice(1))}),[m]),Object(n.useEffect)((function(){i&&r({type:"SET_VK_USER",payload:{id:i,match:s}})}),[i,s,r]),t},gt=function(e){var t=e.children,a=L("/users/profile"),r=Object(u.a)(a,2),c=r[0].response,l=r[1],o=L("/users/find"),i=Object(u.a)(o,2),s=i[0],m=i[1],d=Object(n.useContext)(R),p=Object(u.a)(d,2),E=p[0],f=p[1],b=S("token"),O=Object(u.a)(b,1)[0];return Object(n.useEffect)((function(){!O&&E.vkUser.matchUrlParams&&E.vkUser.id&&(m({params:{id:E.vkUser.id}}),f({type:"SHOW_LOADING"}))}),[O,E.vkUser.matchUrlParams,E.vkUser.id,f,m]),Object(n.useEffect)((function(){s.response&&(s.response.result?f({type:"SET_VIEW",payload:{view:"authorization",panel:"login"}}):f({type:"SET_VIEW",payload:{view:"authorization",panel:"register"}}),f({type:"HIDE_LOADING"}))}),[s.response,f]),Object(n.useEffect)((function(){O&&E.vkUser.matchUrlParams?(l(),f({type:"SHOW_LOADING"})):f({type:"SET_USER",payload:{user:null,isLoggedIn:!1}})}),[l,O,E.vkUser.matchUrlParams,f]),Object(n.useEffect)((function(){if(c){var e=c.user.vk_id.toString()===E.vkUser.id?c.user:null;f({type:"SET_USER",payload:{user:e,isLoggedIn:!!e}})}}),[c,E.vkUser.id,f]),t};i.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;if("VKWebAppUpdateConfig"===a){var r=document.createAttribute("scheme");r.value=n.scheme?n.scheme:"client_light",document.body.attributes.setNamedItem(r)}})),i.a.send("VKWebAppInit"),window.onload=function(){l.a.render(r.a.createElement(D,null,r.a.createElement(yt,null,r.a.createElement(pt,null,r.a.createElement(gt,null,r.a.createElement(mt,null))))),document.getElementById("root"))}}},[[282,1,2]]]);
//# sourceMappingURL=main.c86ec84f.chunk.js.map