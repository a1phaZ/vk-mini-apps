{"version":3,"sources":["hooks/useLocalStorage.js","handlers/history.js","contexts/routerContext.js","hooks/useApi.js","components/Dialer.js","panels/Authorization.js","components/CustomSnackbar.js","panels/Profile.js","handlers/prepare.js","components/ColoredSum.js","components/Calendar.js","components/Receipt/index.js","components/Receipt/receipt.js","components/search/index.js","components/search/SearchComponent.js","panels/Balance.js","handlers/validation.js","panels/AddDay.js","components/Modal.js","panels/Analytics.js","panels/More.js","panels/Catalog.js","panels/ShoppingList.js","App.js","contexts/currentUser.js","contexts/appSign.js","hooks/useCompareSign.js","components/CurrentUserChecker.js","index.js"],"names":["key","initialValue","useState","localStorage","getItem","value","setValue","setLocalStorageValue","setItem","historyPush","view","panel","window","history","pushState","initialState","popout","error","password","confirmPassword","vkUser","id","matchUrlParams","currentUser","isLoggedIn","receipts","item","currentDate","Date","modal","reducer","state","action","type","payload","length","digit","match","user","date","RouterContext","createContext","RouterContextProvider","children","useReducer","Provider","url","isLoading","setIsLoading","response","setResponse","setError","options","setOptions","useLocalStorage","token","useContext","dispatch","_apiBase","process","doApiFetch","useCallback","method","params","bodyFields","useEffect","headers","Authorization","qString","queryString","stringify","uri","a","fetch","mode","body","JSON","then","res","json","r","Error","message","catch","e","fetchData","Dialer","confirm","digits","onClick","currentTarget","dataset","dialer","map","index","className","size","data-digit","formError","setFormError","useApi","startFetchData","setStartFetchData","setToken","status","formButtonClick","loginPassString","replace","confPassString","icon","header","str","headerString","style","textAlign","stretched","to","data-to","CustomSnackBar","isError","onClose","snackbar","setSnackbar","layout","before","backgroundColor","fill","width","height","email","phone","name","kktPassword","Profile","fetchToFns","setFetchToFns","init","setInit","fnsPasswordType","setFnsPasswordType","fnsResponse","doFnsFetch","formState","dispatchForm","bridge","subscribe","detail","data","first_name","last_name","console","log","send","update","getDataFromVK","paddingBottom","top","onChange","bottom","placeholder","target","display","justifyContent","data-type","margin","disabled","marginBottom","vertical","Prepare","dt","sum","fn","i","fp","monthName","getMonth","getDate","getFullYear","n","Intl","NumberFormat","currency","format","arr","totalSum","reduce","previousValue","currentValue","income","ts","items","ColoredSum","fs","stl","color","fontSize","prepare","Calendar","subMonths","asideContent","addMonths","fontWeight","locale","ru","toLocaleUpperCase","Receipt","isSearch","receiptItem","definition","setDefinition","price","quantity","dateTime","totalSumWithParams","SearchComponent","search","setSearch","searchTarget","setSearchTarget","searchResult","setSearchResult","receipt","forEach","push","filter","toLowerCase","indexOf","title","_id","Balance","setReceiptFromBalance","initialFetch","setInitialFetch","changeDate","setChangeDate","actions","autoclose","aside","totalReceiptSum","flexDirection","paddingTop","flex","paddingRight","paddingLeft","expandable","indicator","Validation","max","maxLength","val","slice","now","preventDefault","includes","AddDay","editedItem","setEditedItem","setName","d","setDate","setQuantity","setPrice","setIncome","description","setDescription","groups","setGroups","qr","setQR","checkReceipt","setCheckReceipt","deleteItem","setDeleteItem","statusQuantity","setStatusQuantity","statusPrice","setStatusPrice","code_data","modifiers","properties","canDelete","preparedQR","deletePopout","left","supports","overDate","dateInput","defaultChecked","overSize","onKeyDown","validity","valid","typeNumber","step","Modal","Analytics","More","osName","platform","m","amount","transactionId","transaction_id","IOS","catalog","filteredCatalog","catalogToSave","Set","filterItems","editedElementId","openFilter","filterRules","filteredCatalogAfterResponse","rule","flat","element","findIndex","set","add","uniq","rules","checked","filterByRule","splice","Catalog","updateStr","setUpdateStr","catalogList","data-id","multiline","caption","after","defaultValue","filterList","undefined","data-definition","document","getElementById","focus","fixedLayoutStyle","marginTop","wide","shoppingList","shoppingItem","text","done","list","removeItem","ShoppingList","setList","data-index","textDecoration","parse","onSubmit","App","activeModal","setActiveModal","setModal","setReceipt","modalBack","onpopstate","right","onStoryChange","story","tb","selected","data-story","data-panel","activeStory","tabbar","activePanel","onClickActiveModal","CurrentUserContext","p","CurrentUserProvider","setState","AppSign","urlParams","setUrlParams","vkUserId","setVkUserId","setMatch","qs","vk_user_id","ordered","Object","keys","sort","stringParams","paramsHash","crypto","createHmac","digest","toString","sign","useCompareSign","setParams","location","CurrentUserChecker","doFetch","findUser","doFindFetch","result","vk_id","schemeAttribute","createAttribute","scheme","attributes","setNamedItem","onload","ReactDOM","render"],"mappings":"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","file":"static/js/main.c86ec84f.chunk.js","sourcesContent":["import { useState } from 'react';\r\n\r\nexport default (key, initialValue = '') => {\r\n  const [value, setValue] = useState(() => {\r\n    return localStorage.getItem(key) || initialValue;\r\n  });\r\n\r\n  const setLocalStorageValue = (value) => {\r\n    setValue(value);\r\n    localStorage.setItem(key, value)\r\n  }\r\n\r\n  return [value, setLocalStorageValue];\r\n}\r\n","// import { createHashHistory } from 'history';\r\nexport const historyPush = (view, panel) => {\r\n\twindow.history.pushState({view: view, panel: panel}, `${view}.${panel}`, `#${view}.${panel}`);\r\n}\r\n// export default createHashHistory();","import React, { createContext, useReducer } from 'react';\r\nimport {PopoutWrapper, ScreenSpinner} from \"@vkontakte/vkui\";\r\nimport {historyPush} from \"../handlers/history\";\r\n\r\nconst initialState = {\r\n\tview: 'authorization',\r\n\tpanel: 'authorization.login',\r\n\tpopout: null,\r\n  error: null,\r\n  password: '',\r\n  confirmPassword: '',\r\n\tvkUser: {\r\n\t\tid: null,\r\n\t\tmatchUrlParams: false\r\n\t},\r\n\tcurrentUser: null,\r\n\tisLoggedIn: false,\r\n\treceipts: [],\r\n\titem: null,\r\n\tcurrentDate: new Date(),\r\n\tmodal: null\r\n};\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'SET_VIEW':\r\n\t\t\thistoryPush(action.payload.view, action.payload.panel);\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tview: action.payload.view,\r\n\t\t\t\tpanel: `${action.payload.view}.${action.payload.panel}`,\r\n\t\t\t\terror: null,\r\n\t\t\t\titem: null\r\n\t\t\t};\r\n\t\tcase 'SET_PANEL':\r\n\t\t\thistoryPush(state.view, action.payload.panel);\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpassword: '',\r\n\t\t\t\tconfirmPassword: '',\r\n\t\t\t\tpanel: `${state.view}.${action.payload.panel}`,\r\n\t\t\t\terror: null,\r\n\t\t\t\titem: null\r\n\t\t\t};\r\n\t\tcase 'SHOW_LOADING':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpopout: (\r\n\t\t\t\t\t<PopoutWrapper>\r\n\t\t\t\t\t\t<ScreenSpinner />\r\n\t\t\t\t\t</PopoutWrapper>\r\n\t\t\t\t)\r\n\t\t\t};\r\n\t\tcase 'HIDE_LOADING':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpopout: null\r\n\t\t\t};\r\n\t\tcase 'SET_POPOUT':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpopout: action.payload.popout\r\n\t\t\t}\r\n    case 'SET_ERROR':\r\n      return {\r\n        ...state,\r\n        error: action.payload.error\r\n      }\r\n    case 'UNSET_ERROR' :\r\n      return {\r\n        ...state,\r\n        error: null\r\n      }\r\n    case 'SET_PASSWORD':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpassword: state.password.length < 4 ? state.password+action.payload.digit : state.password\r\n\t\t\t}\r\n\t\tcase 'SET_CONFIRM_PASSWORD':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tconfirmPassword: state.confirmPassword.length < 4 ? state.confirmPassword+action.payload.digit : state.confirmPassword\r\n\t\t\t}\r\n\t\tcase 'UNSET_PASSWORD':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tpassword: '',\r\n\t\t\t\tconfirmPassword: ''\r\n\t\t\t}\r\n\t\tcase 'SET_VK_USER':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tvkUser: {\r\n\t\t\t\t\tid: action.payload.id,\r\n\t\t\t\t\tmatchUrlParams: action.payload.match\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\tcase 'SET_USER':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tcurrentUser: action.payload.user,\r\n\t\t\t\tisLoggedIn: action.payload.isLoggedIn,\r\n\t\t\t}\r\n\t\tcase 'SET_RECEIPTS':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\treceipts: action.payload.receipts,\r\n\t\t\t}\r\n\t\tcase 'SET_DATE':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tcurrentDate: action.payload.date\r\n\t\t\t}\r\n\t\tcase 'SET_ITEM_TO_EDIT':\r\n\t\t\thistoryPush('balance', 'balance.add');\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\titem: action.payload.item,\r\n\t\t\t\tview: 'balance',\r\n\t\t\t\tpanel: 'balance.add',\r\n\t\t\t\tmodal: null\r\n\t\t\t}\r\n\t\tcase 'HIDE_MODAL':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tmodal: null\r\n\t\t\t}\r\n\t\tcase 'SHOW_MODAL':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tmodal: action.payload.modal\r\n\t\t\t}\r\n\t\tcase 'LOGOUT':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tview: 'authorization',\r\n\t\t\t\tpanel: 'authorization.login',\r\n\t\t\t\tpopout: null,\r\n\t\t\t\terror: null,\r\n\t\t\t\tpassword: '',\r\n\t\t\t\tconfirmPassword: '',\r\n\t\t\t\tcurrentUser: null,\r\n\t\t\t\tisLoggedIn: false,\r\n\t\t\t\treceipts: [],\r\n\t\t\t\titem: null,\r\n\t\t\t\tcurrentDate: new Date(),\r\n\t\t\t\tmodal: null\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n};\r\n\r\nexport const RouterContext = createContext();\r\n\r\nexport const RouterContextProvider = ({ children }) => {\r\n\tconst value = useReducer(reducer, initialState);\r\n\treturn (\r\n\t\t<RouterContext.Provider value={value}>\r\n\t\t\t{children}\r\n\t\t</RouterContext.Provider>\r\n\t)\r\n};","import { useState, useEffect, useCallback, useContext } from 'react';\r\nimport useLocalStorage from \"./useLocalStorage\";\r\nimport queryString from 'query-string';\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nexport default url => {\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [response, setResponse] = useState(null);\r\n\tconst [error, setError] = useState(null);\r\n\tconst [options, setOptions] = useState({});\r\n\tconst [token] = useLocalStorage('token');\r\n\tconst [,dispatch] = useContext(RouterContext);\r\n\tconst _apiBase = process.env.NODE_ENV !== 'development' ? process.env.REACT_APP_BASEURL : process.env.REACT_APP_BASEURL_DEV;\r\n\t// const _apiBase = `https://35.238.182.107:8080/api`; `http://localhost:3000/api`\r\n\r\n\tconst doApiFetch = useCallback((options = {}) => {\r\n\t\tsetOptions(options);\r\n\t\tsetResponse(null);\r\n\t\tsetIsLoading(true);\r\n\t\tdispatch({ type: 'SHOW_LOADING' });\r\n\t}, [dispatch]);\r\n\r\n\tconst { method = 'GET', params, ...bodyFields} = options;\r\n\tuseEffect(() => {\r\n\t\tif (!isLoading) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst headers = {\r\n\t\t\t'Content-Type': 'application/json',\r\n\t\t\tAuthorization: token ? `Token ${token}` : '',\r\n\t\t};\r\n\r\n\t\tconst qString = params ? queryString.stringify(params) : null;\r\n\r\n\t\tconst uri = qString ? `${_apiBase}${url}?${qString}` : `${_apiBase}${url}`;\r\n\r\n\t\tconst fetchData = async () => {\r\n\t\t\tawait fetch(uri, {\r\n\t\t\t\tmethod,\r\n\t\t\t\tmode: 'cors',\r\n\t\t\t\theaders,\r\n\t\t\t\tbody: method !== 'GET' ? JSON.stringify(bodyFields) : null,\r\n\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\t// console.log(res.json());\r\n\t\t\t\t\t// if (!res.ok) throw Error(res.statusText);\r\n\t\t\t\t\treturn res.json();\r\n\t\t\t\t})\r\n\t\t\t\t.then(r => {\r\n\t\t\t\t\tif (r.error) {throw Error(r.error.message);}\r\n\t\t\t\t\tsetIsLoading(false);\r\n\t\t\t\t\tdispatch({ type: 'HIDE_LOADING' });\r\n\t\t\t\t\tsetResponse(r);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\tsetIsLoading(false);\r\n\t\t\t\t\tdispatch({ type: 'HIDE_LOADING' });\r\n\t\t\t\t\tdispatch({type: 'SET_ERROR', payload: {error: e}});\r\n\t\t\t\t\tsetError(e);\r\n\t\t\t\t});\r\n\t\t};\r\n\r\n\t\tfetchData();\r\n\t}, [isLoading, bodyFields, method, url, _apiBase, token, params, dispatch]);\r\n\treturn [{isLoading, response, error}, doApiFetch];\r\n}\r\n","import React, { useContext } from 'react';\r\nimport { Button } from \"@vkontakte/vkui\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport Icon28BackspaceOutline from '@vkontakte/icons/dist/28/backspace_outline';\r\nimport './dialer.component.css';\r\n\r\n\r\nconst Dialer = ({confirm = false}) => {\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tconst digits = [\r\n\t\t{item: '1'}, \r\n\t\t{item: '2'},\r\n\t\t{item: '3'},\r\n\t\t{item: '4'},\r\n\t\t{item: '5'},\r\n\t\t{item: '6'},\r\n\t\t{item: '7'},\r\n\t\t{item: '8'},\r\n\t\t{item: '9'},\r\n\t\t{item: null},\r\n\t\t{item: '0'},\r\n\t\t{\r\n\t\t\titem: <Icon28BackspaceOutline />,\r\n\t\t\tonClick: () => {dispatch({type: 'UNSET_PASSWORD'})},\r\n\t\t\tmode: 'destructive'\r\n\t\t}\r\n\t]\r\n\t// const digits = ['1', '2', '3', '4', '5', '6', '7', '8', '9', null, '0', ];\r\n\tconst onClick = (e) => {\r\n\t\tif (confirm) {\r\n\t\t\tdispatch({type: 'SET_CONFIRM_PASSWORD', payload: {digit: e.currentTarget.dataset.digit}})\r\n\t\t} else {\r\n\t\t\tdispatch({type: 'SET_PASSWORD', payload: {digit: e.currentTarget.dataset.digit}})\t\r\n\t\t}\r\n\t}\r\n\tconst dialer = digits.map((digit, index) => {\r\n\t\treturn (\r\n\t\t\t<div className='digit' key={index}>\r\n\t\t\t\t{\r\n\t\t\t\t\tdigit.item  \r\n\t\t\t\t\t && \r\n\t\t\t\t\t<Button \r\n\t\t\t\t\t\tsize='xl' \r\n\t\t\t\t\t\tmode={digit.mode || 'secondary'} \r\n\t\t\t\t\t\tdata-digit={digit.item} \r\n\t\t\t\t\t\tonClick={digit.onClick || onClick}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<b>{digit.item}</b>\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t)\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className='dialer'>\r\n\t\t\t{dialer}\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport default Dialer;","import React, {Fragment, useState, useEffect, useContext} from 'react';\r\nimport {Div, FormLayout, Placeholder, FormStatus} from \"@vkontakte/vkui\";\r\nimport PanelHeader from \"@vkontakte/vkui/dist/components/PanelHeader/PanelHeader\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Icon56LockOutline from '@vkontakte/icons/dist/56/lock_outline';\r\nimport Icon56UserAddOutline from '@vkontakte/icons/dist/56/user_add_outline';\r\nimport useApi from \"../hooks/useApi\";\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport Dialer from '../components/Dialer';\r\n\r\nconst Authorization = ({type}) => {\r\n\tconst [formError, setFormError] = useState(null);\r\n\tconst [{response, error}, doApiFetch] = useApi(`/users/${type}`);\r\n\tconst [startFetchData, setStartFetchData] = useState(false);\r\n\tconst [, setToken] = useLocalStorage('token');\r\n\tconst [state, dispatch] = useContext(RouterContext);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!state.isLoggedIn) return;\r\n\t\tdispatch({type: 'SET_VIEW', payload: { view: 'balance', panel: 'home'}})\r\n\t},[state, dispatch]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif ((state.password.length !== state.confirmPassword.length) || (!state.password.length && !state.confirmPassword.length)) {\r\n\t\t\tsetFormError(null);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (state.password !== state.confirmPassword) {\r\n\t\t\tsetFormError({status: 'Ошибка валидации', message: 'Пароли не совпадают. Проверьте ввод и повторите попытку.'});\r\n\t\t}\r\n\t}, [state.password, state.confirmPassword, type]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (!startFetchData) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'POST',\r\n\t\t\tuser: {\r\n\t\t\t\tid: +state.vkUser.id,\r\n\t\t\t\tpassword: state.password\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdoApiFetch(body);\r\n\t\tsetStartFetchData(false);\r\n\t\tdispatch({type: 'UNSET_PASSWORD'});\r\n\t},[startFetchData, doApiFetch, state.password, state.vkUser.id, dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\r\n\t\tif (!response.user && response.error) {\r\n\t\t\tsetFormError(response.error);\r\n\t\t} else {\r\n\t\t\tsetToken(response.user.token);\r\n\t\t}\r\n\t\tdispatch({type: 'SET_USER', payload: { user: response.user || null, isLoggedIn: !!response.user}});\r\n\r\n\t}, [response, setToken, dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!error) return;\r\n\t\tsetFormError({message: error.message});\r\n\t}, [error]);\r\n\r\n\tconst formStatus = () => {\r\n\t\tif (!formError) return null;\r\n\t\treturn (\r\n\t\t\t<FormStatus header={formError.status} mode=\"error\">\r\n\t\t\t\t{formError.message}\r\n\t\t\t</FormStatus>\r\n\t\t)\r\n\t};\r\n\r\n\tconst formButtonClick = async () => {\r\n\t\tsetStartFetchData(true);\r\n\t};\r\n\r\n\tconst loginPassString = state.password.replace(/[0-9]/g, '*') || 'Введите пароль'\r\n\tconst confPassString = state.confirmPassword.replace(/[0-9]/g, '*') ||  'Повторите пароль'\r\n\tconst digitCount = () => {\r\n\t\tlet str;\r\n\t\tif (state.password.length !== 4) {\r\n\t\t\tstr = state.password.length+' из 4';\r\n\t\t} else if (type==='login') {\r\n\t\t\tstr = state.password.length+' из 4';\r\n\t\t} else {\r\n\t\t\tstr = state.confirmPassword.length+' из 4';\r\n\t\t}\r\n\t\t// state.password.length !== 4 ? state.password.length+' из 4' : state.confirmPassword.length+' из 4'\r\n\t\treturn str;\r\n\t}\r\n\tconst headerString = () => {\r\n\t\tlet str;\r\n\t\tif (state.password.length !== 4) {\r\n\t\t\tstr = loginPassString;\r\n\t\t} else if (type==='login') {\r\n\t\t\tstr = loginPassString;\r\n\t\t} else {\r\n\t\t\tstr = confPassString;\r\n\t\t}\r\n\t\treturn (<b>{str}</b>);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>{type === 'login' ? 'Авторизация' : (type === 'register' ? 'Регистрация' : 'Сменить пароль')}</PanelHeader>\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={type === 'login' ? <Icon56LockOutline /> : <Icon56UserAddOutline />}\r\n\t\t\t\theader={headerString()/*state.password.length !== 4 ? loginPassString : confPassString*/}\r\n\t\t\t>\r\n\t\t\t\t<FormLayout>\r\n\t\t\t\t\t{formStatus()}\r\n\t\t\t\t</FormLayout>\r\n\t\t\t\t{digitCount()}\r\n\t\t\t</Placeholder>\r\n\t\t\t<Dialer confirm={(state.password.length === 4)} />\r\n\t\t\t<FormLayout style={{textAlign: 'center'}}>\r\n\t\t\t{\r\n\t\t\t\t(type === 'login' && state.password.length === 4)\r\n\t\t\t\t&&\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\tsize=\"xl\"\r\n\t\t\t\t\t\tmode='commerce'\r\n\t\t\t\t\t\tonClick={formButtonClick}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{type === 'login' ? 'Авторизация' : 'Регистрация'}\r\n\t\t\t\t\t</Button>\r\n\t\t\t}\r\n\t\t\t{\r\n\t\t\t\t(type !== 'login' && state.password && state.confirmPassword && state.password === state.confirmPassword)\r\n\t\t\t\t&&\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\tmode='commerce'\r\n\t\t\t\t\t\tsize=\"xl\"\r\n\t\t\t\t\t\tonClick={formButtonClick}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{type === 'login' ? 'Авторизация' : (type === 'register' ? 'Регистрация' : 'Сменить пароль')}\r\n\t\t\t\t\t</Button>\r\n\t\t\t}\r\n\t\t\t</FormLayout>\r\n\t\t\t<Div>\r\n\t\t\t\t<Button\r\n\t\t\t\t\tstretched\r\n\t\t\t\t\tmode=\"tertiary\"\r\n\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\tdispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.to}});\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tdata-to={type === 'login' ? 'register' : 'login'}\r\n\t\t\t\t>{type === 'login' ? 'Регистрация' : 'Авторизация'}</Button>\r\n\t\t\t</Div>\r\n\t\t\t{\r\n\t\t\t\ttype === 'login'\r\n\t\t\t\t&&\r\n\t\t\t\t<Div>\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\tstretched\r\n\t\t\t\t\t\tmode=\"tertiary\"\r\n\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\tdispatch({type: 'SET_PANEL', payload: {panel: e.currentTarget.dataset.to}});\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tdata-to={'restore'}\r\n\t\t\t\t\t>Забыли пароль?</Button>\r\n\t\t\t\t</Div>\r\n\t\t\t}\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Authorization;\r\n","import React, {useState, useEffect, useContext} from 'react';\r\nimport Avatar from \"@vkontakte/vkui/dist/components/Avatar/Avatar\";\r\nimport {Snackbar} from \"@vkontakte/vkui\";\r\nimport Icon16Done from '@vkontakte/icons/dist/16/done';\r\nimport Icon28ErrorOutline from '@vkontakte/icons/dist/28/error_outline';\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nconst CustomSnackBar = ({message, isError, onClose}) => {\r\n\tconst [snackbar, setSnackbar] = useState(null);\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tuseEffect(() => {\r\n\t\tsetSnackbar(<Snackbar\r\n\t\t\tlayout=\"vertical\"\r\n\t\t\tonClose={onClose}\r\n\t\t\tbefore={\r\n\t\t\t\tisError\r\n\t\t\t\t\t? <Avatar size={24} style={{backgroundColor: 'var(--destructive)'}}><Icon28ErrorOutline fill=\"#fff\" width={18} height={18} /></Avatar>\r\n\t\t\t\t\t: <Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon16Done fill=\"#fff\" width={18} height={18} /></Avatar>\r\n\t\t\t}\r\n\t\t>\r\n\t\t\t{message}\r\n\t\t</Snackbar>)\r\n\t}, [setSnackbar, dispatch, isError, message, onClose]);\r\n\treturn(\r\n\t\tsnackbar\r\n\t)\r\n};\r\n\r\nexport default CustomSnackBar;\r\n","import React, {useState, useEffect, Fragment, useContext, useReducer, useCallback} from 'react';\r\nimport {\r\n\tFormLayout,\r\n\tPanelHeader, Button, Input, FormLayoutGroup, Snackbar,\r\n\tDiv, FixedLayout\r\n} from '@vkontakte/vkui';\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\nimport useApi from \"../hooks/useApi\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport Avatar from \"@vkontakte/vkui/dist/components/Avatar/Avatar\";\r\nimport Icon16Done from '@vkontakte/icons/dist/16/done';\r\nimport CustomSnackBar from \"../components/CustomSnackbar\";\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\nimport './styles.css';\r\n\r\nconst initialState = {\r\n\temail: '',\r\n\tphone: '',\r\n\tname: '',\r\n\tkktPassword: ''\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'SET_EMAIL':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\temail: action.payload.email\r\n\t\t\t}\r\n\t\tcase 'SET_PHONE':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tphone: action.payload.phone\r\n\t\t\t}\r\n\t\tcase 'SET_NAME':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tname: action.payload.name\r\n\t\t\t}\r\n\t\tcase 'SET_PASSWORD':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tkktPassword: action.payload.password\r\n\t\t\t}\r\n\t\tcase 'INIT':\r\n\t\t\tconst { email, name, phone, password } = action.payload.currentUser;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\temail: email || '',\r\n\t\t\t\tname: name || '',\r\n\t\t\t\tphone: phone || '',\r\n\t\t\t\tkktPassword: password || ''\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nconst Profile = () =>{\r\n\tconst [fetchToFns, setFetchToFns] = useState(false);\r\n\tconst [snackbar, setSnackbar] = useState(null);\r\n\tconst [init, setInit] = useState(true);\r\n\tconst [fnsPasswordType, setFnsPasswordType] = useState('');\r\n\tconst [{response}, doApiFetch] = useApi(`/users/profile`);\r\n\tconst [fnsResponse, doFnsFetch] = useApi(`/fns/password`);\r\n\tconst [startFetchData, setStartFetchData] = useState(false);\r\n\tconst [state, dispatch] = useContext(RouterContext);\r\n\tconst [formState, dispatchForm] = useReducer(reducer, initialState);\r\n\tconst [, setToken] = useLocalStorage('token');\r\n\r\n\tuseEffect(()=>{\r\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'VKWebAppGetUserInfoResult':\r\n\t\t\t\t\tdispatchForm({type: 'SET_NAME', payload: {name: `${data.first_name} ${data.last_name}`}});\r\n\t\t\t\t\tdispatch({type: 'HIDE_LOADING'});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'VKWebAppGetUserInfoFailed':\r\n\t\t\t\t\tdispatchForm({type: 'SET_NAME', payload: {name: ``}});\r\n\t\t\t\t\tdispatch({type: 'HIDE_LOADING'});\r\n\t\t\t\t\tconsole.log(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'VKWebAppGetPersonalCardResult':\r\n\t\t\t\t\tdispatchForm({type: 'SET_EMAIL', payload: {email: data.email}});\r\n\t\t\t\t\tdispatchForm({type: 'SET_PHONE', payload: {phone: data.phone}});\r\n\t\t\t\t\tconsole.log('profile', data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'VKWebAppGetPersonalCardFailed':\r\n\t\t\t\t\tconsole.log('profile error', data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}, [dispatch]);\r\n\r\n\tconst onClose = useCallback(() => {\r\n\t\tdispatch({ type: 'UNSET_ERROR'});\r\n\t\tsetSnackbar(null);\r\n\t}, [dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!init) return;\r\n\t\tdispatchForm({type: 'INIT', payload: {currentUser: state.currentUser}});\r\n\t\tif (state.currentUser.name === '') {\r\n\t\t\tdispatch({type: 'SHOW_LOADING'});\r\n\t\t\tbridge.send('VKWebAppGetUserInfo', {});\r\n\t\t}\r\n\t\tsetInit(false);\r\n\t}, [state, init, dispatch]);\r\n\r\n\tuseEffect(()=>{\r\n\t\tif (!startFetchData) return;\r\n\t\tconst body = {\r\n\t\t\tmethod: 'PUT',\r\n\t\t\tupdate: formState\r\n\t\t};\r\n\t\tdoApiFetch(body);\r\n\t\tsetStartFetchData(false);\r\n\t},[startFetchData, doApiFetch, formState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!fetchToFns) return;\r\n\t\tlet body = {};\r\n\t\tif (fnsPasswordType !== 'restore') {\r\n\t\t\tbody.name = formState.name;\r\n\t\t\tbody.email = formState.email;\r\n\t\t}\r\n\t\tbody.params = {\r\n\t\t\ttype: fnsPasswordType\r\n\t\t};\r\n\t\tbody.phone = formState.phone.replace(/[ ()-]/g, '');\r\n\t\tbody.phone = body.phone.replace(/^[8]/g, '+7');\r\n\t\tbody.method = 'POST';\r\n\t\tdoFnsFetch(body);\r\n\t\tsetFetchToFns(false);\r\n\t}, [fetchToFns, fnsPasswordType, doFnsFetch, formState]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tsetToken(response.user.token);\r\n\t\tdispatch({type: 'SET_USER', payload: { user: response.user || null, isLoggedIn: !!response.user}});\r\n\t\tdispatch({type: 'SET_VIEW', payload: { view: 'balance', panel: 'home'}});\r\n\t}, [response, dispatch, setToken]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!fnsResponse.response) return;\r\n\t\tsetSnackbar(\r\n\t\t\t<Snackbar\r\n\t\t\t\tlayout=\"vertical\"\r\n\t\t\t\tonClose={() => setSnackbar(null)}\r\n\t\t\t\tbefore={<Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon16Done fill=\"#fff\" width={14} height={14} /></Avatar>}\r\n\t\t\t>\r\n\t\t\t\t{fnsResponse.response.message}\r\n\t\t\t</Snackbar>\r\n\t\t)\r\n\t}, [fnsResponse.response]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!state.error) return;\r\n\t\tsetSnackbar(<CustomSnackBar message={state.error.message} isError={true} onClose={onClose}/>);\r\n\t}, [state.error, onClose]);\r\n\r\n\tconst getDataFromVK = () => {\r\n\t\tbridge.send(\"VKWebAppGetPersonalCard\", {\"type\": [\"phone\", \"email\"]});\r\n\t}\r\n\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader\r\n\t\t\t\t// left={<PanelHeaderButton onClick={() => {\r\n\t\t\t\t// \tdispatch({type: 'SET_VIEW', payload: {view: 'balance', panel: 'home'}})\r\n\t\t\t\t// }}>\r\n\t\t\t\t// \t{osName === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}\r\n\t\t\t\t// </PanelHeaderButton>}\r\n\t\t\t>\r\n\t\t\t\tПрофиль\r\n\t\t\t</PanelHeader>\r\n\t\t\t<FormLayout style={{paddingBottom: 40}}>\r\n\t\t\t\t<Input\r\n\t\t\t\t\ttype={'text'}\r\n\t\t\t\t\ttop={'Имя'}\r\n\t\t\t\t\tname={'name'}\r\n\t\t\t\t\tvalue={formState.name}\r\n\t\t\t\t\tonChange={(e) => {dispatchForm({type: 'SET_NAME', payload: {name: e.currentTarget.value}})}}\r\n\t\t\t\t/>\r\n\t\t\t\t<FormLayoutGroup\r\n\t\t\t\t\ttop=\"E-mail и Телефон\"\r\n\t\t\t\t\tbottom=\"Эти данные нужны для того, чтобы пройти регистрацию в сервисе проверки чеков ФНС.\r\n\t\t\t\t\tРегистрация дает возможность получать расшифровку данных по чекам при сканировании QR кода\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'email'}\r\n\t\t\t\t\t\ttop={'e-mail'}\r\n\t\t\t\t\t\tname={'email'}\r\n\t\t\t\t\t\tplaceholder={'Введите e-mail'}\r\n\t\t\t\t\t\tvalue={formState.email}\r\n\t\t\t\t\t\tonChange={(e) => {dispatchForm({type: 'SET_EMAIL', payload: { email: e.currentTarget.value }})}}\r\n\t\t\t\t\t\tonClick={getDataFromVK}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'phone'}\r\n\t\t\t\t\t\ttop={'Телефон'}\r\n\t\t\t\t\t\tname={'phone'}\r\n\t\t\t\t\t\tvalue={formState.phone}\r\n\t\t\t\t\t\tplaceholder={'Введите телефон'}\r\n\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\te.target.value.replace(/^[8]/, '+7');\r\n\t\t\t\t\t\t\tdispatchForm({type: 'SET_PHONE', payload: { phone: e.currentTarget.value }})\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tonClick={getDataFromVK}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</FormLayoutGroup>\r\n\t\t\t\t{<FormLayoutGroup\r\n\t\t\t\t\ttop={'Пароль от ФНС'}\r\n\t\t\t\t\tbottom={'Если вы когда-либо регистрировались в сервисе проверки чеков ФНС, но забыли пароль нажмите \"Восстановить пароль\". ' +\r\n\t\t\t\t\t'Если не хотите получать пароль по каким то причинам, оставьте поле ввода пароля пустым, но тогда у вас не будет возможности' +\r\n\t\t\t\t\t' сканировать чеки и получать расшифровку по чекам'}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Input\r\n\t\t\t\t\t\ttype={'number'}\r\n\t\t\t\t\t\ttop={'Пароль от ФНС'}\r\n\t\t\t\t\t\tplaceholder={'Введите пароль ФНС'}\r\n\t\t\t\t\t\tname={'kktPassword'}\r\n\t\t\t\t\t\tvalue={formState.kktPassword}\r\n\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\tdispatchForm({type: 'SET_PASSWORD', payload: {password: e.currentTarget.value}})\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Div style={{display: 'flex', justifyContent: 'space-between'}}>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tsize='l'\r\n\t\t\t\t\t\t\tdata-type={'signup'}\r\n\t\t\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t\t\t(e) => {\r\n\t\t\t\t\t\t\t\t\tsetFnsPasswordType(e.currentTarget.dataset.type);\r\n\t\t\t\t\t\t\t\t\tsetFetchToFns(true);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tstyle={{margin: '0px', width: '49%'}}\r\n\t\t\t\t\t\t\tdisabled={!(formState.email && formState.name && formState.phone)}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tРегистрация\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tsize='l'\r\n\t\t\t\t\t\t\tdata-type={'restore'}\r\n\t\t\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t\t\t(e) => {\r\n\t\t\t\t\t\t\t\t\tsetFnsPasswordType(e.currentTarget.dataset.type);\r\n\t\t\t\t\t\t\t\t\tsetFetchToFns(true);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tstyle={{margin: '0px', width: '49%'}}\r\n\t\t\t\t\t\t\tdisabled={!(formState.email && formState.name && formState.phone)}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tЗабыли пароль?\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</Div>\r\n\t\t\t\t</FormLayoutGroup>}\r\n\r\n\t\t\t\t<FixedLayout className={'fixed-button'} style={{marginBottom: '1em'}} vertical=\"bottom\">\r\n\t\t\t\t\t<Button size=\"xl\" mode=\"commerce\" onClick={() => {\r\n\t\t\t\t\t\tsetStartFetchData(true);\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t\tОбновить профиль\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</FixedLayout>\r\n\t\t\t</FormLayout>\r\n\t\t\t{snackbar}\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Profile;\r\n","export default class Prepare {\r\n\t/**\r\n\t * Преобразование qr кода\r\n\t * @param str\r\n\t * @returns {{dt: *, fn: *, i: *, sum: *, fp: *}}\r\n\t */\r\n\tstatic qr (str){\r\n\t\ttry {\r\n\t\t\tlet dt, sum, fn, i, fp;\r\n\r\n\t\t\tif (str) {\r\n\t\t\t\t[, dt, sum, fn, i, fp] = str.match(/t=(\\w{8}T\\w+)&s=(\\w+\\.*\\w+)&fn=(\\w+)&i=(\\w+)&fp=(\\w+)/);\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdt,\r\n\t\t\t\tsum: sum.replace(/[.]/g, ''),\r\n\t\t\t\tfn,\r\n\t\t\t\ti,\r\n\t\t\t\tfp\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log(e);\r\n\t\t\treturn {\r\n\t\t\t\terror: {\r\n\t\t\t\t\tmessage: 'Ошибка чтения QR кода'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Преобразование даты\r\n\t * @param str\r\n\t * @returns {string}\r\n\t */\r\n\tstatic date(str) {\r\n\t\tconst dt = new Date(str);\r\n\t\tlet monthName;\r\n\t\tswitch (dt.getMonth() + 1) {\r\n\t\t\tcase 1:\r\n\t\t\t\tmonthName = 'января';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tmonthName = 'февраля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tmonthName = 'марта';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tmonthName = 'апреля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tmonthName = 'мая';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tmonthName = 'июня';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7:\r\n\t\t\t\tmonthName = 'июля';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8:\r\n\t\t\t\tmonthName = 'августа';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 9:\r\n\t\t\t\tmonthName = 'сентября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 10:\r\n\t\t\t\tmonthName = 'октября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 11:\r\n\t\t\t\tmonthName = 'ноября';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 12:\r\n\t\t\t\tmonthName = 'декабря';\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn `${dt.getDate()} ${monthName} ${dt.getFullYear()}`;\r\n\t}\r\n\r\n\t/**\r\n\t * Преобразование суммы\r\n\t * @param n\r\n\t * @returns {string}\r\n\t */\r\n\tstatic sum(n) {\r\n\t\treturn new Intl.NumberFormat('ru-RU', {style: 'currency', currency: 'RUB'}).format(n / 100);\r\n\t}\r\n\r\n\t/**\r\n\t * Расчет общей суммы\r\n\t * @param arr\r\n\t * @returns {number}\r\n\t */\r\n\tstatic totalReceiptSum(arr) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\treturn arr.map((item) => {\r\n\t\t\treturn item.sum || item.totalSum;\r\n\t\t}).reduce(reducer);\r\n\t}\r\n\r\n\tstatic totalSumWithParams(arr) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\treturn arr.map((item) => {\r\n\t\t\tconst {income, sum} = item;\r\n\t\t\tif (income) return sum;\r\n\t\t\treturn -1*sum;\r\n\t\t}).reduce(reducer);\r\n\t}\r\n\r\n\t/**\r\n\t * Подсчет суммарных доходов / расходов\r\n\t * @param arr\r\n\t * @param income\r\n\t * @returns {number}\r\n\t */\r\n\tstatic totalSum(arr, income) {\r\n\t\tif (arr.length === 0) return 0;\r\n\t\tconst reducer = (previousValue, currentValue) => previousValue + currentValue;\r\n\t\tconst ts = arr.map(items => {\r\n\t\t\treturn items.items.map(item => {\r\n\t\t\t\tif (income) {\r\n\t\t\t\t\treturn item.income ? item.sum : 0\r\n\t\t\t\t}\r\n\t\t\t\treturn !item.income ? item.sum : 0\r\n\t\t\t}).reduce(reducer)\r\n\t\t}).reduce(reducer);\r\n\t\treturn income ? ts : -1 * ts;\r\n\t}\r\n}","import React from 'react';\r\nimport prepare from \"../handlers/prepare\";\r\n\r\n/**\r\n * Раскарашиваем сумму\r\n * @param {number} sum - Сумма\r\n * @param {string} fs\r\n * @returns {React.Component}\r\n * @constructor\r\n */\r\nconst ColoredSum = ({sum, fs}) => {\r\n\tconst stl = sum >= 0 ? {color: '#28a745', fontSize: fs} : {color: '#dc3545', fontSize: fs};\r\n\treturn(\r\n\t\t<span style={stl}>{prepare.sum(sum)}</span>\r\n\t)\r\n};\r\n\r\nexport default ColoredSum;\r\n","import React, { useContext } from 'react';\r\nimport {format, addMonths, subMonths} from 'date-fns';\r\nimport { ru } from 'date-fns/locale'\r\nimport {Group, List, Cell, Button} from \"@vkontakte/vkui\";\r\nimport Icon24BrowserBack from '@vkontakte/icons/dist/24/browser_back';\r\nimport Icon24BrowserForward from '@vkontakte/icons/dist/24/browser_forward';\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\n\r\nconst Calendar = () => {\r\n  const [state, dispatch] = useContext(RouterContext);\r\n  const dateFormat = 'LLLL yyyy';\r\n\tconst disabled = format(new Date(), 'yyyy.M') <= format(state.currentDate, 'yyyy.M');\r\n\r\n  const nextMonth = () => {\r\n    dispatch({type: 'SET_DATE', payload: { date: (addMonths(state.currentDate, 1))}});\r\n  };\r\n\r\n  const prevMonth = () => {\r\n    dispatch({type: 'SET_DATE', payload: { date: (subMonths(state.currentDate, 1))}});\r\n  };\r\n\r\n  return(\r\n    <Group>\r\n      <List>\r\n        <Cell\r\n          before={<Button onClick={prevMonth} mode={'secondary'}><Icon24BrowserBack /></Button>}\r\n          asideContent={<Button disabled={disabled} onClick={nextMonth} mode={'secondary'}><Icon24BrowserForward /></Button>}\r\n          style={{textAlign: 'center', fontWeight: 'bold'}}\r\n        >\r\n          {format(state.currentDate, dateFormat, {locale: ru}).toLocaleUpperCase()}\r\n        </Cell>\r\n      </List>\r\n    </Group>\r\n  )\r\n};\r\n\r\nexport default Calendar;\r\n","import Receipt from \"./receipt\";\r\n\r\nexport default Receipt;\r\n","import React, {Fragment, useContext} from 'react';\r\nimport {Separator} from \"@vkontakte/vkui\";\r\nimport prepare from \"../../handlers/prepare\";\r\nimport ColoredSum from \"../ColoredSum\";\r\nimport {RouterContext} from \"../../contexts/routerContext\";\r\n\r\nimport './receipt.css';\r\nimport FormLayout from \"@vkontakte/vkui/dist/components/FormLayout/FormLayout\";\r\n\r\nconst Receipt = ({items, id, isSearch=false}) => {\r\n\tconst [, dispatch] = useContext(RouterContext);\r\n\tconst setDefinition = (item) => {\r\n\t\tif (!item || !item.definition) return null;\r\n\t\tconst {definition} = item.definition;\r\n\t\treturn definition;\r\n\t}\r\n\tconst receiptItem = (items.map((item, index) => {\r\n\t\tconst sum = item.income ? item.sum : (-1) * item.sum ;\r\n\r\n\t\tconst definition = setDefinition(item);// = item && item.definition.definition ? item.definition.definition : null;\r\n\r\n\r\n\t\treturn(\r\n\t\t\t<Fragment key={index}>\r\n\t\t\t\t<div className={'receipt-item'} onClick={() => {dispatch({type: 'SET_ITEM_TO_EDIT', payload: {item: item}})}}>\r\n\t\t\t\t\t<span className={'receipt-item-name'}>{definition ? definition : item.name}</span>\r\n\t\t\t\t\t{item.price && !isSearch ? <span className={'receipt-item-price'}>{prepare.sum(item.price)}</span> : null}\r\n\t\t\t\t\t{item.quantity && !isSearch ? <span className={'receipt-item-quantity'}>{item.quantity}</span> : null}\r\n\t\t\t\t\t{item.dateTime && isSearch ? <span className={'receipt-item-dateTime'}>{prepare.date(item.dateTime)}</span> : null}\r\n\t\t\t\t\t{sum ? <span className={'receipt-item-sum'}>{<ColoredSum sum={sum}/>}</span> : null}\r\n\t\t\t\t</div>\r\n\t\t\t</Fragment>\r\n\t\t)\r\n\t}));\r\n\r\n\treturn(\r\n\t\t<FormLayout id={id} className={'receipt-item-wrapper'}>\r\n\t\t\t<div className={'receipt-item'}>\r\n\t\t\t\t<span className={'receipt-item-name'}>Наименование</span>\r\n\t\t\t\t{!isSearch ?\r\n\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t<span  className={'receipt-item-price'}>Цена</span>\r\n\t\t\t\t\t\t<span  className={'receipt-item-quantity'}>Кол-во</span>\r\n\t\t\t\t\t</Fragment> :\r\n\t\t\t\t\t<span className={'receipt-item-dateTime'}>Дата</span>\r\n\t\t\t\t}\r\n\t\t\t\t<span className={'receipt-item-sum'}>Сумма</span>\r\n\t\t\t</div>\r\n\t\t\t<Separator />\r\n\t\t\t{receiptItem}\r\n\t\t\t<Separator />\r\n\t\t\t<div className={'receipt-total'}>\r\n\t\t\t\t<span className={''}>Итого:</span>\r\n\t\t\t\t<span><ColoredSum sum={prepare.totalSumWithParams(items)}/></span>\r\n\t\t\t</div>\r\n\t\t</FormLayout>\r\n\t)\r\n};\r\n\r\nexport default Receipt;","import SearchComponent from \"./SearchComponent\";\r\n\r\nexport default SearchComponent;\r\n","import React, {Fragment, useState, useEffect} from 'react';\r\nimport {Search} from \"@vkontakte/vkui\";\r\nimport Receipt from \"../Receipt\";\r\nimport Group from \"@vkontakte/vkui/dist/components/Group/Group\";\r\n\r\nconst SearchComponent = ({ receipts }) => {\r\n  const [search, setSearch] = useState('');\r\n  const [searchTarget, setSearchTarget] = useState([]);\r\n  const [searchResult, setSearchResult] = useState([]);\r\n\r\n  const onSearchChange = (e) => {\r\n    setSearch(e.target.value.toLowerCase());\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!receipts) return;\r\n    let arr = [];\r\n    const tmp = receipts.map((receipt) => {\r\n      let dateTime = receipt.dateTime;\r\n      return receipt.items.map((item) => {\r\n        item.dateTime = dateTime;\r\n        return item;\r\n      });\r\n    });\r\n    tmp.forEach((item) => {\r\n      arr.push(...item);\r\n    });\r\n    setSearchTarget(arr);\r\n  }, [receipts]);\r\n\r\n  useEffect(() => {\r\n    if (!search) {\r\n      setSearchResult([]);\r\n      return;\r\n    }\r\n    setSearchResult(searchTarget.filter(({name}) => name.toLowerCase().indexOf(search) > -1));\r\n  }, [search, searchTarget]);\r\n\r\n  return (\r\n    <Fragment>\r\n      <Search value={search} onChange={onSearchChange}/>\r\n      <Group title='Поиск'>\r\n        {\r\n          searchResult.length > 0 && <Receipt id={searchResult._id} isSearch={true} items={searchResult}/>\r\n        }\r\n      </Group>\r\n    </Fragment>\r\n  )\r\n};\r\n\r\nexport default SearchComponent;\r\n","import React, {useState, useEffect, Fragment, useContext} from 'react';\r\nimport useApi from \"../hooks/useApi\";\r\nimport {List, PanelHeaderContent, Placeholder, Separator, Counter, Alert} from \"@vkontakte/vkui\";\r\nimport ColoredSum from \"../components/ColoredSum\";\r\nimport prepare from \"../handlers/prepare\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Group from \"@vkontakte/vkui/dist/components/Group/Group\";\r\nimport Cell from \"@vkontakte/vkui/dist/components/Cell/Cell\";\r\nimport Icon56GoodsCollection from '@vkontakte/icons/dist/56/goods_collection';\r\nimport Icon16Up from '@vkontakte/icons/dist/16/up';\r\nimport Icon16Down from '@vkontakte/icons/dist/16/down';\r\n\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport Calendar from \"../components/Calendar\";\r\nimport {format} from 'date-fns';\r\nimport SearchComponent from \"../components/search\";\r\nimport PanelHeader from \"@vkontakte/vkui/dist/components/PanelHeader/PanelHeader\";\r\n\r\nconst Balance = ({setReceiptFromBalance}) => {\r\n\tconst viewTitle = 'Баланс';\r\n\tconst [initialFetch, setInitialFetch] = useState(true);\r\n\tconst [changeDate, setChangeDate] = useState(false);\r\n\tconst [state, dispatch] = useContext(RouterContext);\r\n\tconst [{response, isLoading}, doApiFetch] = useApi('/day');\r\n\tconst dateFormat = 'yyyy-MM-dd';\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!initialFetch) return;\r\n\t\tdoApiFetch({\r\n\t\t\tparams: {\r\n\t\t\t\tdate: format(state.currentDate, dateFormat)\r\n\t\t\t}\r\n\t\t});\r\n\t\tsetInitialFetch(false);\r\n\t}, [initialFetch, setInitialFetch, doApiFetch, state.currentDate]);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetInitialFetch(true);\r\n\t\tsetChangeDate(true);\r\n\t}, [state.currentDate]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tsetChangeDate(false);\r\n\t\tdispatch({type: 'SET_RECEIPTS', payload: {receipts: response}});\r\n\t}, [response, dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!changeDate) return;\r\n\t\tif (isLoading) return;\r\n\t\tif (!response) return;\r\n\t\tif (!!response.length || (format(state.currentDate, 'yyyy.M') !== format(new Date(), 'yyyy.M'))) return;\r\n\r\n\t\tconst popout = (\r\n\t\t\t<Alert\r\n\t\t\t\tactions={[{\r\n\t\t\t\t\ttitle: 'Отмена',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\tmode: 'cancel'\r\n\t\t\t\t}, {\r\n\t\t\t\t\ttitle: 'Добавить',\r\n\t\t\t\t\tautoclose: true,\r\n\t\t\t\t\taction: () => dispatch({type: 'SET_PANEL', payload: { panel: 'add'}})\r\n\t\t\t\t}]}\r\n\t\t\t\tonClose={() => dispatch({type: 'SET_POPOUT', payload: { popout: null }})}\r\n\t\t\t>\r\n\t\t\t\t<h2>За текущий месяц данных нет</h2>\r\n\t\t\t\t<p>Добавьте остаток денежных средств, для правильной калькуляции баланса</p>\r\n\t\t\t</Alert>\r\n\t\t)\r\n\t\tdispatch({type: 'SET_POPOUT', payload: { popout: popout }});\r\n\t}, [changeDate, isLoading, dispatch, response, state.currentDate]);\r\n\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\t<PanelHeaderContent\r\n\t\t\t\t\taside={<Counter size={'s'} mode={'primary'}>{process.env.REACT_APP_VERSION}</Counter>}\r\n\t\t\t\t\t//aside={<Icon16Dropdown style={{ transform: `rotate(${contextOpened ? '180deg' : '0'})` }} />}\r\n\t\t\t\t\t// onClick={toggleContext}\r\n\t\t\t\t>\r\n\t\t\t\t\t{viewTitle}\r\n\t\t\t\t</PanelHeaderContent>\r\n\t\t\t</PanelHeader>\r\n\t\t\t<SearchComponent receipts={state.receipts} />\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={<Icon56GoodsCollection />}\r\n\t\t\t\theader={<ColoredSum sum={prepare.totalReceiptSum(state.receipts)} fs={'2em'}/>}\r\n\t\t\t\taction={<Button size=\"l\" onClick={(e)=>{\r\n\t\t\t\t\tdispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.to}});\r\n\t\t\t\t}} data-to={'add'}>Добавить доход / расход</Button>}\r\n\t\t\t>\r\n\t\t\t\tДобавляйте доходы/расходы\r\n\t\t\t</Placeholder>\r\n\t\t\t<Separator/>\r\n\t\t\t<div style={{\r\n\t\t\t\tdisplay: 'flex',\r\n\t\t\t\tflexDirection: 'row',\r\n\t\t\t\tjustifyContent: 'space-between',\r\n\t\t\t\tpaddingTop: '1em',\r\n\t\t\t}}>\r\n\t\t\t\t<div style={{flex: '0 1 50%', display: 'flex',justifyContent: 'flex-end',}}>\r\n\t\t\t\t\t<div style={{display: 'flex', flexDirection: 'column', paddingRight: '10px'}}>\r\n\t\t\t\t\t\t<span style={{color: '#6F6F6F', fontSize: '0.7em', textAlign: 'end'}}>Доходы</span>\r\n\t\t\t\t\t\t<ColoredSum sum={prepare.totalSum(state.receipts, true)} fs={'1.4em'}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<Icon16Up width={16} height={40} fill={'#28a745'}/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style={{flex: '0 1 50%', display: 'flex',justifyContent: 'flex-start',}}>\r\n\t\t\t\t\t<Icon16Down width={16} height={40} fill={'#dc3545'}/>\r\n\t\t\t\t\t<div style={{display: 'flex', flexDirection: 'column', paddingLeft: '10px'}}>\r\n\t\t\t\t\t\t<span style={{color: '#6F6F6F', fontSize: '0.7em'}}>Расходы</span>\r\n\t\t\t\t\t\t<ColoredSum sum={prepare.totalSum(state.receipts, false)} fs={'1.4em'}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<Group title='Чеки'>\r\n\t\t\t\t<List>\r\n\t\t\t\t\t<Calendar />\r\n\t\t\t\t\t{state.receipts.map((receipt, index) => {\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\texpandable\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t// onClickActiveModal('modal-page');\r\n\t\t\t\t\t\t\t\t\tdispatch({type: 'SHOW_MODAL', payload: {modal: 'modal-page'}});\r\n\t\t\t\t\t\t\t\t\tsetReceiptFromBalance(receipt);\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tdata-to={receipt._id}\r\n\t\t\t\t\t\t\t\tindicator={<ColoredSum sum={receipt.totalSum}/>}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{prepare.date(receipt.dateTime)}\r\n\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t})}\r\n\t\t\t\t</List>\r\n\t\t\t</Group>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Balance;\r\n","import {format} from 'date-fns';\r\n\r\nexport default class Validation {\r\n\t/**\r\n\t * Проверка на оверсайз\r\n\t * @param e {*}\r\n\t * @param max Number\r\n\t * @returns {boolean}\r\n\t */\r\n\tstatic overSize(e, max) {\r\n\t\tconst val = e.target.value;\r\n\t\tlet maxLength;\r\n\t\tif (val.indexOf('.') >= 0) {\r\n\t\t\tmaxLength = val.indexOf('.')+3\r\n\t\t} else {\r\n\t\t\tmaxLength = max;\r\n\t\t}\r\n\t\treturn e.target.value.slice(0, maxLength);\r\n\t}\r\n\r\n\tstatic overDate (date) {\r\n\t\tconst dt = new Date(date);\r\n\t\tconst now = new Date();\r\n\t\tif (dt > now) {\r\n\t\t\treturn format(new Date(now), 'yyyy-MM-dd');\r\n\t\t}\r\n\t\treturn format(new Date(dt), 'yyyy-MM-dd');\r\n\t}\r\n\r\n\tstatic typeNumber(e) {\r\n\t\tif (e.key === 'e' || e.key === '+' || e.key === '-') {\r\n\t\t\te.preventDefault()\r\n\t\t}\r\n\t\tif (e.key === '.' && e.target.value === '') {\r\n\t\t\te.preventDefault()\r\n\t\t}\r\n\t\tif (e.key === '.' && e.target.value.includes('.')) {\r\n\t\t\tconsole.log(e.target.value);\r\n\t\t\te.target.value.slice(0, e.target.value.indexOf('..'));\r\n\t\t\te.preventDefault()\r\n\t\t}\r\n\t}\r\n}","import React, {useState, useEffect, useContext, Fragment, useCallback} from 'react';\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\r\nimport FormLayout from \"@vkontakte/vkui/dist/components/FormLayout/FormLayout\";\r\nimport Input from \"@vkontakte/vkui/dist/components/Input/Input\";\r\nimport PanelHeaderButton from \"@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton\";\r\nimport {FixedLayout, Alert, Textarea, Radio} from \"@vkontakte/vkui\";\r\n// import Icon24Back from '@vkontakte/icons/dist/24/back';\r\n// import Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Icon24Qr from '@vkontakte/icons/dist/24/qr';\r\n// import PanelHeaderContent from \"@vkontakte/vkui/dist/components/PanelHeaderContent/PanelHeaderContent\";\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport useApi from \"../hooks/useApi\";\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport prepare from \"../handlers/prepare\";\r\nimport CustomSnackBar from \"../components/CustomSnackbar\";\r\nimport {format} from 'date-fns';\r\nimport Validation from \"../handlers/validation\";\r\nimport './styles.css';\r\n\r\nconst AddDay = () => {\r\n  const SUCCESS_MESSAGE = 'Успешно';\r\n  const [state, dispatch] = useContext(RouterContext);\r\n  const [editedItem, setEditedItem] = useState(() => {\r\n    return state.item || null;\r\n  })\r\n  const [name, setName] = useState(() => {\r\n    return editedItem?.name || '';\r\n  });\r\n  const [date, setDate] = useState(() => {\r\n    const d = editedItem?.dateTime || new Date();\r\n    return format(new Date(d), 'yyyy-MM-dd');\r\n  });\r\n  const [quantity, setQuantity] = useState(() => {\r\n    return editedItem?.quantity || 1\r\n  });\r\n  const [price, setPrice] = useState(() => {\r\n    return editedItem?.price / 100 || ''\r\n  });\r\n  const [income, setIncome] = useState(() => {\r\n    return editedItem?.income || false\r\n  });\r\n\r\n  const [description, setDescription] = useState(() => {\r\n    return editedItem?.description || ''\r\n  });\r\n  const [groups, setGroups] = useState(() => {\r\n    return editedItem?.groups || []\r\n  });\r\n  const [snackbar, setSnackbar] = useState(null);\r\n  const [qr, setQR] = useState(null);\r\n  const [{response, error}, doApiFetch] = useApi('/day');\r\n  const [receipts, doFnsFetch] = useApi('/day/receipt');\r\n  const [startFetchData, setStartFetchData] = useState(false);\r\n  const [checkReceipt, setCheckReceipt] = useState(false);\r\n  const [deleteItem, setDeleteItem] = useState(false);\r\n  const [statusQuantity, setStatusQuantity] = useState(true);\r\n  const [statusPrice, setStatusPrice] = useState(true);\r\n  // const osname = platform();\r\n\r\n  const onClose = useCallback(() => {\r\n    dispatch({ type: 'UNSET_ERROR'});\r\n    setSnackbar(null);\r\n  }, [dispatch]);\r\n\r\n  /***\r\n   * Подписываемся на события\r\n   */\r\n  useEffect(()=>{\r\n    bridge.subscribe(({ detail: { type, data }}) => {\r\n      switch (type) {\r\n        case 'VKWebAppOpenCodeReaderResult':\r\n          setQR(data.code_data);\r\n          break;\r\n        case 'VKWebAppOpenCodeReaderFailed':\r\n          console.log('add day error', data);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  /***\r\n   * Добавляем данные на сервер\r\n   */\r\n  useEffect(() => {\r\n    if (!startFetchData) return;\r\n    const body = {\r\n      method: 'POST',\r\n      date: date,\r\n      items: [\r\n        {\r\n          name,\r\n          quantity,\r\n          price: price * 100,\r\n          sum: price * 100 * quantity,\r\n          income,\r\n          modifiers: [],\r\n          properties: [],\r\n          description,\r\n          groups,\r\n          canDelete: true,\r\n        }\r\n      ]\r\n    };\r\n\r\n    body.method = editedItem ? 'PUT' : body.method;\r\n    body.method = deleteItem ? 'DELETE' : body.method;\r\n    if (editedItem && editedItem._id) {body.id = editedItem._id}\r\n    doApiFetch(body);\r\n    setEditedItem(null);\r\n    setName('');\r\n    setQuantity(1);\r\n    setIncome(false);\r\n    setPrice('');\r\n    setStartFetchData(false);\r\n    setDescription('');\r\n    setGroups([]);\r\n    setDeleteItem(false);\r\n  }, [startFetchData, setStartFetchData, date, doApiFetch, income, name, price, editedItem, quantity, description, groups, deleteItem]);\r\n\r\n  /**\r\n   * Выводим сообщение об успехе\r\n   */\r\n  useEffect(() => {\r\n    if (!response) return;\r\n    setSnackbar(<CustomSnackBar message={SUCCESS_MESSAGE} isError={false} onClose={onClose}/>)\r\n  }, [response, onClose]);\r\n\r\n  /**\r\n   * Добавление QR кода\r\n   */\r\n  useEffect(() => {\r\n    if (!qr) return;\r\n\r\n    const preparedQR = prepare.qr(qr);\r\n\r\n    if (preparedQR.error) {\r\n      const e = preparedQR.error;\r\n      dispatch({ type: 'SET_ERROR', payload: { error: e }});\r\n      setQR(null);\r\n      setCheckReceipt(false);\r\n      return;\r\n    }\r\n\r\n    const body = {\r\n      method: 'POST',\r\n      ...preparedQR\r\n    }\r\n    doFnsFetch(body);\r\n  }, [qr, doFnsFetch, checkReceipt, dispatch]);\r\n\r\n  /**\r\n   * Костыль. Проверка есть ли тело в ответе от ФНС. Сохраняем чек на сервере\r\n   */\r\n  useEffect(() => {\r\n    if (!receipts.response) return;\r\n    if (receipts.response._id) {\r\n      setSnackbar(<CustomSnackBar message={SUCCESS_MESSAGE} isError={false} onClose={onClose}/>)\r\n      setCheckReceipt(false);\r\n      setQR(null);\r\n    }\r\n  }, [receipts.response, doFnsFetch, qr, onClose]);\r\n\r\n  /**\r\n   * Вывод сообщения об ощибке\r\n   */\r\n  useEffect(() => {\r\n    if (!state.error) return;\r\n    dispatch({\r\n      type: 'SET_ERROR',\r\n      payload: {\r\n        error: receipts.error || error\r\n      }\r\n    })\r\n    setSnackbar(<CustomSnackBar message={state.error.message} isError={true} onClose={onClose}/>);\r\n    setCheckReceipt(false);\r\n    setQR(null);\r\n\r\n  }, [receipts.error, error, dispatch, state.error, onClose]);\r\n\r\n  const popout = (\r\n    <Alert\r\n      actions={[{\r\n        title: 'Отмена',\r\n        autoclose: true,\r\n        mode: 'cancel'\r\n      }, {\r\n        title: 'Заполнить',\r\n        autoclose: true,\r\n        action: () => dispatch({type: 'SET_VIEW', payload: { view: 'profile', panel: 'edit'}})\r\n      }]}\r\n      onClose={() => dispatch({type: 'SET_POPOUT', payload: { popout: null }})}\r\n    >\r\n      <h2>Незаполнен профиль</h2>\r\n      <p>Для сканирования QR кодов и получения детально информации по чекам необходимо заполнить профиль, ввести email, телефон и получить пароль с сервера ФНС.</p>\r\n    </Alert>\r\n  )\r\n\r\n  const deletePopout = (\r\n    <Alert\r\n      actions={\r\n        [{\r\n          title: 'Отмена',\r\n          autoclose: true,\r\n          mode: 'cancel'\r\n        }, {\r\n          title: 'Удалить',\r\n          autoclose: true,\r\n          mode: 'destructive',\r\n          action: () => {\r\n            setDeleteItem(true);\r\n            setStartFetchData(true);\r\n          }\r\n        }]\r\n      }\r\n      onClose={() => dispatch({type: 'SET_POPOUT', payload: { popout: null }})}\r\n    >\r\n      <h2>Подтвердите действие</h2>\r\n      <p>Вы действительно хотите удалить? Удаление пройдет безвозвратно. Отменить операцию будет нельзя.</p>\r\n    </Alert>\r\n  )\r\n\r\n  const dateInput = (editedItem) => {\r\n    if (!editedItem) {\r\n      return (\r\n        <Input\r\n          type={'date'}\r\n          top={'Дата'}\r\n          name={'date'}\r\n          value={date}\r\n          onChange={(e)=>{\r\n            if (!!e.currentTarget.value) {\r\n              setDate(Validation.overDate(e.currentTarget.value));\r\n            }}\r\n          }\r\n        />\r\n      )\r\n      } else {\r\n        return null\r\n      }\r\n  }\r\n\r\n  return(\r\n    <Fragment>\r\n      <PanelHeader\r\n        left={\r\n          <>\r\n          {/*<PanelHeaderButton key={'back'} onClick={(e) => {*/}\r\n          {/*  dispatch({type: 'SET_PANEL', payload: { panel: e.currentTarget.dataset.to}});*/}\r\n          {/*}} data-to={'home'}>{osname === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}</PanelHeaderButton>*/}\r\n          {\r\n            bridge.supports('VKWebAppOpenCodeReader') &&\r\n            <PanelHeaderButton\r\n            key={'qr'}\r\n            data-to={'qr'}\r\n            onClick={() => {\r\n              dispatch({ type: 'UNSET_ERROR'});\r\n              if (!(!!state.currentUser.email && !!state.currentUser.phone && !!state.currentUser.password)) {\r\n                dispatch({type: 'SET_POPOUT', payload: { popout: popout }});\r\n              } else {\r\n                bridge.send('VKWebAppOpenCodeReader', {});\r\n              }\r\n            }}\r\n            ><Icon24Qr /></PanelHeaderButton>\r\n          }\r\n          </>\r\n        }\r\n      >\r\n        {editedItem ? `Редактировать`: 'Добавить'}\r\n      </PanelHeader>\r\n      <FormLayout style={{paddingBottom: 40}}>\r\n        {dateInput(editedItem)}\r\n        <div>\r\n          <Radio name={'income'} value={false} onChange={() => {setIncome(false)}} defaultChecked={!income}>Расход</Radio>\r\n          <Radio name={'income'} value={false} onChange={() => {setIncome(true)}} defaultChecked={income}>Доход</Radio>\r\n        </div>\r\n        <Input\r\n          type={'text'}\r\n          top={'Название'}\r\n          name={'name'}\r\n          value={name}\r\n          onChange={(e)=>{setName(Validation.overSize(e, 20))}}\r\n          bottom={`Введено ${name.length} из 20`}\r\n        />\r\n        <Input\r\n          className={'number-input'}\r\n          type={'number'}\r\n          top={'Количество'}\r\n          name={'quantity'}\r\n          value={quantity}\r\n          onChange={(e)=>{\r\n            setQuantity(Validation.overSize(e, 6));\r\n          }}\r\n          onKeyDown={ (e) => {\r\n            setStatusQuantity(e.target.validity.valid);\r\n            Validation.typeNumber(e)\r\n          } }\r\n          step={'0.01'}\r\n          bottom={!statusQuantity && 'Введите корректное значение'}\r\n          status={!statusQuantity && 'error'}\r\n        />\r\n        <Input\r\n          className={'number-input'}\r\n          type={'number'}\r\n          top={'Цена'}\r\n          name={'price'}\r\n          value={price}\r\n          onChange={(e)=>{\r\n            setPrice(Validation.overSize(e, 6));\r\n          }}\r\n          onKeyDown={ (e) => {\r\n            setStatusPrice(e.target.validity.valid);\r\n            Validation.typeNumber(e)\r\n          } }\r\n          step={'0.01'}\r\n          bottom={!statusPrice && 'Введите корректное значение'}\r\n          status={!statusPrice && 'error'}\r\n        />\r\n        {!income &&\r\n          <Textarea\r\n            top={'Описание'}\r\n            placeholder={'Почему вы потратили на это деньги?'}\r\n            name={'description'}\r\n            value={description}\r\n            onChange={e => setDescription(Validation.overSize(e,50))}\r\n\t\t\t\t\t\tbottom={`Введено ${description.length} из 50`}\r\n          />\r\n        }\r\n        {\r\n          editedItem?.canDelete\r\n          &&\r\n          <Button\r\n            size=\"xl\"\r\n            mode={'destructive'}\r\n            onClick={() => {dispatch({type: 'SET_POPOUT', payload: { popout: deletePopout }})}}\r\n          >\r\n            Удалить {income ? \"доход\" : \"расход\"}\r\n          </Button>\r\n        }\r\n        <FixedLayout className={'fixed-button'} style={{marginBottom: '1em',}} vertical=\"bottom\">\r\n          {\r\n            editedItem\r\n              ?\r\n                <Button\r\n                  size=\"xl\"\r\n                  disabled={!date || !name || !quantity || !price}\r\n                  mode={\"commerce\"}\r\n                  onClick={() => setStartFetchData(true)}\r\n                >\r\n                  Сохранить изменения\r\n                </Button>\r\n              :\r\n                <Button\r\n                  size=\"xl\"\r\n                  disabled={!date || !name || !quantity || !price}\r\n                  mode={\"commerce\"}\r\n                  onClick={() => {\r\n                    setStartFetchData(true)\r\n                  }}\r\n                >\r\n                  Добавить {income ? \"доход\" : \"расход\"}\r\n                </Button>\r\n          }\r\n        </FixedLayout>\r\n      </FormLayout>\r\n      {snackbar}\r\n    </Fragment>\r\n  )\r\n};\r\n\r\nexport default AddDay;","import React from 'react';\r\nimport {List} from \"@vkontakte/vkui\";\r\nimport Receipt from \"./Receipt\";\r\n\r\nconst Modal = ({receipt}) => {\r\n\treturn (\r\n\t\t<List>\r\n\t\t\t<Receipt id={receipt._id} dateTime={receipt.dateTime} items={receipt.items}/>\r\n\t\t</List>\r\n\t)\r\n};\r\n\r\nexport default Modal;","import React, {Fragment} from 'react';\r\nimport {PanelHeader, Placeholder} from '@vkontakte/vkui';\r\n\r\nconst Analytics = () => {\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\tАналитика\r\n\t\t\t</PanelHeader>\r\n\t\t\t<Placeholder>\r\n\t\t\t\tРаздел находится в разработке\r\n\t\t\t</Placeholder>\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Analytics;","import React, {Fragment, useContext, useEffect, useState, useCallback} from 'react';\r\nimport {IOS, Group, PanelHeader, Header, SimpleCell, platform} from '@vkontakte/vkui';\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport Icon28MoneyCircleOutline from '@vkontakte/icons/dist/28/money_circle_outline';\r\n// import Icon28ListOutline from '@vkontakte/icons/dist/28/list_outline';\r\nimport {RouterContext} from \"../contexts/routerContext\";\r\nimport useApi from \"../hooks/useApi\";\r\nimport CustomSnackBar from \"../components/CustomSnackbar\";\r\nimport Icon28UserOutgoingOutline from '@vkontakte/icons/dist/28/user_outgoing_outline';\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\n\r\nconst More = () => {\r\n\tconst [state, dispatch] = useContext(RouterContext);\r\n\tconst [{response, error}, doApiFetch] = useApi('/day');\r\n\tconst osName = platform();\r\n\tconst [date] = useState(() => {\r\n\t\tconst date = new Date();\r\n\t\tconst m = date.getMonth()+1 > 9 ? date.getMonth()+1 : `0${date.getMonth()+1}`;\r\n\t\tconst d = date.getDate() > 9 ? date.getDate() : `0${date.getDate()}`;\r\n\t\treturn `${date.getFullYear()}-${m}-${d}`;\r\n\t\t});\r\n\tconst [snackbar, setSnackbar] = useState(null);\r\n\tconst [, setToken] = useLocalStorage('token');\r\n\r\n\tuseEffect(() => {\r\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\r\n\t\t\tswitch (type) {\r\n\t\t\t\t\tcase 'VKWebAppOpenPayFormResult':\r\n\t\t\t\t\t\tif (data.status) {\r\n\t\t\t\t\t\t\tconsole.log('Платеж успешно совершен');\r\n\t\t\t\t\t\t\tconst body = {\r\n\t\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\t\tdate: date,\r\n\t\t\t\t\t\t\t\titems: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tname: 'Помощь проекту Balance',\r\n\t\t\t\t\t\t\t\t\t\tquantity: 1,\r\n\t\t\t\t\t\t\t\t\t\tprice: data.amount * 100,\r\n\t\t\t\t\t\t\t\t\t\tsum: data.amount * 100,\r\n\t\t\t\t\t\t\t\t\t\tincome: false,\r\n\t\t\t\t\t\t\t\t\t\tmodifiers: [],\r\n\t\t\t\t\t\t\t\t\t\tproperties: [{transactionId: data.transaction_id}],\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tdoApiFetch(body);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'VKWebAppOpenPayFormFailed':\r\n\t\t\t\t\t\tconsole.log('profile error', data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\tconst onClose = useCallback(() => {\r\n\t\tdispatch({ type: 'UNSET_ERROR'});\r\n\t\tsetSnackbar(null);\r\n\t\t}, [dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tsetSnackbar(<CustomSnackBar message={'Спасибо за помощь проекту!'} isError={false} onClose={onClose}/>)\r\n\t\t}, [response, onClose]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!state.error) return;\r\n\t\tdispatch({\r\n\t\t\ttype: 'SET_ERROR',\r\n\t\t\tpayload: {\r\n\t\t\t\terror: error\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\tsetSnackbar(<CustomSnackBar message={state.error.message} isError={true} onClose={onClose}/>);\r\n\t\t}, [error, dispatch, state.error, onClose]);\r\n\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>\r\n\t\t\t\tДополнительно\r\n\t\t\t</PanelHeader>\r\n\t\t\t{\r\n\t\t\t\tosName !== IOS \r\n\t\t\t\t&&\r\n\t\t\t\t<Group>\r\n\t\t\t\t\t<Header mode={'secondary'}>Помощь проекту</Header>\r\n\t\t\t\t\t<SimpleCell\r\n\t\t\t\t\t\texpandable\r\n\t\t\t\t\t\tbefore={<Icon28MoneyCircleOutline />}\r\n\t\t\t\t\t\tonClick = {() => {\r\n\t\t\t\t\t\t\tbridge.send(\"VKWebAppOpenPayForm\", {\r\n\t\t\t\t\t\t\t\t\"app_id\": +process.env.REACT_APP_ID,\r\n\t\t\t\t\t\t\t\t\"action\": \"pay-to-user\",\r\n\t\t\t\t\t\t\t\t\"params\": {\r\n\t\t\t\t\t\t\t\t\t\"amount\": 100,\r\n\t\t\t\t\t\t\t\t\t\"description\": \"На кофе разработчику\",\r\n\t\t\t\t\t\t\t\t\t\"user_id\": +process.env.REACT_APP_USER_ID\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t\tНа кофе разработчику\r\n\t\t\t\t\t</SimpleCell>\r\n\t\t\t\t</Group>\r\n\t\t\t}\r\n\t\t<Group>\r\n\t\t\t<Header mode={'secondary'}>Управление аккаунтом</Header>\r\n\t\t\t<SimpleCell\r\n\t\t\t\texpandable\r\n\t\t\t\tbefore={<Icon28UserOutgoingOutline />}\r\n\t\t\t\tonClick={() => {\r\n\t\t\t\t\tdispatch({type: 'LOGOUT'});\r\n\t\t\t\t\tsetToken('');\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\tВыйти\r\n\t\t\t</SimpleCell>\r\n\t\t</Group>\r\n\t\t{snackbar}\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default More;\r\n","import React, {Fragment, useEffect, useState, useReducer} from 'react';\r\nimport {\r\n\tPanelHeader,\r\n\tFixedLayout,\r\n\tGroup,\r\n\tRichCell,\r\n\tButton, Input, Separator, PanelHeaderButton, SimpleCell, Switch\r\n} from '@vkontakte/vkui';\r\nimport useApi from \"../hooks/useApi\";\r\nimport Icon28EditOutline from '@vkontakte/icons/dist/28/edit_outline';\r\nimport Icon16Cancel from '@vkontakte/icons/dist/16/cancel';\r\nimport Icon24Filter from '@vkontakte/icons/dist/24/filter';\r\n\r\nconst initialState = {\r\n\tcatalog: [],\r\n\tfilteredCatalog: [],\r\n\tcatalogToSave: new Set(),\r\n\tfilterItems: [],\r\n\teditedElementId: '',\r\n\topenFilter: false,\r\n\tfilterRules: []\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'SET_CATALOG':\r\n\r\n\t\t\tconst filteredCatalogAfterResponse = state.filterRules.map((rule) => {\r\n\t\t\t\treturn state.catalog.filter((item) => {\r\n\t\t\t\t\treturn item.definition === rule && item;\r\n\t\t\t\t});\r\n\t\t\t}).flat();\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tcatalog: action.payload.catalog,\r\n\t\t\t\tfilteredCatalog: filteredCatalogAfterResponse && filteredCatalogAfterResponse.length > 0 ? filteredCatalogAfterResponse : action.payload.catalog,\r\n\t\t\t\tfilterRules: filteredCatalogAfterResponse && filteredCatalogAfterResponse.length > 0 ? state.filterRules : [],\r\n\t\t\t\tcatalogToSave: new Set(),\r\n\t\t\t\teditedElementId: ''\r\n\t\t\t}\r\n\t\tcase 'SET_EDITED_ELEMENT':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\teditedElementId: action.payload.id\r\n\t\t\t}\r\n\t\tcase 'FILL_SAVE_CATALOG':\r\n\t\t\tlet element;\r\n\t\t\tconst index = state.catalog.findIndex((item) => {\r\n\t\t\t\treturn item._id === action.payload.id;\r\n\t\t\t});\r\n\t\t\tif (action.payload.definition) {\r\n\t\t\t\telement = state.catalog[index];\r\n\t\t\t\telement.definition = action.payload.definition;\r\n\t\t\t}\r\n\t\t\tconst set = new Set(state.catalogToSave);\r\n\t\t\tset.add(element);\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tcatalogToSave: set\r\n\t\t\t}\r\n\t\tcase 'ERASE_FILTER_RULES':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tfilterRules: [],\r\n\t\t\t\topenFilter: false,\r\n\t\t\t\tfilteredCatalog: state.catalog\r\n\t\t\t}\r\n\t\tcase 'SET_FILTER_ITEMS':\r\n\t\t\tconst filterItems = state.catalog.map(item => {\r\n\t\t\t\treturn item.definition ? item.definition : '*Нет расшифровки';\r\n\t\t\t}).reduce((uniq, item) => {\r\n\t\t\t\treturn uniq.includes(item) ? uniq : [ ...uniq, item ];\r\n\t\t\t}, []);\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tfilterItems\r\n\t\t\t}\r\n\t\tcase 'SET_FILTER_RULES':\r\n\t\t\tlet rules = state.filterRules;\r\n\t\t\tlet filteredCatalog = state.filterRules.length > 0 ? state.filteredCatalog : [];\r\n\t\t\tif (action.payload.checked) {\r\n\t\t\t\trules = [...rules, action.payload.definition];\r\n\t\t\t\tconst filterByRule = state.catalog.filter((item) => {\r\n\t\t\t\t\treturn item.definition === action.payload.definition;\r\n\t\t\t\t});\r\n\t\t\t\tfilteredCatalog = [...filteredCatalog, ...filterByRule];\r\n\t\t\t} else {\r\n\t\t\t\trules.splice(rules.findIndex((item) => item === action.payload.definition), 1);\r\n\t\t\t\tfilteredCatalog = rules.map((rule) => {\r\n\t\t\t\t\treturn state.catalog.filter((item) => {\r\n\t\t\t\t\t\treturn item.definition === rule && item;\r\n\t\t\t\t\t});\r\n\t\t\t\t}).flat();\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tfilteredCatalog,\r\n\t\t\t\tfilterRules: rules\r\n\t\t\t}\r\n\t\tcase 'OPEN_FILTER':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\topenFilter: true\r\n\t\t\t}\r\n\t\tcase 'CLOSE_FILTER':\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\topenFilter: false\r\n\t\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nconst Catalog = () => {\r\n\tconst [state, dispatch] = useReducer(reducer, initialState);\r\n\tconst [updateStr, setUpdateStr] = useState('');\r\n\tconst [{response}, doApiFetch] = useApi(`/catalog${updateStr}`);\r\n\tconst [initialFetch, setInitialFetch] = useState(true);\r\n\tconst [action] = useState('get');\r\n\r\n\tconst catalogList = state.filteredCatalog.map((item, i) => {\r\n\t\treturn (\r\n\t\t\t<Fragment key={i}>\r\n\t\t\t\t<RichCell\r\n\t\t\t\t\tdata-id={item._id}\r\n\t\t\t\t\tmultiline\r\n\t\t\t\t\tcaption={item.name}\r\n\t\t\t\t\tafter={<Icon28EditOutline />}\r\n\t\t\t\t\tbottom={\r\n\t\t\t\t\t\tstate.editedElementId === item._id\r\n\t\t\t\t\t\t&&\r\n\t\t\t\t\t\t<Input\r\n\t\t\t\t\t\t\tid={state.editedElementId}\r\n\t\t\t\t\t\t\ttype={'text'}\r\n\t\t\t\t\t\t\tdefaultValue={item.definition}\r\n\t\t\t\t\t\t\tplaceholder={'Введите расшифровку'}\r\n\t\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\t\tdispatch({type: 'FILL_SAVE_CATALOG', payload: {id: state.editedElementId, definition: e.target.value}})\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\tdispatch({type: 'SET_EDITED_ELEMENT', payload: {id: e.currentTarget.dataset.id}});\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tactions={\r\n\t\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t\t<Button disabled style={{display: 'none'}}><Icon16Cancel /></Button>\r\n\t\t\t\t\t\t\t<Button disabled style={{display: 'none'}} mode={'secondary'}><Icon16Cancel /></Button>\r\n\t\t\t\t\t\t</Fragment>\r\n\t\t\t\t\t}>\r\n\t\t\t\t\t<b>{item.definition ? item.definition : 'Нет расшифровки'}</b>\r\n\t\t\t\t</RichCell>\r\n\t\t\t</Fragment>\r\n\t\t)\r\n\t});\r\n\r\n\tconst filterList = state.filterItems.map((item, i) => {\r\n\t\tconst defaultChecked = item !== '*Нет расшифровки' ? state.filterRules.includes(item) : state.filterRules.includes(undefined);\r\n\t\treturn(\r\n\t\t\t<SimpleCell key={i} after={<Switch data-definition={item} onChange={(e) => {\r\n\t\t\t\tconst {definition} = e.currentTarget.dataset;\r\n\t\t\t\tconst {checked} = e.currentTarget;\r\n\t\t\t\tdispatch({type: 'SET_FILTER_RULES', payload: {checked, definition: definition !== '*Нет расшифровки' ? definition : undefined}})\r\n\t\t\t}\r\n\t\t\t} defaultChecked={defaultChecked}/>}>{item}</SimpleCell>\r\n\t\t)\r\n\t});\r\n\r\n\t/**\r\n\t * Задаем фокус на элементе\r\n\t */\r\n\tuseEffect(() => {\r\n\t\tif(!state.editedElementId) return;\r\n\t\tdocument.getElementById(state.editedElementId).focus();\r\n\t},[state.editedElementId]);\r\n\r\n\t/**\r\n\t * Обращение к api\r\n\t */\r\n\tuseEffect(() => {\r\n\t\tif (!updateStr && !initialFetch) return;\r\n\r\n\t\tconst body = {};\r\n\t\tif (initialFetch) {\r\n\t\t\tbody.params = { a: action }\r\n\t\t}\r\n\t\tif (updateStr) {\r\n\t\t\tbody.method = 'PUT';\r\n\t\t\tbody.update = [...state.catalogToSave];\r\n\t\t}\r\n\t\tdoApiFetch(body);\r\n\t}, [updateStr, state.catalogToSave, doApiFetch, initialFetch, action]);\r\n\r\n\t/**\r\n\t * Обрабатываем результат запроса\r\n\t */\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\t\tdispatch({type: 'SET_CATALOG', payload: {catalog: response}});\r\n\t\tdispatch({type: 'SET_FILTER_ITEMS'})\r\n\t\tsetUpdateStr('');\r\n\t\tsetInitialFetch(false);\r\n\t}, [response]);\r\n\r\n\tconst style = {\r\n\t\tpaddingTop: state.filterRules.length !== 0 && 60,\r\n\t\tpaddingBottom: ([...state.catalogToSave].length !== 0 || (state.filterRules.length !== 0 && state.openFilter)) && 60\r\n\t}\r\n\r\n\tconst fixedLayoutStyle = {\r\n\t\tpaddingRight: 10,\r\n\t\tpaddingLeft: 10,\r\n\t\tmarginBottom: '1em',\r\n\t\tmarginTop: '1em',\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader\r\n\t\t\t\tleft={<PanelHeaderButton onClick={() => {\r\n\t\t\t\t\tif (!state.openFilter) {\r\n\t\t\t\t\t\tdispatch({type: 'OPEN_FILTER'});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdispatch({type: 'CLOSE_FILTER'})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}}><Icon24Filter /></PanelHeaderButton>}\r\n\t\t\t>\r\n\t\t\t\t{!state.openFilter ? 'Справочник' : 'Фильтр'}\r\n\t\t\t</PanelHeader>\r\n\t\t\t<Group style={style}>\r\n\t\t\t\t{!state.openFilter ? catalogList : filterList}\r\n\t\t\t</Group>\r\n\r\n\t\t\t{state.filterRules.length !== 0 && <FixedLayout style={fixedLayoutStyle} vertical=\"top\">\r\n\t\t\t\t<Separator wide/>\r\n\t\t\t\t<Button mode=\"destructive\" size={'xl'} onClick={() => {dispatch({type: 'ERASE_FILTER_RULES'})}}>Сбросить фильтр</Button>\r\n\t\t\t</FixedLayout>}\r\n\r\n\t\t\t{[...state.catalogToSave].length !== 0 && <FixedLayout style={fixedLayoutStyle} vertical=\"bottom\">\r\n\t\t\t\t<Separator wide/>\r\n\t\t\t\t<Button mode=\"commerce\" size={'xl'} onClick={() => {setUpdateStr('/update')}}>Сохранить изменения</Button>\r\n\t\t\t</FixedLayout>}\r\n\r\n\t\t\t{state.filterRules.length !== 0 && state.openFilter && <FixedLayout style={fixedLayoutStyle} vertical=\"bottom\">\r\n\t\t\t\t<Separator wide/>\r\n\t\t\t\t<Button mode=\"commerce\" size={'xl'} onClick={() => {dispatch({type: 'CLOSE_FILTER'})}}>Применить фильтр</Button>\r\n\t\t\t</FixedLayout>}\r\n\r\n\t\t</Fragment>\r\n\t)\r\n};\r\n\r\nexport default Catalog;\r\n","import React, { useReducer, useEffect, Fragment } from 'react';\r\nimport {Checkbox, FixedLayout, FormLayout, Group, Input, PanelHeader, Placeholder, SimpleCell} from \"@vkontakte/vkui\";\r\nimport Icon28DeleteOutline from '@vkontakte/icons/dist/28/delete_outline';\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\nimport Button from \"@vkontakte/vkui/dist/components/Button/Button\";\r\nimport Validation from \"../handlers/validation\";\r\nimport './styles.css';\r\n\r\nconst initialState = {\r\n\tshoppingList: [],\r\n\tshoppingItem: {\r\n\t\ttext: '',\r\n\t\tdone: false\r\n\t},\r\n\tdate: new Date()\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'INITIAL_SHOPPING_LIST': {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tshoppingList: action.payload.list,\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'SET_SHOPPING_ITEM': {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tshoppingItem: {\r\n\t\t\t\t\ttext: action.payload.text,\r\n\t\t\t\t\tdone: false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'ADD_ITEM': {\r\n\t\t\tconst {shoppingList} = state;\r\n\t\t\tif (state.shoppingItem.text) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tshoppingList: [...shoppingList, state.shoppingItem],\r\n\t\t\t\t\tshoppingItem: {\r\n\t\t\t\t\t\ttext: '',\r\n\t\t\t\t\t\tdone: false\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn state\r\n\t\t\t}\r\n\t\t}\r\n\t\tcase 'DELETE_ITEM': {\r\n\t\t\tconst { shoppingList } = state;\r\n\t\t\tshoppingList.splice(action.payload.index, 1);\r\n\t\t\tif (shoppingList.length === 0) {\r\n\t\t\t\tlocalStorage.removeItem('shoppingList');\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tshoppingList\r\n\t\t\t};\r\n\t\t}\r\n\t\tcase 'SET_DONE': {\r\n\t\t\tconst {shoppingList} = state;\r\n\t\t\tshoppingList[action.payload.index].done = !shoppingList[action.payload.index].done;\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tshoppingList\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n}\r\n\r\nconst ShoppingList = () => {\r\n\tconst [list, setList] = useLocalStorage('shoppingList', JSON.stringify([]));\r\n\tconst [state, dispatch] = useReducer(reducer, initialState);\r\n\tconst shoppingList = state.shoppingList.map((item, index) => {\r\n\t\treturn(\r\n\t\t\t<SimpleCell key={index} after={<Icon28DeleteOutline data-index={index} onClick={(e) => {dispatch({type: 'DELETE_ITEM', payload: {index: e.currentTarget.dataset.index}})}} />}>\r\n\t\t\t\t<Checkbox\r\n\t\t\t\t\tdefaultChecked={item.done}\r\n\t\t\t\t\tdata-index={index}\r\n\t\t\t\t\tstyle={{textDecoration: item.done && 'line-through'}}\r\n\t\t\t\t\tonChange={\r\n\t\t\t\t\t\t(e) => {\r\n\t\t\t\t\t\t\tdispatch({type: 'SET_DONE', payload: {index: e.currentTarget.dataset.index}})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t>\r\n\t\t\t\t\t{item.text}\r\n\t\t\t\t</Checkbox>\r\n\t\t\t</SimpleCell>\r\n\t\t)\r\n\t});\r\n\tuseEffect(() => {\r\n\t\tdispatch({type: 'INITIAL_SHOPPING_LIST', payload: { list: JSON.parse(list)}});\r\n\t}, [list]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (state.shoppingList.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsetList(JSON.stringify(state.shoppingList));\r\n\t}, [setList, state]);\r\n\r\n\treturn(\r\n\t\t<Fragment>\r\n\t\t\t<PanelHeader>Список покупок</PanelHeader>\r\n\t\t\t<FormLayout\r\n\t\t\t\tonSubmit={(e) => {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tdispatch({type: 'ADD_ITEM'});\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<Input\r\n\t\t\t\t\ttype={'text'}\r\n\t\t\t\t\ttop={'Название'}\r\n\t\t\t\t\tname={'shopping-item'}\r\n\t\t\t\t\tvalue={state.shoppingItem.text}\r\n\t\t\t\t\tonChange={(e) => {dispatch({type: 'SET_SHOPPING_ITEM', payload: {text: Validation.overSize(e, 20)}})}}\r\n\t\t\t\t\tbottom={`Введено ${state.shoppingItem.text.length || 0} из 20`}\r\n\t\t\t\t\tplaceholder={'Введите название'}\r\n\t\t\t\t/>\r\n\t\t\t\t<FixedLayout className={'fixed-button'} style={{marginBottom: '1em'}} vertical=\"bottom\">\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\tsize=\"xl\"\r\n\t\t\t\t\t\tdisabled={!state.shoppingItem.text}\r\n\t\t\t\t\t\tmode={\"commerce\"}\r\n\t\t\t\t\t\tonClick={() => dispatch({type: 'ADD_ITEM'})}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tДобавить\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</FixedLayout>\r\n\t\t\t</FormLayout>\r\n\t\t\t<Group>\r\n\t\t\t\t{ state.shoppingList.length > 0\r\n\t\t\t\t\t?\r\n\t\t\t\t\tshoppingList\r\n\t\t\t\t\t:\r\n\t\t\t\t\t<Placeholder>\r\n\t\t\t\t\t\t<p>Ваш список покупок пуст.</p>\r\n\t\t\t\t\t\t<p>Заполните Ваш список и <strong>обязательно</strong> воспользуйтесь им в магазине.</p>\r\n\t\t\t\t\t\tДля добавления элемента введите название и нажмите кнопку \"Добавить\"\r\n\t\t\t\t\t</Placeholder>\r\n\t\t\t\t}\r\n\t\t\t</Group>\r\n\r\n\t\t</Fragment>\r\n\t)\r\n}\r\n\r\nexport default ShoppingList;\r\n","import React, {useContext, useState, useEffect, useCallback} from 'react';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport {Panel, View, platform, ModalRoot, ModalPage, ModalPageHeader, IOS, Epic, Tabbar, TabbarItem} from \"@vkontakte/vkui\";\r\nimport Authorization from \"./panels/Authorization\";\r\nimport Profile from \"./panels/Profile\";\r\nimport {RouterContext} from \"./contexts/routerContext\";\r\nimport Balance from \"./panels/Balance\";\r\nimport AddDay from \"./panels/AddDay\";\r\nimport Modal from \"./components/Modal\";\r\nimport PanelHeaderButton from \"@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton\";\r\nimport prepare from \"./handlers/prepare\";\r\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\r\nimport Icon24Dismiss from '@vkontakte/icons/dist/24/dismiss';\r\nimport Icon28MarketOutline from '@vkontakte/icons/dist/28/market_outline';\r\nimport Icon28More from '@vkontakte/icons/dist/28/more';\r\nimport Icon28UserOutline from '@vkontakte/icons/dist/28/user_outline';\r\nimport Icon28AddSquareOutline from '@vkontakte/icons/dist/28/add_square_outline';\r\nimport Icon28ListOutline from '@vkontakte/icons/dist/28/list_outline';\r\nimport Analytics from \"./panels/Analytics\";\r\nimport More from \"./panels/More\";\r\nimport Catalog from \"./panels/Catalog\";\r\nimport ShoppingList from \"./panels/ShoppingList\";\r\n\r\nconst App = () => {\r\n\tconst [state, dispatch] = useContext(RouterContext);\r\n\tconst [activeModal, setActiveModal] = useState(null);\r\n\tconst [modal, setModal] = useState(null);\r\n\tconst [receipt, setReceipt] = useState(null);\r\n\r\n\tconst modalBack = useCallback(() => {\r\n\t\tdispatch({type: 'HIDE_MODAL'});\r\n\t\t// setActiveModal(null);\r\n\t}, [dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\twindow.onpopstate = e => {\r\n\t\t\tdispatch({type: 'SET_VIEW', payload: {panel: e.state.panel, view: e.state.view}});\r\n\t\t}\r\n\t}, [dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!receipt) return;\r\n\t\tconst osName = platform();\r\n\t\tsetModal(\r\n\t\t\t<ModalRoot activeModal={state.modal} onClose={modalBack}>\r\n\t\t\t\t<ModalPage\r\n\t\t\t\t\tid={'modal-page'}\r\n\t\t\t\t\tonClose={modalBack}\r\n\t\t\t\t\theader={\r\n\t\t\t\t\t\t<ModalPageHeader\r\n\t\t\t\t\t\t\tleft={osName !== IOS && <PanelHeaderButton onClick={modalBack}><Icon24Cancel /></PanelHeaderButton>}\r\n\t\t\t\t\t\t\tright={osName === IOS && <PanelHeaderButton onClick={modalBack}>{osName === IOS ? 'Готово' : <Icon24Dismiss />}</PanelHeaderButton>}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{prepare.date(receipt.dateTime)}\r\n\t\t\t\t\t\t</ModalPageHeader>\r\n\t\t\t\t\t}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Modal onClose={modalBack} receipt={receipt}/>\r\n\t\t\t\t</ModalPage>\r\n\t\t\t</ModalRoot>\r\n\t\t);\r\n\t}, [receipt, activeModal, modalBack, state.modal]);\r\n\r\n\tconst onStoryChange = (e) => {\r\n\t\tdispatch({type: 'SET_VIEW', payload: { view: e.currentTarget.dataset.story, panel: e.currentTarget.dataset.panel}});\r\n\t}\r\n\r\n\tconst tb = state.currentUser && (<Tabbar>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={state.view === 'balance' && state.panel === 'balance.home'}\r\n\t\t\tdata-story=\"balance\"\r\n\t\t\tdata-panel={'home'}\r\n\t\t\ttext=\"Баланс\"\r\n\t\t><Icon28MarketOutline /></TabbarItem>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={state.view === 'list'}\r\n\t\t\tdata-story=\"list\"\r\n\t\t\tdata-panel={'list'}\r\n\t\t\ttext=\"Покупки\"\r\n\t\t><Icon28ListOutline /></TabbarItem>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={state.view === 'balance' && state.panel === 'balance.add'}\r\n\t\t\tdata-story=\"balance\"\r\n\t\t\tdata-panel=\"add\"\r\n\t\t\ttext=\"Добавить\"\r\n\t\t><Icon28AddSquareOutline /></TabbarItem>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={state.view === 'profile'}\r\n\t\t\tdata-story=\"profile\"\r\n\t\t\tdata-panel={'edit'}\r\n\t\t\ttext=\"Профиль\"\r\n\t\t><Icon28UserOutline /></TabbarItem>\r\n\t\t<TabbarItem\r\n\t\t\tonClick={onStoryChange}\r\n\t\t\tselected={state.view === 'more'}\r\n\t\t\tdata-story=\"more\"\r\n\t\t\tdata-panel={'more'}\r\n\t\t\ttext=\"Ещё\"\r\n\t\t><Icon28More /></TabbarItem>\r\n\t</Tabbar>)\r\n\r\n\treturn (\r\n\t\t<Epic activeStory={state.view}\r\n\t\t\t\t\ttabbar={tb}\r\n\t\t>\r\n\t\t\t<View id={'authorization'} activePanel={state.panel} popout={state.popout}>\r\n\t\t\t\t<Panel id={'authorization.login'}>\r\n\t\t\t\t\t<Authorization type={'login'} />\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'authorization.register'}>\r\n\t\t\t\t\t<Authorization type={'register'} />\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'authorization.restore'}>\r\n\t\t\t\t\t<Authorization type={'restore'} />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'profile'} activePanel={state.panel} popout={state.popout}>\r\n\t\t\t\t<Panel id={'profile.edit'}>\r\n\t\t\t\t\t<Profile />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'balance'} activePanel={state.panel} popout={state.popout} modal={modal}>\r\n\t\t\t\t<Panel id={'balance.home'}>\r\n\t\t\t\t\t<Balance\r\n\t\t\t\t\t\tsetReceiptFromBalance={setReceipt}\r\n\t\t\t\t\t\tonClickActiveModal={setActiveModal}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'balance.add'}>\r\n\t\t\t\t\t<AddDay item={state.item} />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'analytics'} activePanel={state.panel} popout={state.popout}>\r\n\t\t\t\t<Panel id={'analytics.home'}>\r\n\t\t\t\t\t<Analytics />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'more'} activePanel={state.panel} popout={state.popout}>\r\n\t\t\t\t<Panel id={'more.more'}>\r\n\t\t\t\t\t<More />\r\n\t\t\t\t</Panel>\r\n\t\t\t\t<Panel id={'more.catalog'}>\r\n\t\t\t\t\t<Catalog />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t\t<View id={'list'} activePanel={state.panel} popout={state.popout}>\r\n\t\t\t\t<Panel id={'list.list'}>\r\n\t\t\t\t\t<ShoppingList />\r\n\t\t\t\t</Panel>\r\n\t\t\t</View>\r\n\t\t</Epic>\r\n\t);\r\n};\r\n\r\nexport default App;\r\n","import React, { createContext, useState } from 'react';\r\n\r\nexport const CurrentUserContext = createContext([{}, p => {}]);\r\n\r\nexport const CurrentUserProvider = ({ children }) => {\r\n\tconst [state, setState] = useState({\r\n\t\tisLoading: false,\r\n\t\tisLoggedIn: null,\r\n\t\tcurrentUser: null\r\n\t});\r\n\treturn (\r\n\t\t<CurrentUserContext.Provider value={[state, setState]}>\r\n\t\t\t{children}\r\n\t\t</CurrentUserContext.Provider>\r\n\t)\r\n};\r\n","import { useContext, useEffect } from 'react';\r\nimport useCompareSign from \"../hooks/useCompareSign\";\r\nimport {RouterContext} from \"./routerContext\";\r\n\r\nexport const AppSign = ({ children }) => {\r\n  const [, dispatch] = useContext(RouterContext);\r\n  const [{vkUserId, matchUrlParams}, setParams] = useCompareSign();\r\n\r\n  useEffect(()=>{\r\n    setParams(window.location.search.slice(1));\r\n  }, [setParams]);\r\n\r\n  useEffect(() => {\r\n    if (!vkUserId) return;\r\n    dispatch({type: 'SET_VK_USER', payload: { id: vkUserId, match: matchUrlParams }});\r\n  }, [vkUserId, matchUrlParams, dispatch]);\r\n\r\n  return children;\r\n};","import { useState, useEffect } from 'react';\r\nimport qs from 'querystring';\r\nimport crypto from 'crypto';\r\n\r\nexport default () => {\r\n\tconst [urlParams, setUrlParams] = useState('');\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [vkUserId, setVkUserId] = useState(null);\r\n\tconst [matchUrlParams, setMatch] = useState(false);\r\n\r\n\tconst setParams = (urlParams = '') => {\r\n\t\tsetUrlParams(urlParams);\r\n\t\tsetIsLoading(true);\r\n\t};\r\n\r\n\tuseEffect(() =>{\r\n\t\tif( !isLoading ) return;\r\n\r\n\t\tconst params = qs.parse(urlParams);\r\n\r\n\t\tif (!params) return;\r\n\r\n\t\tsetVkUserId(params.vk_user_id);\r\n\r\n\t\tconst ordered = {};\r\n\t\tObject.keys(params).sort().forEach((key) => {\r\n\t\t\tif (key.slice(0, 3) === 'vk_') {\r\n\t\t\t\tordered[key] = params[key];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst stringParams = qs.stringify(ordered);\r\n\t\tconst paramsHash = crypto\r\n\t\t\t.createHmac('sha256', process.env.REACT_APP_VK)\r\n\t\t\t.update(stringParams)\r\n\t\t\t.digest()\r\n\t\t\t.toString('base64')\r\n\t\t\t.replace(/\\+/g, '-')\r\n\t\t\t.replace(/\\//g, '_')\r\n\t\t\t.replace(/=$/, '');\r\n\r\n\t\tsetMatch(paramsHash === params.sign);\r\n\t}, [isLoading, urlParams]);\r\n\r\n\treturn [{vkUserId, matchUrlParams}, setParams];\r\n}","import { useEffect, useContext } from 'react';\r\nimport useApi from \"../hooks/useApi\";\r\nimport { RouterContext } from \"../contexts/routerContext\";\r\nimport useLocalStorage from \"../hooks/useLocalStorage\";\r\n\r\nconst CurrentUserChecker = ({ children }) => {\r\n\tconst [{response}, doFetch] = useApi('/users/profile');\r\n\tconst [findUser, doFindFetch] = useApi('/users/find')\r\n\tconst [state, dispatch] = useContext(RouterContext);\r\n\tconst [token] = useLocalStorage('token');\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!token && state.vkUser.matchUrlParams && state.vkUser.id) {\r\n\t\t\tdoFindFetch({\r\n\t\t\t\tparams: {\r\n\t\t\t\t\tid: state.vkUser.id\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tdispatch({type: 'SHOW_LOADING'});\r\n\t\t}\r\n\t}, [token, state.vkUser.matchUrlParams, state.vkUser.id, dispatch, doFindFetch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!findUser.response) return;\r\n\t\tif (findUser.response.result) {\r\n\t\t\tdispatch({type: 'SET_VIEW', payload: { view: 'authorization', panel: 'login'}})\r\n\t\t} else {\r\n\t\t\tdispatch({type: 'SET_VIEW', payload: { view: 'authorization', panel: 'register'}})\r\n\t\t}\r\n\t\tdispatch({type: 'HIDE_LOADING'});\r\n\t}, [findUser.response, dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!token || !state.vkUser.matchUrlParams) {\r\n\t\t\tdispatch({type: 'SET_USER', payload: { user: null, isLoggedIn: false}});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdoFetch();\r\n\t\tdispatch({type: 'SHOW_LOADING'});\r\n\t}, [doFetch, token, state.vkUser.matchUrlParams, dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) return;\r\n\r\n\t\tconst user = response.user.vk_id.toString() === state.vkUser.id ? response.user : null;\r\n\r\n\t\tdispatch({type: 'SET_USER', payload: { user: user, isLoggedIn: !!user}});\r\n\r\n\t}, [response, state.vkUser.id, dispatch ]);\r\n\treturn children;\r\n};\r\n\r\nexport default CurrentUserChecker;\r\n","import 'core-js/features/map';\r\nimport 'core-js/features/set';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport App from './App';\r\nimport {CurrentUserProvider} from \"./contexts/currentUser\";\r\nimport {AppSign} from \"./contexts/appSign\";\r\nimport CurrentUserChecker from \"./components/CurrentUserChecker\";\r\nimport {RouterContextProvider} from \"./contexts/routerContext\";\r\n// import InstallingTheme from \"./components/InstallingTheme\";\r\n// import * as eruda from 'eruda';\r\n// import registerServiceWorker from './sw';\r\n\r\n// const el = document.createElement('div');\r\n// document.body.appendChild(el);\r\n//\r\n// eruda.init({\r\n//   container: el,\r\n//   tool: ['console', 'elements']\r\n// });\r\n\r\nbridge.subscribe(({ detail: { type, data }}) => {\r\n\tif (type === 'VKWebAppUpdateConfig') {\r\n\t\tconst schemeAttribute = document.createAttribute('scheme');\r\n\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\r\n\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\r\n\t}\r\n});\r\n\r\n// Init VK  Mini App\r\nbridge.send('VKWebAppInit');\r\n\r\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\r\n// расскомментируйте строку с registerServiceWorker();\r\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\r\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\r\n// registerServiceWorker();\r\n\r\nwindow.onload = () => {\r\n\tReactDOM.render(\r\n\t\t// <InstallingTheme>\r\n\r\n\t\t\t<RouterContextProvider>\r\n\t\t\t\t<AppSign>\r\n\t\t\t\t\t<CurrentUserProvider>\r\n\t\t\t\t\t\t<CurrentUserChecker>\r\n\t\t\t\t\t\t\t<App/>\r\n\r\n\t\t\t\t\t\t</CurrentUserChecker>\r\n\t\t\t\t\t</CurrentUserProvider>\r\n\t\t\t\t</AppSign>\r\n\t\t\t</RouterContextProvider>\r\n\r\n\t\t// </InstallingTheme>\r\n\t\t,\r\n\t\tdocument.getElementById('root')\r\n\t);\r\n};\r\n"],"sourceRoot":""}